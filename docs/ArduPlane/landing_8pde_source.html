<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>APM:Plane: ArduPlane/landing.pde Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">APM:Plane
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_3410184b0f66c19589d6f580ccb2cc44.html">ArduPlane</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">landing.pde</div>  </div>
</div><!--header-->
<div class="contents">
<a href="landing_8pde.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  landing logic</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  update navigation for landing. Called when on landing approach or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">  final flare</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="landing_8pde.html#a76d7ac00bf1a68b5db464de185d44847">   11</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="landing_8pde.html#a76d7ac00bf1a68b5db464de185d44847">verify_land</a>()</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;{</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="comment">// we don&#39;t &#39;verify&#39; landing in the sense that it never completes,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="comment">// so we don&#39;t verify command completion. Instead we use this to</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="comment">// adjust final landing parameters</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="comment">// If a go around has been commanded, we are done landing.  This will send</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="comment">// the mission to the next mission item, which presumably is a mission</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="comment">// segment with operations to perform when a landing is called off.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">// If there are no commands after the land waypoint mission item then</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// the plane will proceed to loiter about its home point.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.commanded_go_around) {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    }</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordtype">float</span> height = <a class="code" href="altitude_8pde.html#a617593e837e2b32ef1cfe5ffb7323742">height_above_target</a>();</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// use rangefinder to correct if possible</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    height -= <a class="code" href="altitude_8pde.html#a7211323b4aa90b65767c2b0df3f2871e">rangefinder_correction</a>();</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// calculate the sink rate.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordtype">float</span> sink_rate;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classVector3.html">Vector3f</a> vel;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a1dd6e7a686eba47cb054c1fa5f01084d">ahrs</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__AHRS.html#a964855631b6a020e36e3913f51d448d7">get_velocity_NED</a>(vel)) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        sink_rate = vel.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a> &amp;&amp; <a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#ac7d2e0692095207a6ff19072dcac9ef6">have_vertical_velocity</a>()) {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        sink_rate = <a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a8b36acdc5098b3f77e28ec640b438fbd">velocity</a>().<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        sink_rate = -<a class="code" href="ArduPlane_8pde.html#a878e6c2ca2a501e59b25efe16eda17c6">barometer</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Baro.html#afd63ca7ecadb313c2217bd9f7e6a7b42">get_climb_rate</a>();        </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// low pass the sink rate to take some of the noise out</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_sink_rate = 0.8f * <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_sink_rate + 0.2f*sink_rate;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">/* Set land_complete (which starts the flare) under 3 conditions:</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">       1) we are within LAND_FLARE_ALT meters of the landing altitude</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">       2) we are within LAND_FLARE_SEC of the landing point vertically</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">          by the calculated sink rate (if LAND_FLARE_SEC != 0)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">       3) we have gone past the landing point and don&#39;t have</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">          rangefinder data (to prevent us keeping throttle on </span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">          after landing if we&#39;ve had positive baro drift)</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (height &lt;= <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a30442de748ed8ca4cb47e9380dac94ab">land_flare_alt</a> ||</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        (<a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#a876469e88bb7229f56d8cc5be85b6a47">land_flare_sec</a> &gt; 0 &amp;&amp; height &lt;= <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_sink_rate * <a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#a876469e88bb7229f56d8cc5be85b6a47">land_flare_sec</a>) ||</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        (!<a class="code" href="ArduPlane_8pde.html#ac4c7b5e534a39298eaafb51f2c20c2d5">rangefinder_state</a>.in_range &amp;&amp; <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#ab6cd880d070717b4c3cc7a7278768e72">location_passed_point</a>(<a class="code" href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a>, <a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>)) ||</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        (<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(<a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_sink_rate) &lt; 0.2f &amp;&amp; !<a class="code" href="ArduPlane_8pde.html#a911cf724de5ec5104eb7e22550674d05">is_flying</a>())) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_complete) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="ArduPlane_8pde.html#a911cf724de5ec5104eb7e22550674d05">is_flying</a>() &amp;&amp; (<a class="code" href="ArduPlane_8pde.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.scheduler-&gt;millis()-<a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.last_flying_ms) &gt; 3000) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                <a class="code" href="ArduPlane_8pde.html#a7df79fd15233ca04f776c27b69d2e184">gcs_send_text_fmt</a>(<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Progmem__AVR_8h.html#a05ca900ebf7cd121be73c654d9ccb3eb">PSTR</a>(<span class="stringliteral">&quot;Flare crash detected: speed=%.1f&quot;</span>), (<span class="keywordtype">double</span>)<a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a426041563da447ec6e9cde1926a88fdb">ground_speed</a>());</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                <a class="code" href="ArduPlane_8pde.html#a7df79fd15233ca04f776c27b69d2e184">gcs_send_text_fmt</a>(<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Progmem__AVR_8h.html#a05ca900ebf7cd121be73c654d9ccb3eb">PSTR</a>(<span class="stringliteral">&quot;Flare %.1fm sink=%.2f speed=%.1f&quot;</span>), </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                        (<span class="keywordtype">double</span>)height, (<span class="keywordtype">double</span>)<a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_sink_rate, (<span class="keywordtype">double</span>)<a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a426041563da447ec6e9cde1926a88fdb">ground_speed</a>());</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_complete = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a426041563da447ec6e9cde1926a88fdb">ground_speed</a>() &lt; 3) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="comment">// reload any airspeed or groundspeed parameters that may have</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="comment">// been set for landing. We don&#39;t do this till ground</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <span class="comment">// speed drops below 3.0 m/s as otherwise we will change</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="comment">// target speeds too early.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a6ec8ccf1a7e28125c7f5205f0bed2d76">airspeed_cruise_cm</a>.load();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#ac5ab64dfa28355311a9a63e3458aae37">min_gndspeed_cm</a>.load();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#a9aa0578c8a97b6bb874e5a01c2dc2c7d">throttle_cruise</a>.load();</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">      when landing we keep the L1 navigation waypoint 200m ahead. This</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">      prevents sudden turns if we overshoot the landing point</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keyword">struct </span><a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html">Location</a> land_WP_loc = <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    int32_t land_bearing_cd = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#a224e7b94333df3a15a18499026474ac9">get_bearing_cd</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a>(land_WP_loc,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                    land_bearing_cd*0.01<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                    <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a>) + 200);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ace6a581dca1a4d257db10eeb39135bef">nav_controller</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Navigation.html#acbff1d37eab53cfb052773759a27148c">update_waypoint</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, land_WP_loc);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// check if we should auto-disarm after a confirmed landing</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="landing_8pde.html#a1df24c8c6568cbc8c72b7406283bf068">disarm_if_autoland_complete</a>();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">      we return false as a landing mission item never completes</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">      we stay on this waypoint unless the GCS commands us to change</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">      mission item or reset the mission, or a go-around is commanded</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">    If land_DisarmDelay is enabled (non-zero), check for a landing then auto-disarm after time expires</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="landing_8pde.html#a1df24c8c6568cbc8c72b7406283bf068">  105</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="landing_8pde.html#a1df24c8c6568cbc8c72b7406283bf068">disarm_if_autoland_complete</a>()</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;{</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a7703b450ba91537897e6fe821a93e31b">land_disarm_delay</a> &gt; 0 &amp;&amp; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.land_complete &amp;&amp; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        !<a class="code" href="ArduPlane_8pde.html#a911cf724de5ec5104eb7e22550674d05">is_flying</a>() &amp;&amp; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a6af09530fac2ca87866857b084e01961">arming</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Arming.html#a4701a9f5154ee86ca4e108ff1f56ed60">arming_required</a>() != <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Arming.html#a6bb0adda63d9aa22135d5d8e07c2c0ebab9fbfd3aa98fa4164fab9ba558e8e24e">AP_Arming::NO</a> &amp;&amp;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a6af09530fac2ca87866857b084e01961">arming</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Arming.html#aededf89cac3010c297fcef7e8b38e99a">is_armed</a>()) {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">/* we have auto disarm enabled. See if enough time has passed */</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.scheduler-&gt;millis() - <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.last_flying_ms &gt;= <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a7703b450ba91537897e6fe821a93e31b">land_disarm_delay</a>*1000UL) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="system_8pde.html#a685b5c02e09ee2ded2177289d3a90c19">disarm_motors</a>()) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                <a class="code" href="GCS__Mavlink_8pde.html#a6bb153355507cf625bc0de5dfa76c137">gcs_send_text_P</a>(<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/GCS__MAVLink_8h.html#a9d31f489fa85fc474fd9cb87558f77a4ab9579632d898bdffa8c673258aab740d">SEVERITY_LOW</a>,<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Progmem__AVR_8h.html#a05ca900ebf7cd121be73c654d9ccb3eb">PSTR</a>(<span class="stringliteral">&quot;Auto-Disarmed&quot;</span>));</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">  a special glide slope calculation for the landing approach</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">  During the land approach use a linear glide slope to a point</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">  projected through the landing point. We don&#39;t use the landing point</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">  itself as that leads to discontinuities close to the landing point,</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">  which can lead to erratic pitch control</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="landing_8pde.html#ad4c51ac657cf5884a07f0eb547b8c135">  131</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="landing_8pde.html#ad4c51ac657cf5884a07f0eb547b8c135">setup_landing_glide_slope</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html">Location</a> loc = <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="comment">// project a point 500 meters past the landing point, passing</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="comment">// through the landing point</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> land_projection = 500;        </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        int32_t land_bearing_cd = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#a224e7b94333df3a15a18499026474ac9">get_bearing_cd</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordtype">float</span> total_distance = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// height we need to sink for this WP</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordtype">float</span> sink_height = (<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>)*0.01<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">// current ground speed</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordtype">float</span> groundspeed = <a class="code" href="ArduPlane_8pde.html#a1dd6e7a686eba47cb054c1fa5f01084d">ahrs</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__AHRS.html#a4fe7afbe3deb970c4708f4821b029842">groundspeed</a>();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">if</span> (groundspeed &lt; 0.5<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            groundspeed = 0.5f;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">// calculate time to lose the needed altitude</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordtype">float</span> sink_time = total_distance / groundspeed;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span> (sink_time &lt; 0.5<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            sink_time = 0.5f;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">// find the sink rate needed for the target location</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordtype">float</span> sink_rate = sink_height / sink_time;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// the height we aim for is the one to give us the right flare point</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordtype">float</span> aim_height = <a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#a876469e88bb7229f56d8cc5be85b6a47">land_flare_sec</a> * sink_rate;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span> (aim_height &lt;= 0) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            aim_height = <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a30442de748ed8ca4cb47e9380dac94ab">land_flare_alt</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        } </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="comment">// don&#39;t allow the aim height to be too far above LAND_FLARE_ALT</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a30442de748ed8ca4cb47e9380dac94ab">land_flare_alt</a> &gt; 0 &amp;&amp; aim_height &gt; <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a30442de748ed8ca4cb47e9380dac94ab">land_flare_alt</a>*2) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            aim_height = <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a30442de748ed8ca4cb47e9380dac94ab">land_flare_alt</a>*2;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">// time before landing that we will flare</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordtype">float</span> flare_time = aim_height / <a class="code" href="ArduPlane_8pde.html#ad4274413edfc982b49d5c34f7e0cbaf6">SpdHgt_Controller</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__SpdHgtControl.html#acdec9eb799a7f640130a28deee68d81e">get_land_sinkrate</a>();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">// distance to flare is based on ground speed, adjusted as we</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">// get closer. This takes into account the wind</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordtype">float</span> flare_distance = groundspeed * flare_time;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment">// don&#39;t allow the flare before half way along the final leg</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> (flare_distance &gt; total_distance/2) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            flare_distance = total_distance/2;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">// now calculate our aim point, which is before the landing</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">// point and above it</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a>(loc, land_bearing_cd*0.01<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, -flare_distance);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        loc.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> += aim_height*100;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// calculate slope to landing point</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordtype">float</span> land_slope = (sink_height - aim_height) / total_distance;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// calculate point along that slope 500m ahead</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a>(loc, land_bearing_cd*0.01f, land_projection);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        loc.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> -= land_slope * land_projection * 100;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment">// setup the offset_cm for set_target_altitude_proportion()</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="ArduPlane_8pde.html#af8237ee8f6f26cdc2ef344d3e5f8a14f">target_altitude</a>.offset_cm = loc.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">// calculate the proportion we are to the target</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordtype">float</span> land_proportion = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#ab0ccbafe7e2809759eea8d45d23e4ba0">location_path_proportion</a>(<a class="code" href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a>, <a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, loc);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// now setup the glide slope for landing</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <a class="code" href="altitude_8pde.html#a959640f9ebe33459ea8eb28205de7bcc">set_target_altitude_proportion</a>(loc, 1.0f - land_proportion);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// stay within the range of the start and end locations in altitude</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <a class="code" href="altitude_8pde.html#a07cefa9abd921adeca207556fbc4bc84">constrain_target_altitude_location</a>(loc, <a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;}</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">   find the nearest landing sequence starting point (DO_LAND_START) and</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">   switch to that mission item.  Returns false if no DO_LAND_START</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">   available.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="landing_8pde.html#a53286296e984291837fff41ec8c10038">  212</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="landing_8pde.html#a53286296e984291837fff41ec8c10038">jump_to_landing_sequence</a>(<span class="keywordtype">void</span>) </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    uint16_t land_idx = <a class="code" href="ArduPlane_8pde.html#a4ca9908869f03c8499bb30e8cae3ccc0">mission</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Mission.html#af895b228640bdf29178d44e00897d10e">get_landing_sequence_start</a>();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">if</span> (land_idx != 0) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a4ca9908869f03c8499bb30e8cae3ccc0">mission</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Mission.html#ac79a188f81816b3ddfe045b6a0feb6d1">set_current_cmd</a>(land_idx)) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <a class="code" href="system_8pde.html#afe59c30399d04a968780503b2fc09ff7">set_mode</a>(<a class="code" href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485aeef9468d1b98bca652a04bf5063fd9d6">AUTO</a>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="comment">//if the mission has ended it has to be restarted</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a4ca9908869f03c8499bb30e8cae3ccc0">mission</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Mission.html#a4bc7e12deaf6a4c8ea5c327efb32ed49">state</a>() == <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Mission.html#a68eaa6fc9442be7b95fc1d87337059fda24300b0b325f230b107e46302d4d0b7e">AP_Mission::MISSION_STOPPED</a>) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                <a class="code" href="ArduPlane_8pde.html#a4ca9908869f03c8499bb30e8cae3ccc0">mission</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Mission.html#af7b8e9db68a2a858e2ecca8d57c2722e">resume</a>();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <a class="code" href="GCS__Mavlink_8pde.html#a6bb153355507cf625bc0de5dfa76c137">gcs_send_text_P</a>(<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/GCS__MAVLink_8h.html#a9d31f489fa85fc474fd9cb87558f77a4ab9579632d898bdffa8c673258aab740d">SEVERITY_LOW</a>, <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Progmem__AVR_8h.html#a05ca900ebf7cd121be73c654d9ccb3eb">PSTR</a>(<span class="stringliteral">&quot;Landing sequence begun.&quot;</span>));</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        }            </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="GCS__Mavlink_8pde.html#a6bb153355507cf625bc0de5dfa76c137">gcs_send_text_P</a>(<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/GCS__MAVLink_8h.html#a9d31f489fa85fc474fd9cb87558f77a4acf348521b48d5bf3ed3c9b5dd11d6a8b">SEVERITY_HIGH</a>, <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Progmem__AVR_8h.html#a05ca900ebf7cd121be73c654d9ccb3eb">PSTR</a>(<span class="stringliteral">&quot;Unable to start landing sequence.&quot;</span>));</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">  the height above field elevation that we pass to TECS</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="landing_8pde.html#a35e1e6d17726c2d04e346bec271f9564">  236</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="landing_8pde.html#a35e1e6d17726c2d04e346bec271f9564">tecs_hgt_afe</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">      pass the height above field elevation as the height above</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">      the ground when in landing, which means that TECS gets the</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">      rangefinder information and thus can know when the flare is</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">      coming.</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">float</span> hgt_afe;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a1cccc69e02eadc57c64068bb6b06dd56">flight_stage</a> == <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__SpdHgtControl.html#a1ec6db052615972956026e2aaf14638ea1faf5d19d33de8f5f0fecdabf7186900">AP_SpdHgtControl::FLIGHT_LAND_FINAL</a> ||</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a1cccc69e02eadc57c64068bb6b06dd56">flight_stage</a> == <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__SpdHgtControl.html#a1ec6db052615972956026e2aaf14638eaf05d7a5bd035efdab9b300e411ac6307">AP_SpdHgtControl::FLIGHT_LAND_APPROACH</a>) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        hgt_afe = <a class="code" href="altitude_8pde.html#a617593e837e2b32ef1cfe5ffb7323742">height_above_target</a>();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        hgt_afe -= <a class="code" href="altitude_8pde.html#a7211323b4aa90b65767c2b0df3f2871e">rangefinder_correction</a>();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment">// when in normal flight we pass the hgt_afe as relative</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">// altitude to home</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        hgt_afe = <a class="code" href="altitude_8pde.html#aca1d34c92891d51ed07e6d136b5ea532">relative_altitude</a>();</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> hgt_afe;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div>
<div class="ttc" id="classAP__Baro_html_afd63ca7ecadb313c2217bd9f7e6a7b42"><div class="ttname"><a href="../libraries/classAP__Baro.html#afd63ca7ecadb313c2217bd9f7e6a7b42">AP_Baro::get_climb_rate</a></div><div class="ttdeci">float get_climb_rate(void)</div></div>
<div class="ttc" id="altitude_8pde_html_a959640f9ebe33459ea8eb28205de7bcc"><div class="ttname"><a href="altitude_8pde.html#a959640f9ebe33459ea8eb28205de7bcc">set_target_altitude_proportion</a></div><div class="ttdeci">static void set_target_altitude_proportion(const Location &amp;loc, float proportion)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00254">altitude.pde:254</a></div></div>
<div class="ttc" id="system_8pde_html_a685b5c02e09ee2ded2177289d3a90c19"><div class="ttname"><a href="system_8pde.html#a685b5c02e09ee2ded2177289d3a90c19">disarm_motors</a></div><div class="ttdeci">static bool disarm_motors(void)</div><div class="ttdef"><b>Definition:</b> <a href="system_8pde_source.html#l00755">system.pde:755</a></div></div>
<div class="ttc" id="classAP__SpdHgtControl_html_acdec9eb799a7f640130a28deee68d81e"><div class="ttname"><a href="../libraries/classAP__SpdHgtControl.html#acdec9eb799a7f640130a28deee68d81e">AP_SpdHgtControl::get_land_sinkrate</a></div><div class="ttdeci">virtual float get_land_sinkrate(void) const =0</div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a9aa0578c8a97b6bb874e5a01c2dc2c7d"><div class="ttname"><a href="../libraries/structAP__Vehicle_1_1FixedWing.html#a9aa0578c8a97b6bb874e5a01c2dc2c7d">AP_Vehicle::FixedWing::throttle_cruise</a></div><div class="ttdeci">AP_Int8 throttle_cruise</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a878e6c2ca2a501e59b25efe16eda17c6"><div class="ttname"><a href="ArduPlane_8pde.html#a878e6c2ca2a501e59b25efe16eda17c6">barometer</a></div><div class="ttdeci">static AP_Baro barometer</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00198">ArduPlane.pde:198</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a224e7b94333df3a15a18499026474ac9"><div class="ttname"><a href="../libraries/AP__Math_8h.html#a224e7b94333df3a15a18499026474ac9">get_bearing_cd</a></div><div class="ttdeci">int32_t get_bearing_cd(const struct Location &amp;loc1, const struct Location &amp;loc2)</div></div>
<div class="ttc" id="classAP__Arming_html_a6bb0adda63d9aa22135d5d8e07c2c0ebab9fbfd3aa98fa4164fab9ba558e8e24e"><div class="ttname"><a href="../libraries/classAP__Arming.html#a6bb0adda63d9aa22135d5d8e07c2c0ebab9fbfd3aa98fa4164fab9ba558e8e24e">AP_Arming::NO</a></div></div>
<div class="ttc" id="classAP__SpdHgtControl_html_a1ec6db052615972956026e2aaf14638eaf05d7a5bd035efdab9b300e411ac6307"><div class="ttname"><a href="../libraries/classAP__SpdHgtControl.html#a1ec6db052615972956026e2aaf14638eaf05d7a5bd035efdab9b300e411ac6307">AP_SpdHgtControl::FLIGHT_LAND_APPROACH</a></div></div>
<div class="ttc" id="landing_8pde_html_a35e1e6d17726c2d04e346bec271f9564"><div class="ttname"><a href="landing_8pde.html#a35e1e6d17726c2d04e346bec271f9564">tecs_hgt_afe</a></div><div class="ttdeci">static float tecs_hgt_afe(void)</div><div class="ttdef"><b>Definition:</b> <a href="landing_8pde_source.html#l00236">landing.pde:236</a></div></div>
<div class="ttc" id="classAP__Navigation_html_acbff1d37eab53cfb052773759a27148c"><div class="ttname"><a href="../libraries/classAP__Navigation.html#acbff1d37eab53cfb052773759a27148c">AP_Navigation::update_waypoint</a></div><div class="ttdeci">virtual void update_waypoint(const struct Location &amp;prev_WP, const struct Location &amp;next_WP)=0</div></div>
<div class="ttc" id="altitude_8pde_html_a7211323b4aa90b65767c2b0df3f2871e"><div class="ttname"><a href="altitude_8pde.html#a7211323b4aa90b65767c2b0df3f2871e">rangefinder_correction</a></div><div class="ttdeci">static float rangefinder_correction(void)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00524">altitude.pde:524</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a33b9ffa210192904d7f146ba2513220b"><div class="ttname"><a href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a></div><div class="ttdeci">static struct Location current_loc</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00682">ArduPlane.pde:682</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_ab864bd6cf3b07836fa57d87e16cdbf71"><div class="ttname"><a href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a></div><div class="ttdeci">static struct @7 auto_state</div></div>
<div class="ttc" id="GCS__MAVLink_8h_html_a9d31f489fa85fc474fd9cb87558f77a4ab9579632d898bdffa8c673258aab740d"><div class="ttname"><a href="../libraries/GCS__MAVLink_8h.html#a9d31f489fa85fc474fd9cb87558f77a4ab9579632d898bdffa8c673258aab740d">SEVERITY_LOW</a></div></div>
<div class="ttc" id="classAP__GPS_html_a8b36acdc5098b3f77e28ec640b438fbd"><div class="ttname"><a href="../libraries/classAP__GPS.html#a8b36acdc5098b3f77e28ec640b438fbd">AP_GPS::velocity</a></div><div class="ttdeci">const Vector3f &amp; velocity(uint8_t instance) const </div></div>
<div class="ttc" id="classParameters_html_a6ec8ccf1a7e28125c7f5205f0bed2d76"><div class="ttname"><a href="classParameters.html#a6ec8ccf1a7e28125c7f5205f0bed2d76">Parameters::airspeed_cruise_cm</a></div><div class="ttdeci">AP_Int32 airspeed_cruise_cm</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00442">Parameters.h:442</a></div></div>
<div class="ttc" id="classParameters_html_a7703b450ba91537897e6fe821a93e31b"><div class="ttname"><a href="classParameters.html#a7703b450ba91537897e6fe821a93e31b">Parameters::land_disarm_delay</a></div><div class="ttdeci">AP_Int8 land_disarm_delay</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00445">Parameters.h:445</a></div></div>
<div class="ttc" id="classParameters_html_a30442de748ed8ca4cb47e9380dac94ab"><div class="ttname"><a href="classParameters.html#a30442de748ed8ca4cb47e9380dac94ab">Parameters::land_flare_alt</a></div><div class="ttdeci">AP_Float land_flare_alt</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00444">Parameters.h:444</a></div></div>
<div class="ttc" id="GCS__MAVLink_8h_html_a9d31f489fa85fc474fd9cb87558f77a4acf348521b48d5bf3ed3c9b5dd11d6a8b"><div class="ttname"><a href="../libraries/GCS__MAVLink_8h.html#a9d31f489fa85fc474fd9cb87558f77a4acf348521b48d5bf3ed3c9b5dd11d6a8b">SEVERITY_HIGH</a></div></div>
<div class="ttc" id="classAP__Mission_html_a4bc7e12deaf6a4c8ea5c327efb32ed49"><div class="ttname"><a href="../libraries/classAP__Mission.html#a4bc7e12deaf6a4c8ea5c327efb32ed49">AP_Mission::state</a></div><div class="ttdeci">mission_state state() const </div></div>
<div class="ttc" id="classAP__GPS_html_ac7d2e0692095207a6ff19072dcac9ef6"><div class="ttname"><a href="../libraries/classAP__GPS.html#ac7d2e0692095207a6ff19072dcac9ef6">AP_GPS::have_vertical_velocity</a></div><div class="ttdeci">bool have_vertical_velocity(uint8_t instance) const </div></div>
<div class="ttc" id="AP__Math_8h_html_ab6cd880d070717b4c3cc7a7278768e72"><div class="ttname"><a href="../libraries/AP__Math_8h.html#ab6cd880d070717b4c3cc7a7278768e72">location_passed_point</a></div><div class="ttdeci">bool location_passed_point(const struct Location &amp;location, const struct Location &amp;point1, const struct Location &amp;point2)</div></div>
<div class="ttc" id="classAP__SpdHgtControl_html_a1ec6db052615972956026e2aaf14638ea1faf5d19d33de8f5f0fecdabf7186900"><div class="ttname"><a href="../libraries/classAP__SpdHgtControl.html#a1ec6db052615972956026e2aaf14638ea1faf5d19d33de8f5f0fecdabf7186900">AP_SpdHgtControl::FLIGHT_LAND_FINAL</a></div></div>
<div class="ttc" id="landing_8pde_html_a53286296e984291837fff41ec8c10038"><div class="ttname"><a href="landing_8pde.html#a53286296e984291837fff41ec8c10038">jump_to_landing_sequence</a></div><div class="ttdeci">static bool jump_to_landing_sequence(void)</div><div class="ttdef"><b>Definition:</b> <a href="landing_8pde_source.html#l00212">landing.pde:212</a></div></div>
<div class="ttc" id="classAP__GPS_html_a426041563da447ec6e9cde1926a88fdb"><div class="ttname"><a href="../libraries/classAP__GPS.html#a426041563da447ec6e9cde1926a88fdb">AP_GPS::ground_speed</a></div><div class="ttdeci">float ground_speed(uint8_t instance) const </div></div>
<div class="ttc" id="landing_8pde_html_a1df24c8c6568cbc8c72b7406283bf068"><div class="ttname"><a href="landing_8pde.html#a1df24c8c6568cbc8c72b7406283bf068">disarm_if_autoland_complete</a></div><div class="ttdeci">static void disarm_if_autoland_complete()</div><div class="ttdef"><b>Definition:</b> <a href="landing_8pde_source.html#l00105">landing.pde:105</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ab0ccbafe7e2809759eea8d45d23e4ba0"><div class="ttname"><a href="../libraries/AP__Math_8h.html#ab0ccbafe7e2809759eea8d45d23e4ba0">location_path_proportion</a></div><div class="ttdeci">float location_path_proportion(const struct Location &amp;location, const struct Location &amp;point1, const struct Location &amp;point2)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a911cf724de5ec5104eb7e22550674d05"><div class="ttname"><a href="ArduPlane_8pde.html#a911cf724de5ec5104eb7e22550674d05">is_flying</a></div><div class="ttdeci">static bool is_flying(void)</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l01609">ArduPlane.pde:1609</a></div></div>
<div class="ttc" id="landing_8pde_html_a76d7ac00bf1a68b5db464de185d44847"><div class="ttname"><a href="landing_8pde.html#a76d7ac00bf1a68b5db464de185d44847">verify_land</a></div><div class="ttdeci">static bool verify_land()</div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="landing_8pde_source.html#l00011">landing.pde:11</a></div></div>
<div class="ttc" id="GCS__Mavlink_8pde_html_a6bb153355507cf625bc0de5dfa76c137"><div class="ttname"><a href="GCS__Mavlink_8pde.html#a6bb153355507cf625bc0de5dfa76c137">gcs_send_text_P</a></div><div class="ttdeci">static void gcs_send_text_P(gcs_severity severity, const prog_char_t *str)</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Mavlink_8pde_source.html#l01710">GCS_Mavlink.pde:1710</a></div></div>
<div class="ttc" id="altitude_8pde_html_aca1d34c92891d51ed07e6d136b5ea532"><div class="ttname"><a href="altitude_8pde.html#aca1d34c92891d51ed07e6d136b5ea532">relative_altitude</a></div><div class="ttdeci">static float relative_altitude(void)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00117">altitude.pde:117</a></div></div>
<div class="ttc" id="AP__Math__AVR__Compat_8h_html_a3745ca949b1ef9df47fb2f52c2536e68"><div class="ttname"><a href="../libraries/AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a></div><div class="ttdeci">#define fabsf</div></div>
<div class="ttc" id="ArduPlane_8pde_html_af8237ee8f6f26cdc2ef344d3e5f8a14f"><div class="ttname"><a href="ArduPlane_8pde.html#af8237ee8f6f26cdc2ef344d3e5f8a14f">target_altitude</a></div><div class="ttdeci">static struct @9 target_altitude</div></div>
<div class="ttc" id="ArduPlane_8pde_html_aaf9f187190dde6bec231013495948955"><div class="ttname"><a href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a></div><div class="ttdeci">static Parameters g</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00129">ArduPlane.pde:129</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_ac4c7b5e534a39298eaafb51f2c20c2d5"><div class="ttname"><a href="ArduPlane_8pde.html#ac4c7b5e534a39298eaafb51f2c20c2d5">rangefinder_state</a></div><div class="ttdeci">static struct @1 rangefinder_state</div></div>
<div class="ttc" id="classAP__AHRS_html_a4fe7afbe3deb970c4708f4821b029842"><div class="ttname"><a href="../libraries/classAP__AHRS.html#a4fe7afbe3deb970c4708f4821b029842">AP_AHRS::groundspeed</a></div><div class="ttdeci">float groundspeed(void) const </div></div>
<div class="ttc" id="structLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="../libraries/structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div></div>
<div class="ttc" id="ArduPlane_8pde_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="ArduPlane_8pde.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00115">ArduPlane.pde:115</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a1cccc69e02eadc57c64068bb6b06dd56"><div class="ttname"><a href="ArduPlane_8pde.html#a1cccc69e02eadc57c64068bb6b06dd56">flight_stage</a></div><div class="ttdeci">AP_SpdHgtControl::FlightStage flight_stage</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00580">ArduPlane.pde:580</a></div></div>
<div class="ttc" id="altitude_8pde_html_a617593e837e2b32ef1cfe5ffb7323742"><div class="ttname"><a href="altitude_8pde.html#a617593e837e2b32ef1cfe5ffb7323742">height_above_target</a></div><div class="ttdeci">static float height_above_target(void)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00441">altitude.pde:441</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="../libraries/DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a778b4ae07102d0d0c2abb04df700bb5a"><div class="ttname"><a href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a></div><div class="ttdeci">static AP_Vehicle::FixedWing aparm</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00101">ArduPlane.pde:101</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a962e3f0f8682f6dedb5a001a70bdd65e"><div class="ttname"><a href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a></div><div class="ttdeci">static AP_GPS gps</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00193">ArduPlane.pde:193</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_acffa584c42732a9c26e99483d24eb9f9"><div class="ttname"><a href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a></div><div class="ttdeci">static Location next_WP_loc</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00684">ArduPlane.pde:684</a></div></div>
<div class="ttc" id="altitude_8pde_html_a07cefa9abd921adeca207556fbc4bc84"><div class="ttname"><a href="altitude_8pde.html#a07cefa9abd921adeca207556fbc4bc84">constrain_target_altitude_location</a></div><div class="ttdeci">static void constrain_target_altitude_location(const Location &amp;loc1, const Location &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00276">altitude.pde:276</a></div></div>
<div class="ttc" id="classVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="../libraries/classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div></div>
<div class="ttc" id="classAP__Mission_html_ac79a188f81816b3ddfe045b6a0feb6d1"><div class="ttname"><a href="../libraries/classAP__Mission.html#ac79a188f81816b3ddfe045b6a0feb6d1">AP_Mission::set_current_cmd</a></div><div class="ttdeci">bool set_current_cmd(uint16_t index)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a6af09530fac2ca87866857b084e01961"><div class="ttname"><a href="ArduPlane_8pde.html#a6af09530fac2ca87866857b084e01961">arming</a></div><div class="ttdeci">static AP_Arming arming(ahrs, barometer, compass, home_is_set, gcs_send_text_P)</div></div>
<div class="ttc" id="classAP__Mission_html_af895b228640bdf29178d44e00897d10e"><div class="ttname"><a href="../libraries/classAP__Mission.html#af895b228640bdf29178d44e00897d10e">AP_Mission::get_landing_sequence_start</a></div><div class="ttdeci">uint16_t get_landing_sequence_start()</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a4ca9908869f03c8499bb30e8cae3ccc0"><div class="ttname"><a href="ArduPlane_8pde.html#a4ca9908869f03c8499bb30e8cae3ccc0">mission</a></div><div class="ttdeci">AP_Mission mission(ahrs,&amp;start_command_callback,&amp;verify_command_callback,&amp;exit_mission_callback)</div></div>
<div class="ttc" id="classAP__GPS_html_a9093c8cf1d5a78ccd8677229bb314d37"><div class="ttname"><a href="../libraries/classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">AP_GPS::status</a></div><div class="ttdeci">GPS_Status status(uint8_t instance) const </div></div>
<div class="ttc" id="ArduPlane_8pde_html_ace6a581dca1a4d257db10eeb39135bef"><div class="ttname"><a href="ArduPlane_8pde.html#ace6a581dca1a4d257db10eeb39135bef">nav_controller</a></div><div class="ttdeci">static AP_Navigation * nav_controller</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00260">ArduPlane.pde:260</a></div></div>
<div class="ttc" id="system_8pde_html_afe59c30399d04a968780503b2fc09ff7"><div class="ttname"><a href="system_8pde.html#afe59c30399d04a968780503b2fc09ff7">set_mode</a></div><div class="ttdeci">static void set_mode(enum FlightMode mode)</div><div class="ttdef"><b>Definition:</b> <a href="system_8pde_source.html#l00312">system.pde:312</a></div></div>
<div class="ttc" id="classAP__Arming_html_aededf89cac3010c297fcef7e8b38e99a"><div class="ttname"><a href="../libraries/classAP__Arming.html#aededf89cac3010c297fcef7e8b38e99a">AP_Arming::is_armed</a></div><div class="ttdeci">bool is_armed()</div></div>
<div class="ttc" id="classAP__Mission_html_af7b8e9db68a2a858e2ecca8d57c2722e"><div class="ttname"><a href="../libraries/classAP__Mission.html#af7b8e9db68a2a858e2ecca8d57c2722e">AP_Mission::resume</a></div><div class="ttdeci">void resume()</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a8b9a5d50d9220d6f86fb4cc76b139797"><div class="ttname"><a href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a></div><div class="ttdeci">static Location prev_WP_loc</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00680">ArduPlane.pde:680</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a876469e88bb7229f56d8cc5be85b6a47"><div class="ttname"><a href="../libraries/structAP__Vehicle_1_1FixedWing.html#a876469e88bb7229f56d8cc5be85b6a47">AP_Vehicle::FixedWing::land_flare_sec</a></div><div class="ttdeci">AP_Float land_flare_sec</div></div>
<div class="ttc" id="AP__Math_8h_html_ab0e06d28afb9d14043e1938af277396c"><div class="ttname"><a href="../libraries/AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a></div><div class="ttdeci">void location_update(struct Location &amp;loc, float bearing, float distance)</div></div>
<div class="ttc" id="classAP__Arming_html_a4701a9f5154ee86ca4e108ff1f56ed60"><div class="ttname"><a href="../libraries/classAP__Arming.html#a4701a9f5154ee86ca4e108ff1f56ed60">AP_Arming::arming_required</a></div><div class="ttdeci">ArmingRequired arming_required()</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a1dd6e7a686eba47cb054c1fa5f01084d"><div class="ttname"><a href="ArduPlane_8pde.html#a1dd6e7a686eba47cb054c1fa5f01084d">ahrs</a></div><div class="ttdeci">AP_AHRS_DCM ahrs(ins, barometer, gps)</div></div>
<div class="ttc" id="classAP__AHRS_html_a964855631b6a020e36e3913f51d448d7"><div class="ttname"><a href="../libraries/classAP__AHRS.html#a964855631b6a020e36e3913f51d448d7">AP_AHRS::get_velocity_NED</a></div><div class="ttdeci">virtual bool get_velocity_NED(Vector3f &amp;vec) const </div></div>
<div class="ttc" id="landing_8pde_html_ad4c51ac657cf5884a07f0eb547b8c135"><div class="ttname"><a href="landing_8pde.html#ad4c51ac657cf5884a07f0eb547b8c135">setup_landing_glide_slope</a></div><div class="ttdeci">static void setup_landing_glide_slope(void)</div><div class="ttdef"><b>Definition:</b> <a href="landing_8pde_source.html#l00131">landing.pde:131</a></div></div>
<div class="ttc" id="classVector3_html"><div class="ttname"><a href="../libraries/classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="AP__Math_8h_html_aa825a788804b8dd4cf1e3cfb42960a8b"><div class="ttname"><a href="../libraries/AP__Math_8h.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a></div><div class="ttdeci">float get_distance(const struct Location &amp;loc1, const struct Location &amp;loc2)</div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb"><div class="ttname"><a href="../libraries/classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a></div></div>
<div class="ttc" id="classAP__Mission_html_a68eaa6fc9442be7b95fc1d87337059fda24300b0b325f230b107e46302d4d0b7e"><div class="ttname"><a href="../libraries/classAP__Mission.html#a68eaa6fc9442be7b95fc1d87337059fda24300b0b325f230b107e46302d4d0b7e">AP_Mission::MISSION_STOPPED</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_ad4274413edfc982b49d5c34f7e0cbaf6"><div class="ttname"><a href="ArduPlane_8pde.html#ad4274413edfc982b49d5c34f7e0cbaf6">SpdHgt_Controller</a></div><div class="ttdeci">static AP_SpdHgtControl * SpdHgt_Controller</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00263">ArduPlane.pde:263</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a7df79fd15233ca04f776c27b69d2e184"><div class="ttname"><a href="ArduPlane_8pde.html#a7df79fd15233ca04f776c27b69d2e184">gcs_send_text_fmt</a></div><div class="ttdeci">void gcs_send_text_fmt(const prog_char_t *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Mavlink_8pde_source.html#l01727">GCS_Mavlink.pde:1727</a></div></div>
<div class="ttc" id="AP__Progmem__AVR_8h_html_a05ca900ebf7cd121be73c654d9ccb3eb"><div class="ttname"><a href="../libraries/AP__Progmem__AVR_8h.html#a05ca900ebf7cd121be73c654d9ccb3eb">PSTR</a></div><div class="ttdeci">#define PSTR(s)</div></div>
<div class="ttc" id="defines_8h_html_abab3eb875bf63673faa9bb59e58a0485aeef9468d1b98bca652a04bf5063fd9d6"><div class="ttname"><a href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485aeef9468d1b98bca652a04bf5063fd9d6">AUTO</a></div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00060">defines.h:60</a></div></div>
<div class="ttc" id="classParameters_html_ac5ab64dfa28355311a9a63e3458aae37"><div class="ttname"><a href="classParameters.html#ac5ab64dfa28355311a9a63e3458aae37">Parameters::min_gndspeed_cm</a></div><div class="ttdeci">AP_Int32 min_gndspeed_cm</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00446">Parameters.h:446</a></div></div>
<div class="ttc" id="structLocation_html"><div class="ttname"><a href="../libraries/structLocation.html">Location</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 22 2016 15:33:55 for APM:Plane by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
