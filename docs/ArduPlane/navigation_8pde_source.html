<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>APM:Plane: ArduPlane/navigation.pde Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">APM:Plane
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_3410184b0f66c19589d6f580ccb2cc44.html">ArduPlane</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">navigation.pde</div>  </div>
</div><!--header-->
<div class="contents">
<a href="navigation_8pde.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// -*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*-</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// set the nav_controller pointer to the right controller</span></div>
<div class="line"><a name="l00005"></a><span class="lineno"><a class="line" href="navigation_8pde.html#a41cac83c1de66d79acde519f8ba36016">    5</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#a41cac83c1de66d79acde519f8ba36016">set_nav_controller</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;{</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keywordflow">switch</span> ((AP_Navigation::ControllerType)<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#afe6763a69fc900c2a07f79cde055f778">nav_controller</a>.get()) {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <span class="keywordflow">case</span> AP_Navigation::CONTROLLER_L1:</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ace6a581dca1a4d257db10eeb39135bef">nav_controller</a> = &amp;<a class="code" href="ArduPlane_8pde.html#a77753b1f78456153a0acba3279118b3e">L1_controller</a>;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    }</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">  reset the total loiter angle</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="navigation_8pde.html#abb2020b166492828bc0fa1cbdb846588">   17</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#abb2020b166492828bc0fa1cbdb846588">loiter_angle_reset</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;{</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.sum_cd = 0;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.total_cd = 0;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">  update the total angle we have covered in a loiter. Used to support</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">  commands to do N circles of loiter</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="navigation_8pde.html#abf4eb130966fdbd3bbd2e3c71281349d">   27</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#abf4eb130966fdbd3bbd2e3c71281349d">loiter_angle_update</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    int32_t target_bearing_cd = <a class="code" href="ArduPlane_8pde.html#ace6a581dca1a4d257db10eeb39135bef">nav_controller</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Navigation.html#acdb9c5a037fe8707d45ae91138de43eb">target_bearing_cd</a>();</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    int32_t loiter_delta_cd;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.sum_cd == 0) {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <span class="comment">// use 1 cd for initial delta</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        loiter_delta_cd = 1;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        loiter_delta_cd = target_bearing_cd - <a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.old_target_bearing_cd;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.old_target_bearing_cd = target_bearing_cd;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    loiter_delta_cd = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#a35821002985a8e3e526c8ccad9bb9934">wrap_180_cd</a>(loiter_delta_cd);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.sum_cd += loiter_delta_cd * <a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.direction;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//****************************************************************</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// Function that will calculate the desired direction to fly and distance</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//****************************************************************</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="navigation_8pde.html#a5573c39eb2cddb37f77c17128c88eb54">   46</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#a5573c39eb2cddb37f77c17128c88eb54">navigate</a>()</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// allow change of nav controller mid-flight</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="navigation_8pde.html#a41cac83c1de66d79acde519f8ba36016">set_nav_controller</a>();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// do not navigate with corrupt data</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// ---------------------------------</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ArduPlane_8pde.html#a362039c8268af67970f932bedc0bb7bf">have_position</a>) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> == 0) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// waypoint distance from plane</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// ----------------------------</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.wp_distance = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a>(<a class="code" href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.wp_proportion = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#ab0ccbafe7e2809759eea8d45d23e4ba0">location_path_proportion</a>(<a class="code" href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a>, </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                                        <a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// update total loiter angle</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="navigation_8pde.html#abf4eb130966fdbd3bbd2e3c71281349d">loiter_angle_update</a>();</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// control mode specific updates to navigation demands</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// ---------------------------------------------------</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="ArduPlane_8pde.html#a281c9fecc7781fe8c291fbbca573fa5a">update_navigation</a>();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="navigation_8pde.html#a4aefca636333473c7924fe74564efc96">   75</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#a4aefca636333473c7924fe74564efc96">calc_airspeed_errors</a>()</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">float</span> aspeed_cm = <a class="code" href="ArduPlane_8pde.html#a304224bccd737323c9ee5b15cc9149ad">airspeed</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Airspeed.html#ae89e3a7968da5650b306eafaf2d48706">get_airspeed_cm</a>();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// Normal airspeed target</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a> = <a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a6ec8ccf1a7e28125c7f5205f0bed2d76">airspeed_cruise_cm</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// FBW_B airspeed target</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a32d395a28c689e49cbff34d364076ed9">control_mode</a> == <a class="code" href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485a76069e117e0688d8c788806c92b8fb4f">FLY_BY_WIRE_B</a> || </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a32d395a28c689e49cbff34d364076ed9">control_mode</a> == <a class="code" href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485a4c3bb1b37600efcdc5c91861830a3918">CRUISE</a>) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a> = ((int32_t)(<a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">airspeed_max</a> -</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                                        <a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a>) *</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                              <a class="code" href="ArduPlane_8pde.html#af2abeb19c76520d9545edf9f52343a68">channel_throttle</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classRC__Channel.html#aecc4c9d01e139561076e897af1286c0b">control_in</a>) +</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                             ((int32_t)<a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a> * 100);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Set target to current airspeed + ground speed undershoot,</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// but only when this is faster than the target airspeed commanded</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// above.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a32d395a28c689e49cbff34d364076ed9">control_mode</a> &gt;= <a class="code" href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485a76069e117e0688d8c788806c92b8fb4f">FLY_BY_WIRE_B</a> &amp;&amp; (<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#ac5ab64dfa28355311a9a63e3458aae37">min_gndspeed_cm</a> &gt; 0)) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        int32_t min_gnd_target_airspeed = aspeed_cm + <a class="code" href="ArduPlane_8pde.html#a16575e070c77e88e05cb05bdd4d440c4">groundspeed_undershoot</a>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span> (min_gnd_target_airspeed &gt; <a class="code" href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <a class="code" href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a> = min_gnd_target_airspeed;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Bump up the target airspeed based on throttle nudging</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a32d395a28c689e49cbff34d364076ed9">control_mode</a> &gt;= <a class="code" href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485aeef9468d1b98bca652a04bf5063fd9d6">AUTO</a> &amp;&amp; <a class="code" href="ArduPlane_8pde.html#ac505850b865f02506341b3e99ce08c22">airspeed_nudge_cm</a> &gt; 0) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a> += <a class="code" href="ArduPlane_8pde.html#ac505850b865f02506341b3e99ce08c22">airspeed_nudge_cm</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// Apply airspeed limit</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a> &gt; (<a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">airspeed_max</a> * 100))</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a> = (<a class="code" href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">airspeed_max</a> * 100);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// use the TECS view of the target airspeed for reporting, to take</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// account of the landing speed</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="ArduPlane_8pde.html#a30da9e8eb081c5511f1928eeea6f763a">airspeed_error_cm</a> = <a class="code" href="ArduPlane_8pde.html#ad4274413edfc982b49d5c34f7e0cbaf6">SpdHgt_Controller</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__SpdHgtControl.html#aef400289c2cdf6c24d39f3c93b82df37">get_target_airspeed</a>()*100 - aspeed_cm;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="navigation_8pde.html#ad4179c88d519ca32aaabea8ac0fb20eb">  114</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#ad4179c88d519ca32aaabea8ac0fb20eb">calc_gndspeed_undershoot</a>()</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// Use the component of ground speed in the forward direction</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// This prevents flyaway if wind takes plane backwards</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a>) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structVector2.html">Vector2f</a> gndVel = <a class="code" href="ArduPlane_8pde.html#a1dd6e7a686eba47cb054c1fa5f01084d">ahrs</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__AHRS.html#aa2fd48ce0265df723cc8d05bb2150749">groundspeed_vector</a>();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keyword">const</span> <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classMatrix3.html">Matrix3f</a> &amp;rotMat = <a class="code" href="ArduPlane_8pde.html#a1dd6e7a686eba47cb054c1fa5f01084d">ahrs</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__AHRS__DCM.html#ace965389535aa2f3599f21b9f825d2b7">get_dcm_matrix</a>();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structVector2.html">Vector2f</a> yawVect = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structVector2.html">Vector2f</a>(rotMat.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.x,rotMat.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.x);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        yawVect.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/structVector2.html#ace2a626eaa79412e2946216e9c3e63c6">normalize</a>();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordtype">float</span> gndSpdFwd = yawVect * gndVel;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a16575e070c77e88e05cb05bdd4d440c4">groundspeed_undershoot</a> = (<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#ac5ab64dfa28355311a9a63e3458aae37">min_gndspeed_cm</a> &gt; 0) ? (<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#ac5ab64dfa28355311a9a63e3458aae37">min_gndspeed_cm</a> - gndSpdFwd*100) : 0;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;}</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="navigation_8pde.html#a2307c8ad7ff975923da6fbe17c1c28fc">  128</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#a2307c8ad7ff975923da6fbe17c1c28fc">update_loiter</a>()</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;{</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="ArduPlane_8pde.html#ace6a581dca1a4d257db10eeb39135bef">nav_controller</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Navigation.html#a97a9971938227d8e88c267b33e841e0d">update_loiter</a>(<a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>, abs(<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#aa253293b3398aeffe8cac89d76f8d537">loiter_radius</a>), <a class="code" href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a>.direction);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">  handle CRUISE mode, locking heading to GPS course when we have</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">  sufficient ground speed, and no aileron or rudder input</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="navigation_8pde.html#a4d495aace8caa2d8080bea0c27dd3c4c">  137</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#a4d495aace8caa2d8080bea0c27dd3c4c">update_cruise</a>()</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.locked_heading &amp;&amp;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a78cd9699d4ab2011c98c577048f1f79a">channel_roll</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classRC__Channel.html#aecc4c9d01e139561076e897af1286c0b">control_in</a> == 0 &amp;&amp;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a1f6253cc5d0a568caddb00593187e088">rudder_input</a> == 0 &amp;&amp;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a> &amp;&amp;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a426041563da447ec6e9cde1926a88fdb">ground_speed</a>() &gt;= 3 &amp;&amp;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.lock_timer_ms == 0) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// user wants to lock the heading - start the timer</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.lock_timer_ms = <a class="code" href="ArduPlane_8pde.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.scheduler-&gt;millis();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.lock_timer_ms != 0 &amp;&amp;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        (<a class="code" href="ArduPlane_8pde.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.scheduler-&gt;millis() - <a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.lock_timer_ms) &gt; 500) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">// lock the heading after 0.5 seconds of zero heading input</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">// from user</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.locked_heading = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.lock_timer_ms = 0;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.locked_heading_cd = <a class="code" href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__GPS.html#a94caaa8676fecb6c0c4a8a58eea3b106">ground_course_cd</a>();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a> = <a class="code" href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.locked_heading) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a> = <a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// always look 1km ahead</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a>(<a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>,</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                        <a class="code" href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a>.locked_heading_cd*0.01f, </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                        <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a>) + 1000);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ace6a581dca1a4d257db10eeb39135bef">nav_controller</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Navigation.html#acbff1d37eab53cfb052773759a27148c">update_waypoint</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">  handle speed and height control in FBWB or CRUISE mode. </span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">  In this mode the elevator is used to change target altitude. The</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">  throttle is used to change target airspeed or throttle</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="navigation_8pde.html#a0b5c9dfeecbab7c8b57eb2b62cdda33c">  173</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#a0b5c9dfeecbab7c8b57eb2b62cdda33c">update_fbwb_speed_height</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> last_elevator_input;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">float</span> elevator_input;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    elevator_input = <a class="code" href="ArduPlane_8pde.html#abc3609fc6e4c9de229192e19a3554d25">channel_pitch</a>-&gt;<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classRC__Channel.html#aecc4c9d01e139561076e897af1286c0b">control_in</a> / 4500.0f;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a4f689503992a0eb48b91901742700474">flybywire_elev_reverse</a>) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        elevator_input = -elevator_input;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="altitude_8pde.html#ab8083dab6dcaeff9d8150fe04c47185d">change_target_altitude</a>(<a class="code" href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a>.<a class="code" href="classParameters.html#a87062fcd50803f3d48bf4d81bdcb372c">flybywire_climb_rate</a> * elevator_input * <a class="code" href="ArduPlane_8pde.html#aa4a939055af87262bcdcebed06abaa3b">delta_us_fast_loop</a> * 0.0001f);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (is_zero(elevator_input) &amp;&amp; !is_zero(last_elevator_input)) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">// the user has just released the elevator, lock in</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// the current altitude</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <a class="code" href="altitude_8pde.html#a97933d190f6688bcfb0e5f6f9df5383c">set_target_altitude_current</a>();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// check for FBWB altitude limit</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="altitude_8pde.html#a11b3800706ba5d8a81c32c53e5785e4e">check_minimum_altitude</a>();</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="ArduPlane_8pde.html#a37281484783ca6616b08974ea95d3d2c">altitude_error_cm</a> = <a class="code" href="altitude_8pde.html#a26e99e43b17681e3716fef6a71de06b7">calc_altitude_error_cm</a>();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    last_elevator_input = elevator_input;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="Attitude_8pde.html#a5225e5842ebaec48545141f4077351c4">calc_throttle</a>();</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="Attitude_8pde.html#a432b90be495c4f3a40a28fbd20c8cbde">calc_nav_pitch</a>();</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">  calculate the turn angle for the next leg of the mission</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="navigation_8pde.html#a6409561aa9dd027ac95e7110aa5a3e15">  205</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="navigation_8pde.html#a6409561aa9dd027ac95e7110aa5a3e15">setup_turn_angle</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    int32_t next_ground_course_cd = <a class="code" href="ArduPlane_8pde.html#a4ca9908869f03c8499bb30e8cae3ccc0">mission</a>.<a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/classAP__Mission.html#a338b12fad6aa74b9c8a34d65850f6b40">get_next_ground_course_cd</a>(-1);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (next_ground_course_cd == -1) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">// the mission library can&#39;t determine a turn angle, assume 90 degrees</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.next_turn_angle = 90.0f;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">// get the heading of the current leg</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        int32_t ground_course_cd = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#a224e7b94333df3a15a18499026474ac9">get_bearing_cd</a>(<a class="code" href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a>, <a class="code" href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a>);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">// work out the angle we need to turn through</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <a class="code" href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a>.next_turn_angle = <a class="codeRef" doxygen="/home/ac1054/Documents/JSBSim/ardupilot/docs/tags/libraries:../libraries/" href="../libraries/AP__Math_8h.html#a35821002985a8e3e526c8ccad9bb9934">wrap_180_cd</a>(next_ground_course_cd - ground_course_cd) * 0.01f;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}    </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="ttc" id="altitude_8pde_html_ab8083dab6dcaeff9d8150fe04c47185d"><div class="ttname"><a href="altitude_8pde.html#ab8083dab6dcaeff9d8150fe04c47185d">change_target_altitude</a></div><div class="ttdeci">static void change_target_altitude(int32_t change_cm)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00233">altitude.pde:233</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a16575e070c77e88e05cb05bdd4d440c4"><div class="ttname"><a href="ArduPlane_8pde.html#a16575e070c77e88e05cb05bdd4d440c4">groundspeed_undershoot</a></div><div class="ttdeci">static int32_t groundspeed_undershoot</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00433">ArduPlane.pde:433</a></div></div>
<div class="ttc" id="navigation_8pde_html_abb2020b166492828bc0fa1cbdb846588"><div class="ttname"><a href="navigation_8pde.html#abb2020b166492828bc0fa1cbdb846588">loiter_angle_reset</a></div><div class="ttdeci">static void loiter_angle_reset(void)</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00017">navigation.pde:17</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a281c9fecc7781fe8c291fbbca573fa5a"><div class="ttname"><a href="ArduPlane_8pde.html#a281c9fecc7781fe8c291fbbca573fa5a">update_navigation</a></div><div class="ttdeci">static void update_navigation()</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l01416">ArduPlane.pde:1416</a></div></div>
<div class="ttc" id="classAP__Navigation_html_acdb9c5a037fe8707d45ae91138de43eb"><div class="ttname"><a href="../libraries/classAP__Navigation.html#acdb9c5a037fe8707d45ae91138de43eb">AP_Navigation::target_bearing_cd</a></div><div class="ttdeci">virtual int32_t target_bearing_cd(void) const =0</div></div>
<div class="ttc" id="ArduPlane_8pde_html_af2abeb19c76520d9545edf9f52343a68"><div class="ttname"><a href="ArduPlane_8pde.html#af2abeb19c76520d9545edf9f52343a68">channel_throttle</a></div><div class="ttdeci">static RC_Channel * channel_throttle</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00143">ArduPlane.pde:143</a></div></div>
<div class="ttc" id="navigation_8pde_html_a5573c39eb2cddb37f77c17128c88eb54"><div class="ttname"><a href="navigation_8pde.html#a5573c39eb2cddb37f77c17128c88eb54">navigate</a></div><div class="ttdeci">static void navigate()</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00046">navigation.pde:46</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_ad408ccef5e980b02e6b8bfd3059ea79c"><div class="ttname"><a href="ArduPlane_8pde.html#ad408ccef5e980b02e6b8bfd3059ea79c">target_airspeed_cm</a></div><div class="ttdeci">static int32_t target_airspeed_cm</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00412">ArduPlane.pde:412</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a224e7b94333df3a15a18499026474ac9"><div class="ttname"><a href="../libraries/AP__Math_8h.html#a224e7b94333df3a15a18499026474ac9">get_bearing_cd</a></div><div class="ttdeci">int32_t get_bearing_cd(const struct Location &amp;loc1, const struct Location &amp;loc2)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_abc3609fc6e4c9de229192e19a3554d25"><div class="ttname"><a href="ArduPlane_8pde.html#abc3609fc6e4c9de229192e19a3554d25">channel_pitch</a></div><div class="ttdeci">static RC_Channel * channel_pitch</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00142">ArduPlane.pde:142</a></div></div>
<div class="ttc" id="classAP__Navigation_html_acbff1d37eab53cfb052773759a27148c"><div class="ttname"><a href="../libraries/classAP__Navigation.html#acbff1d37eab53cfb052773759a27148c">AP_Navigation::update_waypoint</a></div><div class="ttdeci">virtual void update_waypoint(const struct Location &amp;prev_WP, const struct Location &amp;next_WP)=0</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a33b9ffa210192904d7f146ba2513220b"><div class="ttname"><a href="ArduPlane_8pde.html#a33b9ffa210192904d7f146ba2513220b">current_loc</a></div><div class="ttdeci">static struct Location current_loc</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00682">ArduPlane.pde:682</a></div></div>
<div class="ttc" id="classAP__AHRS__DCM_html_ace965389535aa2f3599f21b9f825d2b7"><div class="ttname"><a href="../libraries/classAP__AHRS__DCM.html#ace965389535aa2f3599f21b9f825d2b7">AP_AHRS_DCM::get_dcm_matrix</a></div><div class="ttdeci">const Matrix3f &amp; get_dcm_matrix(void) const </div></div>
<div class="ttc" id="classRC__Channel_html_aecc4c9d01e139561076e897af1286c0b"><div class="ttname"><a href="../libraries/classRC__Channel.html#aecc4c9d01e139561076e897af1286c0b">RC_Channel::control_in</a></div><div class="ttdeci">int16_t control_in</div></div>
<div class="ttc" id="ArduPlane_8pde_html_ab864bd6cf3b07836fa57d87e16cdbf71"><div class="ttname"><a href="ArduPlane_8pde.html#ab864bd6cf3b07836fa57d87e16cdbf71">auto_state</a></div><div class="ttdeci">static struct @7 auto_state</div></div>
<div class="ttc" id="classMatrix3_html"><div class="ttname"><a href="../libraries/classMatrix3.html">Matrix3</a></div></div>
<div class="ttc" id="classParameters_html_a87062fcd50803f3d48bf4d81bdcb372c"><div class="ttname"><a href="classParameters.html#a87062fcd50803f3d48bf4d81bdcb372c">Parameters::flybywire_climb_rate</a></div><div class="ttdeci">AP_Int8 flybywire_climb_rate</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00389">Parameters.h:389</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a362039c8268af67970f932bedc0bb7bf"><div class="ttname"><a href="ArduPlane_8pde.html#a362039c8268af67970f932bedc0bb7bf">have_position</a></div><div class="ttdeci">static bool have_position</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00404">ArduPlane.pde:404</a></div></div>
<div class="ttc" id="navigation_8pde_html_a4d495aace8caa2d8080bea0c27dd3c4c"><div class="ttname"><a href="navigation_8pde.html#a4d495aace8caa2d8080bea0c27dd3c4c">update_cruise</a></div><div class="ttdeci">static void update_cruise()</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00137">navigation.pde:137</a></div></div>
<div class="ttc" id="classParameters_html_a6ec8ccf1a7e28125c7f5205f0bed2d76"><div class="ttname"><a href="classParameters.html#a6ec8ccf1a7e28125c7f5205f0bed2d76">Parameters::airspeed_cruise_cm</a></div><div class="ttdeci">AP_Int32 airspeed_cruise_cm</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00442">Parameters.h:442</a></div></div>
<div class="ttc" id="navigation_8pde_html_a0b5c9dfeecbab7c8b57eb2b62cdda33c"><div class="ttname"><a href="navigation_8pde.html#a0b5c9dfeecbab7c8b57eb2b62cdda33c">update_fbwb_speed_height</a></div><div class="ttdeci">static void update_fbwb_speed_height(void)</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00173">navigation.pde:173</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_ab774cbd438b0d68da5250de61dca6262"><div class="ttname"><a href="../libraries/structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">AP_Vehicle::FixedWing::airspeed_max</a></div><div class="ttdeci">AP_Int16 airspeed_max</div></div>
<div class="ttc" id="classAP__Airspeed_html_ae89e3a7968da5650b306eafaf2d48706"><div class="ttname"><a href="../libraries/classAP__Airspeed.html#ae89e3a7968da5650b306eafaf2d48706">AP_Airspeed::get_airspeed_cm</a></div><div class="ttdeci">float get_airspeed_cm(void) const </div></div>
<div class="ttc" id="navigation_8pde_html_a41cac83c1de66d79acde519f8ba36016"><div class="ttname"><a href="navigation_8pde.html#a41cac83c1de66d79acde519f8ba36016">set_nav_controller</a></div><div class="ttdeci">static void set_nav_controller(void)</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00005">navigation.pde:5</a></div></div>
<div class="ttc" id="classParameters_html_aa253293b3398aeffe8cac89d76f8d537"><div class="ttname"><a href="classParameters.html#aa253293b3398aeffe8cac89d76f8d537">Parameters::loiter_radius</a></div><div class="ttdeci">AP_Int16 loiter_radius</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00373">Parameters.h:373</a></div></div>
<div class="ttc" id="classAP__AHRS_html_aa2fd48ce0265df723cc8d05bb2150749"><div class="ttname"><a href="../libraries/classAP__AHRS.html#aa2fd48ce0265df723cc8d05bb2150749">AP_AHRS::groundspeed_vector</a></div><div class="ttdeci">virtual Vector2f groundspeed_vector(void)</div></div>
<div class="ttc" id="altitude_8pde_html_a26e99e43b17681e3716fef6a71de06b7"><div class="ttname"><a href="altitude_8pde.html#a26e99e43b17681e3716fef6a71de06b7">calc_altitude_error_cm</a></div><div class="ttdeci">static int32_t calc_altitude_error_cm(void)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00288">altitude.pde:288</a></div></div>
<div class="ttc" id="structLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="../libraries/structLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div></div>
<div class="ttc" id="altitude_8pde_html_a11b3800706ba5d8a81c32c53e5785e4e"><div class="ttname"><a href="altitude_8pde.html#a11b3800706ba5d8a81c32c53e5785e4e">check_minimum_altitude</a></div><div class="ttdeci">static void check_minimum_altitude(void)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00303">altitude.pde:303</a></div></div>
<div class="ttc" id="classAP__Navigation_html_a97a9971938227d8e88c267b33e841e0d"><div class="ttname"><a href="../libraries/classAP__Navigation.html#a97a9971938227d8e88c267b33e841e0d">AP_Navigation::update_loiter</a></div><div class="ttdeci">virtual void update_loiter(const struct Location &amp;center_WP, float radius, int8_t loiter_direction)=0</div></div>
<div class="ttc" id="navigation_8pde_html_abf4eb130966fdbd3bbd2e3c71281349d"><div class="ttname"><a href="navigation_8pde.html#abf4eb130966fdbd3bbd2e3c71281349d">loiter_angle_update</a></div><div class="ttdeci">static void loiter_angle_update(void)</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00027">navigation.pde:27</a></div></div>
<div class="ttc" id="classAP__GPS_html_a426041563da447ec6e9cde1926a88fdb"><div class="ttname"><a href="../libraries/classAP__GPS.html#a426041563da447ec6e9cde1926a88fdb">AP_GPS::ground_speed</a></div><div class="ttdeci">float ground_speed(uint8_t instance) const </div></div>
<div class="ttc" id="classParameters_html_a4f689503992a0eb48b91901742700474"><div class="ttname"><a href="classParameters.html#a4f689503992a0eb48b91901742700474">Parameters::flybywire_elev_reverse</a></div><div class="ttdeci">AP_Int8 flybywire_elev_reverse</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00388">Parameters.h:388</a></div></div>
<div class="ttc" id="defines_8h_html_abab3eb875bf63673faa9bb59e58a0485a76069e117e0688d8c788806c92b8fb4f"><div class="ttname"><a href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485a76069e117e0688d8c788806c92b8fb4f">FLY_BY_WIRE_B</a></div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00057">defines.h:57</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ab0ccbafe7e2809759eea8d45d23e4ba0"><div class="ttname"><a href="../libraries/AP__Math_8h.html#ab0ccbafe7e2809759eea8d45d23e4ba0">location_path_proportion</a></div><div class="ttdeci">float location_path_proportion(const struct Location &amp;location, const struct Location &amp;point1, const struct Location &amp;point2)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a78cd9699d4ab2011c98c577048f1f79a"><div class="ttname"><a href="ArduPlane_8pde.html#a78cd9699d4ab2011c98c577048f1f79a">channel_roll</a></div><div class="ttdeci">static RC_Channel * channel_roll</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00141">ArduPlane.pde:141</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a1f6253cc5d0a568caddb00593187e088"><div class="ttname"><a href="ArduPlane_8pde.html#a1f6253cc5d0a568caddb00593187e088">rudder_input</a></div><div class="ttdeci">static int16_t rudder_input</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00599">ArduPlane.pde:599</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a37281484783ca6616b08974ea95d3d2c"><div class="ttname"><a href="ArduPlane_8pde.html#a37281484783ca6616b08974ea95d3d2c">altitude_error_cm</a></div><div class="ttdeci">static int32_t altitude_error_cm</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00436">ArduPlane.pde:436</a></div></div>
<div class="ttc" id="navigation_8pde_html_a4aefca636333473c7924fe74564efc96"><div class="ttname"><a href="navigation_8pde.html#a4aefca636333473c7924fe74564efc96">calc_airspeed_errors</a></div><div class="ttdeci">static void calc_airspeed_errors()</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00075">navigation.pde:75</a></div></div>
<div class="ttc" id="Attitude_8pde_html_a5225e5842ebaec48545141f4077351c4"><div class="ttname"><a href="Attitude_8pde.html#a5225e5842ebaec48545141f4077351c4">calc_throttle</a></div><div class="ttdeci">static void calc_throttle()</div><div class="ttdef"><b>Definition:</b> <a href="Attitude_8pde_source.html#l00394">Attitude.pde:394</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_aaf9f187190dde6bec231013495948955"><div class="ttname"><a href="ArduPlane_8pde.html#aaf9f187190dde6bec231013495948955">g</a></div><div class="ttdeci">static Parameters g</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00129">ArduPlane.pde:129</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a30da9e8eb081c5511f1928eeea6f763a"><div class="ttname"><a href="ArduPlane_8pde.html#a30da9e8eb081c5511f1928eeea6f763a">airspeed_error_cm</a></div><div class="ttdeci">static float airspeed_error_cm</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00415">ArduPlane.pde:415</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="ArduPlane_8pde.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00115">ArduPlane.pde:115</a></div></div>
<div class="ttc" id="altitude_8pde_html_a97933d190f6688bcfb0e5f6f9df5383c"><div class="ttname"><a href="altitude_8pde.html#a97933d190f6688bcfb0e5f6f9df5383c">set_target_altitude_current</a></div><div class="ttdeci">static void set_target_altitude_current(void)</div><div class="ttdef"><b>Definition:</b> <a href="altitude_8pde_source.html#l00136">altitude.pde:136</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a778b4ae07102d0d0c2abb04df700bb5a"><div class="ttname"><a href="ArduPlane_8pde.html#a778b4ae07102d0d0c2abb04df700bb5a">aparm</a></div><div class="ttdeci">static AP_Vehicle::FixedWing aparm</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00101">ArduPlane.pde:101</a></div></div>
<div class="ttc" id="structVector2_html"><div class="ttname"><a href="../libraries/structVector2.html">Vector2&lt; float &gt;</a></div></div>
<div class="ttc" id="navigation_8pde_html_a2307c8ad7ff975923da6fbe17c1c28fc"><div class="ttname"><a href="navigation_8pde.html#a2307c8ad7ff975923da6fbe17c1c28fc">update_loiter</a></div><div class="ttdeci">static void update_loiter()</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00128">navigation.pde:128</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_ae6e47415180f433d8bbab1f16a8d7431"><div class="ttname"><a href="ArduPlane_8pde.html#ae6e47415180f433d8bbab1f16a8d7431">loiter</a></div><div class="ttdeci">static struct @8 loiter</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a962e3f0f8682f6dedb5a001a70bdd65e"><div class="ttname"><a href="ArduPlane_8pde.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a></div><div class="ttdeci">static AP_GPS gps</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00193">ArduPlane.pde:193</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_acffa584c42732a9c26e99483d24eb9f9"><div class="ttname"><a href="ArduPlane_8pde.html#acffa584c42732a9c26e99483d24eb9f9">next_WP_loc</a></div><div class="ttdeci">static Location next_WP_loc</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00684">ArduPlane.pde:684</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a32d395a28c689e49cbff34d364076ed9"><div class="ttname"><a href="ArduPlane_8pde.html#a32d395a28c689e49cbff34d364076ed9">control_mode</a></div><div class="ttdeci">static enum FlightMode control_mode</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00326">ArduPlane.pde:326</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a77753b1f78456153a0acba3279118b3e"><div class="ttname"><a href="ArduPlane_8pde.html#a77753b1f78456153a0acba3279118b3e">L1_controller</a></div><div class="ttdeci">static AP_L1_Control L1_controller(ahrs)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_aa7c321da6f067c83fdd900d2e2061b31"><div class="ttname"><a href="ArduPlane_8pde.html#aa7c321da6f067c83fdd900d2e2061b31">cruise_state</a></div><div class="ttdeci">static struct @5 cruise_state</div></div>
<div class="ttc" id="ArduPlane_8pde_html_ac505850b865f02506341b3e99ce08c22"><div class="ttname"><a href="ArduPlane_8pde.html#ac505850b865f02506341b3e99ce08c22">airspeed_nudge_cm</a></div><div class="ttdeci">static int16_t airspeed_nudge_cm</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00419">ArduPlane.pde:419</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a4ca9908869f03c8499bb30e8cae3ccc0"><div class="ttname"><a href="ArduPlane_8pde.html#a4ca9908869f03c8499bb30e8cae3ccc0">mission</a></div><div class="ttdeci">AP_Mission mission(ahrs,&amp;start_command_callback,&amp;verify_command_callback,&amp;exit_mission_callback)</div></div>
<div class="ttc" id="classAP__GPS_html_a9093c8cf1d5a78ccd8677229bb314d37"><div class="ttname"><a href="../libraries/classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">AP_GPS::status</a></div><div class="ttdeci">GPS_Status status(uint8_t instance) const </div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff"><div class="ttname"><a href="../libraries/classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a88300cf5dda0e0f3cb5669c564756039"><div class="ttname"><a href="../libraries/structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">AP_Vehicle::FixedWing::airspeed_min</a></div><div class="ttdeci">AP_Int16 airspeed_min</div></div>
<div class="ttc" id="ArduPlane_8pde_html_ace6a581dca1a4d257db10eeb39135bef"><div class="ttname"><a href="ArduPlane_8pde.html#ace6a581dca1a4d257db10eeb39135bef">nav_controller</a></div><div class="ttdeci">static AP_Navigation * nav_controller</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00260">ArduPlane.pde:260</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a8b9a5d50d9220d6f86fb4cc76b139797"><div class="ttname"><a href="ArduPlane_8pde.html#a8b9a5d50d9220d6f86fb4cc76b139797">prev_WP_loc</a></div><div class="ttdeci">static Location prev_WP_loc</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00680">ArduPlane.pde:680</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ab0e06d28afb9d14043e1938af277396c"><div class="ttname"><a href="../libraries/AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a></div><div class="ttdeci">void location_update(struct Location &amp;loc, float bearing, float distance)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_a1dd6e7a686eba47cb054c1fa5f01084d"><div class="ttname"><a href="ArduPlane_8pde.html#a1dd6e7a686eba47cb054c1fa5f01084d">ahrs</a></div><div class="ttdeci">AP_AHRS_DCM ahrs(ins, barometer, gps)</div></div>
<div class="ttc" id="structVector2_html_ace2a626eaa79412e2946216e9c3e63c6"><div class="ttname"><a href="../libraries/structVector2.html#ace2a626eaa79412e2946216e9c3e63c6">Vector2::normalize</a></div><div class="ttdeci">void normalize()</div></div>
<div class="ttc" id="classAP__Mission_html_a338b12fad6aa74b9c8a34d65850f6b40"><div class="ttname"><a href="../libraries/classAP__Mission.html#a338b12fad6aa74b9c8a34d65850f6b40">AP_Mission::get_next_ground_course_cd</a></div><div class="ttdeci">int32_t get_next_ground_course_cd(int32_t default_angle)</div></div>
<div class="ttc" id="classAP__GPS_html_a94caaa8676fecb6c0c4a8a58eea3b106"><div class="ttname"><a href="../libraries/classAP__GPS.html#a94caaa8676fecb6c0c4a8a58eea3b106">AP_GPS::ground_course_cd</a></div><div class="ttdeci">int32_t ground_course_cd(uint8_t instance) const </div></div>
<div class="ttc" id="classAP__SpdHgtControl_html_aef400289c2cdf6c24d39f3c93b82df37"><div class="ttname"><a href="../libraries/classAP__SpdHgtControl.html#aef400289c2cdf6c24d39f3c93b82df37">AP_SpdHgtControl::get_target_airspeed</a></div><div class="ttdeci">virtual float get_target_airspeed(void) const =0</div></div>
<div class="ttc" id="classMatrix3_html_ae16bed039ad87c3337f15837c33fe2fb"><div class="ttname"><a href="../libraries/classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">Matrix3::b</a></div><div class="ttdeci">Vector3&lt; T &gt; b</div></div>
<div class="ttc" id="navigation_8pde_html_ad4179c88d519ca32aaabea8ac0fb20eb"><div class="ttname"><a href="navigation_8pde.html#ad4179c88d519ca32aaabea8ac0fb20eb">calc_gndspeed_undershoot</a></div><div class="ttdeci">static void calc_gndspeed_undershoot()</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00114">navigation.pde:114</a></div></div>
<div class="ttc" id="AP__Math_8h_html_aa825a788804b8dd4cf1e3cfb42960a8b"><div class="ttname"><a href="../libraries/AP__Math_8h.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a></div><div class="ttdeci">float get_distance(const struct Location &amp;loc1, const struct Location &amp;loc2)</div></div>
<div class="ttc" id="ArduPlane_8pde_html_aa4a939055af87262bcdcebed06abaa3b"><div class="ttname"><a href="ArduPlane_8pde.html#aa4a939055af87262bcdcebed06abaa3b">delta_us_fast_loop</a></div><div class="ttdeci">static uint32_t delta_us_fast_loop</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00737">ArduPlane.pde:737</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_ad4274413edfc982b49d5c34f7e0cbaf6"><div class="ttname"><a href="ArduPlane_8pde.html#ad4274413edfc982b49d5c34f7e0cbaf6">SpdHgt_Controller</a></div><div class="ttdeci">static AP_SpdHgtControl * SpdHgt_Controller</div><div class="ttdef"><b>Definition:</b> <a href="ArduPlane_8pde_source.html#l00263">ArduPlane.pde:263</a></div></div>
<div class="ttc" id="classParameters_html_afe6763a69fc900c2a07f79cde055f778"><div class="ttname"><a href="classParameters.html#afe6763a69fc900c2a07f79cde055f778">Parameters::nav_controller</a></div><div class="ttdeci">AP_Int8 nav_controller</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00354">Parameters.h:354</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a35821002985a8e3e526c8ccad9bb9934"><div class="ttname"><a href="../libraries/AP__Math_8h.html#a35821002985a8e3e526c8ccad9bb9934">wrap_180_cd</a></div><div class="ttdeci">int32_t wrap_180_cd(int32_t error)</div></div>
<div class="ttc" id="defines_8h_html_abab3eb875bf63673faa9bb59e58a0485aeef9468d1b98bca652a04bf5063fd9d6"><div class="ttname"><a href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485aeef9468d1b98bca652a04bf5063fd9d6">AUTO</a></div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00060">defines.h:60</a></div></div>
<div class="ttc" id="navigation_8pde_html_a6409561aa9dd027ac95e7110aa5a3e15"><div class="ttname"><a href="navigation_8pde.html#a6409561aa9dd027ac95e7110aa5a3e15">setup_turn_angle</a></div><div class="ttdeci">static void setup_turn_angle(void)</div><div class="ttdef"><b>Definition:</b> <a href="navigation_8pde_source.html#l00205">navigation.pde:205</a></div></div>
<div class="ttc" id="classMatrix3_html_acd7bf3421047fa155168a9c8e5164a2b"><div class="ttname"><a href="../libraries/classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">Matrix3::a</a></div><div class="ttdeci">Vector3&lt; T &gt; a</div></div>
<div class="ttc" id="defines_8h_html_abab3eb875bf63673faa9bb59e58a0485a4c3bb1b37600efcdc5c91861830a3918"><div class="ttname"><a href="defines_8h.html#abab3eb875bf63673faa9bb59e58a0485a4c3bb1b37600efcdc5c91861830a3918">CRUISE</a></div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00058">defines.h:58</a></div></div>
<div class="ttc" id="Attitude_8pde_html_a432b90be495c4f3a40a28fbd20c8cbde"><div class="ttname"><a href="Attitude_8pde.html#a432b90be495c4f3a40a28fbd20c8cbde">calc_nav_pitch</a></div><div class="ttdeci">static void calc_nav_pitch()</div><div class="ttdef"><b>Definition:</b> <a href="Attitude_8pde_source.html#l00487">Attitude.pde:487</a></div></div>
<div class="ttc" id="classParameters_html_ac5ab64dfa28355311a9a63e3458aae37"><div class="ttname"><a href="classParameters.html#ac5ab64dfa28355311a9a63e3458aae37">Parameters::min_gndspeed_cm</a></div><div class="ttdeci">AP_Int32 min_gndspeed_cm</div><div class="ttdef"><b>Definition:</b> <a href="Parameters_8h_source.html#l00446">Parameters.h:446</a></div></div>
<div class="ttc" id="ArduPlane_8pde_html_a304224bccd737323c9ee5b15cc9149ad"><div class="ttname"><a href="ArduPlane_8pde.html#a304224bccd737323c9ee5b15cc9149ad">airspeed</a></div><div class="ttdeci">AP_Airspeed airspeed(aparm)</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 22 2016 15:33:55 for APM:Plane by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
