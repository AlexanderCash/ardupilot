<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>APM:Libraries: libraries/AP_NavEKF/AP_NavEKF.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_46edeb859ac943c9ceb605f4bae14ade.html">AP_NavEKF</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_NavEKF.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__NavEKF_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL.h</a>&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#if HAL_CPU_CLASS &gt;= HAL_CPU_CLASS_150</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  optionally turn down optimisation for debugging</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// #pragma GCC optimize(&quot;O0&quot;)</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__NavEKF_8h.html">AP_NavEKF.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__AHRS_8h.html">AP_AHRS.h</a>&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Param_8h.html">AP_Param.h</a>&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle_8h.html">AP_Vehicle.h</a>&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">  parameter defaults for different types of vehicle. The</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">  APM_BUILD_DIRECTORY is taken from the main vehicle directory name</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">  where the code is built. Note that this trick won&#39;t work for arduino</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">  builds on APM2, but NavEKF doesn&#39;t run on APM2, so that&#39;s OK</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#if APM_BUILD_TYPE(APM_BUILD_ArduCopter)</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor"></span><span class="comment">// copter defaults</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#define VELNE_NOISE_DEFAULT     0.5f</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VELD_NOISE_DEFAULT      0.7f</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define POSNE_NOISE_DEFAULT     0.5f</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ALT_NOISE_DEFAULT       1.0f</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_NOISE_DEFAULT       0.05f</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GYRO_PNOISE_DEFAULT     0.015f</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ACC_PNOISE_DEFAULT      0.25f</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GBIAS_PNOISE_DEFAULT    1E-06f</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ABIAS_PNOISE_DEFAULT    0.00005f</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAGE_PNOISE_DEFAULT     0.0003f</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAGB_PNOISE_DEFAULT     0.0003f</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VEL_GATE_DEFAULT        5</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define POS_GATE_DEFAULT        10</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define HGT_GATE_DEFAULT        10</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_GATE_DEFAULT        3</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_CAL_DEFAULT         1</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GLITCH_ACCEL_DEFAULT    100</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GLITCH_RADIUS_DEFAULT   25</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_MEAS_DELAY         10</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_NOISE_DEFAULT      0.25f</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_GATE_DEFAULT       3</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#elif APM_BUILD_TYPE(APM_BUILD_APMrover2)</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor"></span><span class="comment">// rover defaults</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#define VELNE_NOISE_DEFAULT     0.5f</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VELD_NOISE_DEFAULT      0.7f</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define POSNE_NOISE_DEFAULT     0.5f</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ALT_NOISE_DEFAULT       1.0f</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_NOISE_DEFAULT       0.05f</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GYRO_PNOISE_DEFAULT     0.015f</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ACC_PNOISE_DEFAULT      0.25f</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GBIAS_PNOISE_DEFAULT    1E-06f</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ABIAS_PNOISE_DEFAULT    0.00005f</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAGE_PNOISE_DEFAULT     0.0003f</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAGB_PNOISE_DEFAULT     0.0003f</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VEL_GATE_DEFAULT        5</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define POS_GATE_DEFAULT        10</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define HGT_GATE_DEFAULT        10</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_GATE_DEFAULT        3</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_CAL_DEFAULT         1</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GLITCH_ACCEL_DEFAULT    150</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GLITCH_RADIUS_DEFAULT   15</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_MEAS_DELAY         25</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_NOISE_DEFAULT      0.15f</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_GATE_DEFAULT       5</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor"></span><span class="comment">// generic defaults (and for plane)</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a0f0f886dda819ea2b3cdcc3f4628cd80">   75</a></span>&#160;<span class="preprocessor">#define VELNE_NOISE_DEFAULT     0.5f</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#af8487399e0f3543a8a70146223f8412e">   76</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VELD_NOISE_DEFAULT      0.7f</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a0f1645081a2864df607ae9e25dec9488">   77</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define POSNE_NOISE_DEFAULT     0.5f</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a9d23b3a127a3bd2ef156b919d13c4ddf">   78</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ALT_NOISE_DEFAULT       0.5f</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a41462b3552d510da7e227643d634eedb">   79</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_NOISE_DEFAULT       0.05f</span></div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a603be3532744d28bc5914786120e73a1">   80</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GYRO_PNOISE_DEFAULT     0.015f</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a7ae0a9703c028ac364432e722c91ae57">   81</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ACC_PNOISE_DEFAULT      0.5f</span></div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#ad7c437e7c36f39117d19dc10c6a7766a">   82</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GBIAS_PNOISE_DEFAULT    1E-06f</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#adc02e30ae2afa5e09c12e47158bfa882">   83</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define ABIAS_PNOISE_DEFAULT    0.00005f</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#ad3fb415efca7a253fb01f3d143782230">   84</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAGE_PNOISE_DEFAULT     0.0003f</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#aacc03a626049d93a3ea1f497c767aa00">   85</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAGB_PNOISE_DEFAULT     0.0003f</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a1ed1b5c6e35ed0e61f04b94c4f96133c">   86</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VEL_GATE_DEFAULT        6</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a04640c6b2d683cd1a657580c299f6a38">   87</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define POS_GATE_DEFAULT        30</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a8524c1ce54ed16e744f6690f713daa58">   88</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define HGT_GATE_DEFAULT        20</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#ab8559370abce329611c5c20b1cb92e7c">   89</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_GATE_DEFAULT        3</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a5acc5924c4a1100f963d8002eeb282a2">   90</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAG_CAL_DEFAULT         0</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a35f98cf767c5126fc81118a1d8c05480">   91</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GLITCH_ACCEL_DEFAULT    150</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a70736687012cc7bdcfb1c3c861da9d37">   92</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define GLITCH_RADIUS_DEFAULT   20</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a81e13a370d69eb740c8e4d60ba00652b">   93</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_MEAS_DELAY         25</span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a1f0e37994a6f56855901949bd4ff8e25">   94</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_NOISE_DEFAULT      0.3f</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#afc8bd464e2802810d4493cbea6591972">   95</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FLOW_GATE_DEFAULT       3</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif // APM_BUILD_DIRECTORY</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AP__NavEKF_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a6d50d30e44d32c192e4d932bbb166ba0">  102</a></span>&#160;<span class="preprocessor">#define earthRate 0.000072921f // earth rotation rate (rad/sec)</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">// when the wind estimation first starts with no airspeed sensor,</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">// assume 3m/s to start</span></div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a94492e11259113c24733219b832878b6">  106</a></span>&#160;<span class="preprocessor">#define STARTUP_WIND_SPEED 3.0f</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">// initial imu bias uncertainty (deg/sec)</span></div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a0baed3323b0e73e69e2d80fb232031ba">  109</a></span>&#160;<span class="preprocessor">#define INIT_GYRO_BIAS_UNCERTAINTY  0.1f</span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a486aed3cc284bf78393a531434d38a41">  110</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define INIT_ACCEL_BIAS_UNCERTAINTY 0.3f</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">// Define tuning parameters</span></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="AP__NavEKF_8cpp.html#a0612b502881e2f25e9f3f0295f28d7f1">  113</a></span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classNavEKF.html#a9df8b078c6da464dd8aa858675eae659">NavEKF::var_info</a>[] <a class="code" href="AP__NavEKF_8cpp.html#a0612b502881e2f25e9f3f0295f28d7f1">PROGMEM</a> = {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// @Param: VELNE_NOISE</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// @DisplayName: GPS horizontal velocity measurement noise scaler</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// @Description: This is the scaler that is applied to the speed accuracy reported by the receiver to estimate the horizontal velocity observation noise. If the model of receiver used does not provide a speed accurcy estimate, then a speed acuracy of 1 is assumed. Increasing it reduces the weighting on these measurements.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// @Range: 0.05 5.0</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;VELNE_NOISE&quot;</span>,    0, <a class="code" href="classNavEKF.html">NavEKF</a>, _gpsHorizVelNoise, <a class="code" href="AP__NavEKF_8cpp.html#a0f0f886dda819ea2b3cdcc3f4628cd80">VELNE_NOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// @Param: VELD_NOISE</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// @DisplayName: GPS vertical velocity measurement noise scaler</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// @Description: This is the scaler that is applied to the speed accuracy reported by the receiver to estimate the vertical velocity observation noise. If the model of receiver used does not provide a speed accurcy estimate, then a speed acuracy of 1 is assumed. Increasing it reduces the weighting on this measurement.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// @Range: 0.05 5.0</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;VELD_NOISE&quot;</span>,    1, <a class="code" href="classNavEKF.html">NavEKF</a>, _gpsVertVelNoise, <a class="code" href="AP__NavEKF_8cpp.html#af8487399e0f3543a8a70146223f8412e">VELD_NOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// @Param: POSNE_NOISE</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// @DisplayName: GPS horizontal position measurement noise (m)</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// @Description: This is the RMS value of noise in the GPS horizontal position measurements. Increasing it reduces the weighting on these measurements.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// @Range: 0.1 10.0</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POSNE_NOISE&quot;</span>,    2, <a class="code" href="classNavEKF.html">NavEKF</a>, _gpsHorizPosNoise, <a class="code" href="AP__NavEKF_8cpp.html#a0f1645081a2864df607ae9e25dec9488">POSNE_NOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// @Param: ALT_NOISE</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// @DisplayName: Altitude measurement noise (m)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// @Description: This is the RMS value of noise in the altitude measurement. Increasing it reduces the weighting on this measurement.</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// @Range: 0.1 10.0</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ALT_NOISE&quot;</span>,    3, <a class="code" href="classNavEKF.html">NavEKF</a>, _baroAltNoise, <a class="code" href="AP__NavEKF_8cpp.html#a9d23b3a127a3bd2ef156b919d13c4ddf">ALT_NOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// @Param: MAG_NOISE</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// @DisplayName: Magnetometer measurement noise (Gauss)</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">// @Description: This is the RMS value of noise in magnetometer measurements. Increasing it reduces the weighting on these measurements.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// @Range: 0.01 0.5</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAG_NOISE&quot;</span>,    4, <a class="code" href="classNavEKF.html">NavEKF</a>, _magNoise, <a class="code" href="AP__NavEKF_8cpp.html#a41462b3552d510da7e227643d634eedb">MAG_NOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// @Param: EAS_NOISE</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// @DisplayName: Equivalent airspeed measurement noise (m/s)</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// @Description: This is the RMS value of noise in equivalent airspeed measurements. Increasing it reduces the weighting on these measurements.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// @Range: 0.5 5.0</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EAS_NOISE&quot;</span>,    5, <a class="code" href="classNavEKF.html">NavEKF</a>, _easNoise, 1.4<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// @Param: WIND_PNOISE</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// @DisplayName: Wind velocity process noise (m/s^2)</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// @Description: This noise controls the growth of wind state error estimates. Increasing it makes wind estimation faster and noisier.</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// @Range: 0.01 1.0</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;WIND_PNOISE&quot;</span>,    6, <a class="code" href="classNavEKF.html">NavEKF</a>, _windVelProcessNoise, 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// @Param: WIND_PSCALE</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// @DisplayName: Height rate to wind procss noise scaler</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// @Description: Increasing this parameter increases how rapidly the wind states adapt when changing altitude, but does make wind speed estimation noiser.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// @Range: 0.0 1.0</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;WIND_PSCALE&quot;</span>,    7, <a class="code" href="classNavEKF.html">NavEKF</a>, _wndVarHgtRateScale, 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// @Param: GYRO_PNOISE</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// @DisplayName: Rate gyro noise (rad/s)</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// @Description: This noise controls the growth of estimated error due to gyro measurement errors excluding bias. Increasing it makes the flter trust the gyro measurements less and other measurements more.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// @Range: 0.001 0.05</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// @Increment: 0.001</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYRO_PNOISE&quot;</span>,    8, <a class="code" href="classNavEKF.html">NavEKF</a>, _gyrNoise, <a class="code" href="AP__NavEKF_8cpp.html#a603be3532744d28bc5914786120e73a1">GYRO_PNOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// @Param: ACC_PNOISE</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// @DisplayName: Accelerometer noise (m/s^2)</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// @Description: This noise controls the growth of estimated error due to accelerometer measurement errors excluding bias. Increasing it makes the flter trust the accelerometer measurements less and other measurements more.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// @Range: 0.05 1.0</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC_PNOISE&quot;</span>,    9, <a class="code" href="classNavEKF.html">NavEKF</a>, _accNoise, <a class="code" href="AP__NavEKF_8cpp.html#a7ae0a9703c028ac364432e722c91ae57">ACC_PNOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">// @Param: GBIAS_PNOISE</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// @DisplayName: Rate gyro bias process noise (rad/s)</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// @Description: This noise controls the growth of gyro bias state error estimates. Increasing it makes rate gyro bias estimation faster and noisier.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// @Range: 0.0000001 0.00001</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GBIAS_PNOISE&quot;</span>,    10, <a class="code" href="classNavEKF.html">NavEKF</a>, _gyroBiasProcessNoise, <a class="code" href="AP__NavEKF_8cpp.html#ad7c437e7c36f39117d19dc10c6a7766a">GBIAS_PNOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// @Param: ABIAS_PNOISE</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// @DisplayName: Accelerometer bias process noise (m/s^2)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// @Description: This noise controls the growth of the vertical acelerometer bias state error estimate. Increasing it makes accelerometer bias estimation faster and noisier.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// @Range: 0.00001 0.001</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ABIAS_PNOISE&quot;</span>,    11, <a class="code" href="classNavEKF.html">NavEKF</a>, _accelBiasProcessNoise, <a class="code" href="AP__NavEKF_8cpp.html#adc02e30ae2afa5e09c12e47158bfa882">ABIAS_PNOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// @Param: MAGE_PNOISE</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// @DisplayName: Earth magnetic field process noise (gauss/s)</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// @Description: This noise controls the growth of earth magnetic field state error estimates. Increasing it makes earth magnetic field bias estimation faster and noisier.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// @Range: 0.0001 0.01</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAGE_PNOISE&quot;</span>,    12, <a class="code" href="classNavEKF.html">NavEKF</a>, _magEarthProcessNoise, <a class="code" href="AP__NavEKF_8cpp.html#ad3fb415efca7a253fb01f3d143782230">MAGE_PNOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// @Param: MAGB_PNOISE</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// @DisplayName: Body magnetic field process noise (gauss/s)</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// @Description: This noise controls the growth of body magnetic field state error estimates. Increasing it makes compass offset estimation faster and noisier.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// @Range: 0.0001 0.01</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAGB_PNOISE&quot;</span>,    13, <a class="code" href="classNavEKF.html">NavEKF</a>, _magBodyProcessNoise, <a class="code" href="AP__NavEKF_8cpp.html#aacc03a626049d93a3ea1f497c767aa00">MAGB_PNOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// @Param: VEL_DELAY</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// @DisplayName: GPS velocity measurement delay (msec)</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// @Description: This is the number of msec that the GPS velocity measurements lag behind the inertial measurements.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// @Range: 0 500</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// @Increment: 10</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;VEL_DELAY&quot;</span>,    14, <a class="code" href="classNavEKF.html">NavEKF</a>, _msecVelDelay, 220),</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// @Param: POS_DELAY</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// @DisplayName: GPS position measurement delay (msec)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// @Description: This is the number of msec that the GPS position measurements lag behind the inertial measurements.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// @Range: 0 500</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// @Increment: 10</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POS_DELAY&quot;</span>,    15, <a class="code" href="classNavEKF.html">NavEKF</a>, _msecPosDelay, 220),</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// @Param: GPS_TYPE</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// @DisplayName: GPS mode control</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// @Description: This parameter controls use of GPS measurements : 0 = use 3D velocity &amp; 2D position, 1 = use 2D velocity and 2D position, 2 = use 2D position, 3 = use no GPS (optical flow will be used if available)</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// @Range: 0 3</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GPS_TYPE&quot;</span>,    16, <a class="code" href="classNavEKF.html">NavEKF</a>, _fusionModeGPS, 0),</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// @Param: VEL_GATE</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// @DisplayName: GPS velocity measurement gate size</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// @Description: This parameter sets the number of standard deviations applied to the GPS velocity measurement innovation consistency check. Decreasing it makes it more likely that good measurements willbe rejected. Increasing it makes it more likely that bad measurements will be accepted.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// @Range: 1 100</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;VEL_GATE&quot;</span>,    17, <a class="code" href="classNavEKF.html">NavEKF</a>, _gpsVelInnovGate, <a class="code" href="AP__NavEKF_8cpp.html#a1ed1b5c6e35ed0e61f04b94c4f96133c">VEL_GATE_DEFAULT</a>),</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">// @Param: POS_GATE</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// @DisplayName: GPS position measurement gate size</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// @Description: This parameter sets the number of standard deviations applied to the GPS position measurement innovation consistency check. Decreasing it makes it more likely that good measurements will be rejected. Increasing it makes it more likely that bad measurements will be accepted.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// @Range: 1 100</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POS_GATE&quot;</span>,    18, <a class="code" href="classNavEKF.html">NavEKF</a>, _gpsPosInnovGate, <a class="code" href="AP__NavEKF_8cpp.html#a04640c6b2d683cd1a657580c299f6a38">POS_GATE_DEFAULT</a>),</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// @Param: HGT_GATE</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// @DisplayName: Height measurement gate size</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// @Description: This parameter sets the number of standard deviations applied to the height measurement innovation consistency check. Decreasing it makes it more likely that good measurements will be rejected. Increasing it makes it more likely that bad measurements will be accepted.</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// @Range: 1 100</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;HGT_GATE&quot;</span>,    19, <a class="code" href="classNavEKF.html">NavEKF</a>, _hgtInnovGate, <a class="code" href="AP__NavEKF_8cpp.html#a8524c1ce54ed16e744f6690f713daa58">HGT_GATE_DEFAULT</a>),</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// @Param: MAG_GATE</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// @DisplayName: Magnetometer measurement gate size</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// @Description: This parameter sets the number of standard deviations applied to the magnetometer measurement innovation consistency check. Decreasing it makes it more likely that good measurements will be rejected. Increasing it makes it more likely that bad measurements will be accepted.</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">// @Range: 1 100</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAG_GATE&quot;</span>,    20, <a class="code" href="classNavEKF.html">NavEKF</a>, _magInnovGate, <a class="code" href="AP__NavEKF_8cpp.html#ab8559370abce329611c5c20b1cb92e7c">MAG_GATE_DEFAULT</a>),</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// @Param: EAS_GATE</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// @DisplayName: Airspeed measurement gate size</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// @Description: This parameter sets the number of standard deviations applied to the airspeed measurement innovation consistency check. Decreasing it makes it more likely that good measurements will be rejected. Increasing it makes it more likely that bad measurements will be accepted.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// @Range: 1 100</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EAS_GATE&quot;</span>,    21, <a class="code" href="classNavEKF.html">NavEKF</a>, _tasInnovGate, 10),</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// @Param: MAG_CAL</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// @DisplayName: Magnetometer calibration mode</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// @Description: EKF_MAG_CAL = 0 enables calibration based on flying speed and altitude and is the default setting for Plane users. EKF_MAG_CAL = 1 enables calibration based on manoeuvre level and is the default setting for Copter and Rover users. EKF_MAG_CAL = 2 prevents magnetometer calibration regardless of flight condition and is recommended if in-flight magnetometer calibration is unreliable.</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// @Values: 0:Speed and Height,1:Acceleration,2:Never,3:Always</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAG_CAL&quot;</span>,    22, <a class="code" href="classNavEKF.html">NavEKF</a>, _magCal, <a class="code" href="AP__NavEKF_8cpp.html#a5acc5924c4a1100f963d8002eeb282a2">MAG_CAL_DEFAULT</a>),</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// @Param: GLITCH_ACCEL</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// @DisplayName: GPS glitch accel gate size (cm/s^2)</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// @Description: This parameter controls the maximum amount of difference in horizontal acceleration between the value predicted by the filter and the value measured by the GPS before the GPS position data is rejected. If this value is set too low, then valid GPS data will be regularly discarded, and the position accuracy will degrade. If this parameter is set too high, then large GPS glitches will cause large rapid changes in position.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// @Range: 100 500</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// @Increment: 50</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GLITCH_ACCEL&quot;</span>,    23, <a class="code" href="classNavEKF.html">NavEKF</a>, _gpsGlitchAccelMax, <a class="code" href="AP__NavEKF_8cpp.html#a35f98cf767c5126fc81118a1d8c05480">GLITCH_ACCEL_DEFAULT</a>),</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// @Param: GLITCH_RAD</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// @DisplayName: GPS glitch radius gate size (m)</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">// @Description: This parameter controls the maximum amount of difference in horizontal position (in m) between the value predicted by the filter and the value measured by the GPS before the long term glitch protection logic is activated and an offset is applied to the GPS measurement to compensate. Position steps smaller than this value will be temporarily ignored, but will then be accepted and the filter will move to the new position. Position steps larger than this value will be ignored initially, but the filter will then apply an offset to the GPS position measurement.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// @Range: 10 50</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// @Increment: 5</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GLITCH_RAD&quot;</span>,    24, <a class="code" href="classNavEKF.html">NavEKF</a>, _gpsGlitchRadiusMax, <a class="code" href="AP__NavEKF_8cpp.html#a70736687012cc7bdcfb1c3c861da9d37">GLITCH_RADIUS_DEFAULT</a>),</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// @Param: GND_GRADIENT</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// @DisplayName: Terrain Gradient % RMS</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// @Description: This parameter sets the RMS terrain gradient percentage assumed by the terrain height estimation. Terrain height can be estimated using optical flow and/or range finder sensor data if fitted. Smaller values cause the terrain height estimate to be slower to respond to changes in measurement. Larger values casue the terrain height estimate to be faster to respond, but also more noisy. Generally this value can be reduced if operating over very flat terrain and increased if operating over uneven terrain.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">// @Range: 1 - 50</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// @User: advanced</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GND_GRADIENT&quot;</span>,    25, <a class="code" href="classNavEKF.html">NavEKF</a>, _gndGradientSigma, 2),</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// @Param: FLOW_NOISE</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// @DisplayName: Optical flow measurement noise (rad/s)</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// @Description: This is the RMS value of noise and errors in optical flow measurements. Increasing it reduces the weighting on these measurements.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// @Range: 0.05 - 1.0</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// @User: advanced</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FLOW_NOISE&quot;</span>,    26, <a class="code" href="classNavEKF.html">NavEKF</a>, _flowNoise, <a class="code" href="AP__NavEKF_8cpp.html#a1f0e37994a6f56855901949bd4ff8e25">FLOW_NOISE_DEFAULT</a>),</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// @Param: FLOW_GATE</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// @DisplayName: Optical Flow measurement gate size</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// @Description: This parameter sets the number of standard deviations applied to the optical flow innovation consistency check. Decreasing it makes it more likely that good measurements will be rejected. Increasing it makes it more likely that bad measurements will be accepted.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// @Range: 1 - 100</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// @User: advanced</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FLOW_GATE&quot;</span>,    27, <a class="code" href="classNavEKF.html">NavEKF</a>, _flowInnovGate, <a class="code" href="AP__NavEKF_8cpp.html#afc8bd464e2802810d4493cbea6591972">FLOW_GATE_DEFAULT</a>),</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// @Param: FLOW_DELAY</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// @DisplayName: Optical Flow measurement delay (msec)</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// @Description: This is the number of msec that the optical flow measurements lag behind the inertial measurements. It is the time from the end of the optical flow averaging period and does not include the time delay due to the 100msec of averaging within the flow sensor.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// @Range: 0 - 500</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// @Increment: 10</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// @User: advanced</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FLOW_DELAY&quot;</span>,    28, <a class="code" href="classNavEKF.html">NavEKF</a>, _msecFLowDelay, <a class="code" href="AP__NavEKF_8cpp.html#a81e13a370d69eb740c8e4d60ba00652b">FLOW_MEAS_DELAY</a>),</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// @Param: RNG_GATE</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// @DisplayName: Range finder measurement gate size</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">// @Description: This parameter sets the number of standard deviations applied to the range finder innovation consistency check. Decreasing it makes it more likely that good measurements will be rejected. Increasing it makes it more likely that bad measurements will be accepted.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// @Range: 1 - 100</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// @User: advanced</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RNG_GATE&quot;</span>,    29, <a class="code" href="classNavEKF.html">NavEKF</a>, _rngInnovGate, 5),</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// @Param: MAX_FLOW</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">// @DisplayName: Maximum valid optical flow rate</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// @Description: This parameter sets the magnitude maximum optical flow rate in rad/sec that will be accepted by the filter</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// @Range: 1.0 - 4.0</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// @User: advanced</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAX_FLOW&quot;</span>,    30, <a class="code" href="classNavEKF.html">NavEKF</a>, _maxFlowRate, 2.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// @Param: FALLBACK</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// @DisplayName: Fallback strictness</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// @Description: This parameter controls the conditions necessary to trigger a fallback to DCM and INAV. A value of 1 will cause fallbacks to occur on loss of GPS and other conditions. A value of 0 will trust the EKF more.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">// @Values: 0:Trust EKF more, 1:Trust DCM more</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FALLBACK&quot;</span>,    31, <a class="code" href="classNavEKF.html">NavEKF</a>, _fallback, 1),</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">// @Param: ALT_SOURCE</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// @DisplayName: Primary height source</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">// @Description: This parameter controls which height sensor is used by the EKF during optical flow navigation (when EKF_GPS_TYPE = 3). A value of will 0 cause it to always use baro altitude. A value of 1 will casue it to use range finder if available.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// @Values: 0:Use Baro, 1:Use Range Finder</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ALT_SOURCE&quot;</span>,    32, <a class="code" href="classNavEKF.html">NavEKF</a>, _altSource, 1),</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;};</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">// constructor</span></div>
<div class="line"><a name="l00377"></a><span class="lineno"><a class="line" href="classNavEKF.html#a12a663e422a33c37a23b093dd0f0c397">  377</a></span>&#160;<a class="code" href="classNavEKF.html#a12a663e422a33c37a23b093dd0f0c397">NavEKF::NavEKF</a>(<span class="keyword">const</span> <a class="code" href="classAP__AHRS.html">AP_AHRS</a> *<a class="code" href="AHRS__Test_8pde.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>, <a class="code" href="classAP__Baro.html">AP_Baro</a> &amp;<a class="code" href="AHRS__Test_8pde.html#a53fcf9055dcf2464b865c886fb0c3853">baro</a>, <span class="keyword">const</span> <a class="code" href="classRangeFinder.html">RangeFinder</a> &amp;rng) :</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    _ahrs(ahrs),</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    _baro(baro),</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    _rng(rng),</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="Linux_2Util_8cpp.html#a89f234133d3efe315836311cbf21c64b">state</a>(*reinterpret_cast&lt;struct <a class="code" href="structNavEKF_1_1state__elements.html">state_elements</a> *&gt;(&amp;states)),</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    gpsNEVelVarAccScale(0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),     <span class="comment">// Scale factor applied to horizontal velocity measurement variance due to manoeuvre acceleration - used when GPS doesn&#39;t report speed error</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    gpsDVelVarAccScale(0.07<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),      <span class="comment">// Scale factor applied to vertical velocity measurement variance due to manoeuvre acceleration - used when GPS doesn&#39;t report speed error</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    gpsPosVarAccScale(0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),       <span class="comment">// Scale factor applied to horizontal position measurement variance due to manoeuvre acceleration</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    msecHgtDelay(60),               <span class="comment">// Height measurement delay (msec)</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    msecMagDelay(40),               <span class="comment">// Magnetometer measurement delay (msec)</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    msecTasDelay(240),              <span class="comment">// Airspeed measurement delay (msec)</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    gpsRetryTimeUseTAS(10000),      <span class="comment">// GPS retry time with airspeed measurements (msec)</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    gpsRetryTimeNoTAS(7000),        <span class="comment">// GPS retry time without airspeed measurements (msec)</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    gpsFailTimeWithFlow(5000),      <span class="comment">// If we have no GPS for longer than this and we have optical flow, then we will switch across to using optical flow (msec)</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    hgtRetryTimeMode0(10000),       <span class="comment">// Height retry time with vertical velocity measurement (msec)</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    hgtRetryTimeMode12(5000),       <span class="comment">// Height retry time without vertical velocity measurement (msec)</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    tasRetryTime(5000),             <span class="comment">// True airspeed timeout and retry interval (msec)</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    magFailTimeLimit_ms(10000),     <span class="comment">// number of msec before a magnetometer failing innovation consistency checks is declared failed (msec)</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    magVarRateScale(0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),         <span class="comment">// scale factor applied to magnetometer variance due to angular rate</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    gyroBiasNoiseScaler(2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),      <span class="comment">// scale factor applied to imu gyro bias learning before the vehicle is armed</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    accelBiasNoiseScaler(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),     <span class="comment">// scale factor applied to imu accel bias learning before the vehicle is armed</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    msecGpsAvg(200),                <span class="comment">// average number of msec between GPS measurements</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    msecHgtAvg(100),                <span class="comment">// average number of msec between height measurements</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    msecMagAvg(100),                <span class="comment">// average number of msec between magnetometer measurements</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    msecBetaAvg(100),               <span class="comment">// average number of msec between synthetic sideslip measurements</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    msecBetaMax(200),               <span class="comment">// maximum number of msec between synthetic sideslip measurements</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    msecFlowAvg(100),               <span class="comment">// average number of msec between optical flow measurements</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    dtVelPos(0.2<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),                 <span class="comment">// number of seconds between position and velocity corrections. This should be a multiple of the imu update interval.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    covTimeStepMax(0.07<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),          <span class="comment">// maximum time (sec) between covariance prediction updates</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    covDelAngMax(0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),            <span class="comment">// maximum delta angle between covariance prediction updates</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    TASmsecMax(200),                <span class="comment">// maximum allowed interval between airspeed measurement updates</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    DCM33FlowMin(0.71<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),            <span class="comment">// If Tbn(3,3) is less than this number, optical flow measurements will not be fused as tilt is too high.</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    fScaleFactorPnoise(1e-10<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),     <span class="comment">// Process noise added to focal length scale factor state variance at each time step</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    flowTimeDeltaAvg_ms(100),       <span class="comment">// average interval between optical flow measurements (msec)</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    flowIntervalMax_ms(100),        <span class="comment">// maximum allowable time between flow fusion events</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    gndEffectTimeout_ms(1000),          <span class="comment">// time in msec that baro ground effect compensation will timeout after initiation</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    gndEffectBaroScaler(4.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)      <span class="comment">// scaler applied to the barometer observation variance when operating in ground effect</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;#if CONFIG_HAL_BOARD == <a class="code" href="AP__HAL__Boards_8h.html#a8dcea2b41cd8fb125b22079bfad735aa">HAL_BOARD_PX4</a> || CONFIG_HAL_BOARD == <a class="code" href="AP__HAL__Boards_8h.html#a1a4e182bb1892026f81f6652d6550cdc">HAL_BOARD_VRBRAIN</a></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    ,_perf_UpdateFilter(perf_alloc(PC_ELAPSED, <span class="stringliteral">&quot;EKF_UpdateFilter&quot;</span>)),</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    _perf_CovariancePrediction(perf_alloc(PC_ELAPSED, <span class="stringliteral">&quot;EKF_CovariancePrediction&quot;</span>)),</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    _perf_FuseVelPosNED(perf_alloc(PC_ELAPSED, <span class="stringliteral">&quot;EKF_FuseVelPosNED&quot;</span>)),</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    _perf_FuseMagnetometer(perf_alloc(PC_ELAPSED, <span class="stringliteral">&quot;EKF_FuseMagnetometer&quot;</span>)),</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    _perf_FuseAirspeed(perf_alloc(PC_ELAPSED, <span class="stringliteral">&quot;EKF_FuseAirspeed&quot;</span>)),</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    _perf_FuseSideslip(perf_alloc(PC_ELAPSED, <span class="stringliteral">&quot;EKF_FuseSideslip&quot;</span>))</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;#endif</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, <a class="code" href="classNavEKF.html#a9df8b078c6da464dd8aa858675eae659">var_info</a>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">// Check basic filter health metrics and return a consolidated health status</span></div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="classNavEKF.html#ad418b75ceae3dde42f8c588b7e88abb4">  429</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#ad418b75ceae3dde42f8c588b7e88abb4">NavEKF::healthy</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    uint8_t faultInt;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="classNavEKF.html#ab71619ef68ba5d8b11f68ef4f31a65c2">getFilterFaults</a>(faultInt);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">if</span> (faultInt &gt; 0) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#acae32760a02eabd8be7398e5a52ad47b">_fallback</a> &amp;&amp; <a class="code" href="classNavEKF.html#a96245bb1cbb49e89c52e282b38d00c7a">velTestRatio</a> &gt; 1 &amp;&amp; <a class="code" href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">posTestRatio</a> &gt; 1 &amp;&amp; <a class="code" href="classNavEKF.html#a96c31aaedf02ab8cc9f33c7da1d85fd8">hgtTestRatio</a> &gt; 1) {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment">// all three metrics being above 1 means the filter is</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment">// extremely unhealthy.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// Give the filter a second to settle before use</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a85bde5695be6bf1fcfec41fc13ccddcd">ekfStartTime_ms</a>) &lt; 1000 ) {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// barometer and position innovations must be within limits when on-ground</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">float</span> horizErrSq = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[3]) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[4]);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; (<a class="code" href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(<a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[5]) &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> || horizErrSq &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">// all OK</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">// resets position states to last GPS measurement or to zero if in constant position mode</span></div>
<div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">  456</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">NavEKF::ResetPosition</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;{</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> || (<a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> != <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>)) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = 0;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = 0;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a>) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="comment">// write to state vector and compensate for GPS latency</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> + <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> + 0.001f*<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>*float(<a class="code" href="classNavEKF.html#a575fac67ea0188de47ee6ac5c2217f32">_msecPosDelay</a>);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> + <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> + 0.001f*<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*float(<a class="code" href="classNavEKF.html#a575fac67ea0188de47ee6ac5c2217f32">_msecPosDelay</a>);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="comment">// the estimated states at the last GPS measurement are set equal to the GPS measurement to prevent transients on the first fusion</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// stored horizontal position states to prevent subsequent GPS measurements from being rejected</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=49; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++){</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>].position.x = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>].position.y = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;}</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">// Reset velocity states to last GPS measurement if available or to zero if in constant position mode or if PV aiding is not absolute</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">// Do not reset vertical velocity using GPS as there is baro alt available to constrain drift</span></div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">  478</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">NavEKF::ResetVelocity</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;{</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> || <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> != <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;         <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;         <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">vel1</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;         <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">vel2</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a>) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="comment">// reset horizontal velocity states, applying an offset to the GPS velocity to prevent the GPS position being rejected when the GPS position offset is being decayed to zero.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>  = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>; <span class="comment">// north velocity from blended accel data</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>  = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>; <span class="comment">// east velocity from blended accel data</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">vel1</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>      = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>; <span class="comment">// north velocity from IMU1 accel data</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">vel1</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>      = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>; <span class="comment">// east velocity from IMU1 accel data</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">vel2</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>      = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>; <span class="comment">// north velocity from IMU2 accel data</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">vel2</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>      = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>; <span class="comment">// east velocity from IMU2 accel data</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="comment">// over write stored horizontal velocity states to prevent subsequent GPS measurements from being rejected</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=49; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++){</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>].velocity.x = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>].velocity.y = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">// reset the vertical position state using the last height measurement</span></div>
<div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="classNavEKF.html#a469538f4ff5dd6886d8db2be0acd3b48">  501</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a469538f4ff5dd6886d8db2be0acd3b48">NavEKF::ResetHeight</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;{</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">// read the altimeter</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="classNavEKF.html#a87c71e92e35c460ff8f026333dc1e813">readHgtData</a>();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// write to the state vector</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = -<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>; <span class="comment">// down position from blended accel data</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#abd2b7c8d517daa27d47b67217a881e17">posD1</a> = -<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>; <span class="comment">// down position from IMU1 accel data</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#aab01a87c6ad75643a39277a8954a7140">posD2</a> = -<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>; <span class="comment">// down position from IMU2 accel data</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">// reset stored vertical position states to prevent subsequent GPS measurements from being rejected</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=49; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++){</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>].position.z = -<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> + <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">// this function is used to initialise the filter whilst moving, using the AHRS DCM solution</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">// it should NOT be used to re-initialise after a timeout as DCM will also be corrupted</span></div>
<div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="classNavEKF.html#a12500a621febd8f914f6e16db4c28759">  518</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a12500a621febd8f914f6e16db4c28759">NavEKF::InitialiseFilterDynamic</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;{</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// this forces healthy() to be false so that when we ask for ahrs</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">// attitude we get the DCM attitude regardless of the state of AHRS_EKF_USE</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// If we are a plane and don&#39;t have GPS lock then don&#39;t initialise</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &lt; <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a>) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// If the DCM solution has not converged, then don&#39;t initialise,</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// unless at least 30s has passed</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#abfedb071fb724826675bbe3186eeb9e3">get_error_rp</a>() &gt; 0.05f &amp;&amp; <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adab911dc87e234603bea168495da909a">uptime_ms</a>() &lt; 30000U) {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// Set re-used variables to zero</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <a class="code" href="classNavEKF.html#a619b70e1205a58b444e22a8d5b51f16d">InitialiseVariables</a>();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">// get initial time deltat between IMU measurements (sec)</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a> = <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> = 1.0f/<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">get_ins</a>().<a class="code" href="classAP__InertialSensor.html#a7e9afc57ac1aa35adca7d8bf870fbb4c">get_sample_rate</a>();</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">// set number of updates over which gps and baro measurements are applied to the velocity and position states</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="classNavEKF.html#a99a20e876b5b008663c831da43ab44e7">gpsUpdateCountMaxInv</a> = (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * 1000.0f)/<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#a0ece2c48f78d3496d10b1476f89125b1">msecGpsAvg</a>);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="classNavEKF.html#ac149423cfc4aeaf0d3e8128d2334190e">gpsUpdateCountMax</a> = uint8_t(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classNavEKF.html#a99a20e876b5b008663c831da43ab44e7">gpsUpdateCountMaxInv</a>);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <a class="code" href="classNavEKF.html#aa4a74b46cabd98bf20f38e957e8562e3">hgtUpdateCountMaxInv</a> = (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * 1000.0f)/<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#a584f5bca8fd1baa4a42462830cb5151b">msecHgtAvg</a>);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <a class="code" href="classNavEKF.html#a8fbcd9282f3dcf7cd4b6bab74a1ac1e5">hgtUpdateCountMax</a> = uint8_t(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classNavEKF.html#aa4a74b46cabd98bf20f38e957e8562e3">hgtUpdateCountMaxInv</a>);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="classNavEKF.html#a7312c13dafe6b36bf4703f10dd57aa2d">magUpdateCountMaxInv</a> = (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * 1000.0f)/<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#ab0386943c12a0b3dabf4822c22ebd215">msecMagAvg</a>);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <a class="code" href="classNavEKF.html#a0e431c75e932225df5190a5e3e9d72c9">magUpdateCountMax</a> = uint8_t(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classNavEKF.html#a7312c13dafe6b36bf4703f10dd57aa2d">magUpdateCountMaxInv</a>);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <a class="code" href="classNavEKF.html#acc762a0249338693cdd04ed6a51b7b86">flowUpdateCountMaxInv</a> = (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * 1000.0f)/<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#aa996a851e3fdcf1d8e5566667d7a7849">msecFlowAvg</a>);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <a class="code" href="classNavEKF.html#abf2437b13b0f20096df6b2bd633c4944">flowUpdateCountMax</a> = uint8_t(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classNavEKF.html#acc762a0249338693cdd04ed6a51b7b86">flowUpdateCountMaxInv</a>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// calculate initial orientation and earth magnetic field states</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a> = <a class="code" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">calcQuatAndFieldStates</a>(<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">roll</a>, <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">pitch</a>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">// write to state vector</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">accel_zbias1</a> = 0;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">accel_zbias2</a> = 0;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// read the GPS and set the position and velocity states</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="classNavEKF.html#a4c44a7b25f5b5584b755142c6198fd1e">readGpsData</a>();</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">// read the barometer and set the height state</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="classNavEKF.html#a87c71e92e35c460ff8f026333dc1e813">readHgtData</a>();</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <a class="code" href="classNavEKF.html#a469538f4ff5dd6886d8db2be0acd3b48">ResetHeight</a>();</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">// set stored states to current state</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640">StoreStatesReset</a>();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">// set to true now that states have be initialised</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// define Earth rotation vector in the NED navigation frame</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="classNavEKF.html#a8071e344cd833c0d7e511de9f423ff88">calcEarthRateNED</a>(<a class="code" href="classNavEKF.html#a5e82d7eb114f6e4b37f15564c22f46b7">earthRateNED</a>, <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>().<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">// initialise IMU pre-processing states</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="code" href="classNavEKF.html#a617e88f0e357eb16d2540f25981e9ee2">readIMUData</a>();</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">// initialise the covariance matrix</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <a class="code" href="classNavEKF.html#a37d2f6484fc9385a275829a481341d2a">CovarianceInit</a>();</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;}</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">// Initialise the states from accelerometer and magnetometer data (if present)</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">// This method can only be used when the vehicle is static</span></div>
<div class="line"><a name="l00589"></a><span class="lineno"><a class="line" href="classNavEKF.html#a290932b02347c5247f036fbc3c7af9d8">  589</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a290932b02347c5247f036fbc3c7af9d8">NavEKF::InitialiseFilterBootstrap</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;{</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">// If we are a plane and don&#39;t have GPS lock then don&#39;t initialise</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &lt; <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a>) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">// set re-used variables to zero</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="classNavEKF.html#a619b70e1205a58b444e22a8d5b51f16d">InitialiseVariables</a>();</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">// get initial time deltat between IMU measurements (sec)</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a> = <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> = 1.0f/<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">get_ins</a>().<a class="code" href="classAP__InertialSensor.html#a7e9afc57ac1aa35adca7d8bf870fbb4c">get_sample_rate</a>();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// set number of updates over which gps and baro measurements are applied to the velocity and position states</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <a class="code" href="classNavEKF.html#a99a20e876b5b008663c831da43ab44e7">gpsUpdateCountMaxInv</a> = (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * 1000.0f)/<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#a0ece2c48f78d3496d10b1476f89125b1">msecGpsAvg</a>);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <a class="code" href="classNavEKF.html#ac149423cfc4aeaf0d3e8128d2334190e">gpsUpdateCountMax</a> = uint8_t(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classNavEKF.html#a99a20e876b5b008663c831da43ab44e7">gpsUpdateCountMaxInv</a>);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <a class="code" href="classNavEKF.html#aa4a74b46cabd98bf20f38e957e8562e3">hgtUpdateCountMaxInv</a> = (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * 1000.0f)/<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#a584f5bca8fd1baa4a42462830cb5151b">msecHgtAvg</a>);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <a class="code" href="classNavEKF.html#a8fbcd9282f3dcf7cd4b6bab74a1ac1e5">hgtUpdateCountMax</a> = uint8_t(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classNavEKF.html#aa4a74b46cabd98bf20f38e957e8562e3">hgtUpdateCountMaxInv</a>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="classNavEKF.html#a7312c13dafe6b36bf4703f10dd57aa2d">magUpdateCountMaxInv</a> = (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * 1000.0f)/<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#ab0386943c12a0b3dabf4822c22ebd215">msecMagAvg</a>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="classNavEKF.html#a0e431c75e932225df5190a5e3e9d72c9">magUpdateCountMax</a> = uint8_t(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classNavEKF.html#a7312c13dafe6b36bf4703f10dd57aa2d">magUpdateCountMaxInv</a>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="comment">// acceleration vector in XYZ body axes measured by the IMU (m/s^2)</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> initAccVec;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">// TODO we should average accel readings over several cycles</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    initAccVec = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">get_ins</a>().<a class="code" href="classAP__InertialSensor.html#a0f63a4a0e6fc84d6ab9519bc4b254055">get_accel</a>();</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">// read the magnetometer data</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="classNavEKF.html#adf06c6a73b9ca994ca16892ed0740283">readMagData</a>();</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">// normalise the acceleration vector</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordtype">float</span> pitch=0, roll=0;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span> (initAccVec.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>() &gt; 0.001f) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        initAccVec.<a class="code" href="classVector3.html#a9b147a862a1b86ed2e5b735d19da3da1">normalize</a>();</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// calculate initial pitch angle</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        pitch = <a class="code" href="AP__Math__AVR__Compat_8h.html#a68e4969cdd396dc3d4ad5abef13880b1">asinf</a>(initAccVec.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="comment">// calculate initial roll angle</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        roll = -<a class="code" href="AP__Math__AVR__Compat_8h.html#a68e4969cdd396dc3d4ad5abef13880b1">asinf</a>(initAccVec.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> / <a class="code" href="AP__Math__AVR__Compat_8h.html#acc171f0e087ed26abd701c827944a43b">cosf</a>(pitch));</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// calculate initial orientation and earth magnetic field states</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <a class="code" href="classQuaternion.html">Quaternion</a> initQuat;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    initQuat = <a class="code" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">calcQuatAndFieldStates</a>(roll, pitch);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">// check on ground status</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="classNavEKF.html#a02ca7503660ded3d95abce7c81d2eebf">SetFlightAndFusionModes</a>();</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">// write to state vector</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a> = initQuat;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">accel_zbias1</a> = 0;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">accel_zbias2</a> = 0;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">// read the GPS and set the position and velocity states</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <a class="code" href="classNavEKF.html#a4c44a7b25f5b5584b755142c6198fd1e">readGpsData</a>();</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// read the barometer and set the height state</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <a class="code" href="classNavEKF.html#a87c71e92e35c460ff8f026333dc1e813">readHgtData</a>();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="classNavEKF.html#a469538f4ff5dd6886d8db2be0acd3b48">ResetHeight</a>();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="comment">// set stored states to current state</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640">StoreStatesReset</a>();</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">// set to true now we have intialised the states</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">// define Earth rotation vector in the NED navigation frame</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <a class="code" href="classNavEKF.html#a8071e344cd833c0d7e511de9f423ff88">calcEarthRateNED</a>(<a class="code" href="classNavEKF.html#a5e82d7eb114f6e4b37f15564c22f46b7">earthRateNED</a>, <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>().<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">// initialise IMU pre-processing states</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <a class="code" href="classNavEKF.html#a617e88f0e357eb16d2540f25981e9ee2">readIMUData</a>();</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">// initialise the covariance matrix</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <a class="code" href="classNavEKF.html#a37d2f6484fc9385a275829a481341d2a">CovarianceInit</a>();</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">// Update Filter States - this should be called whenever new IMU data is available</span></div>
<div class="line"><a name="l00675"></a><span class="lineno"><a class="line" href="classNavEKF.html#a58d3c9694abab421e8eadd78e72ac67c">  675</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a58d3c9694abab421e8eadd78e72ac67c">NavEKF::UpdateFilter</a>()</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;{</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">// zero the delta quaternion used by the strapdown navigation because it is published</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">// and we need to return a zero rotation of the INS fails to update it</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="classNavEKF.html#aa9c0b8027f194f5e4735bc8cfede2503">correctedDelAngQuat</a>.<a class="code" href="classQuaternion.html#a872dcfe279bd5ba36a67ce90014dc187">initialise</a>();</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// don&#39;t run filter updates if states have not been initialised</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a>) {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">// start the timer used for load measurement</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#ab4055c5fc783af9aac11a3e0a3fc5bc4">_perf_UpdateFilter</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">//get starting time for update step</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> = hal.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#a26b68339fc68a562d8d3a1238d0ec8c1">millis</a>();</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">// read IMU data and convert to delta angles and velocities</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <a class="code" href="classNavEKF.html#a617e88f0e357eb16d2540f25981e9ee2">readIMUData</a>();</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> prev_armed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordtype">bool</span> armed = <a class="code" href="classNavEKF.html#aa98e017d389ce1831db02e36a44d5647">getVehicleArmStatus</a>();</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="comment">// the vehicle was previously disarmed and time has slipped</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="comment">// gyro auto-zero has likely just been done - skip this timestep</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">if</span> (!prev_armed &amp;&amp; <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a> &gt; <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>*5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="comment">// stop the timer used for load measurement</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        perf_end(<a class="code" href="classNavEKF.html#ab4055c5fc783af9aac11a3e0a3fc5bc4">_perf_UpdateFilter</a>);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        prev_armed = armed;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    prev_armed = armed;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="comment">// detect if the filter update has been delayed for too long</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a> &gt; 0.2f) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="comment">// we have stalled for too long - reset states</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <a class="code" href="classNavEKF.html#a469538f4ff5dd6886d8db2be0acd3b48">ResetHeight</a>();</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <a class="code" href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640">StoreStatesReset</a>();</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="comment">//Initialise IMU pre-processing states</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <a class="code" href="classNavEKF.html#a617e88f0e357eb16d2540f25981e9ee2">readIMUData</a>();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="comment">// stop the timer used for load measurement</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        perf_end(<a class="code" href="classNavEKF.html#ab4055c5fc783af9aac11a3e0a3fc5bc4">_perf_UpdateFilter</a>);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="comment">// check if on ground</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <a class="code" href="classNavEKF.html#a02ca7503660ded3d95abce7c81d2eebf">SetFlightAndFusionModes</a>();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// Check arm status and perform required checks and mode changes</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <a class="code" href="classNavEKF.html#a9eb8c77b7f824e2ebbf378f1d269290b">performArmingChecks</a>();</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">// run the strapdown INS equations every IMU update</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="classNavEKF.html#a6718baa569eff65fb4e317ecf5426598">UpdateStrapdownEquationsNED</a>();</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="comment">// store the predicted states for subsequent use by measurement fusion</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="classNavEKF.html#acc95e88cc639bb7672a907e0e51f854d">StoreStates</a>();</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">// sum delta angles and time used by covariance prediction</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a> = <a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a> + <a class="code" href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">correctedDelAng</a>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <a class="code" href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">summedDelVel</a> = <a class="code" href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">summedDelVel</a> + <a class="code" href="classNavEKF.html#ad92280e849a014d102950c24f37a0324">correctedDelVel1</a>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> += <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">// perform a covariance prediction if the total delta angle has exceeded the limit</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">// or the time limit will be exceeded at the next IMU update</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">if</span> (((<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> &gt;= (<a class="code" href="classNavEKF.html#a13b1a09dcdaaae1707abcf0e9e9d6471">covTimeStepMax</a> - <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>)) || (<a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a>.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>() &gt; <a class="code" href="classNavEKF.html#a4841badbd59995a1269f0ecdbfe6a8a3">covDelAngMax</a>))) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <a class="code" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">CovariancePrediction</a>();</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">// Read range finder data which is used by both position and optical flow fusion</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="classNavEKF.html#ae4d8e282bc4e67e56179c5dd6861dfe9">readRangeFinder</a>();</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">// Update states using GPS, altimeter, compass, airspeed and synthetic sideslip observations</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <a class="code" href="classNavEKF.html#a58fc44f797a61b7f760baa4961f43342">SelectVelPosFusion</a>();</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <a class="code" href="classNavEKF.html#abb693a00d56f98f4cd8d654605163d14">SelectMagFusion</a>();</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <a class="code" href="classNavEKF.html#a0302b7bbb74998406a938c227367797e">SelectFlowFusion</a>();</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <a class="code" href="classNavEKF.html#a49295ac247658724f852cbec8be83398">SelectTasFusion</a>();</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <a class="code" href="classNavEKF.html#a8525e5774e083f7187a7c4ed8609fa38">SelectBetaFusion</a>();</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">// stop the timer used for load measurement</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#ab4055c5fc783af9aac11a3e0a3fc5bc4">_perf_UpdateFilter</a>);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;}</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">// select fusion of velocity, position and height measurements</span></div>
<div class="line"><a name="l00762"></a><span class="lineno"><a class="line" href="classNavEKF.html#a58fc44f797a61b7f760baa4961f43342">  762</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a58fc44f797a61b7f760baa4961f43342">NavEKF::SelectVelPosFusion</a>()</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;{</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">// check for and read new GPS data</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <a class="code" href="classNavEKF.html#a4c44a7b25f5b5584b755142c6198fd1e">readGpsData</a>();</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="comment">// Specify which measurements should be used and check data for freshness</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="comment">// check if we can use opticalflow as a backup</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordtype">bool</span> optFlowBackup = (<a class="code" href="classNavEKF.html#ac8ac5c5066acbea171a692e2b03735e6">flowDataValid</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a>);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="comment">// Set GPS time-out threshold depending on whether we have an airspeed sensor to constrain drift</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        uint16_t gpsRetryTimeout = <a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">useAirspeed</a>() ? <a class="code" href="classNavEKF.html#a50054a8af8c2457a5dd91fd443d7dcf3">gpsRetryTimeUseTAS</a> : <a class="code" href="classNavEKF.html#a3d21102f255ba63c8d37a50ff9abde46">gpsRetryTimeNoTAS</a>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="comment">// Set the time that copters will fly without a GPS lock before failing the GPS and switching to a non GPS mode</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        uint16_t gpsFailTimeout = optFlowBackup ? <a class="code" href="classNavEKF.html#afc0e131151cc5d4c9ce26621b5427152">gpsFailTimeWithFlow</a> : gpsRetryTimeout;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="comment">// If we haven&#39;t received GPS data for a while, then declare the position and velocity data as being timed out</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">lastFixTime_ms</a> &gt; gpsFailTimeout) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="comment">// If this happens in flight and we don&#39;t have airspeed or sideslip assumption or optical flow to constrain drift, then go into constant position mode.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="comment">// Stay in that mode until the vehicle is re-armed.</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="comment">// If we can do optical flow nav (valid flow data and hieght above ground estimate, then go into flow nav mode.</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="comment">// Stay in that mode until the vehicle is dis-armed.</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">useAirspeed</a>() &amp;&amp; !<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>()) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                <span class="keywordflow">if</span> (optFlowBackup) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                    <span class="comment">// we can do optical flow only nav</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                    <a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> = 3;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                    <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20">AID_RELATIVE</a>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                    <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                    <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                    <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>; <span class="comment">// always clear constant velocity mode if constant velocity mode is active</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                    <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                    <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                    <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                    <span class="comment">// reset the velocity</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                    <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                    <span class="comment">// store the current position to be used to keep reporting the last known position</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                    <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                    <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                    <span class="comment">// reset the position</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                    <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                <span class="comment">// set the position and velocity timeouts to indicate we are not using GPS data</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="comment">// command fusion of GPS data and reset states as required</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#af5b82a44abb8a143dd981043af24248f">newDataGps</a> &amp;&amp; (<a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>)) {</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="comment">// reset data arrived flag</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <a class="code" href="classNavEKF.html#af5b82a44abb8a143dd981043af24248f">newDataGps</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <span class="comment">// reset state updates and counter used to spread fusion updates across several frames to reduce 10Hz pulsing</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            memset(&amp;<a class="code" href="classNavEKF.html#a878cd2073d88522b03e3f6a972bacf3c">gpsIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a878cd2073d88522b03e3f6a972bacf3c">gpsIncrStateDelta</a>));</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="classNavEKF.html#a08e342053cbf38b680f703e8ed575189">gpsUpdateCount</a> = 0;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="comment">// use both if GPS use is enabled</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <span class="comment">// If a long time since last GPS update, then reset position and velocity and reset stored state history</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a8ac5727059185f254f5c95ea8ba658b1">secondLastFixTime_ms</a> &gt; gpsRetryTimeout) {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                <span class="comment">// Apply an offset to the GPS position so that the position can be corrected gradually</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> - <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> - <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                <span class="comment">// limit the radius of the offset to 100m and decay the offset to zero radially</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                <a class="code" href="classNavEKF.html#a55a6ae919135e4deef0cffe2eca3ac80">decayGpsOffset</a>();</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                <span class="comment">// record the fail time</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                <a class="code" href="classNavEKF.html#a9f5a7e05866a566fd9243727906f636f">lastPosFailTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                <span class="comment">// Reset the normalised innovation to avoid false failing the bad position fusion test</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                <a class="code" href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">posTestRatio</a> = 0.0f;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> &amp;&amp; <a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a>) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="comment">// in constant position mode use synthetic position measurements set to zero</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="comment">// only fuse synthetic measurements when rate of change of velocity is less than 0.5g to reduce attitude errors due to launch acceleration</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="comment">// do not use velocity fusion to reduce the effect of movement on attitude</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aa55218a253ab5ef9c321145d552ccbef">accNavMag</a> &lt; 4.9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> &amp;&amp; <a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a>) {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="comment">// In constant velocity mode we fuse the last valid velocity vector</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="comment">// Reset the stored velocity vector when we enter the mode</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> &amp;&amp; !<a class="code" href="classNavEKF.html#ae348168676a32e441570ef3dd46153be">lastConstVelMode</a>) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <a class="code" href="classNavEKF.html#a42c664df5b7a9fb51d590fc3d7791c5d">heldVelNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            <a class="code" href="classNavEKF.html#a42c664df5b7a9fb51d590fc3d7791c5d">heldVelNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <a class="code" href="classNavEKF.html#ae348168676a32e441570ef3dd46153be">lastConstVelMode</a> = <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="comment">// We do not fuse when manoeuvring to avoid corrupting the attitude</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aa55218a253ab5ef9c321145d552ccbef">accNavMag</a> &lt; 4.9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// check for and read new height data</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="classNavEKF.html#a87c71e92e35c460ff8f026333dc1e813">readHgtData</a>();</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// If we haven&#39;t received height data for a while, then declare the height data as being timed out</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">// set timeout period based on whether we have vertical GPS velocity available to constrain drift</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="classNavEKF.html#a202ea1c0d365a297b1619730b0110678">hgtRetryTime</a> = (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 0 &amp;&amp; !<a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a>) ? <a class="code" href="classNavEKF.html#a1566591e9caf14504f532caaed34b7bb">hgtRetryTimeMode0</a> : <a class="code" href="classNavEKF.html#aead25814b7b3c494ceccbde73fb55125">hgtRetryTimeMode12</a>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#aebca5af77c541497460468f5f6b4cfcb">lastHgtMeasTime</a> &gt; <a class="code" href="classNavEKF.html#a202ea1c0d365a297b1619730b0110678">hgtRetryTime</a>) {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="comment">// command fusion of height data</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#adc843fa54ea2e75f96053bc8033e0f09">newDataHgt</a>)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="comment">// reset data arrived flag</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <a class="code" href="classNavEKF.html#adc843fa54ea2e75f96053bc8033e0f09">newDataHgt</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="comment">// reset state updates and counter used to spread fusion updates across several frames to reduce 10Hz pulsing</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        memset(&amp;<a class="code" href="classNavEKF.html#a1849d7cc900d9c76dfcfee92e9ede03d">hgtIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a1849d7cc900d9c76dfcfee92e9ede03d">hgtIncrStateDelta</a>));</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <a class="code" href="classNavEKF.html#acea66c70376189fe4399fd1c355a793f">hgtUpdateCount</a> = 0;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="comment">// enable fusion</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <a class="code" href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">fuseHgtData</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <a class="code" href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">fuseHgtData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="comment">// perform fusion</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> || <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> || <a class="code" href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">fuseHgtData</a>) {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="comment">// ensure that the covariance prediction is up to date before fusing data</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a>) <a class="code" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">CovariancePrediction</a>();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <a class="code" href="classNavEKF.html#a74882eb98d3c69065b640829154a500c">FuseVelPosNED</a>();</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="comment">// Fuse corrections to quaternion, position and velocity states across several time steps to reduce 5 and 10Hz pulsing in the output</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a08e342053cbf38b680f703e8ed575189">gpsUpdateCount</a> &lt; <a class="code" href="classNavEKF.html#ac149423cfc4aeaf0d3e8128d2334190e">gpsUpdateCountMax</a>) {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <a class="code" href="classNavEKF.html#a08e342053cbf38b680f703e8ed575189">gpsUpdateCount</a> ++;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 9; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] += <a class="code" href="classNavEKF.html#a878cd2073d88522b03e3f6a972bacf3c">gpsIncrStateDelta</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#acea66c70376189fe4399fd1c355a793f">hgtUpdateCount</a> &lt; <a class="code" href="classNavEKF.html#a8fbcd9282f3dcf7cd4b6bab74a1ac1e5">hgtUpdateCountMax</a>) {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <a class="code" href="classNavEKF.html#acea66c70376189fe4399fd1c355a793f">hgtUpdateCount</a> ++;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 9; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] += <a class="code" href="classNavEKF.html#a1849d7cc900d9c76dfcfee92e9ede03d">hgtIncrStateDelta</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="comment">// Detect and declare bad GPS aiding status for minimum 10 seconds if a GPS rejection occurs after</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="comment">// rejection of GPS and reset to GPS position. This addresses failure case where errors cause ongoing rejection</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="comment">// of GPS and severe loss of position accuracy.</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    uint32_t gpsRetryTime;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">useAirspeed</a>()) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        gpsRetryTime = <a class="code" href="classNavEKF.html#a50054a8af8c2457a5dd91fd443d7dcf3">gpsRetryTimeUseTAS</a>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        gpsRetryTime = <a class="code" href="classNavEKF.html#a3d21102f255ba63c8d37a50ff9abde46">gpsRetryTimeNoTAS</a>;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">posTestRatio</a> &gt; 2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) &amp;&amp; ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a9f5a7e05866a566fd9243727906f636f">lastPosFailTime</a>) &lt; gpsRetryTime) &amp;&amp; ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a9f5a7e05866a566fd9243727906f636f">lastPosFailTime</a>) &gt; gpsRetryTime/2) &amp;&amp; <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a>) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <a class="code" href="classNavEKF.html#a0463575b0fd4ac7b5fa4cf9db23e6418">lastGpsAidBadTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <a class="code" href="classNavEKF.html#a7ffc1616eba87ddced506c6bc2c47ba6">gpsAidingBad</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <a class="code" href="classNavEKF.html#a7ffc1616eba87ddced506c6bc2c47ba6">gpsAidingBad</a> = <a class="code" href="classNavEKF.html#a7ffc1616eba87ddced506c6bc2c47ba6">gpsAidingBad</a> &amp;&amp; ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a0463575b0fd4ac7b5fa4cf9db23e6418">lastGpsAidBadTime_ms</a>) &lt; 10000);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;}</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">// select fusion of magnetometer data</span></div>
<div class="line"><a name="l00934"></a><span class="lineno"><a class="line" href="classNavEKF.html#abb693a00d56f98f4cd8d654605163d14">  934</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#abb693a00d56f98f4cd8d654605163d14">NavEKF::SelectMagFusion</a>()</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;{</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">// start performance timer</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#a09aca3d45616daec8ede188f54dc3734">_perf_FuseMagnetometer</a>);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="comment">// check for and read new magnetometer measurements</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <a class="code" href="classNavEKF.html#adf06c6a73b9ca994ca16892ed0740283">readMagData</a>();</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="comment">// If we are using the compass and the magnetometer has been unhealthy for too long we declare a timeout</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ac5bd4b5c0717d17f66f4a97f647368ac">magHealth</a>) {</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <a class="code" href="classNavEKF.html#a8072f31f08434518f5a27ad06ce6d2b5">magTimeout</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <a class="code" href="classNavEKF.html#a0704abcdd99ba0ab2a8254fba20c843c">lastHealthyMagTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a0704abcdd99ba0ab2a8254fba20c843c">lastHealthyMagTime_ms</a>) &gt; <a class="code" href="classNavEKF.html#a108cf3c8f5e4cfa274249eacebe33298">magFailTimeLimit_ms</a> &amp;&amp; <a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>()) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <a class="code" href="classNavEKF.html#a8072f31f08434518f5a27ad06ce6d2b5">magTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    }</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="comment">// determine if conditions are right to start a new fusion cycle</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordtype">bool</span> dataReady = <a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a> &amp;&amp; <a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a0e2d1fc2ccd36ee1751b09aae63cfda1">newDataMag</a>;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">if</span> (dataReady) {</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="comment">// reset state updates and counter used to spread fusion updates across several frames to reduce 10Hz pulsing</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        memset(&amp;<a class="code" href="classNavEKF.html#a5ea1ecbce4372b7cb77fd19e6142a1aa">magIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a5ea1ecbce4372b7cb77fd19e6142a1aa">magIncrStateDelta</a>));</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <a class="code" href="classNavEKF.html#a63ede7463be667d9ac34509ea5414a2d">magUpdateCount</a> = 0;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="comment">// ensure that the covariance prediction is up to date before fusing data</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a>) <a class="code" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">CovariancePrediction</a>();</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="comment">// fuse the three magnetometer componenents sequentially</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.obsIndex = 0; <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.obsIndex &lt;= 2; <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.obsIndex++) <a class="code" href="classNavEKF.html#af2a003bbd6abea81eae93d2c2faf8bfa">FuseMagnetometer</a>();</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="comment">// Fuse corrections to quaternion, position and velocity states across several time steps to reduce 10Hz pulsing in the output</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a63ede7463be667d9ac34509ea5414a2d">magUpdateCount</a> &lt; <a class="code" href="classNavEKF.html#a0e431c75e932225df5190a5e3e9d72c9">magUpdateCountMax</a>) {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <a class="code" href="classNavEKF.html#a63ede7463be667d9ac34509ea5414a2d">magUpdateCount</a> ++;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 9; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] += <a class="code" href="classNavEKF.html#a5ea1ecbce4372b7cb77fd19e6142a1aa">magIncrStateDelta</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">// stop performance timer</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#a09aca3d45616daec8ede188f54dc3734">_perf_FuseMagnetometer</a>);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;}</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">// select fusion of optical flow measurements</span></div>
<div class="line"><a name="l00975"></a><span class="lineno"><a class="line" href="classNavEKF.html#a0302b7bbb74998406a938c227367797e">  975</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a0302b7bbb74998406a938c227367797e">NavEKF::SelectFlowFusion</a>()</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">// start performance timer</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#a09707728fa0e68e4ce49133052ab1d11">_perf_FuseOptFlow</a>);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// Perform Data Checks</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">// Check if the optical flow data is still valid</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <a class="code" href="classNavEKF.html#ac8ac5c5066acbea171a692e2b03735e6">flowDataValid</a> = ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#aefbf03b57265a352e23c75441036f414">flowValidMeaTime_ms</a>) &lt; 1000);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">// Check if the optical flow sensor has timed out</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordtype">bool</span> flowSensorTimeout = ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#aefbf03b57265a352e23c75441036f414">flowValidMeaTime_ms</a>) &gt; 5000);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">// Check if the fusion has timed out (flow measurements have been rejected for too long)</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordtype">bool</span> flowFusionTimeout = ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a1fff68de02d811e590b09385a9427e58">prevFlowFuseTime_ms</a>) &gt; 5000);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// check is the terrain offset estimate is still valid</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <a class="code" href="classNavEKF.html#aedabdd90e9cfdf598424e88700d94c7f">gndOffsetValid</a> = ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#ae04d7990ade9e35561c1cb3759267196">gndHgtValidTime_ms</a>) &lt; 5000);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// Perform tilt check</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordtype">bool</span> tiltOK = (<a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a>.<a class="code" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> &gt; <a class="code" href="classNavEKF.html#a8fa1f0e68c872b724a2af4b2610c635e">DCM33FlowMin</a>);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="comment">// Constrain measurements to zero if we are using optical flow and are on the ground</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 3 &amp;&amp; !<a class="code" href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">takeOffDetected</a> &amp;&amp; <a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[0]    = 0.0f;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[1]    = 0.0f;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[0]        = 0.0f;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[1]        = 0.0f;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="comment">// If the flow measurements have been rejected for too long and we are relying on them, then revert to constant position mode</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">if</span> ((flowSensorTimeout || flowFusionTimeout) &amp;&amp; <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20">AID_RELATIVE</a>) {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>; <span class="comment">// always clear constant velocity mode if constant velocity mode is active</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            <span class="comment">// reset the velocity</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <span class="comment">// store the current position to be used to keep reporting the last known position</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            <span class="comment">// reset the position</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">// if we do have valid flow measurements, fuse data into a 1-state EKF to estimate terrain height</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="comment">// we don&#39;t do terrain height estimation in optical flow only mode as the ground becomes our zero height reference</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> || <a class="code" href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">newDataRng</a>) &amp;&amp; tiltOK) {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="comment">// fuse range data into the terrain estimator if available</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <a class="code" href="classNavEKF.html#a0f328969ff5f2ed7349d760661a65a62">fuseRngData</a> = <a class="code" href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">newDataRng</a>;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="comment">// fuse optical flow data into the terrain estimator if available and if there is no range data (range data is better)</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <a class="code" href="classNavEKF.html#af87a2a59a63349321588523f47027747">fuseOptFlowData</a> = (<a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a0f328969ff5f2ed7349d760661a65a62">fuseRngData</a>);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="comment">// Estimate the terrain offset (runs a one state EKF)</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <a class="code" href="classNavEKF.html#a1c2beb90156edd9a4383c7d652b7ef7e">EstimateTerrainOffset</a>();</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="comment">// Indicate we have used the range data</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <a class="code" href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">newDataRng</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <span class="comment">// we don&#39;t do subsequent fusion of optical flow data into the main filter if GPS is good and terrain offset data is invalid</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="comment">// because an invalid height above ground estimate will cause the optical flow measurements to fight the GPS</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a> &amp;&amp; !<a class="code" href="classNavEKF.html#aedabdd90e9cfdf598424e88700d94c7f">gndOffsetValid</a>) {</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            <span class="comment">// turn off fusion permissions</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            <span class="comment">// reset the flags to indicate that no new range finder or flow data is available for fusion</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="comment">// Fuse optical flow data into the main filter</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="comment">// if the filter is initialised, we have data to fuse and the vehicle is not excessively tilted, then perform optical flow fusion</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ac8ac5c5066acbea171a692e2b03735e6">flowDataValid</a> &amp;&amp; <a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> &amp;&amp; tiltOK &amp;&amp; !<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    {</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="comment">// reset state updates and counter used to spread fusion updates across several frames to reduce 10Hz pulsing</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        memset(&amp;<a class="code" href="classNavEKF.html#a703d77a71d6bd0be67dcfb9ad1d1eb97">flowIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a703d77a71d6bd0be67dcfb9ad1d1eb97">flowIncrStateDelta</a>));</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <a class="code" href="classNavEKF.html#a83bc985fa5b587e5d43f8482f93c763c">flowUpdateCount</a> = 0;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="comment">// Set the flow noise used by the fusion processes</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#aafbe3d69b1f8da37e57fb67505c9928f">_flowNoise</a>, 0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="comment">// ensure that the covariance prediction is up to date before fusing data</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a>) <a class="code" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">CovariancePrediction</a>();</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <span class="comment">// Fuse the optical flow X and Y axis data into the main filter sequentially</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.obsIndex = 0; <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.obsIndex &lt;= 1; <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.obsIndex++) <a class="code" href="classNavEKF.html#ab0b5685a752b604d338b625da5e457d4">FuseOptFlow</a>();</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="comment">// reset flag to indicate that no new flow data is available for fusion</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="comment">// indicate that flow fusion has been performed. This is used for load spreading.</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <a class="code" href="classNavEKF.html#a7d468bceeabf5169403c4b1b146bec63">flowFusePerformed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    }</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="comment">// Apply corrections to quaternion, position and velocity states across several time steps to reduce 10Hz pulsing in the output</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a83bc985fa5b587e5d43f8482f93c763c">flowUpdateCount</a> &lt; <a class="code" href="classNavEKF.html#abf2437b13b0f20096df6b2bd633c4944">flowUpdateCountMax</a>) {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <a class="code" href="classNavEKF.html#a83bc985fa5b587e5d43f8482f93c763c">flowUpdateCount</a> ++;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 9; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] += <a class="code" href="classNavEKF.html#a703d77a71d6bd0be67dcfb9ad1d1eb97">flowIncrStateDelta</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    }</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="comment">// stop the performance timer</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#a09707728fa0e68e4ce49133052ab1d11">_perf_FuseOptFlow</a>);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;}</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">// select fusion of true airspeed measurements</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="classNavEKF.html#a49295ac247658724f852cbec8be83398"> 1062</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a49295ac247658724f852cbec8be83398">NavEKF::SelectTasFusion</a>()</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;{</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">// get true airspeed measurement</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="classNavEKF.html#a6d310b4b28cd5ab824db834feadc83ff">readAirSpdData</a>();</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">// If we haven&#39;t received airspeed data for a while, then declare the airspeed data as being timed out</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a0779a1ae19736ff610bc33032eecefc1">lastAirspeedUpdate</a> &gt; <a class="code" href="classNavEKF.html#a8213661ff081f3e15cbf7293e744fa84">tasRetryTime</a>) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <a class="code" href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">tasTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    }</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">// if the filter is initialised, wind states are not inhibited and we have data to fuse, then perform TAS fusion</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <a class="code" href="classNavEKF.html#aa52bc3aced1667720b90440f2e1d63ee">tasDataWaiting</a> = (<a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a> &amp;&amp; !<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a> &amp;&amp; <a class="code" href="classNavEKF.html#ae0f9a27d62a94d973281b2ee9bae4ac6">newDataTas</a>);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aa52bc3aced1667720b90440f2e1d63ee">tasDataWaiting</a>)</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    {</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="comment">// ensure that the covariance prediction is up to date before fusing data</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a>) <a class="code" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">CovariancePrediction</a>();</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <a class="code" href="classNavEKF.html#af4f4d6647b1e7882dc009af5b475761b">FuseAirspeed</a>();</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <a class="code" href="classNavEKF.html#a00cd23012b3330cc889f02352d3e47d2">TASmsecPrev</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <a class="code" href="classNavEKF.html#aa52bc3aced1667720b90440f2e1d63ee">tasDataWaiting</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <a class="code" href="classNavEKF.html#ae0f9a27d62a94d973281b2ee9bae4ac6">newDataTas</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;}</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">// select fusion of synthetic sideslip measurements</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">// synthetic sidelip fusion only works for fixed wing aircraft and relies on the average sideslip being close to zero</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">// it requires a stable wind for best results and should not be used for aerobatic flight with manoeuvres that induce large sidslip angles (eg knife-edge, spins, etc)</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"><a class="line" href="classNavEKF.html#a8525e5774e083f7187a7c4ed8609fa38"> 1088</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a8525e5774e083f7187a7c4ed8609fa38">NavEKF::SelectBetaFusion</a>()</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;{</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="comment">// set true when the fusion time interval has triggered</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keywordtype">bool</span> f_timeTrigger = ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#aeed006203acc8a02856514f330b17ed7">BETAmsecPrev</a>) &gt;= <a class="code" href="classNavEKF.html#a84907f07399afdb2b7c8562aa5d749b4">msecBetaAvg</a>);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// set true when use of synthetic sideslip fusion is necessary because we have limited sensor data or are dead reckoning position</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordtype">bool</span> f_required = !(<a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">useAirspeed</a>() &amp;&amp; <a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a>);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="comment">// set true when sideslip fusion is feasible (requires zero sideslip assumption to be valid and use of wind states)</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordtype">bool</span> f_feasible = (<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>() &amp;&amp; !<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// use synthetic sideslip fusion if feasible, required and enough time has lapsed since the last fusion</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">if</span> (f_feasible &amp;&amp; f_required &amp;&amp; f_timeTrigger) {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="comment">// ensure that the covariance prediction is up to date before fusing data</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a>) <a class="code" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">CovariancePrediction</a>();</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <a class="code" href="classNavEKF.html#a55bead411e1fd0ed64342bd38e6a83bf">FuseSideslip</a>();</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <a class="code" href="classNavEKF.html#aeed006203acc8a02856514f330b17ed7">BETAmsecPrev</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">// update the quaternion, velocity and position states using IMU measurements</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"><a class="line" href="classNavEKF.html#a6718baa569eff65fb4e317ecf5426598"> 1106</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a6718baa569eff65fb4e317ecf5426598">NavEKF::UpdateStrapdownEquationsNED</a>()</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;{</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> delVelNav;  <span class="comment">// delta velocity vector calculated using a blend of IMU1 and IMU2 data</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> delVelNav1; <span class="comment">// delta velocity vector calculated using IMU1 data</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> delVelNav2; <span class="comment">// delta velocity vector calculated using IMU2 data</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="comment">// remove sensor bias errors</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <a class="code" href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">correctedDelAng</a> = <a class="code" href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">dAngIMU</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a>;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="classNavEKF.html#ad92280e849a014d102950c24f37a0324">correctedDelVel1</a> = <a class="code" href="classNavEKF.html#ae409812bda25d41cf485da8a133c8cf7">dVelIMU1</a>;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <a class="code" href="classNavEKF.html#a98f32795156af6b0de0eadfdd9d304f9">correctedDelVel2</a> = <a class="code" href="classNavEKF.html#a5bf42c72b13a5a1b0055d42627dd8bde">dVelIMU2</a>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <a class="code" href="classNavEKF.html#ad92280e849a014d102950c24f37a0324">correctedDelVel1</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> -= <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">accel_zbias1</a>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <a class="code" href="classNavEKF.html#a98f32795156af6b0de0eadfdd9d304f9">correctedDelVel2</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> -= <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">accel_zbias2</a>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">// use weighted average of both IMU units for delta velocities</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <a class="code" href="classNavEKF.html#a745bb9dd1c9c7377dc8971b4b315f28e">correctedDelVel12</a> = <a class="code" href="classNavEKF.html#ad92280e849a014d102950c24f37a0324">correctedDelVel1</a> * <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a> + <a class="code" href="classNavEKF.html#a98f32795156af6b0de0eadfdd9d304f9">correctedDelVel2</a> * (1.0f - <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="comment">// apply correction for earths rotation rate</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="comment">// % * - and + operators have been overloaded</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <a class="code" href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">correctedDelAng</a>   = correctedDelAng - <a class="code" href="classNavEKF.html#aef1c557739419cc240386b4f3c8e7983">prevTnb</a> * <a class="code" href="classNavEKF.html#a5e82d7eb114f6e4b37f15564c22f46b7">earthRateNED</a>*<a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="comment">// convert the rotation vector to its equivalent quaternion</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <a class="code" href="classNavEKF.html#aa9c0b8027f194f5e4735bc8cfede2503">correctedDelAngQuat</a>.<a class="code" href="classQuaternion.html#a6c21fe33378aa16a33cba869ba4af5dc">from_axis_angle</a>(correctedDelAng);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="comment">// update the quaternion states by rotating from the previous attitude through</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">// the delta angle rotation quaternion and normalise</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a> *= <a class="code" href="classNavEKF.html#aa9c0b8027f194f5e4735bc8cfede2503">correctedDelAngQuat</a>;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">normalize</a>();</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="comment">// calculate the body to nav cosine matrix</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <a class="code" href="classMatrix3.html">Matrix3f</a> Tbn_temp;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#afb7132c9c69a984a40be950a17effeaa">rotation_matrix</a>(Tbn_temp);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <a class="code" href="classNavEKF.html#aef1c557739419cc240386b4f3c8e7983">prevTnb</a> = Tbn_temp.<a class="code" href="classMatrix3.html#a18e2df03dec4abdf11fc9fb60ed7c226">transposed</a>();</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="keywordtype">float</span> delVelGravity1_z = <a class="code" href="AP__Math_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>*<a class="code" href="classNavEKF.html#a42c64f93e6b922ee0e9167c7c9755748">dtDelVel1</a>;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordtype">float</span> delVelGravity2_z = <a class="code" href="AP__Math_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>*<a class="code" href="classNavEKF.html#a708dcd665d3a63193a1efd2ac89e2d8c">dtDelVel2</a>;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keywordtype">float</span> delVelGravity_z = delVelGravity1_z * <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a> + delVelGravity2_z * (1.0f - <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a>);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">// transform body delta velocities to delta velocities in the nav frame</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// * and + operators have been overloaded</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="comment">// blended IMU calc</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    delVelNav  = Tbn_temp*<a class="code" href="classNavEKF.html#a745bb9dd1c9c7377dc8971b4b315f28e">correctedDelVel12</a>;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    delVelNav.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> += delVelGravity_z;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// single IMU calcs</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    delVelNav1 = Tbn_temp*<a class="code" href="classNavEKF.html#ad92280e849a014d102950c24f37a0324">correctedDelVel1</a>;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    delVelNav1.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> += delVelGravity1_z;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    delVelNav2 = Tbn_temp*<a class="code" href="classNavEKF.html#a98f32795156af6b0de0eadfdd9d304f9">correctedDelVel2</a>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    delVelNav2.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> += delVelGravity2_z;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="comment">// calculate the rate of change of velocity (used for launch detect and other functions)</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <a class="code" href="classNavEKF.html#a21191ffbd3559a58c8dfe91b73520b02">velDotNED</a> = delVelNav / <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="comment">// apply a first order lowpass filter</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <a class="code" href="classNavEKF.html#ae9a923b1ced7c82894cbd0c2caebadee">velDotNEDfilt</a> = <a class="code" href="classNavEKF.html#a21191ffbd3559a58c8dfe91b73520b02">velDotNED</a> * 0.05f + <a class="code" href="classNavEKF.html#ae9a923b1ced7c82894cbd0c2caebadee">velDotNEDfilt</a> * 0.95f;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="comment">// calculate a magnitude of the filtered nav acceleration (required for GPS</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="comment">// variance estimation)</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <a class="code" href="classNavEKF.html#aa55218a253ab5ef9c321145d552ccbef">accNavMag</a> = <a class="code" href="classNavEKF.html#ae9a923b1ced7c82894cbd0c2caebadee">velDotNEDfilt</a>.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>();</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <a class="code" href="classNavEKF.html#a6ca946cfb2943450437555b33a8975f0">accNavMagHoriz</a> = <a class="code" href="AP__Math_8cpp.html#afd3767d48a7b20f6d5220a4f8007af00">pythagorous2</a>(<a class="code" href="classNavEKF.html#ae9a923b1ced7c82894cbd0c2caebadee">velDotNEDfilt</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> , <a class="code" href="classNavEKF.html#ae9a923b1ced7c82894cbd0c2caebadee">velDotNEDfilt</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">// save velocity for use in trapezoidal intergration for position calcuation</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> lastVelocity = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> lastVel1     = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">vel1</a>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> lastVel2     = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">vel2</a>;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="comment">// sum delta velocities to get velocity</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a> += delVelNav;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">vel1</a>     += delVelNav1;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">vel2</a>     += delVelNav2;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="comment">// apply a trapezoidal integration to velocities to calculate position</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a> += (<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a> + lastVelocity) * (dtIMUactual*0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#abd2b7c8d517daa27d47b67217a881e17">posD1</a>    += (<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">vel1</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> + lastVel1.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) * (dtIMUactual*0.5f);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#aab01a87c6ad75643a39277a8954a7140">posD2</a>    += (<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">vel2</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> + lastVel2.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) * (dtIMUactual*0.5f);</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">// capture current angular rate to augmented state vector for use by optical flow fusion</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a066d407536e13a4e96b1293528550611">omega</a> = correctedDelAng / <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">// LPF the yaw rate using a 1 second time constant yaw rate and determine if we are doing continual</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">// fast rotations that can cause problems due to gyro scale factor errors.</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordtype">float</span> alphaLPF = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(dtIMUactual, 0.0f, 1.0f);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <a class="code" href="classNavEKF.html#a11268c75bd9e5061c56d9d0776634edc">yawRateFilt</a> += (<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a066d407536e13a4e96b1293528550611">omega</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - <a class="code" href="classNavEKF.html#a11268c75bd9e5061c56d9d0776634edc">yawRateFilt</a>)*alphaLPF;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(<a class="code" href="classNavEKF.html#a11268c75bd9e5061c56d9d0776634edc">yawRateFilt</a>) &gt; 1.0f) {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <a class="code" href="classNavEKF.html#a7a9f26f4c53700ba4f1afac54e9c6ac5">highYawRate</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <a class="code" href="classNavEKF.html#a7a9f26f4c53700ba4f1afac54e9c6ac5">highYawRate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="comment">// limit states to protect against divergence</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="classNavEKF.html#a1d3dccbab86ffda5898048f8f159c00c">ConstrainStates</a>();</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;}</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">// calculate the predicted state covariance matrix</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"><a class="line" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1"> 1201</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">NavEKF::CovariancePrediction</a>()</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;{</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#a178fdcb2e3178a0738ef69bd994a66f1">_perf_CovariancePrediction</a>);</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordtype">float</span> windVelSigma; <span class="comment">// wind velocity 1-sigma process noise - m/s</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordtype">float</span> dAngBiasSigma;<span class="comment">// delta angle bias 1-sigma process noise - rad/s</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordtype">float</span> dVelBiasSigma;<span class="comment">// delta velocity bias 1-sigma process noise - m/s</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordtype">float</span> magEarthSigma;<span class="comment">// earth magnetic field 1-sigma process noise</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordtype">float</span> magBodySigma; <span class="comment">// body magnetic field 1-sigma process noise</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordtype">float</span> daxCov;       <span class="comment">// X axis delta angle variance rad^2</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordtype">float</span> dayCov;       <span class="comment">// Y axis delta angle variance rad^2</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="keywordtype">float</span> dazCov;       <span class="comment">// Z axis delta angle variance rad^2</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordtype">float</span> dvxCov;       <span class="comment">// X axis delta velocity variance (m/s)^2</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordtype">float</span> dvyCov;       <span class="comment">// Y axis delta velocity variance (m/s)^2</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordtype">float</span> dvzCov;       <span class="comment">// Z axis delta velocity variance (m/s)^2</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordtype">float</span> dvx;          <span class="comment">// X axis delta velocity (m/s)</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordtype">float</span> dvy;          <span class="comment">// Y axis delta velocity (m/s)</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordtype">float</span> dvz;          <span class="comment">// Z axis delta velocity (m/s)</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordtype">float</span> dax;          <span class="comment">// X axis delta angle (rad)</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordtype">float</span> day;          <span class="comment">// Y axis delta angle (rad)</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordtype">float</span> daz;          <span class="comment">// Z axis delta angle (rad)</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>;           <span class="comment">// attitude quaternion</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>;           <span class="comment">// attitude quaternion</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;           <span class="comment">// attitude quaternion</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;           <span class="comment">// attitude quaternion</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordtype">float</span> dax_b;        <span class="comment">// X axis delta angle measurement bias (rad)</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordtype">float</span> day_b;        <span class="comment">// Y axis delta angle measurement bias (rad)</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordtype">float</span> daz_b;        <span class="comment">// Z axis delta angle measurement bias (rad)</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordtype">float</span> dvz_b;        <span class="comment">// Z axis delta velocity measurement bias (rad)</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">// calculate covariance prediction process noise</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="comment">// use filtered height rate to increase wind process noise when climbing or descending</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="comment">// this allows for wind gradient effects.</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="comment">// filter height rate using a 10 second time constant filter</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keywordtype">float</span> alpha = 0.1f * <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <a class="code" href="classNavEKF.html#ac9273a0000085f43cceee01c72dcc2cf">hgtRate</a> = <a class="code" href="classNavEKF.html#ac9273a0000085f43cceee01c72dcc2cf">hgtRate</a> * (1.0f - alpha) - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> * alpha;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="comment">// use filtered height rate to increase wind process noise when climbing or descending</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="comment">// this allows for wind gradient effects.</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    if (!<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>) {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        windVelSigma  = <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a921e3fd1bb15e7f2414a9d85b1642fb7">_windVelProcessNoise</a>, 0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) * (1.0f + <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a96fd5d3fe1fa7ec75c5841e7eb99c100">_wndVarHgtRateScale</a>, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) * <a class="code" href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(<a class="code" href="classNavEKF.html#ac9273a0000085f43cceee01c72dcc2cf">hgtRate</a>));</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        windVelSigma  = 0.0f;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    }</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    dAngBiasSigma = <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a2be25c24c75b63c69ec5051b1b6d6c41">_gyroBiasProcessNoise</a>, 1e-7<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1e-5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    dVelBiasSigma = <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a7ca27f8c85733769ea4bfdb723dab655">_accelBiasProcessNoise</a>, 1e-5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1e-3<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        magEarthSigma = <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a6279cd6036a295cdb23eb6791e2b3606">_magEarthProcessNoise</a>, 1e-4<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1e-2<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        magBodySigma  = <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a9325c105b47dc9d869863976933a221a">_magBodyProcessNoise</a>, 1e-4<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1e-2<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        magEarthSigma = 0.0f;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        magBodySigma  = 0.0f;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=9;  <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1.0e-9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=10; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=12; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = dAngBiasSigma;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="comment">// scale gyro bias noise when disarmed to allow for faster bias estimation</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=10; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=12; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = dAngBiasSigma;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;            <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] *= <a class="code" href="classNavEKF.html#aaac625772ab0369814489a172b4ea9e7">gyroBiasNoiseScaler</a>;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        }</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    }</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="comment">// if we are yawing rapidly, inhibit yaw gyro bias learning to prevent gyro scale factor errors from corrupting the bias estimate</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a7a9f26f4c53700ba4f1afac54e9c6ac5">highYawRate</a>) {</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[12] = 0.0f;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12] = 0.0f;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="comment">// scale accel bias noise when disarmed to allow for faster bias estimation</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="comment">// inhibit bias estimation during takeoff with ground effect to prevent bad bias learning</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">expectGndEffectTakeoff</a>) {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[13] = 0.0f;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[13] = dVelBiasSigma * <a class="code" href="classNavEKF.html#ac6c439b358eca4f9a6ada0b8a3fcbafc">accelBiasNoiseScaler</a>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[13] = dVelBiasSigma;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    }</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=14; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=15; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = windVelSigma;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=18; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = magEarthSigma;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=19; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = magBodySigma;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="comment">// set variables used to calculate covariance growth</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    dvx = <a class="code" href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">summedDelVel</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    dvy = <a class="code" href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">summedDelVel</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    dvz = <a class="code" href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">summedDelVel</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    dax = <a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    day = <a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    daz = <a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    q0 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[0];</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    q1 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[1];</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    q2 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[2];</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    q3 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[3];</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    dax_b = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    day_b = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    daz_b = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    dvz_b = <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a> * <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">accel_zbias1</a> + (1.0f - <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a>) * <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">accel_zbias2</a>;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <a class="code" href="classNavEKF.html#a68eb1a5117369ac8f7ceb677d42758ce">_gyrNoise</a> = constrain_float(<a class="code" href="classNavEKF.html#a68eb1a5117369ac8f7ceb677d42758ce">_gyrNoise</a>, 1e-3<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 5e-2<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    daxCov = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*<a class="code" href="classNavEKF.html#a68eb1a5117369ac8f7ceb677d42758ce">_gyrNoise</a>);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    dayCov = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*_gyrNoise);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="comment">// Account for 3% scale factor error on Z angular rate. This reduces chance of continuous fast rotations causing loss of yaw reference.</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    dazCov = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*_gyrNoise) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*0.03<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*<a class="code" href="classNavEKF.html#a11268c75bd9e5061c56d9d0776634edc">yawRateFilt</a>);</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <a class="code" href="classNavEKF.html#ae427875ce4593b477ae259ab7a551c7e">_accNoise</a> = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#ae427875ce4593b477ae259ab7a551c7e">_accNoise</a>, 5e-2<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    dvxCov = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*<a class="code" href="classNavEKF.html#ae427875ce4593b477ae259ab7a551c7e">_accNoise</a>);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    dvyCov = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*_accNoise);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    dvzCov = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*_accNoise);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="comment">// calculate the predicted covariance due to inertial sensor error propagation</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[0] = dvz - dvz_b;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[1] = 2*q3*<a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[0] + 2*dvx*q1 + 2*dvy*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[2] = 2*dvx*q3 - 2*q1*<a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[0] + 2*dvy*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[3] = 2*q2*<a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[0] + 2*dvx*q0 - 2*dvy*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[4] = day/2 - day_b/2;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[5] = daz/2 - daz_b/2;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[6] = dax/2 - dax_b/2;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[7] = dax_b/2 - dax/2;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[8] = daz_b/2 - daz/2;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[9] = day_b/2 - day/2;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[10] = 2*q0*<a class="code" href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">SF</a>[0];</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    SF[11] = q1/2;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    SF[12] = q2/2;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    SF[13] = q3/2;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    SF[14] = 2*dvy*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[0] = q0/2;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[1] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[2] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[3] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[4] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[5] = 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[6] = 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[7] = 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[0] = dvzCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[5] - 2*q0*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[1] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[2] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[3] + <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[4]) - dvyCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[5] + 2*q0*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[1] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[2] + <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[3] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[4]) + dvxCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[6] - 2*q0*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[7] + 2*q0*q3);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[1] = dvzCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[6] + 2*q0*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[1] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[2] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[3] + <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[4]) - dvxCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[6] - 2*q0*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[1] + <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[2] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[3] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[4]) + dvyCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[5] + 2*q0*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[7] - 2*q0*q3);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[2] = dvzCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[5] - 2*q0*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[6] + 2*q0*q2) - dvyCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[7] - 2*q0*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[1] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[2] + <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[3] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[4]) - dvxCov*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[7] + 2*q0*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)*(<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[1] + <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[2] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[3] - <a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[4]);</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[3] = (dayCov*q1*<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[0])/2 - (dazCov*q1*<a class="code" href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">SG</a>[0])/2 - (daxCov*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)/4;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[4] = (dazCov*q2*SG[0])/2 - (daxCov*q2*SG[0])/2 - (dayCov*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)/4;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[5] = (daxCov*q3*SG[0])/2 - (dayCov*q3*SG[0])/2 - (dazCov*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)/4;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[6] = (daxCov*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)/4 - (dazCov*q3*SG[0])/2 - (dayCov*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)/4;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[7] = (dazCov*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)/4 - (daxCov*q1*q3)/4 - (dayCov*q2*SG[0])/2;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[8] = (dayCov*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)/4 - (daxCov*q1*SG[0])/2 - (dazCov*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)/4;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[9] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[0]);</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[10] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[0] = SF[10] + SF[14] - 2*dvx*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[1] = 2*q2*SF[0] + 2*dvx*q0 - 2*dvy*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[2] = 2*dvx*q3 - 2*q1*SF[0] + 2*dvy*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[3] = 2*q0*q1 - 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[4] = 2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[5] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[6] = SF[13];</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[7] = SF[12];</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <a class="code" href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">nextP</a>[0][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*<a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*<a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[6] + (daxCov*<a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[10])/4 + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*<a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*<a class="code" href="classNavEKF.html#a03ae50659f23195842d62d3345397819">SPP</a>[6]) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[6]) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[6]) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[6]) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[6]) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[6]) + (dayCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2))/4 + (dazCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))/4;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <a class="code" href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">nextP</a>[0][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[6] + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[6]) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[6]) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[6]) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[6]) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[6]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[6]))/2;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    nextP[0][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[6] + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[6]) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[6]) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[6]) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[6]) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[6]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[6]))/2;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    nextP[0][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[6] + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[6]) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[6]) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[6]) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[6]) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[6]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[6]))/2;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    nextP[0][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SPP[6] + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[6]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[6]) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[6]) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[6]) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[6]);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    nextP[0][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SPP[6] + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[6]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[6]) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[6]) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[6]) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[6]);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    nextP[0][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*SPP[6] + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[6]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[6]) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[6]) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[6]) - (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[6]);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    nextP[0][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][7]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][7]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][7]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][7]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][7]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][7]*SPP[6] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SPP[6]);</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    nextP[0][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][8]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][8]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][8]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][8]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][8]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][8]*SPP[6] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SPP[6]);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    nextP[0][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][9]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][9]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][9]*SPP[6] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*SPP[6]);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    nextP[0][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[6];</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    nextP[0][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[6];</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    nextP[0][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[6];</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    nextP[0][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[6];</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    nextP[0][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][14]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][14]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][14]*SPP[6];</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    nextP[0][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][15]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][15]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][15]*SPP[6];</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    nextP[0][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16]*SPP[6];</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    nextP[0][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17]*SPP[6];</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    nextP[0][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18]*SPP[6];</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    nextP[0][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][19]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][19]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][19]*SPP[6];</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    nextP[0][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][20]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][20]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][20]*SPP[6];</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    nextP[0][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][21]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][21]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][21]*SPP[6];</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    nextP[1][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*q0)/2) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*q0)/2) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*q0)/2) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*q0)/2) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*q0)/2) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*q0)/2);</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    nextP[1][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[7] + daxCov*<a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[9] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*q0)/2) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*q0)/2) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*q0)/2) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*q0)/2) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*q0)/2) + (dayCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))/4 + (dazCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2))/4 - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*q0)/2))/2;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    nextP[1][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*q0)/2) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*q0)/2) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*q0)/2) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*q0)/2) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*q0)/2) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*q0)/2))/2;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    nextP[1][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*q0)/2) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*q0)/2) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*q0)/2) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*q0)/2) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*q0)/2) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*q0)/2))/2;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    nextP[1][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*q0)/2) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*q0)/2) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*q0)/2) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*q0)/2);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    nextP[1][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*q0)/2) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*q0)/2) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*q0)/2) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*q0)/2);</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    nextP[1][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*q0)/2) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*q0)/2) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*q0)/2) - (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*q0)/2);</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    nextP[1][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][7]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][7]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][7]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][7]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][7]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][7]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*q0)/2);</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    nextP[1][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][8]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][8]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][8]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][8]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][8]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][8]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*q0)/2);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    nextP[1][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][9]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][9]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][9]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*q0)/2);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    nextP[1][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    nextP[1][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    nextP[1][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    nextP[1][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    nextP[1][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][14]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][14]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][14]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    nextP[1][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][15]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][15]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][15]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    nextP[1][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    nextP[1][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    nextP[1][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    nextP[1][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][19]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][19]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][19]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    nextP[1][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][20]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][20]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][20]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    nextP[1][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][21]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][21]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][21]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    nextP[2][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*q0)/2) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*q0)/2) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*q0)/2) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*q0)/2) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*q0)/2) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*q0)/2);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    nextP[2][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*q0)/2) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*q0)/2) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*q0)/2) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*q0)/2) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*q0)/2) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*q0)/2))/2;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    nextP[2][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[6] + dayCov*<a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[9] + (dazCov*<a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[10])/4 - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*q0)/2 + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + (daxCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))/4 - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*q0)/2))/2;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    nextP[2][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*q0)/2) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*q0)/2) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*q0)/2) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*q0)/2) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*q0)/2) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*q0)/2))/2;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    nextP[2][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*q0)/2) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*q0)/2) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*q0)/2) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*q0)/2);</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    nextP[2][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*q0)/2) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*q0)/2) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*q0)/2) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*q0)/2);</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    nextP[2][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*q0)/2) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*q0)/2) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*q0)/2) - (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*q0)/2);</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    nextP[2][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][7]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][7]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][7]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][7]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][7]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][7]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*q0)/2);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    nextP[2][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][8]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][8]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][8]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][8]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][8]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][8]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*q0)/2);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    nextP[2][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][9]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][9]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][9]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*q0)/2);</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    nextP[2][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    nextP[2][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    nextP[2][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    nextP[2][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    nextP[2][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][14]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][14]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][14]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    nextP[2][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][15]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][15]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][15]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    nextP[2][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    nextP[2][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    nextP[2][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    nextP[2][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][19]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][19]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][19]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    nextP[2][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][20]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][20]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][20]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    nextP[2][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][21]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][21]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][21]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    nextP[3][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*q0)/2) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*q0)/2) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*q0)/2) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*q0)/2) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*q0)/2) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*q0)/2);</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    nextP[3][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*q0)/2) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*q0)/2) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*q0)/2) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*q0)/2) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*q0)/2) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*q0)/2))/2;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    nextP[3][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*q0)/2) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*q0)/2) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*q0)/2) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*q0)/2) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*q0)/2) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*q0)/2))/2;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    nextP[3][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[7] + (dayCov*<a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[10])/4 + dazCov*<a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[9] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*q0)/2 + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2) + (daxCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2))/4 - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*q0)/2))/2;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    nextP[3][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*q0)/2) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*q0)/2) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*q0)/2) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*q0)/2);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    nextP[3][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*q0)/2) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*q0)/2) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*q0)/2) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*q0)/2);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    nextP[3][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*q0)/2) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*q0)/2) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*q0)/2) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*q0)/2) - (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*q0)/2);</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    nextP[3][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][7]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][7]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][7]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][7]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][7]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][7]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*q0)/2);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    nextP[3][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][8]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][8]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][8]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][8]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][8]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][8]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*q0)/2);</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    nextP[3][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][9]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][9]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][9]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2 + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*q0)/2);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    nextP[3][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    nextP[3][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    nextP[3][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    nextP[3][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    nextP[3][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][14]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][14]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][14]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    nextP[3][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][15]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][15]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][15]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    nextP[3][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    nextP[3][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    nextP[3][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    nextP[3][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][19]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][19]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][19]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    nextP[3][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][20]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][20]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][20]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    nextP[3][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][21]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][21]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][21]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    nextP[4][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[4] + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[4]) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[4]) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[4]) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[4]) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[4]) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[4]);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    nextP[4][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[4] + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[4]) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[4]) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[4]) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[4]) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[4]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[4]))/2;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    nextP[4][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[4] + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[4]) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[4]) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[4]) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[4]) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[4]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[4]))/2;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    nextP[4][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[4] + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[4]) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[4]) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[4]) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[4]) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[4]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[4]))/2;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    nextP[4][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4]*SPP[4] + dvyCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[7] - 2*q0*q3) + dvzCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[6] + 2*q0*q2) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[4]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[4]) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[4]) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[4]) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[4]) + dvxCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[1] + SG[2] - SG[3] - SG[4]);</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    nextP[4][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5]*SPP[4] + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[4]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[4]) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[4]) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[4]) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[4]);</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    nextP[4][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6]*SPP[4] + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[4]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[4]) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[4]) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[4]) - (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[4]);</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    nextP[4][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][7]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][7]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][7]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][7]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][7]*SPP[4] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4]*SPP[4]);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    nextP[4][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][8]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][8]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][8]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][8]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][8]*SPP[4] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5]*SPP[4]);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    nextP[4][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][9]*SPP[4] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6]*SPP[4]);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    nextP[4][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[4];</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    nextP[4][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[4];</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    nextP[4][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[4];</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    nextP[4][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[4];</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    nextP[4][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][14]*SPP[4];</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    nextP[4][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][15]*SPP[4];</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    nextP[4][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][16]*SPP[4];</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    nextP[4][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][17]*SPP[4];</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    nextP[4][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][18]*SPP[4];</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    nextP[4][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][19]*SPP[4];</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    nextP[4][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][20]*SPP[4];</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    nextP[4][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][21]*SPP[4];</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    nextP[5][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[3] + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[3]) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[3]) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[3]) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[3]) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[3]) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[3]);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    nextP[5][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[3] + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[3]) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[3]) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[3]) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[3]) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[3]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[3]))/2;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    nextP[5][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[3] + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[3]) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[3]) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[3]) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[3]) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[3]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[3]))/2;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    nextP[5][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[3] + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[3]) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[3]) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[3]) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[3]) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[3]) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[3]))/2;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    nextP[5][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4]*SPP[3] + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[3]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[3]) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[3]) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[3]) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[3]);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    nextP[5][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5]*SPP[3] + dvxCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[7] + 2*q0*q3) + dvzCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[5] - 2*q0*q1) + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[3]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[3]) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[3]) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[3]) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[3]) + dvyCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[1] - SG[2] + SG[3] - SG[4]);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    nextP[5][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6]*SPP[3] + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[3]) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[3]) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[3]) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[3]) - (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[3]);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    nextP[5][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][7]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][7]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][7]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][7]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][7]*SPP[3] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4]*SPP[3]);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    nextP[5][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][8]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][8]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][8]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][8]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][8]*SPP[3] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5]*SPP[3]);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    nextP[5][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][9]*SPP[3] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6]*SPP[3]);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    nextP[5][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[3];</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    nextP[5][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[3];</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    nextP[5][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[3];</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    nextP[5][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[3];</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    nextP[5][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][14]*SPP[3];</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    nextP[5][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][15]*SPP[3];</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    nextP[5][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][16]*SPP[3];</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    nextP[5][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][17]*SPP[3];</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    nextP[5][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][18]*SPP[3];</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    nextP[5][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][19]*SPP[3];</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    nextP[5][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][20]*SPP[3];</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    nextP[5][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][21]*SPP[3];</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    nextP[6][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)));</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    nextP[6][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))))/2;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    nextP[6][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))))/2;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    nextP[6][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))))/2;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    nextP[6][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)));</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    nextP[6][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5] + <a class="code" href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">SQ</a>[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)));</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    nextP[6][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + dvxCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[6] - 2*q0*q2) + dvyCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[5] + 2*q0*q1) - SPP[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[5]) + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + dvzCov*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SG[1] - SG[2] - SG[3] + SG[4]);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    nextP[6][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][7]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][7]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][7]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][7]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][7]*SPP[5] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4]*SPP[5]);</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    nextP[6][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][8]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][8]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][8]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][8]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][8]*SPP[5] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5]*SPP[5]);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    nextP[6][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][9]*SPP[5] + <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6]*SPP[5]);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    nextP[6][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][10]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][10]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][10]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][10]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[5];</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    nextP[6][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][11]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][11]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][11]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][11]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[5];</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    nextP[6][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][12]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][12]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][12]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][12]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[5];</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    nextP[6][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][13]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][13]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][13]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][13]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[5];</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    nextP[6][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][14]*SPP[5];</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    nextP[6][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][15]*SPP[5];</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    nextP[6][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][16]*SPP[5];</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    nextP[6][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][17]*SPP[5];</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    nextP[6][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][18]*SPP[5];</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    nextP[6][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][19]*SPP[5];</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    nextP[6][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][20]*SPP[5];</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    nextP[6][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][21]*SPP[5];</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    nextP[7][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10]*dt) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12]*dt);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    nextP[7][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*dt + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*dt) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11]*dt) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10]*dt))/2;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    nextP[7][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*dt + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*dt) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12]*dt) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11]*dt))/2;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    nextP[7][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*dt + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*dt) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11]*dt) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12]*dt))/2;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    nextP[7][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*dt + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*dt) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*dt) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    nextP[7][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*dt + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*dt) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*dt) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    nextP[7][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*dt + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*dt) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*dt) - SPP[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    nextP[7][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][7]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    nextP[7][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][8]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    nextP[7][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][9]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    nextP[7][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    nextP[7][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][11]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    nextP[7][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][12]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    nextP[7][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    nextP[7][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][14]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    nextP[7][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][15]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    nextP[7][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][16]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    nextP[7][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][17]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    nextP[7][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][18]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    nextP[7][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][19]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    nextP[7][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][20]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    nextP[7][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][21]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    nextP[8][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*dt + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*dt) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10]*dt) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12]*dt);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    nextP[8][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*dt + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*dt) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11]*dt) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10]*dt))/2;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    nextP[8][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*dt + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*dt) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12]*dt) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11]*dt))/2;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    nextP[8][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*dt + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*dt) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11]*dt) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12]*dt))/2;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    nextP[8][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*dt + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*dt) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*dt) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    nextP[8][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*dt + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*dt) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*dt) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    nextP[8][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*dt + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*dt) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*dt) - SPP[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    nextP[8][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][7]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    nextP[8][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][8]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    nextP[8][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][9]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    nextP[8][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    nextP[8][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][11]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    nextP[8][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][12]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    nextP[8][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    nextP[8][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][14]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    nextP[8][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][15]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    nextP[8][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][16]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    nextP[8][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][17]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    nextP[8][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][18]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    nextP[8][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][19]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    nextP[8][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][20]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    nextP[8][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][21]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    nextP[9][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*dt + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*dt) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10]*dt) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12]*dt);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    nextP[9][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*dt + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*dt) + SF[9]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11]*dt) - SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10]*dt))/2;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    nextP[9][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*dt + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[8]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*dt) + SF[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12]*dt) - SPP[6]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11]*dt))/2;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    nextP[9][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*dt + SF[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*dt) + SF[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SF[11]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11]*dt) + SPP[7]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - (q0*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12]*dt))/2;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    nextP[9][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*dt + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*dt) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*dt) - SPP[4]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    nextP[9][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*dt + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*dt) + SF[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*dt) + SPP[3]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    nextP[9][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*dt + SF[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) + SF[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*dt) + SPP[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>) - SPP[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*dt) - SPP[5]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    nextP[9][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][7]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    nextP[9][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][8]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    nextP[9][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][9]*dt + dt*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>);</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    nextP[9][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][10] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][10]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    nextP[9][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][11]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    nextP[9][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][12] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][12]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    nextP[9][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][13] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][13]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    nextP[9][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][14] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][14]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    nextP[9][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][15] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][15]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    nextP[9][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][16]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    nextP[9][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][17]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    nextP[9][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][18]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    nextP[9][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][19]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    nextP[9][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][20]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    nextP[9][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][21]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    nextP[10][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[6];</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    nextP[10][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    nextP[10][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    nextP[10][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    nextP[10][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[4];</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    nextP[10][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[3];</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    nextP[10][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13]*SPP[5];</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    nextP[10][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    nextP[10][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    nextP[10][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    nextP[10][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10];</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    nextP[10][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][11];</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    nextP[10][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][12];</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    nextP[10][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][13];</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    nextP[10][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][14];</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    nextP[10][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][15];</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    nextP[10][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16];</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    nextP[10][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17];</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    nextP[10][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18];</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    nextP[10][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][19];</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    nextP[10][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][20];</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    nextP[10][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][21];</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    nextP[11][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[6];</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    nextP[11][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    nextP[11][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    nextP[11][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    nextP[11][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[4];</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    nextP[11][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[3];</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    nextP[11][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13]*SPP[5];</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    nextP[11][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    nextP[11][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    nextP[11][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    nextP[11][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][10];</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    nextP[11][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11];</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    nextP[11][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][12];</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    nextP[11][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][13];</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    nextP[11][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][14];</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    nextP[11][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][15];</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    nextP[11][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16];</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    nextP[11][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17];</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    nextP[11][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18];</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    nextP[11][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][19];</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    nextP[11][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][20];</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    nextP[11][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][21];</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    nextP[12][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[6];</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    nextP[12][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    nextP[12][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    nextP[12][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    nextP[12][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[4];</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    nextP[12][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[3];</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    nextP[12][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13]*SPP[5];</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    nextP[12][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    nextP[12][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    nextP[12][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    nextP[12][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][10];</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    nextP[12][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][11];</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    nextP[12][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12];</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    nextP[12][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][13];</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    nextP[12][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][14];</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    nextP[12][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][15];</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    nextP[12][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16];</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    nextP[12][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17];</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    nextP[12][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18];</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    nextP[12][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][19];</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    nextP[12][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][20];</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    nextP[12][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][21];</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    nextP[13][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[6];</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    nextP[13][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    nextP[13][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    nextP[13][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    nextP[13][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[4];</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    nextP[13][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[3];</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    nextP[13][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13]*SPP[5];</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    nextP[13][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    nextP[13][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    nextP[13][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    nextP[13][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][10];</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    nextP[13][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][11];</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    nextP[13][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][12];</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    nextP[13][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13];</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    nextP[13][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][14];</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    nextP[13][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][15];</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    nextP[13][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][16];</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    nextP[13][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][17];</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    nextP[13][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][18];</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    nextP[13][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][19];</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    nextP[13][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][20];</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    nextP[13][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][21];</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    nextP[14][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][12]*SPP[6];</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    nextP[14][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    nextP[14][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    nextP[14][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    nextP[14][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][13]*SPP[4];</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    nextP[14][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][13]*SPP[3];</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    nextP[14][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][13]*SPP[5];</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    nextP[14][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    nextP[14][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    nextP[14][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    nextP[14][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][10];</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    nextP[14][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][11];</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    nextP[14][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][12];</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    nextP[14][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][13];</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    nextP[14][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14];</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    nextP[14][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][15];</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    nextP[14][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][16];</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    nextP[14][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][17];</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    nextP[14][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][18];</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    nextP[14][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][19];</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    nextP[14][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][20];</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    nextP[14][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][21];</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    nextP[15][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][12]*SPP[6];</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    nextP[15][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    nextP[15][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    nextP[15][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    nextP[15][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][13]*SPP[4];</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    nextP[15][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][13]*SPP[3];</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    nextP[15][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][13]*SPP[5];</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    nextP[15][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    nextP[15][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    nextP[15][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    nextP[15][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][10];</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    nextP[15][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][11];</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    nextP[15][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][12];</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    nextP[15][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][13];</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    nextP[15][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][14];</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    nextP[15][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15];</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    nextP[15][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][16];</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    nextP[15][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][17];</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    nextP[15][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][18];</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    nextP[15][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][19];</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    nextP[15][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][20];</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    nextP[15][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][21];</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    nextP[16][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][12]*SPP[6];</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    nextP[16][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    nextP[16][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    nextP[16][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    nextP[16][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][13]*SPP[4];</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    nextP[16][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][13]*SPP[3];</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    nextP[16][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][13]*SPP[5];</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    nextP[16][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    nextP[16][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    nextP[16][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    nextP[16][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][10];</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    nextP[16][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][11];</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    nextP[16][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][12];</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    nextP[16][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][13];</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    nextP[16][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][14];</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    nextP[16][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][15];</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    nextP[16][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16];</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    nextP[16][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][17];</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    nextP[16][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][18];</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    nextP[16][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][19];</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    nextP[16][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][20];</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    nextP[16][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][21];</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    nextP[17][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][12]*SPP[6];</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    nextP[17][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    nextP[17][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    nextP[17][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    nextP[17][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][13]*SPP[4];</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    nextP[17][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][13]*SPP[3];</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    nextP[17][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][13]*SPP[5];</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    nextP[17][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    nextP[17][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    nextP[17][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    nextP[17][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][10];</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    nextP[17][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][11];</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    nextP[17][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][12];</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    nextP[17][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][13];</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    nextP[17][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][14];</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    nextP[17][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][15];</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    nextP[17][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][16];</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    nextP[17][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17];</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    nextP[17][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][18];</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    nextP[17][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][19];</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    nextP[17][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][20];</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    nextP[17][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][21];</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    nextP[18][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][12]*SPP[6];</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    nextP[18][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    nextP[18][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    nextP[18][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    nextP[18][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][13]*SPP[4];</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    nextP[18][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][13]*SPP[3];</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    nextP[18][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][13]*SPP[5];</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    nextP[18][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    nextP[18][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    nextP[18][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    nextP[18][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][10];</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    nextP[18][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][11];</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    nextP[18][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][12];</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    nextP[18][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][13];</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    nextP[18][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][14];</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    nextP[18][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][15];</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    nextP[18][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][16];</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    nextP[18][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][17];</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    nextP[18][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18];</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    nextP[18][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][19];</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    nextP[18][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][20];</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    nextP[18][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][21];</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    nextP[19][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][12]*SPP[6];</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    nextP[19][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    nextP[19][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    nextP[19][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    nextP[19][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][13]*SPP[4];</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    nextP[19][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][13]*SPP[3];</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    nextP[19][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][13]*SPP[5];</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    nextP[19][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    nextP[19][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    nextP[19][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    nextP[19][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][10];</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    nextP[19][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][11];</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    nextP[19][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][12];</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    nextP[19][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][13];</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    nextP[19][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][14];</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    nextP[19][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][15];</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    nextP[19][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][16];</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    nextP[19][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][17];</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    nextP[19][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][18];</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    nextP[19][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][19];</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    nextP[19][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][20];</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    nextP[19][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][21];</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    nextP[20][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][12]*SPP[6];</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    nextP[20][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    nextP[20][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    nextP[20][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    nextP[20][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][13]*SPP[4];</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    nextP[20][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][13]*SPP[3];</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    nextP[20][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][13]*SPP[5];</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    nextP[20][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    nextP[20][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    nextP[20][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    nextP[20][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][10];</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    nextP[20][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][11];</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    nextP[20][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][12];</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    nextP[20][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][13];</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    nextP[20][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][14];</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    nextP[20][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][15];</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    nextP[20][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][16];</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    nextP[20][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][17];</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    nextP[20][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][18];</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    nextP[20][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][19];</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    nextP[20][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][20];</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    nextP[20][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][21];</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    nextP[21][0] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SF[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][10]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][11]*SPP[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][12]*SPP[6];</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    nextP[21][1] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SF[9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][11]*SPP[6] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][12]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][10]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    nextP[21][2] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SF[8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SF[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][12]*SF[11] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][10]*SPP[6] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][11]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    nextP[21][3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SF[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SF[4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SF[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][11]*SF[11] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][10]*SPP[7] - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][12]*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>)/2;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    nextP[21][4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][4] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SF[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SPP[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][13]*SPP[4];</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    nextP[21][5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SF[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SPP[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][13]*SPP[3];</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    nextP[21][6] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SF[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SF[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SPP[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SPP[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][13]*SPP[5];</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    nextP[21][7] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][4]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    nextP[21][8] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][8] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][5]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    nextP[21][9] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][9] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][6]*<a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a>;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    nextP[21][10] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][10];</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    nextP[21][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][11];</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    nextP[21][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][12];</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    nextP[21][13] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][13];</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    nextP[21][14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][14];</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    nextP[21][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][15];</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    nextP[21][16] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][16];</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    nextP[21][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][17];</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    nextP[21][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][18];</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    nextP[21][19] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][19];</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    nextP[21][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][20];</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    nextP[21][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][21];</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="comment">// add the general state process noise variances</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;= 21; i++)</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    {</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        nextP[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = nextP[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] + <a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    }</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="comment">// if the total position variance exceeds 1e4 (100m), then stop covariance</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="comment">// growth by setting the predicted to the previous values</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    <span class="comment">// This prevent an ill conditioned matrix from occurring for long periods</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="comment">// without GPS</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][8]) &gt; 1e4f)</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    {</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=7; i&lt;=8; i++)</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        {</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            <span class="keywordflow">for</span> (uint8_t j=0; j&lt;=21; j++)</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;            {</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                nextP[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                nextP[j][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[j][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;            }</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        }</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    }</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="comment">// copy covariances to output and fix numerical errors</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <a class="code" href="classNavEKF.html#afaa81e08a98db599f139657cabd99fa7">CopyAndFixCovariances</a>();</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="comment">// constrain diagonals to prevent ill-conditioning</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <a class="code" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">ConstrainVariances</a>();</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <span class="comment">// set the flag to indicate that covariance prediction has been performed and reset the increments used by the covariance prediction</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <a class="code" href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">covPredStep</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <a class="code" href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">summedDelVel</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    dt = 0.0f;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#a178fdcb2e3178a0738ef69bd994a66f1">_perf_CovariancePrediction</a>);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;}</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">// fuse selected position, velocity and height measurements</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"><a class="line" href="classNavEKF.html#a74882eb98d3c69065b640829154a500c"> 1876</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a74882eb98d3c69065b640829154a500c">NavEKF::FuseVelPosNED</a>()</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;{</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="comment">// start performance timer</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#a11e77f9d00e0bcaf0d480d15c5922f29">_perf_FuseVelPosNED</a>);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="comment">// health is set bad until test passed</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <a class="code" href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">velHealth</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <a class="code" href="classNavEKF.html#a514c91480f1d3173fc3f463519c1e3a9">hgtHealth</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="comment">// declare variables used to check measurement errors</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> velInnov;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> velInnov1;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> velInnov2;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="comment">// declare variables used to control access to arrays</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    <span class="keywordtype">bool</span> fuseData[6] = {<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>};</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    uint8_t stateIndex;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    uint8_t <a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="comment">// declare variables used by state and covariance update calculations</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <span class="keywordtype">float</span> posErr;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <a class="code" href="classNavEKF.html#aff54fedb54585c939b417de52da8e37a">Vector6</a> R_OBS; <span class="comment">// Measurement variances used for fusion</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <a class="code" href="classNavEKF.html#aff54fedb54585c939b417de52da8e37a">Vector6</a> R_OBS_DATA_CHECKS; <span class="comment">// Measurement variances used for data checks only</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <a class="code" href="classNavEKF.html#aff54fedb54585c939b417de52da8e37a">Vector6</a> observation;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="keywordtype">float</span> SK;</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="comment">// perform sequential fusion of GPS measurements. This assumes that the</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="comment">// errors in the different velocity and position components are</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="comment">// uncorrelated which is not true, however in the absence of covariance</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="comment">// data from the GPS receiver it is the only assumption we can make</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="comment">// so we might as well take advantage of the computational efficiencies</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="comment">// associated with sequential fusion</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> || <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> || <a class="code" href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">fuseHgtData</a>) {</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        <span class="comment">// if constant position or constant velocity mode use the current states to calculate the predicted</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <span class="comment">// measurement rather than use states from a previous time. We need to do this</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="comment">// because there may be no stored states due to lack of real measurements.</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>) {</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;            <a class="code" href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">statesAtVelTime</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        }</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        <span class="comment">// set the GPS data timeout depending on whether airspeed data is present</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        uint32_t gpsRetryTime;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">useAirspeed</a>()) gpsRetryTime = <a class="code" href="classNavEKF.html#a50054a8af8c2457a5dd91fd443d7dcf3">gpsRetryTimeUseTAS</a>;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        <span class="keywordflow">else</span> gpsRetryTime = <a class="code" href="classNavEKF.html#a3d21102f255ba63c8d37a50ff9abde46">gpsRetryTimeNoTAS</a>;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        <span class="comment">// form the observation vector and zero velocity and horizontal position observations if in constant position mode</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        <span class="comment">// If in constant velocity mode, hold the last known horizontal velocity vector</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>) {</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;            observation[0] = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;            observation[1] = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> + <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;            observation[2] = <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;            observation[3] = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> + <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;            observation[4] = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> + <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>){</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=4; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) observation[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>) {</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;            observation[0] = <a class="code" href="classNavEKF.html#a42c664df5b7a9fb51d590fc3d7791c5d">heldVelNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;            observation[1] = <a class="code" href="classNavEKF.html#a42c664df5b7a9fb51d590fc3d7791c5d">heldVelNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=2; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=4; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) observation[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        }</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        observation[5] = -<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        <span class="comment">// calculate additional error in GPS position caused by manoeuvring</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        posErr = <a class="code" href="classNavEKF.html#a4600ad3e42aba285eb657ef3ce1af512">gpsPosVarAccScale</a> * <a class="code" href="classNavEKF.html#aa55218a253ab5ef9c321145d552ccbef">accNavMag</a>;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <span class="comment">// estimate the GPS Velocity, GPS horiz position and height measurement variances.</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        <span class="comment">// if the GPS is able to report a speed error, we use it to adjust the observation noise for GPS velocity</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        <span class="comment">// otherwise we scale it using manoeuvre acceleration</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;            <span class="comment">// use GPS receivers reported speed accuracy - floor at value set by gps noise parameter</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;            R_OBS[0] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a>, <a class="code" href="classNavEKF.html#a1f1806842e132701a67b46c9f7139e1c">_gpsHorizVelNoise</a>, 50.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            R_OBS[2] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a>, <a class="code" href="classNavEKF.html#aec873372a31572fa3b15829cb0b96c50">_gpsVertVelNoise</a>, 50.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;            <span class="comment">// calculate additional error in GPS velocity caused by manoeuvring</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            R_OBS[0] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a1f1806842e132701a67b46c9f7139e1c">_gpsHorizVelNoise</a>, 0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ab4970d7ec89480a7198a8e3254ac9f30">gpsNEVelVarAccScale</a> * accNavMag);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;            R_OBS[2] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aec873372a31572fa3b15829cb0b96c50">_gpsVertVelNoise</a>,  0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a93570c80357656a5389eee3f186f000a">gpsDVelVarAccScale</a>  * accNavMag);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        }</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        R_OBS[1] = R_OBS[0];</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        R_OBS[3] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aedc86985a1237d4a4a5c68be1a6bc7c4">_gpsHorizPosNoise</a>, 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 10.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(posErr);</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        R_OBS[4] = R_OBS[3];</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        R_OBS[5] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a74e1debc46998128deb7ba6a77e75f29">_baroAltNoise</a>, 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 10.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        <span class="comment">// reduce weighting (increase observation noise) on baro if we are likely to be in ground effect</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a3108596d21f107f9b35517900bb82569">getTakeoffExpected</a>() || <a class="code" href="classNavEKF.html#a22250b5dd5beb633d424ed895659039f">getTouchdownExpected</a>()) &amp;&amp; <a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;            R_OBS[5] *= <a class="code" href="classNavEKF.html#a0499e105467997498b813dbc1af7607e">gndEffectBaroScaler</a>;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        }</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <span class="comment">// For data integrity checks we use the same measurement variances as used to calculate the Kalman gains for all measurements except GPS horizontal velocity</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        <span class="comment">// For horizontal GPs velocity we don&#39;t want the acceptance radius to increase with reported GPS accuracy so we use a value based on best GPs perfomrance</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        <span class="comment">// plus a margin for manoeuvres. It is better to reject GPS horizontal velocity errors early</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=1; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) R_OBS_DATA_CHECKS[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a1f1806842e132701a67b46c9f7139e1c">_gpsHorizVelNoise</a>, 0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ab4970d7ec89480a7198a8e3254ac9f30">gpsNEVelVarAccScale</a> * accNavMag);</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=2; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=5; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) R_OBS_DATA_CHECKS[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = R_OBS[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;        <span class="comment">// if vertical GPS velocity data is being used, check to see if the GPS vertical velocity and barometer</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        <span class="comment">// innovations have the same sign and are outside limits. If so, then it is likely aliasing is affecting</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <span class="comment">// the accelerometers and we should disable the GPS and barometer innovation consistency checks.</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 0 &amp;&amp; <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> &amp;&amp; (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#aebca5af77c541497460468f5f6b4cfcb">lastHgtMeasTime</a>) &lt;  (2 * <a class="code" href="classNavEKF.html#a584f5bca8fd1baa4a42462830cb5151b">msecHgtAvg</a>)) {</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;            <span class="comment">// calculate innovations for height and vertical GPS vel measurements</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            <span class="keywordtype">float</span> hgtErr  = <a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - observation[5];</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;            <span class="keywordtype">float</span> velDErr = <a class="code" href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">statesAtVelTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - observation[2];</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;            <span class="comment">// check if they are the same sign and both more than 3-sigma out of bounds</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;            <span class="keywordflow">if</span> ((hgtErr*velDErr &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) &amp;&amp; (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(hgtErr) &gt; 9.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][9] + R_OBS_DATA_CHECKS[5])) &amp;&amp; (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(velDErr) &gt; 9.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6] + R_OBS_DATA_CHECKS[2]))) {</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                <a class="code" href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">badIMUdata</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                <a class="code" href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">badIMUdata</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            }</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        <span class="comment">// calculate innovations and check GPS data validity using an innovation consistency check</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        <span class="comment">// test position measurements</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a>) {</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;            <span class="comment">// test horizontal position measurements</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;            <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[3] = <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> - observation[3];</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;            <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[4] = <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> - observation[4];</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;            <a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[3] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][7] + R_OBS_DATA_CHECKS[3];</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;            <a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[4] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][8] + R_OBS_DATA_CHECKS[4];</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            <span class="comment">// apply an innovation consistency threshold test, but don&#39;t fail if bad IMU data</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            <span class="comment">// calculate max valid position innovation squared based on a maximum horizontal inertial nav accel error and GPS noise parameter</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            <span class="comment">// max inertial nav error is scaled with horizontal g to allow for increased errors when manoeuvring</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            <span class="keywordtype">float</span> accelScale =  (1.0f + 0.1f * <a class="code" href="classNavEKF.html#aa55218a253ab5ef9c321145d552ccbef">accNavMag</a>);</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            <span class="keywordtype">float</span> maxPosInnov2 = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ab5af5cb7fb1076a855e4eacebc14daba">_gpsPosInnovGate</a> * <a class="code" href="classNavEKF.html#aedc86985a1237d4a4a5c68be1a6bc7c4">_gpsHorizPosNoise</a>) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(0.005<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * accelScale * <span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#ab6af69aeaca1965e2a45c0eabd9d78c5">_gpsGlitchAccelMax</a>) * <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * <span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a8c72f168838db6b818956a87fa640f0e">lastPosPassTime</a>)));</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            <a class="code" href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">posTestRatio</a> = (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[3]) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[4])) / maxPosInnov2;</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            <a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a> = ((<a class="code" href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">posTestRatio</a> &lt; 1.0f) || <a class="code" href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">badIMUdata</a>);</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            <span class="comment">// declare a timeout condition if we have been too long without data or not aiding</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;            <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = (((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a8c72f168838db6b818956a87fa640f0e">lastPosPassTime</a>) &gt; gpsRetryTime) || <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>);</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;            <span class="comment">// use position data if healthy, timed out, or in constant position mode</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a> || <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                <a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                <span class="comment">// only reset the failed time and do glitch timeout checks if we are doing full aiding</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>) {</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                    <a class="code" href="classNavEKF.html#a8c72f168838db6b818956a87fa640f0e">lastPosPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                    <span class="comment">// if timed out or outside the specified glitch radius, increment the offset applied to GPS data to compensate for large GPS position jumps</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> || (maxPosInnov2 &gt; <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#a2b605aa62bb5ce81f9d0cccaa3ad0f0b">_gpsGlitchRadiusMax</a>)))) {</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                        <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> += <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[3];</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                        <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> += <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[4];</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                        <span class="comment">// limit the radius of the offset and decay the offset to zero radially</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                        <a class="code" href="classNavEKF.html#a55a6ae919135e4deef0cffe2eca3ac80">decayGpsOffset</a>();</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                        <span class="comment">// reset the position to the current GPS position which will include the glitch correction offset</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                        <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                        <span class="comment">// reset the velocity to the GPS velocity</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                        <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                        <span class="comment">// don&#39;t fuse data on this time step</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                        <a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                        <span class="comment">// record the fail time</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                        <a class="code" href="classNavEKF.html#a9f5a7e05866a566fd9243727906f636f">lastPosFailTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                        <span class="comment">// Reset the normalised innovation to avoid false failing the bad position fusion test</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                        <a class="code" href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">posTestRatio</a> = 0.0f;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                    }</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                }</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                <a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            }</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        }</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        <span class="comment">// test velocity measurements</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a>) {</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;            <span class="comment">// test velocity measurements</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            uint8_t imax = 2;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 1 || <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>) {</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                imax = 1;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            }</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;            <span class="keywordtype">float</span> K1 = 0; <span class="comment">// innovation to error ratio for IMU1</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;            <span class="keywordtype">float</span> K2 = 0; <span class="comment">// innovation to error ratio for IMU2</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            <span class="keywordtype">float</span> innovVelSumSq = 0; <span class="comment">// sum of squares of velocity innovations</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;            <span class="keywordtype">float</span> varVelSum = 0; <span class="comment">// sum of velocity innovation variances</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=imax; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                <span class="comment">// velocity states start at index 4</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                stateIndex   = <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> + 4;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                <span class="comment">// calculate innovations using blended and single IMU predicted states</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                velInnov[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]  = <a class="code" href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">statesAtVelTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - observation[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]; <span class="comment">// blended</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                velInnov1[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">statesAtVelTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">vel1</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - observation[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]; <span class="comment">// IMU1</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                velInnov2[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">statesAtVelTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">vel2</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - observation[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]; <span class="comment">// IMU2</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                <span class="comment">// calculate innovation variance</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                <a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[stateIndex][stateIndex] + R_OBS_DATA_CHECKS[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                <span class="comment">// calculate error weightings for single IMU velocity states using</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                <span class="comment">// observation error to normalise</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                <span class="keywordtype">float</span> R_hgt;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> == 2) {</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                    R_hgt = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aec873372a31572fa3b15829cb0b96c50">_gpsVertVelNoise</a>, 0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                    R_hgt = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a1f1806842e132701a67b46c9f7139e1c">_gpsHorizVelNoise</a>, 0.05<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;                }</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                K1 += R_hgt / (R_hgt + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(velInnov1[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;                K2 += R_hgt / (R_hgt + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(velInnov2[i]));</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                <span class="comment">// sum the innovation and innovation variances</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                innovVelSumSq += <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(velInnov[i]);</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                varVelSum += <a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;            }</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;            <span class="comment">// calculate weighting used by fuseVelPosNED to do IMU accel data blending</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;            <span class="comment">// this is used to detect and compensate for aliasing errors with the accelerometers</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;            <span class="comment">// provide for a first order lowpass filter to reduce noise on the weighting if required</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            <span class="comment">// set weighting to 0.5 when on ground to allow more rapid learning of bias errors without &#39;ringing&#39; in bias estimates</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a> = 1.0f * (K1 / (K1 + K2)) + 0.0f * <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a>; <span class="comment">// filter currently inactive</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a> = 0.5f;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            }</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;            <span class="comment">// apply an innovation consistency threshold test, but don&#39;t fail if bad IMU data</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            <span class="comment">// calculate the test ratio</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;            <a class="code" href="classNavEKF.html#a96245bb1cbb49e89c52e282b38d00c7a">velTestRatio</a> = innovVelSumSq / (varVelSum * <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aaff17cca139a3ba16009e124e3e7ec0f">_gpsVelInnovGate</a>));</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            <span class="comment">// fail if the ratio is greater than 1</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;            <a class="code" href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">velHealth</a> = ((<a class="code" href="classNavEKF.html#a96245bb1cbb49e89c52e282b38d00c7a">velTestRatio</a> &lt; 1.0f)  || <a class="code" href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">badIMUdata</a>);</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;            <span class="comment">// declare a timeout if we have not fused velocity data for too long or not aiding</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;            <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = (((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a532d96729dba3c794df2de8c36890fba">lastVelPassTime</a>) &gt; gpsRetryTime) || <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>);</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;            <span class="comment">// if data is healthy  or in constant velocity mode we fuse it</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">velHealth</a> || <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> || <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>) {</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                <a class="code" href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">velHealth</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;                <span class="comment">// restart the timeout count</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                <a class="code" href="classNavEKF.html#a532d96729dba3c794df2de8c36890fba">lastVelPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> &amp;&amp; !<a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a> &amp;&amp; <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>) {</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                <span class="comment">// if data is not healthy and timed out and position is unhealthy and we are using aiding, we reset the velocity, but do not fuse data on this time step</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;                <a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> =  <span class="keyword">false</span>;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                <span class="comment">// if data is unhealthy and position is healthy, we do not fuse it</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                <a class="code" href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">velHealth</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;            }</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        }</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="comment">// test height measurements</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">fuseHgtData</a>) {</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            <span class="comment">// calculate height innovations</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;            <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[5] = <a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - observation[5];</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            <a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[5] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][9] + R_OBS_DATA_CHECKS[5];</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;            <span class="comment">// calculate the innovation consistency test ratio</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;            <a class="code" href="classNavEKF.html#a96c31aaedf02ab8cc9f33c7da1d85fd8">hgtTestRatio</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[5]) / (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a90a0fa8431a481fc2809734fee931610">_hgtInnovGate</a>) * <a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[5]);</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;            <span class="comment">// fail if the ratio is &gt; 1, but don&#39;t fail if bad IMU data</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;            <a class="code" href="classNavEKF.html#a514c91480f1d3173fc3f463519c1e3a9">hgtHealth</a> = ((<a class="code" href="classNavEKF.html#a96c31aaedf02ab8cc9f33c7da1d85fd8">hgtTestRatio</a> &lt; 1.0f) || <a class="code" href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">badIMUdata</a>);</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;            <a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a> = (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a269fafed960b894f2f170bdb66e367dd">lastHgtPassTime</a>) &gt; <a class="code" href="classNavEKF.html#a202ea1c0d365a297b1619730b0110678">hgtRetryTime</a>;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            <span class="comment">// Fuse height data if healthy or timed out or in constant position mode</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a514c91480f1d3173fc3f463519c1e3a9">hgtHealth</a> || <a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a> || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                <a class="code" href="classNavEKF.html#a514c91480f1d3173fc3f463519c1e3a9">hgtHealth</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                <a class="code" href="classNavEKF.html#a269fafed960b894f2f170bdb66e367dd">lastHgtPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                <span class="comment">// if timed out, reset the height, but do not fuse data on this time step</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a>) {</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                    <a class="code" href="classNavEKF.html#a469538f4ff5dd6886d8db2be0acd3b48">ResetHeight</a>();</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                    <a class="code" href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">fuseHgtData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                }</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            }</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                <a class="code" href="classNavEKF.html#a514c91480f1d3173fc3f463519c1e3a9">hgtHealth</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;            }</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        }</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        <span class="comment">// set range for sequential fusion of velocity and position measurements depending on which data is available and its health</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> &amp;&amp; <a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 0 &amp;&amp; <a class="code" href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">velHealth</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> &amp;&amp; <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>) {</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            fuseData[0] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            fuseData[1] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            fuseData[2] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        }</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">fuseVelData</a> &amp;&amp; <a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 1 &amp;&amp; <a class="code" href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">velHealth</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> &amp;&amp; <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>) {</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;            fuseData[0] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;            fuseData[1] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a22317183f862c0e772190633317d77e7">fusePosData</a> &amp;&amp; <a class="code" href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">posHealth</a> &amp;&amp; <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>) || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;            fuseData[3] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;            fuseData[4] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        }</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">fuseHgtData</a> &amp;&amp; <a class="code" href="classNavEKF.html#a514c91480f1d3173fc3f463519c1e3a9">hgtHealth</a>) || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;            fuseData[5] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        }</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>) {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;            fuseData[0] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            fuseData[1] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;        }</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        <span class="comment">// fuse measurements sequentially</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="keywordflow">for</span> (obsIndex=0; obsIndex&lt;=5; obsIndex++) {</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            <span class="keywordflow">if</span> (fuseData[obsIndex]) {</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                stateIndex = 4 + <a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                <span class="comment">// calculate the measurement innovation, using states from a different time coordinate if fusing height data</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                <span class="comment">// adjust scaling on GPS measurement noise variances if not enough satellites</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                <span class="keywordflow">if</span> (obsIndex &lt;= 2)</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                {</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                    <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] = <a class="code" href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">statesAtVelTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] - observation[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                    R_OBS[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] *= <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a33123d9b5a1a7551b2c0a7c1addea560">gpsNoiseScaler</a>);</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                }</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obsIndex == 3 || obsIndex == 4) {</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;                    <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] = <a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[obsIndex-3] - observation[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                    R_OBS[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] *= <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a33123d9b5a1a7551b2c0a7c1addea560">gpsNoiseScaler</a>);</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                    <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] = <a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[obsIndex-3] - observation[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                    <span class="keywordflow">if</span> (obsIndex == 5) {</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> gndMaxBaroErr = 4.0f;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> gndBaroInnovFloor = -0.5f;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="classNavEKF.html#a22250b5dd5beb633d424ed895659039f">getTouchdownExpected</a>()) {</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                            <span class="comment">// when a touchdown is expected, floor the barometer innovation at gndBaroInnovFloor</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                            <span class="comment">// constrain the correction between 0 and gndBaroInnovFloor+gndMaxBaroErr</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                            <span class="comment">// this function looks like this:</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                            <span class="comment">//         |/</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                            <span class="comment">//---------|---------</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                            <span class="comment">//    ____/|</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                            <span class="comment">//   /     |</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                            <span class="comment">//  /      |</span></div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                            <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[5] += <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(-<a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[5]+gndBaroInnovFloor, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, gndBaroInnovFloor+gndMaxBaroErr);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                        }</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                    }</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                }</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                <span class="comment">// calculate the Kalman gain and calculate innovation variances</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                <a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[stateIndex][stateIndex] + R_OBS[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;                SK = 1.0f/<a class="code" href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">varInnovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=12; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][stateIndex]*SK;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;                }</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                <span class="comment">// Only height and height rate observations are used to update z accel bias estimate</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                <span class="comment">// Protect Kalman gain from ill-conditioning</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                <span class="comment">// Don&#39;t update Z accel bias if off-level by greater than 60 degrees to avoid scale factor error effects</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                <span class="comment">// Don&#39;t update if we are taking off with ground effect</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                <span class="keywordflow">if</span> ((obsIndex == 5 || obsIndex == 2) &amp;&amp; <a class="code" href="classNavEKF.html#aef1c557739419cc240386b4f3c8e7983">prevTnb</a>.<a class="code" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> &gt; 0.5f &amp;&amp; !<a class="code" href="classNavEKF.html#a3108596d21f107f9b35517900bb82569">getTakeoffExpected</a>()) {</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[13] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][stateIndex]*SK,-1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[13] = 0.0f;</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                }</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                <span class="comment">// inhibit wind state estimation by setting Kalman gains to zero</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>) {</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[14] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][stateIndex]*SK;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][stateIndex]*SK;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[14] = 0.0f;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[15] = 0.0f;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                <span class="comment">// inhibit magnetic field state estimation by setting Kalman gains to zero</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][stateIndex]*SK;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                    }</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                    }</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                }</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                <span class="comment">// Set the Kalman gain values for the single IMU states</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[22] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[13]; <span class="comment">// IMU2 Z accel bias</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[26] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[9];  <span class="comment">// IMU1 posD</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[30] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[9];  <span class="comment">// IMU2 posD</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=2; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>+23] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>+4]; <span class="comment">// IMU1 velNED</span></div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                    <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>+27] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>+4]; <span class="comment">// IMU2 velNED</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                }</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                <span class="comment">// Correct states that have been predicted using single (not blended) IMU data</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                <span class="keywordflow">if</span> (obsIndex == 5){</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                    <span class="comment">// Calculate height measurement innovations using single IMU states</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                    <span class="keywordtype">float</span> hgtInnov1 = <a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#abd2b7c8d517daa27d47b67217a881e17">posD1</a> - observation[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                    <span class="keywordtype">float</span> hgtInnov2 = <a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#aab01a87c6ad75643a39277a8954a7140">posD2</a> - observation[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                        <span class="comment">// Correct single IMU prediction states using height measurement, limiting rate of change of bias to 0.005 m/s3</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                        <span class="keywordtype">float</span> correctionLimit = 0.005f * <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> * <a class="code" href="classNavEKF.html#a770d6516e6b4e7a2fb3ba5a81dda54d6">dtVelPos</a>;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">accel_zbias1</a> -= <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[13] * hgtInnov1, -correctionLimit, correctionLimit); <span class="comment">// IMU1 Z accel bias</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">accel_zbias2</a> -= <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[22] * hgtInnov2, -correctionLimit, correctionLimit); <span class="comment">// IMU2 Z accel bias</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                        <span class="comment">// When disarmed, do not rate limit accel bias learning</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">accel_zbias1</a> -= <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[13] * hgtInnov1; <span class="comment">// IMU1 Z accel bias</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">accel_zbias2</a> -= <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[22] * hgtInnov2; <span class="comment">// IMU2 Z accel bias</span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                    }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 23; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=26; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                        <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * hgtInnov1; <span class="comment">// IMU1 velNED,posD</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                    }</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;                    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 27; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=30; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;                        <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * hgtInnov2; <span class="comment">// IMU2 velNED,posD</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                    }</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obsIndex == 0 || obsIndex == 1 || obsIndex == 2) {</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                    <span class="comment">// Correct single IMU prediction states using velocity measurements</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 23; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=26; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                        <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * velInnov1[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>]; <span class="comment">// IMU1 velNED,posD</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                    }</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 27; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=30; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                        <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * velInnov2[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>]; <span class="comment">// IMU2 velNED,posD</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                    }</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                }</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                <span class="comment">// calculate state corrections and re-normalise the quaternions for states predicted using the blended IMU data</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                <span class="comment">// attitude, velocity and position corrections are spread across multiple prediction cycles between now</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                <span class="comment">// and the anticipated time for the next measurement.</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                <span class="comment">// Don&#39;t spread quaternion corrections if total angle change across predicted interval is going to exceed 0.1 rad</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                <span class="comment">// Don&#39;t apply corrections to Z bias state as this has been done already as part of the single IMU calculations</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                <span class="keywordtype">bool</span> highRates = ((<a class="code" href="classNavEKF.html#ac149423cfc4aeaf0d3e8128d2334190e">gpsUpdateCountMax</a> * <a class="code" href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">correctedDelAng</a>.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>()) &gt; 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> != 13) {</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                        <span class="keywordflow">if</span> ((<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 3 &amp;&amp; highRates) || <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= 10 || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> || <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a>) {</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                            <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                            <span class="keywordflow">if</span> (obsIndex == 5) {</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                                <a class="code" href="classNavEKF.html#a1849d7cc900d9c76dfcfee92e9ede03d">hgtIncrStateDelta</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] * <a class="code" href="classNavEKF.html#aa4a74b46cabd98bf20f38e957e8562e3">hgtUpdateCountMaxInv</a>;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                                <a class="code" href="classNavEKF.html#a878cd2073d88522b03e3f6a972bacf3c">gpsIncrStateDelta</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] * <a class="code" href="classNavEKF.html#a99a20e876b5b008663c831da43ab44e7">gpsUpdateCountMaxInv</a>;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                            }</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                        }</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                    }</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                }</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">normalize</a>();</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                <span class="comment">// update the covariance - take advantage of direct observation of a single state at index = stateIndex to reduce computations</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                <span class="comment">// this is a numerically optimised implementation of standard equation P = (I - K*H)*P;</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                    <span class="keywordflow">for</span> (uint8_t j= 0; j&lt;=21; j++)</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                    {</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                        <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[stateIndex][j];</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                    }</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                }</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                    <span class="keywordflow">for</span> (uint8_t j= 0; j&lt;=21; j++) {</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                        <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] - <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                    }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                }</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;            }</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        }</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    }</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="comment">// force the covariance matrix to be symmetrical and limit the variances to prevent ill-condiioning.</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    <a class="code" href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb">ForceSymmetry</a>();</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <a class="code" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">ConstrainVariances</a>();</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="comment">// stop performance timer</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#a11e77f9d00e0bcaf0d480d15c5922f29">_perf_FuseVelPosNED</a>);</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;}</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment">// fuse magnetometer measurements and apply innovation consistency checks</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">// fuse each axis on consecutive time steps to spread computional load</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"><a class="line" href="classNavEKF.html#af2a003bbd6abea81eae93d2c2faf8bfa"> 2305</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#af2a003bbd6abea81eae93d2c2faf8bfa">NavEKF::FuseMagnetometer</a>()</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;{</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;    <span class="comment">// declarations</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.q0;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.q1;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.q2;</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.q3;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a2740f69c3b0d44a9758ad49fb06021aa">magN</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.magN;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a9edf7bed6dcbaaecf7c3f88e9cc2daa9">magE</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.magE;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a2edd60a03392bb20f9f5de0da6b6f7d3">magD</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.magD;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a9abbd1ebe9283e85acb9a76a04e31039">magXbias</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.magXbias;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#aa91014258fb5b42fa4e1c33353f775ef">magYbias</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.magYbias;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a7ee46142ad96265b38516044aa506906">magZbias</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.magZbias;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    uint8_t &amp;<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.obsIndex;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <a class="code" href="classMatrix3.html">Matrix3f</a> &amp;<a class="code" href="classNavEKF.html#ae88087f9cdf8baa6d5f5d7106d682a80">DCM</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.DCM;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> &amp;<a class="code" href="classNavEKF.html#a04bc3b07fd94968b70effec730d3b829">MagPred</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.MagPred;</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#ad8f659aaf64d57f01bfe8a677c15aa2f">R_MAG</a> = <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.R_MAG;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> *<a class="code" href="classNavEKF.html#a69ee0fc8083369854d0df69078454a67">SH_MAG</a> = &amp;<a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.SH_MAG[0];</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <a class="code" href="classNavEKF.html#aa655860e29ea497ab4b38f6c38f047bc">Vector22</a> H_MAG;</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    <a class="code" href="classNavEKF.html#aff54fedb54585c939b417de52da8e37a">Vector6</a> SK_MX;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <a class="code" href="classNavEKF.html#aff54fedb54585c939b417de52da8e37a">Vector6</a> SK_MY;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    <a class="code" href="classNavEKF.html#aff54fedb54585c939b417de52da8e37a">Vector6</a> SK_MZ;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <span class="comment">// perform sequential fusion of magnetometer measurements.</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    <span class="comment">// this assumes that the errors in the different components are</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    <span class="comment">// uncorrelated which is not true, however in the absence of covariance</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="comment">// data fit is the only assumption we can make</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    <span class="comment">// so we might as well take advantage of the computational efficiencies</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <span class="comment">// associated with sequential fusion</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    <span class="comment">// calculate observation jacobians and Kalman gains</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="keywordflow">if</span> (obsIndex == 0)</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        <span class="comment">// copy required states to local variable names</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        q0       = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[0];</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;        q1       = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[1];</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;        q2       = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[2];</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;        q3       = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[3];</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;        magN     = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a>[0];</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;        magE     = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a>[1];</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;        magD     = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a>[2];</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;        magXbias = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>[0];</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;        magYbias = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>[1];</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;        magZbias = <a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>[2];</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;        <span class="comment">// rotate predicted earth components into body axes and calculate</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;        <span class="comment">// predicted measurements</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;        DCM[0][0] = q0*q0 + q1*q1 - q2*q2 - q3*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;        DCM[0][1] = 2*(q1*q2 + q0*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>);</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;        DCM[0][2] = 2*(q1*q3-q0*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;        DCM[1][0] = 2*(q1*q2 - q0*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>);</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;        DCM[1][1] = q0*q0 - q1*q1 + q2*q2 - q3*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;        DCM[1][2] = 2*(q2*q3 + q0*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>);</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;        DCM[2][0] = 2*(q1*q3 + q0*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;        DCM[2][1] = 2*(q2*q3 - q0*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>);</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;        DCM[2][2] = q0*q0 - q1*q1 - q2*q2 + q3*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        MagPred[0] = DCM[0][0]*magN + DCM[0][1]*magE  + DCM[0][2]*magD + <a class="code" href="classNavEKF.html#a9abbd1ebe9283e85acb9a76a04e31039">magXbias</a>;</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        MagPred[1] = DCM[1][0]*magN + DCM[1][1]*magE  + DCM[1][2]*magD + <a class="code" href="classNavEKF.html#aa91014258fb5b42fa4e1c33353f775ef">magYbias</a>;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        MagPred[2] = DCM[2][0]*magN + DCM[2][1]*magE  + DCM[2][2]*magD + <a class="code" href="classNavEKF.html#a7ee46142ad96265b38516044aa506906">magZbias</a>;</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;        <span class="comment">// scale magnetometer observation error with total angular rate</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        R_MAG = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#ae388459b6238501b7689d371cba355fc">_magNoise</a>, 0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a8f54918dd49fe509a6f95c2ee0a590e0">magVarRateScale</a>*<a class="code" href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">dAngIMU</a>.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>() / <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>);</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;        <span class="comment">// calculate observation jacobians</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;        SH_MAG[0] = 2*magD*q3 + 2*magE*q2 + 2*magN*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;        SH_MAG[1] = 2*magD*q0 - 2*magE*q1 + 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;        SH_MAG[2] = 2*magD*q1 + 2*magE*q0 - 2*magN*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;        SH_MAG[3] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;        SH_MAG[4] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2);</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;        SH_MAG[5] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1);</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;        SH_MAG[6] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0);</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;        SH_MAG[7] = 2*magN*<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        SH_MAG[8] = 2*magE*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) H_MAG[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        H_MAG[0] = SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;        H_MAG[1] = SH_MAG[0];</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        H_MAG[2] = 2*magE*q1 - 2*magD*q0 - 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        H_MAG[3] = SH_MAG[2];</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;        H_MAG[16] = SH_MAG[5] - SH_MAG[4] - SH_MAG[3] + SH_MAG[6];</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;        H_MAG[17] = 2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        H_MAG[18] = 2*q1*q3 - 2*q0*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        H_MAG[19] = 1;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        <span class="comment">// calculate Kalman gain</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <span class="keywordtype">float</span> temp = (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][19] + R_MAG + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][19]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) - (2*magD*q0 - 2*magE*q1 + 2*magN*q2)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*(2*q0*q3 + 2*q1*q2) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*(2*magD*q0 - 2*magE*q1 + 2*magN*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + (SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*(2*q0*q2 - 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*(2*magD*q0 - 2*magE*q1 + 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + SH_MAG[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*(2*q0*q2 - 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*(2*magD*q0 - 2*magE*q1 + 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + SH_MAG[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*(2*q0*q2 - 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*(2*magD*q0 - 2*magE*q1 + 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) - (SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][16]*(2*q0*q3 + 2*q1*q2) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][16]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*(2*magD*q0 - 2*magE*q1 + 2*magN*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][19]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][19]*(2*q0*q2 - 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19]*(2*magD*q0 - 2*magE*q1 + 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + (2*q0*q3 + 2*q1*q2)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][17]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17]*(2*q0*q3 + 2*q1*q2) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][17]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*(2*magD*q0 - 2*magE*q1 + 2*magN*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - (2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SH_MAG[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][18]*(SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][18]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18]*(2*q0*q2 - 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*(2*magD*q0 - 2*magE*q1 + 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2));</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;        <span class="keywordflow">if</span> (temp &gt;= R_MAG) {</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;            SK_MX[0] = 1.0f / temp;</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_xmag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;            <span class="comment">// the calculation is badly conditioned, so we cannot perform fusion on this step</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;            <span class="comment">// we increase the state variances and try again next time</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][19] += 0.1f*<a class="code" href="classNavEKF.html#ad8f659aaf64d57f01bfe8a677c15aa2f">R_MAG</a>;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;            obsIndex = 1;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_xmag = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        }</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;        SK_MX[1] = SH_MAG[3] + SH_MAG[4] - SH_MAG[5] - SH_MAG[6];</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;        SK_MX[2] = 2*magD*q0 - 2*magE*q1 + 2*magN*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        SK_MX[3] = SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        SK_MX[4] = 2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        SK_MX[5] = 2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[0] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SK_MX[4]);</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[1] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SK_MX[4]);</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        Kfusion[2] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SK_MX[4]);</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        Kfusion[3] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SK_MX[4]);</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;        Kfusion[4] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][18]*SK_MX[4]);</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        Kfusion[5] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][18]*SK_MX[4]);</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        Kfusion[6] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][18]*SK_MX[4]);</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        Kfusion[7] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][18]*SK_MX[4]);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        Kfusion[8] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][18]*SK_MX[4]);</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        Kfusion[9] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][18]*SK_MX[4]);</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        Kfusion[10] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18]*SK_MX[4]);</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;        Kfusion[11] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18]*SK_MX[4]);</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        Kfusion[12] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18]*SK_MX[4]);</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <span class="comment">// this term has been zeroed to improve stability of the Z accel bias</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        Kfusion[13] = 0.0f;<span class="comment">//SK_MX[0]*(P[13][19] + P[13][1]*SH_MAG[0] + P[13][3]*SH_MAG[2] + P[13][0]*SK_MX[3] - P[13][2]*SK_MX[2] - P[13][16]*SK_MX[1] + P[13][17]*SK_MX[5] - P[13][18]*SK_MX[4]);</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        <span class="comment">// zero Kalman gains to inhibit wind state estimation</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>) {</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;            Kfusion[14] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][18]*SK_MX[4]);</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;            Kfusion[15] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][18]*SK_MX[4]);</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;            Kfusion[14] = 0.0f;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;            Kfusion[15] = 0.0f;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        }</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <span class="comment">// zero Kalman gains to inhibit magnetic field state estimation</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;            Kfusion[16] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][18]*SK_MX[4]);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;            Kfusion[17] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][18]*SK_MX[4]);</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            Kfusion[18] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18]*SK_MX[4]);</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;            Kfusion[19] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][18]*SK_MX[4]);</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;            Kfusion[20] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][18]*SK_MX[4]);</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            Kfusion[21] = SK_MX[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][19] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SK_MX[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SK_MX[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][16]*SK_MX[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][17]*SK_MX[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][18]*SK_MX[4]);</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            }</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;        }</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;        <span class="comment">// calculate the observation innovation variance</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;        <a class="code" href="classNavEKF.html#aab032ee99a4313ffb2ef124b0d1d61a9">varInnovMag</a>[0] = 1.0f/SK_MX[0];</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <span class="comment">// reset the observation index to 0 (we start by fusing the X measurement)</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        obsIndex = 0;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;        <span class="comment">// set flags to indicate to other processes that fusion has been performed and is required on the next frame</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        <span class="comment">// this can be used by other fusion processes to avoid fusing on the same frame as this expensive step</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        <a class="code" href="classNavEKF.html#a91042776d706028291bd771fc20bfc7c">magFusePerformed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;        <a class="code" href="classNavEKF.html#a036b68726cb71dd62ac61bae01e0832a">magFuseRequired</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    }</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obsIndex == 1) <span class="comment">// we are now fusing the Y measurement</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    {</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;        <span class="comment">// calculate observation jacobians</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) H_MAG[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;        H_MAG[0] = SH_MAG[2];</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        H_MAG[1] = SH_MAG[1];</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        H_MAG[2] = SH_MAG[0];</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;        H_MAG[3] = 2*magD*q2 - SH_MAG[8] - SH_MAG[7];</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;        H_MAG[16] = 2*q1*q2 - 2*q0*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        H_MAG[17] = SH_MAG[4] - SH_MAG[3] - SH_MAG[5] + SH_MAG[6];</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;        H_MAG[18] = 2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;        H_MAG[20] = 1;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <span class="comment">// calculate Kalman gain</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;        <span class="keywordtype">float</span> temp = (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][20] + R_MAG + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][20]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - (2*q0*q3 - 2*q1*q2)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][16]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16]*(2*q0*q3 - 2*q1*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][16]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + (2*q0*q1 + 2*q2*q3)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][18]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][18]*(2*q0*q3 - 2*q1*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) - (SH_MAG[7] + SH_MAG[8] - 2*magD*q2)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*(2*q0*q3 - 2*q1*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][20]*(2*q0*q3 - 2*q1*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][20]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_MAG[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*(2*q0*q1 + 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + SH_MAG[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*(2*q0*q3 - 2*q1*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + SH_MAG[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*(2*q0*q1 + 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - (SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17]*(SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][17]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][17]*(2*q0*q1 + 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>));</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;        <span class="keywordflow">if</span> (temp &gt;= R_MAG) {</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;            SK_MY[0] = 1.0f / temp;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_ymag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;            <span class="comment">// the calculation is badly conditioned, so we cannot perform fusion on this step</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;            <span class="comment">// we increase the state variances and try again next time</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][20] += 0.1f*<a class="code" href="classNavEKF.html#ad8f659aaf64d57f01bfe8a677c15aa2f">R_MAG</a>;</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            obsIndex = 2;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_ymag = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        }</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;        SK_MY[1] = SH_MAG[3] - SH_MAG[4] + SH_MAG[5] - SH_MAG[6];</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        SK_MY[2] = SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        SK_MY[3] = 2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        SK_MY[4] = 2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[0] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SK_MY[4]);</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[1] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SK_MY[4]);</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        Kfusion[2] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SK_MY[4]);</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        Kfusion[3] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SK_MY[4]);</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        Kfusion[4] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][18]*SK_MY[4]);</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;        Kfusion[5] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][18]*SK_MY[4]);</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        Kfusion[6] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][18]*SK_MY[4]);</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        Kfusion[7] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][18]*SK_MY[4]);</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        Kfusion[8] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][18]*SK_MY[4]);</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        Kfusion[9] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][18]*SK_MY[4]);</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        Kfusion[10] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18]*SK_MY[4]);</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        Kfusion[11] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18]*SK_MY[4]);</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        Kfusion[12] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18]*SK_MY[4]);</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        <span class="comment">// this term has been zeroed to improve stability of the Z accel bias</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;        Kfusion[13] = 0.0f;<span class="comment">//SK_MY[0]*(P[13][20] + P[13][0]*SH_MAG[2] + P[13][1]*SH_MAG[1] + P[13][2]*SH_MAG[0] - P[13][3]*SK_MY[2] - P[13][17]*SK_MY[1] - P[13][16]*SK_MY[3] + P[13][18]*SK_MY[4]);</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        <span class="comment">// zero Kalman gains to inhibit wind state estimation</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>) {</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;            Kfusion[14] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][18]*SK_MY[4]);</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            Kfusion[15] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][18]*SK_MY[4]);</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;            Kfusion[14] = 0.0f;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;            Kfusion[15] = 0.0f;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;        }</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;        <span class="comment">// zero Kalman gains to inhibit magnetic field state estimation</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            Kfusion[16] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][18]*SK_MY[4]);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            Kfusion[17] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][18]*SK_MY[4]);</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;            Kfusion[18] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18]*SK_MY[4]);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            Kfusion[19] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][18]*SK_MY[4]);</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            Kfusion[20] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][18]*SK_MY[4]);</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            Kfusion[21] = SK_MY[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][20] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SH_MAG[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SK_MY[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][17]*SK_MY[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][16]*SK_MY[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][18]*SK_MY[4]);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;        }</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;        <span class="comment">// calculate the observation innovation variance</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;        <a class="code" href="classNavEKF.html#aab032ee99a4313ffb2ef124b0d1d61a9">varInnovMag</a>[1] = 1.0f/SK_MY[0];</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        <span class="comment">// set flags to indicate to other processes that fusion has been performede and is required on the next frame</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="comment">// this can be used by other fusion processes to avoid fusing on the same frame as this expensive step</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        <a class="code" href="classNavEKF.html#a91042776d706028291bd771fc20bfc7c">magFusePerformed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;        <a class="code" href="classNavEKF.html#a036b68726cb71dd62ac61bae01e0832a">magFuseRequired</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    }</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obsIndex == 2) <span class="comment">// we are now fusing the Z measurement</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    {</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        <span class="comment">// calculate observation jacobians</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) H_MAG[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        H_MAG[0] = SH_MAG[1];</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        H_MAG[1] = 2*magN*q3 - 2*magE*q0 - 2*magD*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        H_MAG[2] = SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        H_MAG[3] = SH_MAG[0];</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        H_MAG[16] = 2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        H_MAG[17] = 2*q2*q3 - 2*q0*<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>;</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        H_MAG[18] = SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6];</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        H_MAG[21] = 1;</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        <span class="comment">// calculate Kalman gain</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <span class="keywordtype">float</span> temp = (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][21] + R_MAG + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][21]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) - (2*magD*q1 + 2*magE*q0 - 2*magN*q3)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*(2*q0*q2 + 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*(2*q0*q1 - 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*(2*magD*q1 + 2*magE*q0 - 2*magN*q3) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + (SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*(2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*(2*q0*q1 - 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*(2*magD*q1 + 2*magE*q0 - 2*magN*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + SH_MAG[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*(2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*(2*q0*q1 - 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*(2*magD*q1 + 2*magE*q0 - 2*magN*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + SH_MAG[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*(2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*(2*q0*q1 - 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*(2*magD*q1 + 2*magE*q0 - 2*magN*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + (SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][18] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][18]*(2*q0*q2 + 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][18]*(2*q0*q1 - 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*(2*magD*q1 + 2*magE*q0 - 2*magN*q3) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][21]*(2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][21]*(2*q0*q1 - 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21]*(2*magD*q1 + 2*magE*q0 - 2*magN*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + (2*q0*q2 + 2*q1*q3)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][16] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][16]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16]*(2*q0*q2 + 2*q1*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][16]*(2*q0*q1 - 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*(2*magD*q1 + 2*magE*q0 - 2*magN*q3) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*(SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - (2*q0*q1 - 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][17] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SH_MAG[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][17]*(SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][17]*(2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17]*(2*q0*q1 - 2*q2*q3) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*(2*magD*q1 + 2*magE*q0 - 2*magN*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21]*(SH_MAG[7] + SH_MAG[8] - 2*magD*q2));</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <span class="keywordflow">if</span> (temp &gt;= R_MAG) {</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;            SK_MZ[0] = 1.0f / temp;</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_zmag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;            <span class="comment">// the calculation is badly conditioned, so we cannot perform fusion on this step</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;            <span class="comment">// we increase the state variances and try again next time</span></div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][21] += 0.1f*<a class="code" href="classNavEKF.html#ad8f659aaf64d57f01bfe8a677c15aa2f">R_MAG</a>;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;            obsIndex = 3;</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_zmag = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        }</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;        SK_MZ[1] = SH_MAG[3] - SH_MAG[4] - SH_MAG[5] + SH_MAG[6];</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        SK_MZ[2] = 2*magD*q1 + 2*magE*q0 - 2*magN*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        SK_MZ[3] = SH_MAG[7] + SH_MAG[8] - 2*magD*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        SK_MZ[4] = 2*q0*q1 - 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        SK_MZ[5] = 2*q0*q2 + 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[0] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[1] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;        Kfusion[2] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        Kfusion[3] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;        Kfusion[4] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        Kfusion[5] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;        Kfusion[6] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        Kfusion[7] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        Kfusion[8] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        Kfusion[9] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;        Kfusion[10] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        Kfusion[11] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        Kfusion[12] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        <span class="comment">// this term has been zeroed to improve stability of the Z accel bias</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;        Kfusion[13] = 0.0f;<span class="comment">//SK_MZ[0]*(P[13][21] + P[13][0]*SH_MAG[1] + P[13][3]*SH_MAG[0] - P[13][1]*SK_MZ[2] + P[13][2]*SK_MZ[3] + P[13][18]*SK_MZ[1] + P[13][16]*SK_MZ[5] - P[13][17]*SK_MZ[4]);</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        <span class="comment">// zero Kalman gains to inhibit wind state estimation</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>) {</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;            Kfusion[14] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;            Kfusion[15] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;            Kfusion[14] = 0.0f;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;            Kfusion[15] = 0.0f;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        }</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;        <span class="comment">// zero Kalman gains to inhibit magnetic field state estimation</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            Kfusion[16] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            Kfusion[17] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;            Kfusion[18] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;            Kfusion[19] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;            Kfusion[20] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;            Kfusion[21] = SK_MZ[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][21] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SH_MAG[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SH_MAG[0] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SK_MZ[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SK_MZ[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][18]*SK_MZ[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][16]*SK_MZ[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][17]*SK_MZ[4]);</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;            }</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        }</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        <span class="comment">// calculate the observation innovation variance</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        <a class="code" href="classNavEKF.html#aab032ee99a4313ffb2ef124b0d1d61a9">varInnovMag</a>[2] = 1.0f/SK_MZ[0];</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        <span class="comment">// set flags to indicate to other processes that fusion has been performede and is required on the next frame</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <span class="comment">// this can be used by other fusion processes to avoid fusing on the same frame as this expensive step</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        <a class="code" href="classNavEKF.html#a91042776d706028291bd771fc20bfc7c">magFusePerformed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;        <a class="code" href="classNavEKF.html#a036b68726cb71dd62ac61bae01e0832a">magFuseRequired</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    }</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    <span class="comment">// calculate the measurement innovation</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <a class="code" href="classNavEKF.html#a4b96227e0553b69fa0882d3adc0a2877">innovMag</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] = MagPred[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] - <a class="code" href="classNavEKF.html#aee2794d28212ecbeb58ba7fa5fedb543">magData</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    <span class="comment">// calculate the innovation test ratio</span></div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a4b96227e0553b69fa0882d3adc0a2877">innovMag</a>[obsIndex]) / (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a2d3826764619f06308d9390eb798b7c2">_magInnovGate</a>) * <a class="code" href="classNavEKF.html#aab032ee99a4313ffb2ef124b0d1d61a9">varInnovMag</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>]);</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    <span class="comment">// check the last values from all components and set magnetometer health accordingly</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    <a class="code" href="classNavEKF.html#ac5bd4b5c0717d17f66f4a97f647368ac">magHealth</a> = (<a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>[0] &lt; 1.0f &amp;&amp; <a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>[1] &lt; 1.0f &amp;&amp; <a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>[2] &lt; 1.0f);</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="comment">// Don&#39;t fuse unless all componenets pass. The exception is if the bad health has timed out and we are not a fly forward vehicle</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    <span class="comment">// In this case we might as well try using the magnetometer, but with a reduced weighting</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ac5bd4b5c0717d17f66f4a97f647368ac">magHealth</a> || ((<a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>[obsIndex] &lt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) &amp;&amp; !<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a8072f31f08434518f5a27ad06ce6d2b5">magTimeout</a>)) {</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;        <span class="comment">// Attitude, velocity and position corrections are averaged across multiple prediction cycles between now and the anticipated time for the next measurement.</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;        <span class="comment">// Don&#39;t do averaging of quaternion state corrections if total angle change across predicted interval is going to exceed 0.1 rad</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;        <span class="keywordtype">bool</span> highRates = ((<a class="code" href="classNavEKF.html#a0e431c75e932225df5190a5e3e9d72c9">magUpdateCountMax</a> * <a class="code" href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">correctedDelAng</a>.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>()) &gt; 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;        <span class="comment">// Calculate the number of averaging frames left to go. This is required becasue magnetometer fusion is applied across three consecutive prediction cycles</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;        <span class="comment">// There is no point averaging if the number of cycles left is less than 2</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        <span class="keywordtype">float</span> minorFramesToGo = float(<a class="code" href="classNavEKF.html#a0e431c75e932225df5190a5e3e9d72c9">magUpdateCountMax</a>) - float(<a class="code" href="classNavEKF.html#a63ede7463be667d9ac34509ea5414a2d">magUpdateCount</a>);</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;        <span class="comment">// correct the state vector or store corrections to be applied incrementally</span></div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;        <span class="keywordflow">for</span> (uint8_t j= 0; j&lt;=21; j++) {</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;            <span class="comment">// If we are forced to use a bad compass in flight, we reduce the weighting by a factor of 4</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#ac5bd4b5c0717d17f66f4a97f647368ac">magHealth</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[j] *= 0.25f;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;            }</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;            <span class="comment">// If in the air and there is no other form of heading reference or we are yawing rapidly which creates larger inertial yaw errors,</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;            <span class="comment">// we strengthen the magnetometer attitude correction</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; (<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> || <a class="code" href="classNavEKF.html#a7a9f26f4c53700ba4f1afac54e9c6ac5">highYawRate</a>) &amp;&amp; j &lt;= 3) {</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[j] *= 4.0f;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;            }</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;            <span class="comment">// We don&#39;t need to spread corrections for non-dynamic states or if we are in a  constant postion mode</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;            <span class="comment">// We can&#39;t spread corrections if there is not enough time remaining</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;            <span class="comment">// We don&#39;t spread corrections to attitude states if we are rotating rapidly</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;            <span class="keywordflow">if</span> ((j &lt;= 3 &amp;&amp; highRates) || j &gt;= 10 || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> || minorFramesToGo &lt; 1.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> ) {</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[j] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[j] - <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[j] * <a class="code" href="classNavEKF.html#a4b96227e0553b69fa0882d3adc0a2877">innovMag</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                <span class="comment">// scale the correction based on the number of averaging frames left to go</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                <a class="code" href="classNavEKF.html#a5ea1ecbce4372b7cb77fd19e6142a1aa">magIncrStateDelta</a>[j] -= <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[j] * <a class="code" href="classNavEKF.html#a4b96227e0553b69fa0882d3adc0a2877">innovMag</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] * (<a class="code" href="classNavEKF.html#a7312c13dafe6b36bf4703f10dd57aa2d">magUpdateCountMaxInv</a> * float(<a class="code" href="classNavEKF.html#a0e431c75e932225df5190a5e3e9d72c9">magUpdateCountMax</a>) / minorFramesToGo);</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;            }</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;        }</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        <span class="comment">// normalise the quaternion states</span></div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">normalize</a>();</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        <span class="comment">// correct the covariance P = (I - K*H)*P</span></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        <span class="comment">// take advantage of the empty columns in KH to reduce the</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        <span class="comment">// number of operations</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=3; j++) {</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_MAG[j];</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;            }</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 4; j&lt;=15; j++) {</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0f;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;            }</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 16; j&lt;=21; j++) {</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                    <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_MAG[j];</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                }</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 16; j&lt;=21; j++) {</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                    <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0f;</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                }</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            }</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        }</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=21; j++) {</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                <span class="keywordflow">for</span> (uint8_t k = 0; k&lt;=3; k++) {</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                    <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[k][j];</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                }</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                    <span class="keywordflow">for</span> (uint8_t k = 16; k&lt;=21; k++) {</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                        <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[k][j];</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                    }</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                }</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;            }</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        }</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=21; j++) {</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] - <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;            }</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        }</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;    }</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    <span class="comment">// force the covariance matrix to be symmetrical and limit the variances to prevent</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    <span class="comment">// ill-condiioning.</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    <a class="code" href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb">ForceSymmetry</a>();</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <a class="code" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">ConstrainVariances</a>();</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;}</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="comment">Estimation of terrain offset using a single state EKF</span></div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="comment">The filter can fuse motion compensated optiocal flow rates and range finder measurements</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"><a class="line" href="classNavEKF.html#a1c2beb90156edd9a4383c7d652b7ef7e"> 2692</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a1c2beb90156edd9a4383c7d652b7ef7e">NavEKF::EstimateTerrainOffset</a>()</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;{</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="comment">// start performance timer</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#aec5be73c28730c3f9c6cf4a908e6c26e">_perf_OpticalFlowEKF</a>);</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    <span class="comment">// constrain height above ground to be above range measured on ground</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <span class="keywordtype">float</span> heightAboveGndEst = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>), <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    <span class="comment">// calculate a predicted LOS rate squared</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    <span class="keywordtype">float</span> velHorizSq = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    <span class="keywordtype">float</span> losRateSq = velHorizSq / <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(heightAboveGndEst);</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <span class="comment">// don&#39;t update terrain offset state if there is no range finder and not generating enough LOS rate, or without GPS, as it is poorly observable</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a0f328969ff5f2ed7349d760661a65a62">fuseRngData</a> &amp;&amp; (<a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a> || <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20">AID_RELATIVE</a> || velHorizSq &lt; 25.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> || losRateSq &lt; 0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> || <a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a>)) {</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        <a class="code" href="classNavEKF.html#a68aa4d3ae31fc58ca9cdc21cdd4e2799">inhibitGndState</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;        <a class="code" href="classNavEKF.html#a68aa4d3ae31fc58ca9cdc21cdd4e2799">inhibitGndState</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;        <span class="comment">// record the time we last updated the terrain offset state</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        <a class="code" href="classNavEKF.html#ae04d7990ade9e35561c1cb3759267196">gndHgtValidTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        <span class="comment">// propagate ground position state noise each time this is called using the difference in position since the last observations and an RMS gradient assumption</span></div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        <span class="comment">// limit distance to prevent intialisation afer bad gps causing bad numerical conditioning</span></div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="keywordtype">float</span> distanceTravelledSq = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[0] - <a class="code" href="classNavEKF.html#a736a3224673c62453aaf9a9035d1470a">prevPosN</a>) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[1] - <a class="code" href="classNavEKF.html#a67e6b67640dd6b3b44b35b6406c47c6e">prevPosE</a>);</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;        distanceTravelledSq = <a class="code" href="AP__Math_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(distanceTravelledSq, 100.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;        <a class="code" href="classNavEKF.html#a736a3224673c62453aaf9a9035d1470a">prevPosN</a> = <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[0];</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        <a class="code" href="classNavEKF.html#a67e6b67640dd6b3b44b35b6406c47c6e">prevPosE</a> = <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[1];</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;        <span class="comment">// in addition to a terrain gradient error model, we also have a time based error growth that is scaled using the gradient parameter</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <span class="keywordtype">float</span> timeLapsed = <a class="code" href="AP__Math_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a2d27879e22f14746869d7152f57e5667">timeAtLastAuxEKF_ms</a>), 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        <span class="keywordtype">float</span> Pincrement = (distanceTravelledSq * <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#aeaae7c89924a1c30e39b67e9e6d97e28">_gndGradientSigma</a>))) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#aeaae7c89924a1c30e39b67e9e6d97e28">_gndGradientSigma</a>) * timeLapsed);</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;        <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> += Pincrement;</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;        <a class="code" href="classNavEKF.html#a2d27879e22f14746869d7152f57e5667">timeAtLastAuxEKF_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        <span class="comment">// fuse range finder data</span></div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0f328969ff5f2ed7349d760661a65a62">fuseRngData</a>) {</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;            <span class="comment">// predict range</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;            <span class="keywordtype">float</span> predRngMeas = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2]),<a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>) / <a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a>.<a class="code" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            <span class="comment">// Copy required states to local variable names</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a> = <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[0]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a> = <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[1]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a> = <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[2]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a> = <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[3]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;            <span class="comment">// Set range finder measurement noise variance. TODO make this a function of range and tilt to allow for sensor, alignment and AHRS errors</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;            <span class="keywordtype">float</span> R_RNG = 0.5f;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;            <span class="comment">// calculate Kalman gain</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;            <span class="keywordtype">float</span> SK_RNG = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;            <span class="keywordtype">float</span> K_RNG = <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>/(SK_RNG*(R_RNG + <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SK_RNG)));</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;            <span class="comment">// Calculate the innovation variance for data logging</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;            <a class="code" href="classNavEKF.html#aa7a1c636e5f17f79265bab234dfac5c9">varInnovRng</a> = (R_RNG + <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SK_RNG));</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;            <span class="comment">// constrain terrain height to be below the vehicle</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;            <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>, <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2] + <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;            <span class="comment">// Calculate the measurement innovation</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;            <a class="code" href="classNavEKF.html#a7834f68e34b1d9541d1836661b02571d">innovRng</a> = predRngMeas - <a class="code" href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">rngMea</a>;</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;            <span class="comment">// calculate the innovation consistency test ratio</span></div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;            <a class="code" href="classNavEKF.html#a1b60b100325aafb18a11331ccb1ab15e">auxRngTestRatio</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a7834f68e34b1d9541d1836661b02571d">innovRng</a>) / (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a08ea3fd0ddbdb4153eedeb6f43a7352c">_rngInnovGate</a>) * <a class="code" href="classNavEKF.html#aa7a1c636e5f17f79265bab234dfac5c9">varInnovRng</a>);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;            <span class="comment">// Check the innovation for consistency and don&#39;t fuse if &gt; 5Sigma</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a7834f68e34b1d9541d1836661b02571d">innovRng</a>)*SK_RNG) &lt; 25.0f)</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;            {</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                <span class="comment">// correct the state</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> -= K_RNG * <a class="code" href="classNavEKF.html#a7834f68e34b1d9541d1836661b02571d">innovRng</a>;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                <span class="comment">// constrain the state</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>, <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2] + <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                <span class="comment">// correct the covariance</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> = <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>)/(SK_RNG*(R_RNG + <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SK_RNG))*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)));</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                <span class="comment">// prevent the state variance from becoming negative</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>,0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;            }</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        }</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#af87a2a59a63349321588523f47027747">fuseOptFlowData</a>) {</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;            <a class="code" href="classVector3.html">Vector3f</a> vel; <span class="comment">// velocity of sensor relative to ground in NED axes</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;            <a class="code" href="classVector3.html">Vector3f</a> relVelSensor; <span class="comment">// velocity of sensor relative to ground in sensor axes</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#adf35d8ce1fae088bf19de6c0b8d9fc26">losPred</a>; <span class="comment">// predicted optical flow angular rate measurement</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a> = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[0]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a> = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[1]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a> = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[2]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a> = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[3]; <span class="comment">// quaternion at optical flow measurement time</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;            <span class="keywordtype">float</span> K_OPT;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;            <span class="keywordtype">float</span> H_OPT;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;            <span class="comment">// Correct velocities for GPS glitch recovery offset</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;            vel.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>          = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[0] - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;            vel.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>          = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[1] - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;            vel.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>          = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[2];</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;            <span class="comment">// predict range to centre of image</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;            <span class="keywordtype">float</span> flowRngPred = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2]),<a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>) / <a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a>.<a class="code" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;            <span class="comment">// constrain terrain height to be below the vehicle</span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;            <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>, <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2] + <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;            <span class="comment">// calculate relative velocity in sensor frame</span></div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;            relVelSensor = <a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a>*vel;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;            <span class="comment">// divide velocity by range, subtract body rates and apply scale factor to</span></div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;            <span class="comment">// get predicted sensed angular optical rates relative to X and Y sensor axes</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;            losPred =   relVelSensor.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>()/flowRngPred;</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;            <span class="comment">// calculate innovations</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;            <a class="code" href="classNavEKF.html#ac046341898f80930a42b4827c2c66f98">auxFlowObsInnov</a> = losPred - <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[0]) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[1]));</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;            <span class="comment">// calculate observation jacobian</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#ad63ffee70a630b49aa4e5677ad59c3a9">t3</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0);</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#ae95ab11d59379638967673bd74654b2a">t4</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1);</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a7c3c3fcc625241253a23a2b68805d0a7">t5</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2);</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a4adccacc4492780e962b0b872360b081">t6</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#abb28cf0ad28ee53d88665f63178d4f88">t10</a> = q0*q3*2.0f;</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a8ff29a8a8c15df0fe2b26ca482f2a548">t11</a> = q1*q2*2.0f;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a2af8cc9d990e7ff559392286c7120c1f">t14</a> = t3+t4-t5-<a class="code" href="calcH__MAG_8c.html#a4adccacc4492780e962b0b872360b081">t6</a>;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#ad5dd8be9d3136630d1ab0c84d00f8bed">t15</a> = t14*vel.x;</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a6d9d60005c3b44698c855beacdaaa49e">t16</a> = t10+<a class="code" href="calcH__MAG_8c.html#a8ff29a8a8c15df0fe2b26ca482f2a548">t11</a>;</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a15011398a338800188c9c7a86078d230">t17</a> = t16*vel.y;</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a11a516f80538ab08ec10562101bdc1e7">t18</a> = q0*q2*2.0f;</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a3a58fa912c1355cab719e7537e61a055">t19</a> = q1*q3*2.0f;</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#afb611b7759e2b83202e0f3bb9ea1b1f1">t20</a> = t18-<a class="code" href="calcH__MAG_8c.html#a3a58fa912c1355cab719e7537e61a055">t19</a>;</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#aff3592d4298ab52727456d4e8ce6c18b">t21</a> = t20*vel.z;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a24aeadb733f27244ec14e4cba82eeee9">t2</a> = t15+t17-<a class="code" href="calcH__MAG_8c.html#aff3592d4298ab52727456d4e8ce6c18b">t21</a>;</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#afe975e201ce16d25813c239a1d21e8c9">t7</a> = t3-t4-t5+<a class="code" href="calcH__MAG_8c.html#a4adccacc4492780e962b0b872360b081">t6</a>;</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a804705b86ec3b055a1b0f8d8baf6e6b4">t8</a> = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2]-<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>;</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a8450c19ec690232a7ab0a967df04e469">t9</a> = 1.0f/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(t8);</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#ab31e784050f8ae27dacd42839540e397">t24</a> = t3-t4+t5-<a class="code" href="calcH__MAG_8c.html#a4adccacc4492780e962b0b872360b081">t6</a>;</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a254d1982103c648403924dc00c845301">t25</a> = t24*vel.y;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a17c89aaaeb13a9f784b22070c92a90b5">t26</a> = t10-<a class="code" href="calcH__MAG_8c.html#a8ff29a8a8c15df0fe2b26ca482f2a548">t11</a>;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a0b0052b773b95089b9fccc7d02009d8d">t27</a> = t26*vel.x;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a8ce5f52ee45362cd73431e43eafd7ebb">t28</a> = q0*q1*2.0f;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a8f776ff561231966d9c72ec06e1b56f9">t29</a> = q2*q3*2.0f;</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a21a7899aa064a08635b4233f4f00b658">t30</a> = t28+<a class="code" href="calcH__MAG_8c.html#a8f776ff561231966d9c72ec06e1b56f9">t29</a>;</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a892ea9ef8352f64c8fc3e4fd4ded1bca">t31</a> = t30*vel.z;</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a22dd0f659b148ac74a104caa972e6790">t12</a> = t25-t27+<a class="code" href="calcH__MAG_8c.html#a892ea9ef8352f64c8fc3e4fd4ded1bca">t31</a>;</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a5e2e9fd0ef3ef01661ed47b760169514">t13</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(t7);</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#adb7f8988295b809f49f25c5842228d6a">t22</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(t2);</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#a96994a7b9809909fd8f626cfad5a0cfa">t23</a> = 1.0f/(t8*t8*<a class="code" href="calcH__MAG_8c.html#a804705b86ec3b055a1b0f8d8baf6e6b4">t8</a>);</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;            <span class="keywordtype">float</span> <a class="code" href="calcH__MAG_8c.html#ad3ddc628cd252634272d1818f00c7981">t32</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(t12);</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;            H_OPT = 0.5f*(t13*t22*t23*2.0f+t13*t23*t32*2.0f)/<a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(t9*t13*t22+t9*t13*t32);</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;            <span class="comment">// calculate innovation variances</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;            <a class="code" href="classNavEKF.html#ac06c4870764d286cc4661233c07fec30">auxFlowObsInnovVar</a> = H_OPT*<a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>*H_OPT + <a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a>;</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;            <span class="comment">// calculate Kalman gain</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;            K_OPT = <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>*H_OPT/<a class="code" href="classNavEKF.html#ac06c4870764d286cc4661233c07fec30">auxFlowObsInnovVar</a>;</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            <span class="comment">// calculate the innovation consistency test ratio</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;            <a class="code" href="classNavEKF.html#a91fee108e5fe9e1201be3552e8b8e9d1">auxFlowTestRatio</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ac046341898f80930a42b4827c2c66f98">auxFlowObsInnov</a>) / (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aa86e0ec11ec5c3abe9b13b69377298ff">_flowInnovGate</a>) * <a class="code" href="classNavEKF.html#ac06c4870764d286cc4661233c07fec30">auxFlowObsInnovVar</a>);</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;            <span class="comment">// don&#39;t fuse if optical flow data is outside valid range</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[0],<a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[1]) &lt; <a class="code" href="classNavEKF.html#adcdf19a4bd79530aaac0fb6b49acca3f">_maxFlowRate</a>) {</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;            <span class="comment">// correct the state</span></div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;            <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> -= K_OPT * <a class="code" href="classNavEKF.html#ac046341898f80930a42b4827c2c66f98">auxFlowObsInnov</a>;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;            <span class="comment">// constrain the state</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;            <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>, <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2] + <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;            <span class="comment">// correct the covariance</span></div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;            <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> = <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> - K_OPT * H_OPT * <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;            <span class="comment">// prevent the state variances from becoming negative</span></div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            Popt = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(Popt,0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;            }</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        }</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    }</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="comment">// stop the performance timer</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#aec5be73c28730c3f9c6cf4a908e6c26e">_perf_OpticalFlowEKF</a>);</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;}</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div>
<div class="line"><a name="l02871"></a><span class="lineno"><a class="line" href="classNavEKF.html#ab0b5685a752b604d338b625da5e457d4"> 2871</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#ab0b5685a752b604d338b625da5e457d4">NavEKF::FuseOptFlow</a>()</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;{</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    <a class="code" href="classNavEKF.html#aa655860e29ea497ab4b38f6c38f047bc">Vector22</a> H_LOS;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <a class="code" href="classNavEKF.html#ae5da79f131b7cf151054f0d31bc19afe">Vector8</a> tempVar;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> velNED_local;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> relVelSensor;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    uint8_t &amp;<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.obsIndex;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.q0;</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.q1;</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.q2;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.q3;</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> *<a class="code" href="classNavEKF.html#aeb79ccc4b0cf30d9accb79b76820f151">SH_LOS</a> = &amp;<a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.SH_LOS[0];</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> *<a class="code" href="classNavEKF.html#aa08107820e13ef44bf7a9325c713365b">SK_LOS</a> = &amp;<a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.SK_LOS[0];</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.vn;</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#ab9f414948d3220b44f9737db742a6c6c">ve</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.ve;</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.vd;</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> &amp;<a class="code" href="classNavEKF.html#a6931a7d21e31405f2f50b672daa82218">pd</a> = <a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.pd;</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;    <a class="code" href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">ftype</a> *<a class="code" href="classNavEKF.html#adf35d8ce1fae088bf19de6c0b8d9fc26">losPred</a> = &amp;<a class="code" href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">flow_state</a>.losPred[0];</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    <span class="comment">// Copy required states to local variable names</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    q0       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[0];</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    q1       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[1];</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    q2       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[2];</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    q3       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[3];</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    vn       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[0];</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    ve       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[1];</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    vd       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>[2];</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    pd       = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2];</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="comment">// Correct velocities for GPS glitch recovery offset</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    velNED_local.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = vn - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    velNED_local.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = ve - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    velNED_local.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    <span class="comment">// constrain height above ground to be above range measured on ground</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    <span class="keywordtype">float</span> heightAboveGndEst = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - pd), <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    <span class="comment">// Calculate observation jacobians and Kalman gains</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;    <span class="keywordflow">if</span> (obsIndex == 0) {</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        <span class="comment">// calculate range from ground plain to centre of sensor fov assuming flat earth</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        <span class="keywordtype">float</span> range = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>((heightAboveGndEst/<a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a>.<a class="code" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>),<a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>,1000.0f);</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        <span class="comment">// calculate relative velocity in sensor frame</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        relVelSensor = <a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a>*velNED_local;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        <span class="comment">// divide velocity by range  to get predicted angular LOS rates relative to X and Y axes</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        losPred[0] =  relVelSensor.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>/range;</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        losPred[1] = -relVelSensor.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>/range;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        <span class="comment">// Calculate common expressions for observation jacobians</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        SH_LOS[0] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        SH_LOS[1] = vn*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) - vd*(2*q0*q2 - 2*q1*q3) + ve*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        SH_LOS[2] = ve*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + vd*(2*q0*q1 + 2*q2*q3) - vn*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        SH_LOS[3] = -1.0f/heightAboveGndEst;</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        <span class="comment">// Calculate common expressions for Kalman gains</span></div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        <span class="comment">// calculate innovation variance for Y axis observation</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        <a class="code" href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">varInnovOptFlow</a>[1] = (<a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a> + (SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[1]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + (SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - (SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q2*SH_LOS[1]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + (SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*vn) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][4]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*vn) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*vn) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*vn) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*vn) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*q2) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][5]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*vn) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*vn) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*vn) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*vn) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*q2) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][6]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - (SH_LOS[0]*SH_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q2*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][9]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][9]*SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][9]*SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][9]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))))/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>));</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">varInnovOptFlow</a>[1] &gt; <a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a>) {</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;            SK_LOS[0] = 1.0f/<a class="code" href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">varInnovOptFlow</a>[1];</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;            SK_LOS[0] = 1.0f/<a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a>;</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        }</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        <span class="comment">// calculate innovation variance for X axis observation</span></div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;        <a class="code" href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">varInnovOptFlow</a>[0] = (<a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a> + (SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[2]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + (SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[2]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + (SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[2]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - (SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*vn) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][5]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*vn) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*vn) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*vn) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*vn) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][4]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) + SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>)*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*vn) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*vn) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*vn) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*vn) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*q2) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][6]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))) - (SH_LOS[0]*SH_LOS[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*(SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*(SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[2]*SH_LOS[3]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*(SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*(SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][9]*SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][9]*SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*q3) - (<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][9]*SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][9]*SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3))))/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(pd - <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>));</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">varInnovOptFlow</a>[0] &gt; <a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a>) {</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;            SK_LOS[1] = 1.0f/<a class="code" href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">varInnovOptFlow</a>[0];</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;            SK_LOS[1] = 1.0f/<a class="code" href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">R_LOS</a>;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;        }</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;        SK_LOS[2] = SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>);</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        SK_LOS[3] = SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>);</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        SK_LOS[4] = SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>);</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;        SK_LOS[5] = SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>);</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;        SK_LOS[6] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;        SK_LOS[7] = 1.0f/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(heightAboveGndEst);</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;        SK_LOS[8] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        SK_LOS[9] = SH_LOS[3];</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        <span class="comment">// Calculate common intermediate terms</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        tempVar[0] = SK_LOS[4] + 2*q0*SH_LOS[2]*SK_LOS[9];</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        tempVar[1] = SK_LOS[3] - 2*q1*SH_LOS[2]*SK_LOS[9];</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        tempVar[2] = SK_LOS[2] - 2*q3*SH_LOS[2]*SK_LOS[9];</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;        tempVar[3] = SH_LOS[0]*SK_LOS[9]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        tempVar[4] = SH_LOS[0]*SK_LOS[9]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>);</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        tempVar[5] = SH_LOS[0]*SH_LOS[2]*SK_LOS[7];</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        tempVar[6] = SH_LOS[0]*SK_LOS[6]*SK_LOS[9];</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        tempVar[7] = SK_LOS[5] - 2*q2*SH_LOS[2]*SK_LOS[9];</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;        <span class="comment">// calculate observation jacobians for X LOS rate</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;        memset(&amp;H_LOS[0], 0, <span class="keyword">sizeof</span>(H_LOS));</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;        H_LOS[0] = - SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q0*SH_LOS[2]*SH_LOS[3];</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        H_LOS[1] = 2*q1*SH_LOS[2]*SH_LOS[3] - SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>);</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;        H_LOS[2] = 2*q2*SH_LOS[2]*SH_LOS[3] - SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>);</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;        H_LOS[3] = SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q3*SH_LOS[2]*SH_LOS[3];</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        H_LOS[4] = SH_LOS[0]*SH_LOS[3]*(2*q0*q3 - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        H_LOS[5] = -SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3));</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        H_LOS[6] = -SH_LOS[0]*SH_LOS[3]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>);</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;        H_LOS[9] = (SH_LOS[0]*SH_LOS[2])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(heightAboveGndEst);</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        <span class="comment">// calculate Kalman gains for X LOS rate</span></div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[0] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*tempVar[6]);</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[1] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*tempVar[6]);</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;        Kfusion[2] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*tempVar[6]);</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        Kfusion[3] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*tempVar[6]);</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        Kfusion[4] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*tempVar[6]);</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        Kfusion[5] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*tempVar[6]);</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;        <span class="comment">// Don&#39;t allow optical flow measurements to modify vertical velocity as it can produce height offsets</span></div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;        Kfusion[6] = 0.0f;<span class="comment">//-SK_LOS[1]*(P[6][0]*tempVar[0] + P[6][1]*tempVar[1] - P[6][3]*tempVar[2] + P[6][2]*tempVar[7] - P[6][4]*tempVar[3] + P[6][6]*tempVar[4] - P[6][9]*tempVar[5] + P[6][5]*tempVar[6]);</span></div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;        Kfusion[7] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][5]*tempVar[6]);</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        Kfusion[8] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][5]*tempVar[6]);</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        <span class="comment">// Don&#39;t allow optical flow measurements to modify vertical position as it can produce height offsets</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;        Kfusion[9] = 0.0f;<span class="comment">//-SK_LOS[1]*(P[9][0]*tempVar[0] + P[9][1]*tempVar[1] - P[9][3]*tempVar[2] + P[9][2]*tempVar[7] - P[9][4]*tempVar[3] + P[9][6]*tempVar[4] - P[9][9]*tempVar[5] + P[9][5]*tempVar[6]);</span></div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        Kfusion[10] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*tempVar[6]);</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        Kfusion[11] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*tempVar[6]);</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;        Kfusion[12] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*tempVar[6]);</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;        <span class="comment">// only height measurements are allowed to modify the Z bias state to improve the stability of the estimate</span></div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;        Kfusion[13] = 0.0f;<span class="comment">//Kfusion[13] = -SK_LOS[1]*(P[13][0]*tempVar[0] + P[13][1]*tempVar[1] - P[13][3]*tempVar[2] + P[13][2]*tempVar[7] - P[13][4]*tempVar[3] + P[13][6]*tempVar[4] - P[13][9]*tempVar[5] + P[13][5]*tempVar[6]);</span></div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>) {</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;            Kfusion[14] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5]*tempVar[6]);</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;            Kfusion[15] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5]*tempVar[6]);</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;            Kfusion[14] = 0.0f;</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;            Kfusion[15] = 0.0f;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        }</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;            Kfusion[16] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][5]*tempVar[6]);</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;            Kfusion[17] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][5]*tempVar[6]);</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;            Kfusion[18] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][5]*tempVar[6]);</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;            Kfusion[19] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][5]*tempVar[6]);</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;            Kfusion[20] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][5]*tempVar[6]);</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;            Kfusion[21] = -SK_LOS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*tempVar[7] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][4]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][6]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][9]*tempVar[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][5]*tempVar[6]);</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;            }</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        }</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;        <span class="comment">// calculate innovation for X axis observation</span></div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        <a class="code" href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">innovOptFlow</a>[0] = losPred[0] - <a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[0];</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obsIndex == 1) {</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        <span class="comment">// calculate intermediate common variables</span></div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        tempVar[0] = SK_LOS[2] + 2*q0*SH_LOS[1]*SK_LOS[9];</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        tempVar[1] = SK_LOS[5] - 2*q1*SH_LOS[1]*SK_LOS[9];</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        tempVar[2] = SK_LOS[3] + 2*q2*SH_LOS[1]*SK_LOS[9];</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;        tempVar[3] = SK_LOS[4] + 2*q3*SH_LOS[1]*SK_LOS[9];</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;        tempVar[4] = SH_LOS[0]*SK_LOS[9]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        tempVar[5] = SH_LOS[0]*SK_LOS[9]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>);</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;        tempVar[6] = SH_LOS[0]*SH_LOS[1]*SK_LOS[7];</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        tempVar[7] = SH_LOS[0]*SK_LOS[8]*SK_LOS[9];</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;        <span class="comment">// Calculate observation jacobians for Y LOS rate</span></div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;        memset(&amp;H_LOS[0], 0, <span class="keyword">sizeof</span>(H_LOS));</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;        H_LOS[0] = SH_LOS[0]*SH_LOS[3]*(2*q3*ve - 2*q2*vd + 2*q0*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q0*SH_LOS[1]*SH_LOS[3];</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        H_LOS[1] = SH_LOS[0]*SH_LOS[3]*(2*q3*vd + 2*q2*ve + 2*q1*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q1*SH_LOS[1]*SH_LOS[3];</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        H_LOS[2] = - SH_LOS[0]*SH_LOS[3]*(2*q0*vd - 2*q1*ve + 2*q2*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) - 2*q2*SH_LOS[1]*SH_LOS[3];</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        H_LOS[3] = SH_LOS[0]*SH_LOS[3]*(2*q1*vd + 2*q0*ve - 2*q3*<a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>) + 2*q3*SH_LOS[1]*SH_LOS[3];</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;        H_LOS[4] = SH_LOS[0]*SH_LOS[3]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3));</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        H_LOS[5] = SH_LOS[0]*SH_LOS[3]*(2*q0*q3 + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;        H_LOS[6] = -SH_LOS[0]*SH_LOS[3]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>);</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        H_LOS[9] = -(SH_LOS[0]*SH_LOS[1])/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(heightAboveGndEst);</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;        <span class="comment">// Calculate Kalman gains for Y LOS rate</span></div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[0] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*tempVar[7]);</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[1] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*tempVar[7]);</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;        Kfusion[2] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*tempVar[7]);</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;        Kfusion[3] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*tempVar[7]);</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        Kfusion[4] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*tempVar[7]);</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;        Kfusion[5] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*tempVar[7]);</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;        <span class="comment">// Don&#39;t allow optical flow measurements to modify vertical velocity as it can produce height offsets</span></div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        Kfusion[6] = 0.0f;<span class="comment">//SK_LOS[0]*(P[6][0]*tempVar[0] + P[6][1]*tempVar[1] - P[6][2]*tempVar[2] + P[6][3]*tempVar[3] + P[6][5]*tempVar[4] - P[6][6]*tempVar[5] - P[6][9]*tempVar[6] + P[6][4]*tempVar[7]);</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;        Kfusion[7] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][4]*tempVar[7]);</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;        Kfusion[8] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][4]*tempVar[7]);</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;        <span class="comment">// Don&#39;t allow optical flow measurements to modify vertical position as it can produce height offsets</span></div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;        Kfusion[9] = 0.0f;<span class="comment">//SK_LOS[0]*(P[9][0]*tempVar[0] + P[9][1]*tempVar[1] - P[9][2]*tempVar[2] + P[9][3]*tempVar[3] + P[9][5]*tempVar[4] - P[9][6]*tempVar[5] - P[9][9]*tempVar[6] + P[9][4]*tempVar[7]);</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;        Kfusion[10] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*tempVar[7]);</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;        Kfusion[11] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*tempVar[7]);</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;        Kfusion[12] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*tempVar[7]);</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;        <span class="comment">// only height measurements are allowed to modify the Z bias state to improve the stability of the estimate</span></div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;        Kfusion[13] = 0.0f;<span class="comment">//SK_LOS[0]*(P[13][0]*tempVar[0] + P[13][1]*tempVar[1] - P[13][2]*tempVar[2] + P[13][3]*tempVar[3] + P[13][5]*tempVar[4] - P[13][6]*tempVar[5] - P[13][9]*tempVar[6] + P[13][4]*tempVar[7]);</span></div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a>) {</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;            Kfusion[14] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4]*tempVar[7]);</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;            Kfusion[15] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4]*tempVar[7]);</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;            Kfusion[14] = 0.0f;</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;            Kfusion[15] = 0.0f;</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        }</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;            Kfusion[16] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][4]*tempVar[7]);</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;            Kfusion[17] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][4]*tempVar[7]);</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;            Kfusion[18] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][4]*tempVar[7]);</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;            Kfusion[19] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][4]*tempVar[7]);</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;            Kfusion[20] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][4]*tempVar[7]);</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;            Kfusion[21] = SK_LOS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*tempVar[0] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*tempVar[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*tempVar[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*tempVar[3] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][5]*tempVar[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][6]*tempVar[5] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][9]*tempVar[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][4]*tempVar[7]);</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;                Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;            }</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;        }</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        <span class="comment">// calculate innovation for Y observation</span></div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;        <a class="code" href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">innovOptFlow</a>[1] = losPred[1] - <a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[1];</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    }</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <span class="comment">// calculate the innovation consistency test ratio</span></div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    <a class="code" href="classNavEKF.html#a50f655be7d57ef4d23c9d7d1007c02ea">flowTestRatio</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">innovOptFlow</a>[obsIndex]) / (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#aa86e0ec11ec5c3abe9b13b69377298ff">_flowInnovGate</a>) * <a class="code" href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">varInnovOptFlow</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>]);</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;    <span class="comment">// Check the innovation for consistency and don&#39;t fuse if out of bounds or flow is too fast to be reliable</span></div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a50f655be7d57ef4d23c9d7d1007c02ea">flowTestRatio</a>[obsIndex]) &lt; 1.0f &amp;&amp; (<a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] &lt; <a class="code" href="classNavEKF.html#adcdf19a4bd79530aaac0fb6b49acca3f">_maxFlowRate</a>)) {</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        <span class="comment">// record the last time both X and Y observations were accepted for fusion</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;        <span class="keywordflow">if</span> (obsIndex == 0) {</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;            <a class="code" href="classNavEKF.html#a0b9da623e9e7cf3d051442c3ecb97b81">flowXfailed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a0b9da623e9e7cf3d051442c3ecb97b81">flowXfailed</a>) {</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;            <a class="code" href="classNavEKF.html#a1fff68de02d811e590b09385a9427e58">prevFlowFuseTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        }</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <span class="comment">// Attitude, velocity and position corrections are averaged across multiple prediction cycles between now and the anticipated time for the next measurement.</span></div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        <span class="comment">// Don&#39;t do averaging of quaternion state corrections if total angle change across predicted interval is going to exceed 0.1 rad</span></div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        <span class="keywordtype">bool</span> highRates = ((<a class="code" href="classNavEKF.html#abf2437b13b0f20096df6b2bd633c4944">flowUpdateCountMax</a> * <a class="code" href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">correctedDelAng</a>.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>()) &gt; 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="comment">// Calculate the number of averaging frames left to go.</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        <span class="comment">// There is no point averaging if the number of cycles left is less than 2</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        <span class="keywordtype">float</span> minorFramesToGo = float(<a class="code" href="classNavEKF.html#abf2437b13b0f20096df6b2bd633c4944">flowUpdateCountMax</a>) - float(<a class="code" href="classNavEKF.html#a83bc985fa5b587e5d43f8482f93c763c">flowUpdateCount</a>);</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 3 &amp;&amp; highRates) || <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= 10 || minorFramesToGo &lt; 1.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">innovOptFlow</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>];</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;                    <a class="code" href="classNavEKF.html#a703d77a71d6bd0be67dcfb9ad1d1eb97">flowIncrStateDelta</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * <a class="code" href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">innovOptFlow</a>[<a class="code" href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">obsIndex</a>] * (<a class="code" href="classNavEKF.html#acc762a0249338693cdd04ed6a51b7b86">flowUpdateCountMaxInv</a> * float(<a class="code" href="classNavEKF.html#abf2437b13b0f20096df6b2bd633c4944">flowUpdateCountMax</a>) / minorFramesToGo);</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;            }</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        }</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        <span class="comment">// normalise the quaternion states</span></div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">normalize</a>();</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;        <span class="comment">// correct the covariance P = (I - K*H)*P</span></div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;        <span class="comment">// take advantage of the empty columns in KH to reduce the</span></div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;        <span class="comment">// number of operations</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        {</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j &lt;= 6; j++)</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;            {</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;                <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_LOS[j];</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;            }</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 7; j &lt;= 8; j++)</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;            {</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;                <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0f;</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;            }</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][9] = <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_LOS[9];</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 10; j &lt;= 21; j++)</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;            {</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0f;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;            }</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        }</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        {</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j &lt;= 21; j++)</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;            {</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;                <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0f;</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;                <span class="keywordflow">for</span> (uint8_t k = 0; k &lt;= 6; k++)</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;                {</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;                    <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[k][j];</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;                }</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;                <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][9] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][j];</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;            }</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;        }</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;=  21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;        {</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j &lt;=  21; j++)</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;            {</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;                <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] - <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;            }</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;        }</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obsIndex == 0) {</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <span class="comment">// store the fact we have failed the X conponent so that a combined X and Y axis pass/fail can be calculated next time round</span></div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;        <a class="code" href="classNavEKF.html#a0b9da623e9e7cf3d051442c3ecb97b81">flowXfailed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    }</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    <a class="code" href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb">ForceSymmetry</a>();</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;    <a class="code" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">ConstrainVariances</a>();</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;}</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;<span class="comment">// fuse true airspeed measurements</span></div>
<div class="line"><a name="l03151"></a><span class="lineno"><a class="line" href="classNavEKF.html#af4f4d6647b1e7882dc009af5b475761b"> 3151</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#af4f4d6647b1e7882dc009af5b475761b">NavEKF::FuseAirspeed</a>()</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;{</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <span class="comment">// start performance timer</span></div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#af8becb3bed10af9b016a0bfe529543e5">_perf_FuseAirspeed</a>);</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="comment">// declarations</span></div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ab9f414948d3220b44f9737db742a6c6c">ve</a>;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    <span class="keywordtype">float</span> vwn;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <span class="keywordtype">float</span> vwe;</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    <span class="keywordtype">float</span> EAS2TAS = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a2648b5fc68b22e83205161cf1274939c">get_EAS2TAS</a>();</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> R_TAS = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#ad0cb4a84962425485592d3e1d1727471">_easNoise</a>, 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(EAS2TAS, 0.9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 10.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> SH_TAS;</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    <span class="keywordtype">float</span> SK_TAS;</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <a class="code" href="classNavEKF.html#aa655860e29ea497ab4b38f6c38f047bc">Vector22</a> H_TAS;</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <span class="keywordtype">float</span> VtasPred;</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <span class="comment">// health is set bad until test passed</span></div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    <a class="code" href="classNavEKF.html#a9c1aa11023c0d9aff8a091ebcc4a789d">tasHealth</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;    <span class="comment">// copy required states to local variable names</span></div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    vn = <a class="code" href="classNavEKF.html#a438ec63738f917e8d25a448414c83d23">statesAtVtasMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;    ve = <a class="code" href="classNavEKF.html#a438ec63738f917e8d25a448414c83d23">statesAtVtasMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    vd = <a class="code" href="classNavEKF.html#a438ec63738f917e8d25a448414c83d23">statesAtVtasMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    vwn = <a class="code" href="classNavEKF.html#a438ec63738f917e8d25a448414c83d23">statesAtVtasMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    vwe = <a class="code" href="classNavEKF.html#a438ec63738f917e8d25a448414c83d23">statesAtVtasMeasTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    <span class="comment">// calculate the predicted airspeed, compensating for bias in GPS velocity when we are pulling a glitch offset back in</span></div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    VtasPred = <a class="code" href="AP__Math_8cpp.html#ac09c78b18c2ad21b9a04081f119f11c0">pythagorous3</a>((ve - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> - vwe) , (vn - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> - vwn) , vd);</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <span class="comment">// perform fusion of True Airspeed measurement</span></div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="keywordflow">if</span> (VtasPred &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    {</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        <span class="comment">// calculate observation jacobians</span></div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;        SH_TAS[0] = 1.0f/VtasPred;</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        SH_TAS[1] = (SH_TAS[0]*(2*ve - 2*vwe))/2;</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;        SH_TAS[2] = (SH_TAS[0]*(2*vn - 2*vwn))/2;</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) H_TAS[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        H_TAS[4] = SH_TAS[2];</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        H_TAS[5] = SH_TAS[1];</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;        H_TAS[6] = vd*SH_TAS[0];</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        H_TAS[14] = -SH_TAS[2];</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        H_TAS[15] = -SH_TAS[1];</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;        <span class="comment">// calculate Kalman gains</span></div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;        <span class="keywordtype">float</span> temp = (R_TAS + SH_TAS[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*vd*SH_TAS[0]) + SH_TAS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*vd*SH_TAS[0]) - SH_TAS[2]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][14]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][14]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][14]*vd*SH_TAS[0]) - SH_TAS[1]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][15]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][15]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][15]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][15]*vd*SH_TAS[0]) + vd*SH_TAS[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*vd*SH_TAS[0]));</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;        <span class="keywordflow">if</span> (temp &gt;= R_TAS) {</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;            SK_TAS = 1.0f / temp;</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_airspeed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;            <span class="comment">// the calculation is badly conditioned, so we cannot perform fusion on this step</span></div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;            <span class="comment">// we increase the wind state variances and try again next time</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14] += 0.05f*R_TAS;</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15] += 0.05f*R_TAS;</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_airspeed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;        }</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[0] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[1] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        Kfusion[2] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        Kfusion[3] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        Kfusion[4] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;        Kfusion[5] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;        Kfusion[6] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;        Kfusion[7] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;        Kfusion[8] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;        Kfusion[9] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        Kfusion[10] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        Kfusion[11] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;        Kfusion[12] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        <span class="comment">// this term has been zeroed to improve stability of the Z accel bias</span></div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;        Kfusion[13] = 0.0f;<span class="comment">//SK_TAS*(P[13][4]*SH_TAS[2] - P[13][14]*SH_TAS[2] + P[13][5]*SH_TAS[1] - P[13][15]*SH_TAS[1] + P[13][6]*vd*SH_TAS[0]);</span></div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        Kfusion[14] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        Kfusion[15] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        <span class="comment">// zero Kalman gains to inhibit magnetic field state estimation</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;            Kfusion[16] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;            Kfusion[17] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;            Kfusion[18] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;            Kfusion[19] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;            Kfusion[20] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;            Kfusion[21] = SK_TAS*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][4]*SH_TAS[2] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][14]*SH_TAS[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][5]*SH_TAS[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][15]*SH_TAS[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][6]*vd*SH_TAS[0]);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;            }</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;        }</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        <span class="comment">// calculate measurement innovation variance</span></div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <a class="code" href="classNavEKF.html#a4361b93656f6964cc65943400ddffb8c">varInnovVtas</a> = 1.0f/SK_TAS;</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <span class="comment">// calculate measurement innovation</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;        <a class="code" href="classNavEKF.html#ad04500d06937a8f13de6c4ee497cdb84">innovVtas</a> = VtasPred - <a class="code" href="classNavEKF.html#a4b6dd409fcc6638f66596f0e8c99b96e">VtasMeas</a>;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;        <span class="comment">// calculate the innovation consistency test ratio</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        <a class="code" href="classNavEKF.html#a2f5fa2977d33ddd0c5f8d350c049cd2c">tasTestRatio</a> = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ad04500d06937a8f13de6c4ee497cdb84">innovVtas</a>) / (<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#adf4a1897b5d669e0b0403926993204ff">_tasInnovGate</a>) * <a class="code" href="classNavEKF.html#a4361b93656f6964cc65943400ddffb8c">varInnovVtas</a>);</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;        <span class="comment">// fail if the ratio is &gt; 1, but don&#39;t fail if bad IMU data</span></div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;        <a class="code" href="classNavEKF.html#a9c1aa11023c0d9aff8a091ebcc4a789d">tasHealth</a> = ((<a class="code" href="classNavEKF.html#a2f5fa2977d33ddd0c5f8d350c049cd2c">tasTestRatio</a> &lt; 1.0f) || <a class="code" href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">badIMUdata</a>);</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;        <a class="code" href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">tasTimeout</a> = (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a2ba17c3452c9ce37f919bfa58f8ddd38">lastTasPassTime</a>) &gt; <a class="code" href="classNavEKF.html#a8213661ff081f3e15cbf7293e744fa84">tasRetryTime</a>;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;        <span class="comment">// test the ratio before fusing data, forcing fusion if airspeed and position are timed out as we have no choice but to try and use airspeed to constrain error growth</span></div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a9c1aa11023c0d9aff8a091ebcc4a789d">tasHealth</a> || (<a class="code" href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">tasTimeout</a> &amp;&amp; <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a>))</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;        {</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;            <span class="comment">// restart the counter</span></div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;            <a class="code" href="classNavEKF.html#a2ba17c3452c9ce37f919bfa58f8ddd38">lastTasPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;            <span class="comment">// correct the state vector</span></div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;            <span class="keywordflow">for</span> (uint8_t j=0; j&lt;=21; j++)</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;            {</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;                <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[j] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[j] - Kfusion[j] * <a class="code" href="classNavEKF.html#ad04500d06937a8f13de6c4ee497cdb84">innovVtas</a>;</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;            }</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;            <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">normalize</a>();</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;            <span class="comment">// correct the covariance P = (I - K*H)*P</span></div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;            <span class="comment">// take advantage of the empty columns in H to reduce the number of operations</span></div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;            {</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=3; j++) <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 4; j&lt;=6; j++)</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;                {</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                    <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_TAS[j];</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;                }</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 7; j&lt;=13; j++) <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 14; j&lt;=15; j++)</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;                {</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;                    <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_TAS[j];</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;                }</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 16; j&lt;=21; j++) <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            }</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;            {</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=21; j++)</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;                {</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                    <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                    <span class="keywordflow">for</span> (uint8_t k = 4; k&lt;=6; k++)</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                    {</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                        <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[k][j];</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                    }</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;                    <span class="keywordflow">for</span> (uint8_t k = 14; k&lt;=15; k++)</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;                    {</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;                        <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[k][j];</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                    }</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;                }</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;            }</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;            {</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=21; j++)</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;                {</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;                    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] - <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;                }</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;            }</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        }</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    }</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    <span class="comment">// force the covariance matrix to me symmetrical and limit the variances to prevent ill-condiioning.</span></div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    <a class="code" href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb">ForceSymmetry</a>();</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <a class="code" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">ConstrainVariances</a>();</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    <span class="comment">// stop performance timer</span></div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#af8becb3bed10af9b016a0bfe529543e5">_perf_FuseAirspeed</a>);</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;}</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">// fuse sythetic sideslip measurement of zero</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"><a class="line" href="classNavEKF.html#a55bead411e1fd0ed64342bd38e6a83bf"> 3317</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a55bead411e1fd0ed64342bd38e6a83bf">NavEKF::FuseSideslip</a>()</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;{</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;    <span class="comment">// start performance timer</span></div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;    perf_begin(<a class="code" href="classNavEKF.html#ab2cb888ba8f31016825f3b0ce2466935">_perf_FuseSideslip</a>);</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    <span class="comment">// declarations</span></div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">q0</a>;</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">q1</a>;</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>;</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">vn</a>;</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#ab9f414948d3220b44f9737db742a6c6c">ve</a>;</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;    <span class="keywordtype">float</span> vwn;</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    <span class="keywordtype">float</span> vwe;</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> R_BETA = 0.03f; <span class="comment">// assume a sideslip angle RMS of ~10 deg</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;    <a class="code" href="classNavEKF.html#a8bf0c9a0bbc43bcd399261e54af1b662">Vector13</a> SH_BETA;</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;    <a class="code" href="classNavEKF.html#ae5da79f131b7cf151054f0d31bc19afe">Vector8</a> SK_BETA;</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> vel_rel_wind;</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    <a class="code" href="classNavEKF.html#aa655860e29ea497ab4b38f6c38f047bc">Vector22</a> H_BETA;</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    <span class="keywordtype">float</span> innovBeta;</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;    <span class="comment">// copy required states to local variable names</span></div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;    q0 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[0];</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    q1 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[1];</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;    q2 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[2];</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;    q3 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>[3];</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    vn = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;    ve = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    vd = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;    vwn = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;    vwe = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    <span class="comment">// calculate predicted wind relative velocity in NED, compensating for offset in velcity when we are pulling a GPS glitch offset back in</span></div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;    vel_rel_wind.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = vn - vwn - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    vel_rel_wind.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = ve - vwe - <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;    vel_rel_wind.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;    <span class="comment">// rotate into body axes</span></div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;    vel_rel_wind = <a class="code" href="classNavEKF.html#aef1c557739419cc240386b4f3c8e7983">prevTnb</a> * vel_rel_wind;</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    <span class="comment">// perform fusion of assumed sideslip  = 0</span></div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;    <span class="keywordflow">if</span> (vel_rel_wind.x &gt; 5.0f)</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    {</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;        <span class="comment">// Calculate observation jacobians</span></div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        SH_BETA[0] = (vn - vwn)*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) - vd*(2*q0*q2 - 2*q1*q3) + (ve - vwe)*(2*q0*q3 + 2*q1*q2);</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(SH_BETA[0]) &lt;= 1e-9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_sideslip = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_sideslip = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;        }</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        SH_BETA[1] = (ve - vwe)*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3)) + vd*(2*q0*q1 + 2*q2*q3) - (vn - vwn)*(2*q0*q3 - 2*q1*q2);</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        SH_BETA[2] = vn - vwn;</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        SH_BETA[3] = ve - vwe;</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;        SH_BETA[4] = 1/<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(SH_BETA[0]);</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        SH_BETA[5] = 1/SH_BETA[0];</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;        SH_BETA[6] = SH_BETA[5]*(<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3));</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;        SH_BETA[7] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q0) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q1) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q2) - <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(q3);</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;        SH_BETA[8] = 2*q0*SH_BETA[3] - 2*q3*SH_BETA[2] + 2*q1*<a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;        SH_BETA[9] = 2*q0*SH_BETA[2] + 2*q3*SH_BETA[3] - 2*q2*<a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        SH_BETA[10] = 2*q2*SH_BETA[2] - 2*q1*SH_BETA[3] + 2*q0*<a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;        SH_BETA[11] = 2*q1*SH_BETA[2] + 2*q2*SH_BETA[3] + 2*q3*<a class="code" href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">vd</a>;</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;        SH_BETA[12] = 2*q0*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>;</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            H_BETA[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;        }</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        H_BETA[0] = SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9];</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        H_BETA[1] = SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11];</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        H_BETA[2] = SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10];</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;        H_BETA[3] = - SH_BETA[5]*SH_BETA[9] - SH_BETA[1]*SH_BETA[4]*SH_BETA[8];</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        H_BETA[4] = - SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - SH_BETA[1]*SH_BETA[4]*SH_BETA[7];</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;        H_BETA[5] = SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;        H_BETA[6] = SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3);</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        H_BETA[14] = SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7];</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;        H_BETA[15] = SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) - SH_BETA[6];</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;        <span class="comment">// Calculate Kalman gains</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;        <span class="keywordtype">float</span> temp = (R_BETA - (SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*(SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3))) + (SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][14]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][14]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][14]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][14]*(SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3))) + (SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*(SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3))) - (SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][15]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][15]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][15]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][15]*(SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3))) + (SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*q2) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*q2) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*q2)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*q2)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*(SH_BETA[5]*(2*q0*q1 + 2*q2*q3) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>))) + (SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*(SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3))) + (SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*q2) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*q2) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*q2)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*q2)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*(SH_BETA[5]*(2*q0*q1 + 2*q2*q3) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>))) - (SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8])*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*(SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3))) + (SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3))*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*q2) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*(SH_BETA[5]*(SH_BETA[12] - 2*q1*q2) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*q2)) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6]*(SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*q2)) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*(SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*(SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*(SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10]) - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*(SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8]) + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*(SH_BETA[5]*(2*q0*q1 + 2*q2*q3) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>))));</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;        <span class="keywordflow">if</span> (temp &gt;= R_BETA) {</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;            SK_BETA[0] = 1.0f / temp;</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_sideslip = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;            <span class="comment">// the calculation is badly conditioned, so we cannot perform fusion on this step</span></div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;            <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_sideslip = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;        }</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;        SK_BETA[1] = SH_BETA[5]*(SH_BETA[12] - 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>) + SH_BETA[1]*SH_BETA[4]*SH_BETA[7];</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        SK_BETA[2] = SH_BETA[6] - SH_BETA[1]*SH_BETA[4]*(SH_BETA[12] + 2*q1*<a class="code" href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">q2</a>);</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;        SK_BETA[3] = SH_BETA[5]*(2*q0*q1 + 2*q2*<a class="code" href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">q3</a>) + SH_BETA[1]*SH_BETA[4]*(2*q0*q2 - 2*q1*q3);</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;        SK_BETA[4] = SH_BETA[5]*SH_BETA[10] - SH_BETA[1]*SH_BETA[4]*SH_BETA[11];</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;        SK_BETA[5] = SH_BETA[5]*SH_BETA[8] - SH_BETA[1]*SH_BETA[4]*SH_BETA[9];</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;        SK_BETA[6] = SH_BETA[5]*SH_BETA[11] + SH_BETA[1]*SH_BETA[4]*SH_BETA[10];</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        SK_BETA[7] = SH_BETA[5]*SH_BETA[9] + SH_BETA[1]*SH_BETA[4]*SH_BETA[8];</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[0] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        <a class="code" href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">Kfusion</a>[1] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        Kfusion[2] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;        Kfusion[3] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;        Kfusion[4] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;        Kfusion[5] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;        Kfusion[6] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;        Kfusion[7] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;        Kfusion[8] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        Kfusion[9] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;        Kfusion[10] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;        Kfusion[11] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;        Kfusion[12] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        <span class="comment">// this term has been zeroed to improve stability of the Z accel bias</span></div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;        Kfusion[13] = 0.0f;<span class="comment">//SK_BETA[0]*(P[13][0]*SK_BETA[5] + P[13][1]*SK_BETA[4] - P[13][4]*SK_BETA[1] + P[13][5]*SK_BETA[2] + P[13][2]*SK_BETA[6] + P[13][6]*SK_BETA[3] - P[13][3]*SK_BETA[7] + P[13][14]*SK_BETA[1] - P[13][15]*SK_BETA[2]);</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;        Kfusion[14] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;        Kfusion[15] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;        <span class="comment">// zero Kalman gains to inhibit magnetic field state estimation</span></div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a>) {</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;            Kfusion[16] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;            Kfusion[17] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;            Kfusion[18] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;            Kfusion[19] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;            Kfusion[20] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;            Kfusion[21] = SK_BETA[0]*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][0]*SK_BETA[5] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][1]*SK_BETA[4] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][4]*SK_BETA[1] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][5]*SK_BETA[2] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][2]*SK_BETA[6] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][6]*SK_BETA[3] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][3]*SK_BETA[7] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][14]*SK_BETA[1] - <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][15]*SK_BETA[2]);</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;            <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=16; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;                Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0f;</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;            }</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;        }</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;        <span class="comment">// calculate predicted sideslip angle and innovation using small angle approximation</span></div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;        innovBeta = vel_rel_wind.y / vel_rel_wind.x;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;        <span class="comment">// reject measurement if greater than 3-sigma inconsistency</span></div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;        <span class="keywordflow">if</span> (innovBeta &gt; 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;        }</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;        <span class="comment">// correct the state vector</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;        <span class="keywordflow">for</span> (uint8_t j=0; j&lt;=21; j++)</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        {</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;            <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[j] = <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[j] - Kfusion[j] * innovBeta;</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;        }</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">normalize</a>();</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;        <span class="comment">// correct the covariance P = (I - K*H)*P</span></div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;        <span class="comment">// take advantage of the empty columns in H to reduce the</span></div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;        <span class="comment">// number of operations</span></div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;        {</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=6; j++)</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;            {</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;                <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_BETA[j];</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;            }</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 7; j&lt;=13; j++) <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 14; j&lt;=15; j++)</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;            {</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = Kfusion[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] * H_BETA[j];</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;            }</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 16; j&lt;=21; j++) <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;        }</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;        {</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=21; j++)</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;            {</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;                <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0;</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;                <span class="keywordflow">for</span> (uint8_t k = 0; k&lt;=6; k++)</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;                {</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;                    <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[k][j];</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;                }</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;                <span class="keywordflow">for</span> (uint8_t k = 14; k&lt;=15; k++)</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;                {</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                    <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">KH</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[k][j];</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;                }</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;            }</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;        }</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;        <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;        {</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j&lt;=21; j++)</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;            {</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] - <a class="code" href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">KHP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;            }</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;        }</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;    }</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;    <span class="comment">// force the covariance matrix to me symmetrical and limit the variances to prevent ill-condiioning.</span></div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;    <a class="code" href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb">ForceSymmetry</a>();</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;    <a class="code" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">ConstrainVariances</a>();</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    <span class="comment">// stop the performance timer</span></div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    perf_end(<a class="code" href="classNavEKF.html#ab2cb888ba8f31016825f3b0ce2466935">_perf_FuseSideslip</a>);</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;}</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="comment">// zero specified range of rows in the state covariance matrix</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"><a class="line" href="classNavEKF.html#aaef60d20b82acb3930c5866abe3977b4"> 3507</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#aaef60d20b82acb3930c5866abe3977b4">NavEKF::zeroRows</a>(Matrix22 &amp;covMat, uint8_t first, uint8_t last)</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;{</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    uint8_t row;</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <span class="keywordflow">for</span> (row=first; row&lt;=last; row++)</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    {</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;        memset(&amp;covMat[row][0], 0, <span class="keyword">sizeof</span>(covMat[0][0])*22);</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    }</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;}</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;<span class="comment">// zero specified range of columns in the state covariance matrix</span></div>
<div class="line"><a name="l03517"></a><span class="lineno"><a class="line" href="classNavEKF.html#a755c7075fb0ee5f86cef734ecf83e53a"> 3517</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a755c7075fb0ee5f86cef734ecf83e53a">NavEKF::zeroCols</a>(Matrix22 &amp;covMat, uint8_t first, uint8_t last)</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;{</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    uint8_t row;</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    <span class="keywordflow">for</span> (row=0; row&lt;=21; row++)</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    {</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;        memset(&amp;covMat[row][first], 0, <span class="keyword">sizeof</span>(covMat[0][0])*(1+last-first));</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    }</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;}</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;<span class="comment">// store states in a history array along with time stamp</span></div>
<div class="line"><a name="l03527"></a><span class="lineno"><a class="line" href="classNavEKF.html#acc95e88cc639bb7672a907e0e51f854d"> 3527</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#acc95e88cc639bb7672a907e0e51f854d">NavEKF::StoreStates</a>()</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;{</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    <span class="comment">// Don&#39;t need to store states more often than every 10 msec</span></div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a640b3c5ebf5371325d670668a6c2557e">lastStateStoreTime_ms</a> &gt;= 10) {</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;        <a class="code" href="classNavEKF.html#a640b3c5ebf5371325d670668a6c2557e">lastStateStoreTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> &gt; 49) {</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;            <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> = 0;</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;        }</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;        <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a>] = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>;</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;        <a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>[<a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a>] = <a class="code" href="classNavEKF.html#a640b3c5ebf5371325d670668a6c2557e">lastStateStoreTime_ms</a>;</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;        <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> = <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> + 1;</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    }</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;}</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;<span class="comment">// reset the stored state history and store the current state</span></div>
<div class="line"><a name="l03542"></a><span class="lineno"><a class="line" href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640"> 3542</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640">NavEKF::StoreStatesReset</a>()</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;{</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;    <span class="comment">// clear stored state history</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>));</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>));</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;    <span class="comment">// store current state vector in first column</span></div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> = 0;</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;    <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a>] = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>;</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    <a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>[<a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a>] = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> = <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> + 1;</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;}</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="comment">// recall state vector stored at closest time to the one specified by msec</span></div>
<div class="line"><a name="l03555"></a><span class="lineno"><a class="line" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9"> 3555</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">NavEKF::RecallStates</a>(<a class="code" href="structNavEKF_1_1state__elements.html">state_elements</a> &amp;statesForFusion, uint32_t msec)</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;{</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;    uint32_t timeDelta;</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    uint32_t bestTimeDelta = 200;</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;    uint8_t bestStoreIndex = 0;</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=49; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;    {</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;        timeDelta = msec - <a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;        <span class="keywordflow">if</span> (timeDelta &lt; bestTimeDelta)</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;        {</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;            bestStoreIndex = <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;            bestTimeDelta = timeDelta;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;        }</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    }</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    <span class="keywordflow">if</span> (bestTimeDelta &lt; 200) <span class="comment">// only output stored state if &lt; 200 msec retrieval error</span></div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    {</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        statesForFusion = <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[bestStoreIndex];</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    }</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;    <span class="keywordflow">else</span> <span class="comment">// otherwise output current state</span></div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;    {</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;        statesForFusion = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>;</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;    }</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;}</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;<span class="comment">// recall omega (angular rate vector) average across the time interval from msecStart to msecEnd</span></div>
<div class="line"><a name="l03580"></a><span class="lineno"><a class="line" href="classNavEKF.html#a826c6c487744f2a5997045e1bf4ffb6e"> 3580</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a826c6c487744f2a5997045e1bf4ffb6e">NavEKF::RecallOmega</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;omegaAvg, uint32_t msecStart, uint32_t msecEnd)</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;{</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    <span class="comment">// calculate average angular rate vector over the time interval from msecStart to msecEnd</span></div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;    <span class="comment">// if no values are inside the time window, return the current angular rate</span></div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;    omegaAvg.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;    uint8_t numAvg = 0;</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=49; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;    {</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;        <span class="keywordflow">if</span> (msecStart &lt;= <a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] &amp;&amp; msecEnd &gt;= <a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;        {</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;            omegaAvg += <a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>].omega;</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;            numAvg += 1;</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;        }</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;    }</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;    <span class="keywordflow">if</span> (numAvg &gt;= 1)</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;    {</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;        omegaAvg = omegaAvg / float(numAvg);</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a> &gt; 0) {</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;        omegaAvg = <a class="code" href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">correctedDelAng</a> / <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;        omegaAvg.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    }</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;}</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;<span class="comment">// calculate nav to body quaternions from body to nav rotation matrix</span></div>
<div class="line"><a name="l03605"></a><span class="lineno"><a class="line" href="classNavEKF.html#aba3fd29d5b5e57944f4bd7977d9ff5a0"> 3605</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#aba3fd29d5b5e57944f4bd7977d9ff5a0">NavEKF::quat2Tbn</a>(<a class="code" href="classMatrix3.html">Matrix3f</a> &amp;Tbn, <span class="keyword">const</span> <a class="code" href="classQuaternion.html">Quaternion</a> &amp;quat)<span class="keyword"> const</span></div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;    <span class="comment">// Calculate the body to nav cosine matrix</span></div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;    quat.<a class="code" href="classQuaternion.html#afb7132c9c69a984a40be950a17effeaa">rotation_matrix</a>(Tbn);</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;}</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;<span class="comment">// return the Euler roll, pitch and yaw angle in radians</span></div>
<div class="line"><a name="l03612"></a><span class="lineno"><a class="line" href="classNavEKF.html#af00a144845ea0078be28516c5d584c78"> 3612</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#af00a144845ea0078be28516c5d584c78">NavEKF::getEulerAngles</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;euler)<span class="keyword"> const</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#ab3049efa36b211699ca03ea53970f0fd">to_euler</a>(euler.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, euler.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, euler.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;    euler = euler - <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a93a3774320e331583fc6c6ac2418be21">get_trim</a>();</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;}</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;<span class="comment">// This returns the specific forces in the NED frame</span></div>
<div class="line"><a name="l03619"></a><span class="lineno"><a class="line" href="classNavEKF.html#a82d63c45e27559907bba4f997230c8b9"> 3619</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a82d63c45e27559907bba4f997230c8b9">NavEKF::getAccelNED</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;accelNED)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;    accelNED = <a class="code" href="classNavEKF.html#a21191ffbd3559a58c8dfe91b73520b02">velDotNED</a>;</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    accelNED.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> -= <a class="code" href="AP__Math_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;}</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="comment">// return NED velocity in m/s</span></div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l03626"></a><span class="lineno"><a class="line" href="classNavEKF.html#a3925b0ab8bf958e0a8dfb84cd591c8b3"> 3626</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a3925b0ab8bf958e0a8dfb84cd591c8b3">NavEKF::getVelNED</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;vel)<span class="keyword"> const</span></div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;    vel = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>;</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;}</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;<span class="comment">// Return the last calculated NED position relative to the reference point (m).</span></div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;<span class="comment">// if a calculated solution is not available, use the best available data and return false</span></div>
<div class="line"><a name="l03633"></a><span class="lineno"><a class="line" href="classNavEKF.html#a90a1fa4f67a09d5af0a6d2a11580269f"> 3633</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a90a1fa4f67a09d5af0a6d2a11580269f">NavEKF::getPosNED</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;pos)<span class="keyword"> const</span></div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;    <span class="comment">// The EKF always has a height estimate regardless of mode of operation</span></div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    pos.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;    <span class="comment">// There are three modes of operation, absolute position (GPS fusion), relative position (optical flow fusion) and constant position (no position estimate available)</span></div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;    <a class="code" href="unionnav__filter__status.html">nav_filter_status</a> status;</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    <a class="code" href="classNavEKF.html#a84cacea011683356ae5fcd2eb2e30fcc">getFilterStatus</a>(status);</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;    <span class="keywordflow">if</span> (status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a4a085e3ddf0ce92ba727e3ba78650c34">horiz_pos_abs</a> || status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#aeb523909236437827ddecee5cdfbe0ff">horiz_pos_rel</a>) {</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;        <span class="comment">// This is the normal mode of operation where we can use the EKF position states</span></div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;        pos.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;        pos.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;        <span class="comment">// In constant position mode the EKF position states are at the origin, so we cannot use them as a position estimate</span></div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a>) {</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a>)) {</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;                <span class="comment">// If the origin has been set and we have GPS, then return the GPS position relative to the origin</span></div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structLocation.html">Location</a> &amp;gpsloc = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">location</a>();</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;                <a class="code" href="structVector2.html">Vector2f</a> tempPosNE = <a class="code" href="AP__Math_8h.html#a527b26472ed6f2e0c141e109a0722a0a">location_diff</a>(<a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a>, gpsloc);</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;                pos.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = tempPosNE.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;                pos.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = tempPosNE.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;                <span class="comment">// If no GPS fix is available, all we can do is provide the last known position</span></div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;                pos.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> + <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;                pos.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> + <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;            }</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;            <span class="comment">// If the origin has not been set, then we have no means of providing a relative position</span></div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;            pos.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = 0.0f;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;            pos.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = 0.0f;</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;        }</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;    }</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;}</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;<span class="comment">// return body axis gyro bias estimates in rad/sec</span></div>
<div class="line"><a name="l03672"></a><span class="lineno"><a class="line" href="classNavEKF.html#a7aa7c1b989521cde235e21a82ec537e4"> 3672</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a7aa7c1b989521cde235e21a82ec537e4">NavEKF::getGyroBias</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;gyroBias)<span class="keyword"> const</span></div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> &lt; 1e-6<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;        gyroBias.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;    }</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;    gyroBias = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a> / <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>;</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;}</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;<span class="comment">// reset the body axis gyro bias states to zero and re-initialise the corresponding covariances</span></div>
<div class="line"><a name="l03682"></a><span class="lineno"><a class="line" href="classNavEKF.html#a2ef01d55f65156c80bcd8ef8ef3ac909"> 3682</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a2ef01d55f65156c80bcd8ef8ef3ac909">NavEKF::resetGyroBias</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;{</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">gyro_bias</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;    <a class="code" href="classNavEKF.html#aaef60d20b82acb3930c5866abe3977b4">zeroRows</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>,10,12);</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;    <a class="code" href="classNavEKF.html#a755c7075fb0ee5f86cef734ecf83e53a">zeroCols</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>,10,12);</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(<a class="code" href="AP__NavEKF_8cpp.html#a0baed3323b0e73e69e2d80fb232031ba">INIT_GYRO_BIAS_UNCERTAINTY</a> * <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>));</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10];</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10];</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;}</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;<span class="comment">// Commands the EKF to not use GPS.</span></div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;<span class="comment">// This command must be sent prior to arming</span></div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;<span class="comment">// This command is forgotten by the EKF each time the vehicle disarms</span></div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="comment">// Returns 0 if command rejected</span></div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;<span class="comment">// Returns 1 if attitude, vertical velocity and vertical position will be provided</span></div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;<span class="comment">// Returns 2 if attitude, 3D-velocity, vertical position and relative horizontal position will be provided</span></div>
<div class="line"><a name="l03699"></a><span class="lineno"><a class="line" href="classNavEKF.html#adbbffcb5c98c13ab6b1cef9ead571451"> 3699</a></span>&#160;uint8_t <a class="code" href="classNavEKF.html#adbbffcb5c98c13ab6b1cef9ead571451">NavEKF::setInhibitGPS</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;{</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;    }</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a17086cdf3fc411329b12faa25b1713f1">optFlowDataPresent</a>()) {</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;        <a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> = 3;</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;        <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;    }</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;}</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;<span class="comment">// return the horizontal speed limit in m/s set by optical flow sensor limits</span></div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;<span class="comment">// return the scale factor to be applied to navigation velocity gains to compensate for increase in velocity noise with height when using optical flow</span></div>
<div class="line"><a name="l03714"></a><span class="lineno"><a class="line" href="classNavEKF.html#ac67dfe022dbb4c390fdefa3f60d6a6d8"> 3714</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#ac67dfe022dbb4c390fdefa3f60d6a6d8">NavEKF::getEkfControlLimits</a>(<span class="keywordtype">float</span> &amp;ekfGndSpdLimit, <span class="keywordtype">float</span> &amp;ekfNavVelGainScaler)<span class="keyword"> const</span></div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20">AID_RELATIVE</a>) {</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;        <span class="comment">// allow 1.0 rad/sec margin for angular motion</span></div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;        ekfGndSpdLimit = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classNavEKF.html#adcdf19a4bd79530aaac0fb6b49acca3f">_maxFlowRate</a> - 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>), 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) * <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2]), <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;        <span class="comment">// use standard gains up to 5.0 metres height and reduce above that</span></div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;        ekfNavVelGainScaler = 4.0f / <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>[2]),4.0f);</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;        ekfGndSpdLimit = 400.0f; <span class="comment">//return 80% of max filter speed</span></div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;        ekfNavVelGainScaler = 1.0f;</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;    }</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;}</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;<span class="comment">// return weighting of first IMU in blending function</span></div>
<div class="line"><a name="l03728"></a><span class="lineno"><a class="line" href="classNavEKF.html#a0de2acf7f39fb61c8dd76255933a1a8c"> 3728</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a0de2acf7f39fb61c8dd76255933a1a8c">NavEKF::getIMU1Weighting</a>(<span class="keywordtype">float</span> &amp;ret)<span class="keyword"> const</span></div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    ret = <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a>;</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;}</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;<span class="comment">// return the individual Z-accel bias estimates in m/s^2</span></div>
<div class="line"><a name="l03734"></a><span class="lineno"><a class="line" href="classNavEKF.html#ac2cc3ec695c82693577b72655f675aa9"> 3734</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#ac2cc3ec695c82693577b72655f675aa9">NavEKF::getAccelZBias</a>(<span class="keywordtype">float</span> &amp;zbias1, <span class="keywordtype">float</span> &amp;zbias2)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> &gt; 0) {</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;        zbias1 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">accel_zbias1</a> / <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>;</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;        zbias2 = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">accel_zbias2</a> / <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>;</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;        zbias1 = 0;</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;        zbias2 = 0;</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    }</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;}</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;<span class="comment">// return the NED wind speed estimates in m/s (positive is air moving in the direction of the axis)</span></div>
<div class="line"><a name="l03745"></a><span class="lineno"><a class="line" href="classNavEKF.html#a4f2f0068a25f875107d34f4781ddf8dd"> 3745</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a4f2f0068a25f875107d34f4781ddf8dd">NavEKF::getWind</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;wind)<span class="keyword"> const</span></div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    wind.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;    wind.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;    wind.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = 0.0f; <span class="comment">// currently don&#39;t estimate this</span></div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;}</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;<span class="comment">// return earth magnetic field estimates in measurement units / 1000</span></div>
<div class="line"><a name="l03753"></a><span class="lineno"><a class="line" href="classNavEKF.html#a1bccd4b8bcc129f2daabf04b02a44bf3"> 3753</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a1bccd4b8bcc129f2daabf04b02a44bf3">NavEKF::getMagNED</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;magNED)<span class="keyword"> const</span></div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;    magNED = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a> * 1000.0f;</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;}</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;<span class="comment">// return body magnetic field estimates in measurement units / 1000</span></div>
<div class="line"><a name="l03759"></a><span class="lineno"><a class="line" href="classNavEKF.html#add08a20902184b616da1e9f79efcbc5f"> 3759</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#add08a20902184b616da1e9f79efcbc5f">NavEKF::getMagXYZ</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;magXYZ)<span class="keyword"> const</span></div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;    magXYZ = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>*1000.0f;</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;}</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;<span class="comment">// return magnetometer offsets</span></div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;<span class="comment">// return true if offsets are valid</span></div>
<div class="line"><a name="l03766"></a><span class="lineno"><a class="line" href="classNavEKF.html#a57da170435f7f705a37d9e7beaaa680b"> 3766</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a57da170435f7f705a37d9e7beaaa680b">NavEKF::getMagOffsets</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;magOffsets)<span class="keyword"> const</span></div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;    <span class="comment">// compass offsets are valid if we have finalised magnetic field initialisation and magnetic field learning is not prohibited and primary compass is valid</span></div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a1056d50a16aea29e1fab99e3d4a1c61c">secondMagYawInit</a> &amp;&amp; (<a class="code" href="classNavEKF.html#a8a0d11f11046dfe628c6bc1e51ef643a">_magCal</a> != 2) &amp;&amp; <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#ab3787292557255d4b935b00fe7a94f68">healthy</a>(0)) {</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;        magOffsets = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a6ef45f63ac177793bf38270cef8228cb">get_offsets</a>(0) - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>*1000.0f;</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;        magOffsets = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a6ef45f63ac177793bf38270cef8228cb">get_offsets</a>(0);</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;    }</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;}</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;<span class="comment">// Return the last calculated latitude, longitude and height in WGS-84</span></div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;<span class="comment">// If a calculated location isn&#39;t available, return a raw GPS measurement</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;<span class="comment">// The status will return true if a calculation or raw measurement is available</span></div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;<span class="comment">// The getFilterStatus() function provides a more detailed description of data health and must be checked if data is to be used for flight control</span></div>
<div class="line"><a name="l03782"></a><span class="lineno"><a class="line" href="classNavEKF.html#adc74369bdb7425b717f68eec54aa123f"> 3782</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#adc74369bdb7425b717f68eec54aa123f">NavEKF::getLLH</a>(<span class="keyword">struct</span> <a class="code" href="structLocation.html">Location</a> &amp;loc)<span class="keyword"> const</span></div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a>) {</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;        <span class="comment">// Altitude returned is an absolute altitude relative to the WGS-84 spherioid</span></div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;        loc.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> = <a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a>.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>*100;</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;        loc.<a class="code" href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">flags</a>.<a class="code" href="structLocation__Option__Flags.html#a3f0f17e655550917bc3177e876d6dc14">relative_alt</a> = 0;</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;        loc.<a class="code" href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">flags</a>.<a class="code" href="structLocation__Option__Flags.html#a4c355df903072f511744774812ef6dc3">terrain_alt</a> = 0;</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        <span class="comment">// there are three modes of operation, absolute position (GPS fusion), relative position (optical flow fusion) and constant position (no aiding)</span></div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        <a class="code" href="unionnav__filter__status.html">nav_filter_status</a> status;</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;        <a class="code" href="classNavEKF.html#a84cacea011683356ae5fcd2eb2e30fcc">getFilterStatus</a>(status);</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;        <span class="keywordflow">if</span> (status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a4a085e3ddf0ce92ba727e3ba78650c34">horiz_pos_abs</a> || status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#aeb523909236437827ddecee5cdfbe0ff">horiz_pos_rel</a>) {</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;            loc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> = <a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a>.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>;</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;            loc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> = <a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a>.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>;</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;            <a class="code" href="AP__Math_8h.html#a717b438a67f0b41665feec9009ba1bd4">location_offset</a>(loc, <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;            <span class="comment">// we could be in constant position mode  becasue the vehicle has taken off without GPS, or has lost GPS</span></div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;            <span class="comment">// in this mode we cannot use the EKF states to estimate position so will return the best available data</span></div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a>)) {</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;                <span class="comment">// we have a GPS position fix to return</span></div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structLocation.html">Location</a> &amp;gpsloc = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">location</a>();</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;                loc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> = gpsloc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>;</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;                loc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> = gpsloc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>;</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;                <span class="comment">// if no GPS fix, provide last known position before entering the mode</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;                <a class="code" href="AP__Math_8h.html#a717b438a67f0b41665feec9009ba1bd4">location_offset</a>(loc, <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>, <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>);</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            }</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;        }</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;        <span class="comment">// If no origin has been defined for the EKF, then we cannot use its position states so return a raw</span></div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;        <span class="comment">// GPS reading if available and return false</span></div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a>)) {</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;            <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structLocation.html">Location</a> &amp;gpsloc = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">location</a>();</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;            loc = gpsloc;</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;            loc.<a class="code" href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">flags</a>.<a class="code" href="structLocation__Option__Flags.html#a3f0f17e655550917bc3177e876d6dc14">relative_alt</a> = 0;</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;            loc.<a class="code" href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">flags</a>.<a class="code" href="structLocation__Option__Flags.html#a4c355df903072f511744774812ef6dc3">terrain_alt</a> = 0;</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;        }</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;    }</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;}</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;<span class="comment">// return the estimated height above ground level</span></div>
<div class="line"><a name="l03827"></a><span class="lineno"><a class="line" href="classNavEKF.html#a7bcc5a68b0195a062de10b1fe028e2a4"> 3827</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a7bcc5a68b0195a062de10b1fe028e2a4">NavEKF::getHAGL</a>(<span class="keywordtype">float</span> &amp;HAGL)<span class="keyword"> const</span></div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;    HAGL = <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;    <span class="comment">// If we know the terrain offset and altitude, then we have a valid height above ground estimate</span></div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;    <span class="keywordflow">return</span> !<a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a> &amp;&amp; <a class="code" href="classNavEKF.html#aedabdd90e9cfdf598424e88700d94c7f">gndOffsetValid</a> &amp;&amp; <a class="code" href="classNavEKF.html#ad418b75ceae3dde42f8c588b7e88abb4">healthy</a>();</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;}</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;<span class="comment">// return data for debugging optical flow fusion</span></div>
<div class="line"><a name="l03835"></a><span class="lineno"><a class="line" href="classNavEKF.html#a7cdd3a0ebbcb7be9bd644ebb03665e55"> 3835</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a7cdd3a0ebbcb7be9bd644ebb03665e55">NavEKF::getFlowDebug</a>(<span class="keywordtype">float</span> &amp;varFlow, <span class="keywordtype">float</span> &amp;gndOffset, <span class="keywordtype">float</span> &amp;flowInnovX, <span class="keywordtype">float</span> &amp;flowInnovY, <span class="keywordtype">float</span> &amp;auxInnov, <span class="keywordtype">float</span> &amp;HAGL, <span class="keywordtype">float</span> &amp;rngInnov, <span class="keywordtype">float</span> &amp;range, <span class="keywordtype">float</span> &amp;gndOffsetErr)<span class="keyword"> const</span></div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;    varFlow = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#a50f655be7d57ef4d23c9d7d1007c02ea">flowTestRatio</a>[0],<a class="code" href="classNavEKF.html#a50f655be7d57ef4d23c9d7d1007c02ea">flowTestRatio</a>[1]);</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;    gndOffset = <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>;</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;    flowInnovX = <a class="code" href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">innovOptFlow</a>[0];</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;    flowInnovY = <a class="code" href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">innovOptFlow</a>[1];</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;    auxInnov = <a class="code" href="classNavEKF.html#ac046341898f80930a42b4827c2c66f98">auxFlowObsInnov</a>;</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;    HAGL = <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;    rngInnov = <a class="code" href="classNavEKF.html#a7834f68e34b1d9541d1836661b02571d">innovRng</a>;</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;    range = <a class="code" href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">rngMea</a>;</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;    gndOffsetErr = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a>); <span class="comment">// note Popt is constrained to be non-negative in EstimateTerrainOffset()</span></div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;}</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;<span class="comment">// calculate whether the flight vehicle is on the ground or flying from height, airspeed and GPS speed</span></div>
<div class="line"><a name="l03849"></a><span class="lineno"><a class="line" href="classNavEKF.html#a02ca7503660ded3d95abce7c81d2eebf"> 3849</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a02ca7503660ded3d95abce7c81d2eebf">NavEKF::SetFlightAndFusionModes</a>()</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;{</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;    <span class="comment">// determine if the vehicle is manoevring</span></div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a6ca946cfb2943450437555b33a8975f0">accNavMagHoriz</a> &gt; 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>){</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;        <a class="code" href="classNavEKF.html#a28bfd83f329595dc26ba1dce262c4c19">manoeuvring</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;        <a class="code" href="classNavEKF.html#a28bfd83f329595dc26ba1dce262c4c19">manoeuvring</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;    }</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;    <span class="comment">// if we are a fly forward type vehicle, then in-air mode can be determined through a combination of speed and height criteria</span></div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>()) {</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;        <span class="comment">// Evaluate a numerical score that defines the likelihood we are in the air</span></div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;        <span class="keywordtype">float</span> gndSpdSq = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>[0]) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>[1]);</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;        <span class="keywordtype">bool</span> highGndSpd = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;        <span class="keywordtype">bool</span> highAirSpd = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;        <span class="keywordtype">bool</span> largeHgtChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;        <span class="comment">// trigger at 8 m/s airspeed</span></div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a8691156c332da099e3f5952e72ae2a58">airspeed_sensor_enabled</a>()) {</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;            <span class="keyword">const</span> <a class="code" href="classAP__Airspeed.html">AP_Airspeed</a> *<a class="code" href="Airspeed_8pde.html#a304224bccd737323c9ee5b15cc9149ad">airspeed</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a2e82ec5ae0f44ff0e9e944e354b17eb3">get_airspeed</a>();</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;            <span class="keywordflow">if</span> (airspeed-&gt;<a class="code" href="classAP__Airspeed.html#a1027b15b91e0af1dbfe8b999a88c8a25">get_airspeed</a>() * airspeed-&gt;<a class="code" href="classAP__Airspeed.html#a9bb14f83815ed35b067dd2f4a7c1851f">get_EAS2TAS</a>() &gt; 10.0f) {</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;                highAirSpd = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;            }</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;        }</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;        <span class="comment">// trigger at 10 m/s GPS velocity, but not if GPS is reporting bad velocity errors</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;        <span class="keywordflow">if</span> (gndSpdSq &gt; 100.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; <a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a> &lt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;            highGndSpd = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;        }</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;        <span class="comment">// trigger if more than 10m away from initial height</span></div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>) &gt; 10.0f) {</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;            largeHgtChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;        }</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;        <span class="comment">// to go to in-air mode we also need enough GPS velocity to be able to calculate a reliable ground track heading and either a lerge height or airspeed change</span></div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> &amp;&amp; highGndSpd &amp;&amp; (highAirSpd || largeHgtChange)) {</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;            <a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;        }</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;        <span class="comment">// if is possible we are in flight, set the time this condition was last detected</span></div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;        <span class="keywordflow">if</span> (highGndSpd || highAirSpd || largeHgtChange) {</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;            <a class="code" href="classNavEKF.html#a08de10f525ebfa894304c1fe3f8cf521">airborneDetectTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;        }</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;        <span class="comment">// after 5 seconds of not detecting a possible flight condition, we transition to on-ground mode</span></div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> &amp;&amp; ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a08de10f525ebfa894304c1fe3f8cf521">airborneDetectTime_ms</a>) &gt; 5000)) {</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;            <a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;        }</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;        <span class="comment">// perform a yaw alignment check against GPS if exiting on-ground mode, bu tonly if we have enough ground speed</span></div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;        <span class="comment">// this is done to protect against unrecoverable heading alignment errors due to compass faults</span></div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> &amp;&amp; <a class="code" href="classNavEKF.html#aeed7826096e508cea10ebd858694f308">prevOnGround</a>) {</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;            <a class="code" href="classNavEKF.html#a24a9b1e9c8504aa4821f2459c7ae6117">alignYawGPS</a>();</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;        }</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;        <span class="comment">// If we aren&#39;t using an airspeed sensor we set the wind velocity to the reciprocal</span></div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;        <span class="comment">// of the velocity vector and scale states so that the wind speed is equal to 3m/s. This helps prevent gains</span></div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;        <span class="comment">// being too high at the start of flight if launching into a headwind until the first turn when the EKF can form</span></div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;        <span class="comment">// a wind speed estimate and also corrects bad initial wind estimates due to heading errors</span></div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> &amp;&amp; <a class="code" href="classNavEKF.html#aeed7826096e508cea10ebd858694f308">prevOnGround</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">useAirspeed</a>()) {</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;            <a class="code" href="classNavEKF.html#a6d64ec17dcec8b8c486857bd4fb3b54c">setWindVelStates</a>();</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;        }</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;    }</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;    <span class="comment">// store current on-ground status for next time</span></div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    <a class="code" href="classNavEKF.html#aeed7826096e508cea10ebd858694f308">prevOnGround</a> = <a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a>;</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;    <span class="comment">// If we are on ground, or in constant position mode, or don&#39;t have the right vehicle and sensing to estimate wind, inhibit wind states</span></div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;    <a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a> = ((!<a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">useAirspeed</a>() &amp;&amp; !<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>()) || <a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>);</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;    <span class="comment">// request mag calibration for both in-air and manoeuvre threshold options</span></div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;    <span class="keywordtype">bool</span> magCalRequested = ((<a class="code" href="classNavEKF.html#a8a0d11f11046dfe628c6bc1e51ef643a">_magCal</a> == 0) &amp;&amp; !<a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a>) || ((<a class="code" href="classNavEKF.html#a8a0d11f11046dfe628c6bc1e51ef643a">_magCal</a> == 1) &amp;&amp; <a class="code" href="classNavEKF.html#a28bfd83f329595dc26ba1dce262c4c19">manoeuvring</a>)  || (<a class="code" href="classNavEKF.html#a8a0d11f11046dfe628c6bc1e51ef643a">_magCal</a> == 3);</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;    <span class="comment">// deny mag calibration request if we aren&#39;t using the compass, are in the pre-arm constant position mode or it has been inhibited by the user</span></div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;    <span class="keywordtype">bool</span> magCalDenied = !<a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>() || <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> || (<a class="code" href="classNavEKF.html#a8a0d11f11046dfe628c6bc1e51ef643a">_magCal</a> == 2);</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;    <span class="comment">// inhibit the magnetic field calibration if not requested or denied</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;    <a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a> = (!magCalRequested || magCalDenied);</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;}</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;<span class="comment">// initialise the covariance matrix</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"><a class="line" href="classNavEKF.html#a37d2f6484fc9385a275829a481341d2a"> 3921</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a37d2f6484fc9385a275829a481341d2a">NavEKF::CovarianceInit</a>()</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;{</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;    <span class="comment">// zero the matrix</span></div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;    {</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;        <span class="keywordflow">for</span> (uint8_t j=0; j&lt;=21; j++)</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;        {</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0f;</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;        }</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;    }</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;    <span class="comment">// quaternions - TODO better maths for initial quaternion covariances that uses roll, pitch and yaw</span></div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]   = 1.0e-9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]   = 0.25f*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]   = 0.25f*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]   = 0.25f*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;    <span class="comment">// velocities</span></div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]   = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(0.7<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]   = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4];</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]   = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(0.7<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;    <span class="comment">// positions</span></div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][7]   = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(15.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][8]   = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][7];</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][9]   = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#a74e1debc46998128deb7ba6a77e75f29">_baroAltNoise</a>);</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <span class="comment">// delta angle biases</span></div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(<a class="code" href="AP__NavEKF_8cpp.html#a0baed3323b0e73e69e2d80fb232031ba">INIT_GYRO_BIAS_UNCERTAINTY</a> * <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>));</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[11][11] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10];</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[12][12] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[10][10];</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;    <span class="comment">// Z delta velocity bias</span></div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13] = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__NavEKF_8cpp.html#a486aed3cc284bf78393a531434d38a41">INIT_ACCEL_BIAS_UNCERTAINTY</a> * dtIMUavg);</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;    <span class="comment">// wind velocities</span></div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14] = 0.0f;</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15]  = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14];</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;    <span class="comment">// earth magnetic field</span></div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16] = 0.0f;</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[17][17] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16];</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[18][18] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[16][16];</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;    <span class="comment">// body magnetic field</span></div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][19] = 0.0f;</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[20][20] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][19];</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[21][21] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[19][19];</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;    <span class="comment">// optical flow ground height covariance</span></div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;    <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> = 0.25f;</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;}</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;<span class="comment">// force symmetry on the covariance matrix to prevent ill-conditioning</span></div>
<div class="line"><a name="l03968"></a><span class="lineno"><a class="line" href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb"> 3968</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb">NavEKF::ForceSymmetry</a>()</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;{</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;    {</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;        <span class="keywordflow">for</span> (uint8_t j=0; j&lt;=<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>-1; j++)</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;        {</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;            <span class="keywordtype">float</span> temp = 0.5f*(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[j][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = temp;</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[j][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = temp;</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;        }</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;    }</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;}</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;<span class="comment">// copy covariances across from covariance prediction calculation and fix numerical errors</span></div>
<div class="line"><a name="l03982"></a><span class="lineno"><a class="line" href="classNavEKF.html#afaa81e08a98db599f139657cabd99fa7"> 3982</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#afaa81e08a98db599f139657cabd99fa7">NavEKF::CopyAndFixCovariances</a>()</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;{</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;    <span class="comment">// copy predicted variances</span></div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;        <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">nextP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;    }</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;    <span class="comment">// copy predicted covariances and force symmetry</span></div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=21; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;        <span class="keywordflow">for</span> (uint8_t j=0; j&lt;=<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>-1; j++)</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;        {</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.5f*(<a class="code" href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">nextP</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] + <a class="code" href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">nextP</a>[j][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[j][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        }</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;    }</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;}</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;<span class="comment">// constrain variances (diagonal terms) in the state covariance matrix to  prevent ill-conditioning</span></div>
<div class="line"><a name="l03999"></a><span class="lineno"><a class="line" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd"> 3999</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">NavEKF::ConstrainVariances</a>()</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;{</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=3; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>],0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>); <span class="comment">// quaternions</span></div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=4; i&lt;=6; i++) <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i],0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0e3f); <span class="comment">// velocities</span></div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=7; i&lt;=9; i++) <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i],0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0e6f); <span class="comment">// positions</span></div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=10; i&lt;=12; i++) <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i],0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(0.175<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>)); <span class="comment">// delta angle biases</span></div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;    <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[13][13],0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(10.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * dtIMUavg)); <span class="comment">// delta velocity bias</span></div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=14; i&lt;=15; i++) <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i],0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0e3f); <span class="comment">// earth magnetic field</span></div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=16; i&lt;=21; i++) <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[i][i],0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>); <span class="comment">// body magnetic field</span></div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;}</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;<span class="comment">// constrain states to prevent ill-conditioning</span></div>
<div class="line"><a name="l04011"></a><span class="lineno"><a class="line" href="classNavEKF.html#a1d3dccbab86ffda5898048f8f159c00c"> 4011</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a1d3dccbab86ffda5898048f8f159c00c">NavEKF::ConstrainStates</a>()</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;{</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;    <span class="comment">// quaternions are limited between +-1</span></div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=3; <a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[<a class="code" href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a>],-1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;    <span class="comment">// velocity limit 500 m/sec (could set this based on some multiple of max airspeed * EAS2TAS)</span></div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=4; i&lt;=6; i++) <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i],-5.0e2f,5.0e2f);</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    <span class="comment">// position limit 1000 km - TODO apply circular limit</span></div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=7; i&lt;=8; i++) <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i],-1.0e6f,1.0e6f);</div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;    <span class="comment">// height limit covers home alt on everest through to home alt at SL and ballon drop</span></div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>,-4.0e4f,1.0e4f);</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;    <span class="comment">// gyro bias limit ~6 deg/sec (this needs to be set based on manufacturers specs)</span></div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=10; i&lt;=12; i++) <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i],-0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*<a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a>,0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*dtIMUavg);</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;    <span class="comment">// Z accel bias limit 1.0 m/s^2 (this needs to be finalised from test data)</span></div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;    <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[13] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[13],-1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*dtIMUavg,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*dtIMUavg);</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[22] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[22],-1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*dtIMUavg,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*dtIMUavg);</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;    <span class="comment">// wind velocity limit 100 m/s (could be based on some multiple of max airspeed * EAS2TAS) - TODO apply circular limit</span></div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=14; i&lt;=15; i++) <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i],-100.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,100.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;    <span class="comment">// earth magnetic field limit</span></div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=16; i&lt;=18; i++) <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i],-1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;    <span class="comment">// body magnetic field limit</span></div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=19; i&lt;=21; i++) <a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i] = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(<a class="code" href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">states</a>[i],-0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;    <span class="comment">// constrain the terrain offset state</span></div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;    <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a>, <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> + <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;}</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;</div>
<div class="line"><a name="l04036"></a><span class="lineno"><a class="line" href="classNavEKF.html#ad3d371f0125528a6ca2f3a996e7a4ad6"> 4036</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#ad3d371f0125528a6ca2f3a996e7a4ad6">NavEKF::readDeltaVelocity</a>(uint8_t ins_index, <a class="code" href="classVector3.html">Vector3f</a> &amp;dVel, <span class="keywordtype">float</span> &amp;dVel_dt) {</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a> &amp;<a class="code" href="AHRS__Test_8pde.html#a4b91d1711c0d031f33f581540503bc54">ins</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">get_ins</a>();</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;    <span class="keywordflow">if</span> (ins_index &lt; ins.<a class="code" href="classAP__InertialSensor.html#ac57331a5046d45016ef900726e1be2fb">get_accel_count</a>()) {</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;        <span class="keywordflow">if</span> (ins.<a class="code" href="classAP__InertialSensor.html#ae29959984a5cbda37ebfce599f89ef73">get_delta_velocity</a>(ins_index,dVel)) {</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;            dVel_dt = ins.<a class="code" href="classAP__InertialSensor.html#ad22e8ed9b13a093d5cf3a2a420522b3b">get_delta_velocity_dt</a>(ins_index);</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;            dVel = ins.<a class="code" href="classAP__InertialSensor.html#a0f63a4a0e6fc84d6ab9519bc4b254055">get_accel</a>(ins_index) * <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;            dVel_dt = <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;        }</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;    }</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;}</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;</div>
<div class="line"><a name="l04051"></a><span class="lineno"><a class="line" href="classNavEKF.html#af3ed4d1ab0d1e7c6eb21356ba24b8cd6"> 4051</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#af3ed4d1ab0d1e7c6eb21356ba24b8cd6">NavEKF::readDeltaAngle</a>(uint8_t ins_index, <a class="code" href="classVector3.html">Vector3f</a> &amp;dAng) {</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a> &amp;<a class="code" href="AHRS__Test_8pde.html#a4b91d1711c0d031f33f581540503bc54">ins</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">get_ins</a>();</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;    <span class="keywordflow">if</span> (ins_index &lt; ins.<a class="code" href="classAP__InertialSensor.html#aef7fac4fe6ae817ed325f9e35735e94d">get_gyro_count</a>()) {</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;        <span class="keywordflow">if</span> (!ins.<a class="code" href="classAP__InertialSensor.html#a3be069418436a7fc7a9f87c2b8b34730">get_delta_angle</a>(ins_index,dAng)) {</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;            dAng = ins.<a class="code" href="classAP__InertialSensor.html#a6df2d8ad956d4f375bdee541102f16af">get_gyro</a>(ins_index) * <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a>;</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;        }</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;    }</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;}</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;<span class="comment">// update IMU delta angle and delta velocity measurements</span></div>
<div class="line"><a name="l04064"></a><span class="lineno"><a class="line" href="classNavEKF.html#a617e88f0e357eb16d2540f25981e9ee2"> 4064</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a617e88f0e357eb16d2540f25981e9ee2">NavEKF::readIMUData</a>()</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;{</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a> &amp;<a class="code" href="AHRS__Test_8pde.html#a4b91d1711c0d031f33f581540503bc54">ins</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">get_ins</a>();</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;    <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> = 1.0f/ins.<a class="code" href="classAP__InertialSensor.html#a7e9afc57ac1aa35adca7d8bf870fbb4c">get_sample_rate</a>();</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;    <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(ins.<a class="code" href="classAP__InertialSensor.html#a7091792f55b39778157617b5e38e6075">get_delta_time</a>(),1.0e-3<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;    <span class="comment">// the imu sample time is used as a common time reference throughout the filter</span></div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;    <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> = hal.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#a26b68339fc68a562d8d3a1238d0ec8c1">millis</a>();</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;    <span class="keywordflow">if</span> (ins.<a class="code" href="classAP__InertialSensor.html#a2044e7b3804c73b4c393d3988351a96e">get_accel_health</a>(0) &amp;&amp; ins.<a class="code" href="classAP__InertialSensor.html#a2044e7b3804c73b4c393d3988351a96e">get_accel_health</a>(1)) {</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;        <span class="comment">// dual accel mode</span></div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;        <a class="code" href="classNavEKF.html#ad3d371f0125528a6ca2f3a996e7a4ad6">readDeltaVelocity</a>(0, <a class="code" href="classNavEKF.html#ae409812bda25d41cf485da8a133c8cf7">dVelIMU1</a>, <a class="code" href="classNavEKF.html#a42c64f93e6b922ee0e9167c7c9755748">dtDelVel1</a>);</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;        <a class="code" href="classNavEKF.html#ad3d371f0125528a6ca2f3a996e7a4ad6">readDeltaVelocity</a>(1, <a class="code" href="classNavEKF.html#a5bf42c72b13a5a1b0055d42627dd8bde">dVelIMU2</a>, <a class="code" href="classNavEKF.html#a708dcd665d3a63193a1efd2ac89e2d8c">dtDelVel2</a>);</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;        <span class="comment">// single accel mode - one of the first two accelerometers are unhealthy</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;        <span class="comment">// read primary accelerometer into dVelIMU1 and copy to dVelIMU2</span></div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;        <a class="code" href="classNavEKF.html#ad3d371f0125528a6ca2f3a996e7a4ad6">readDeltaVelocity</a>(ins.<a class="code" href="classAP__InertialSensor.html#ab7e75af54a874d77240c89c6e5152a99">get_primary_accel</a>(), <a class="code" href="classNavEKF.html#ae409812bda25d41cf485da8a133c8cf7">dVelIMU1</a>, <a class="code" href="classNavEKF.html#a42c64f93e6b922ee0e9167c7c9755748">dtDelVel1</a>);</div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;        <a class="code" href="classNavEKF.html#a708dcd665d3a63193a1efd2ac89e2d8c">dtDelVel2</a> = <a class="code" href="classNavEKF.html#a42c64f93e6b922ee0e9167c7c9755748">dtDelVel1</a>;</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;        <a class="code" href="classNavEKF.html#a5bf42c72b13a5a1b0055d42627dd8bde">dVelIMU2</a> = <a class="code" href="classNavEKF.html#ae409812bda25d41cf485da8a133c8cf7">dVelIMU1</a>;</div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;    }</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;</div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    <span class="keywordflow">if</span> (ins.<a class="code" href="classAP__InertialSensor.html#abc8c1aea2c3bc58a05d8d9832a9d1194">get_gyro_health</a>(0) &amp;&amp; ins.<a class="code" href="classAP__InertialSensor.html#abc8c1aea2c3bc58a05d8d9832a9d1194">get_gyro_health</a>(1)) {</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;        <span class="comment">// dual gyro mode - average first two gyros</span></div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> dAng;</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;        <a class="code" href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">dAngIMU</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;        <a class="code" href="classNavEKF.html#af3ed4d1ab0d1e7c6eb21356ba24b8cd6">readDeltaAngle</a>(0, dAng);</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;        <a class="code" href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">dAngIMU</a> += dAng;</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;        <a class="code" href="classNavEKF.html#af3ed4d1ab0d1e7c6eb21356ba24b8cd6">readDeltaAngle</a>(1, dAng);</div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;        <a class="code" href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">dAngIMU</a> += dAng;</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;        <a class="code" href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">dAngIMU</a> *= 0.5f;</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;        <span class="comment">// single gyro mode - one of the first two gyros are unhealthy or don&#39;t exist</span></div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;        <span class="comment">// just read primary gyro</span></div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;        <a class="code" href="classNavEKF.html#af3ed4d1ab0d1e7c6eb21356ba24b8cd6">readDeltaAngle</a>(ins.<a class="code" href="classAP__InertialSensor.html#a7fa04e2f196b27b876d86966f64e1fed">get_primary_gyro</a>(), <a class="code" href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">dAngIMU</a>);</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;    }</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;}</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;<span class="comment">// check for new valid GPS data and update stored measurement if available</span></div>
<div class="line"><a name="l04104"></a><span class="lineno"><a class="line" href="classNavEKF.html#a4c44a7b25f5b5584b755142c6198fd1e"> 4104</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a4c44a7b25f5b5584b755142c6198fd1e">NavEKF::readGpsData</a>()</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;{</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;    <span class="keywordtype">bool</span> goodToAlign = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;    <span class="comment">// check for new GPS data</span></div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#af701b15d8f8f1050e4acab57a867cf4b">last_message_time_ms</a>() != <a class="code" href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">lastFixTime_ms</a>) &amp;&amp;</div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;            (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a>))</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;    {</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;        <span class="comment">// store fix time from previous read</span></div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;        <a class="code" href="classNavEKF.html#a8ac5727059185f254f5c95ea8ba658b1">secondLastFixTime_ms</a> = <a class="code" href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">lastFixTime_ms</a>;</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;        <span class="comment">// get current fix time</span></div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;        <a class="code" href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">lastFixTime_ms</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#af701b15d8f8f1050e4acab57a867cf4b">last_message_time_ms</a>();</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;</div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;        <span class="comment">// set flag that lets other functions know that new GPS data has arrived</span></div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;        <a class="code" href="classNavEKF.html#af5b82a44abb8a143dd981043af24248f">newDataGps</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;</div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;        <span class="comment">// get state vectors that were stored at the time that is closest to when the the GPS measurement</span></div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;        <span class="comment">// time after accounting for measurement delays</span></div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;        <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">statesAtVelTime</a>, (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="AP__Math_8cpp.html#ac5d9502aca91c97f523fd9b35590215f">constrain_int16</a>(<a class="code" href="classNavEKF.html#a83d2898e9146509d0fc353a17a2dfc7e">_msecVelDelay</a>, 0, 500)));</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;        <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">statesAtPosTime</a>, (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="AP__Math_8cpp.html#ac5d9502aca91c97f523fd9b35590215f">constrain_int16</a>(<a class="code" href="classNavEKF.html#a575fac67ea0188de47ee6ac5c2217f32">_msecPosDelay</a>, 0, 500)));</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;        <span class="comment">// read the NED velocity from the GPS</span></div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;        <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a8b36acdc5098b3f77e28ec640b438fbd">velocity</a>();</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;        <span class="comment">// Use the speed accuracy from the GPS if available, otherwise set it to zero.</span></div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;        <span class="comment">// Apply a decaying envelope filter with a 5 second time constant to the raw speed accuracy data</span></div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;        <span class="keywordtype">float</span> alpha = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(0.0002<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * (<a class="code" href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">lastFixTime_ms</a> - <a class="code" href="classNavEKF.html#a8ac5727059185f254f5c95ea8ba658b1">secondLastFixTime_ms</a>),0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;        <a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a> *= (1.0f - alpha);</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;        <span class="keywordtype">float</span> gpsSpdAccRaw;</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#ae23d76fc05fafc83e57d0c6a620b1567">speed_accuracy</a>(gpsSpdAccRaw)) {</div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;            <a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a> = 0.0f;</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;            <a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a>,gpsSpdAccRaw);</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;        }</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;        <span class="comment">// check if we have enough GPS satellites and increase the gps noise scaler if we don&#39;t</span></div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#af74c8da8ab7394a33b0f0e64582d8648">num_sats</a>() &gt;= 6 &amp;&amp; !<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;            <a class="code" href="classNavEKF.html#a33123d9b5a1a7551b2c0a7c1addea560">gpsNoiseScaler</a> = 1.0f;</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#af74c8da8ab7394a33b0f0e64582d8648">num_sats</a>() == 5 &amp;&amp; !<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>) {</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;            <a class="code" href="classNavEKF.html#a33123d9b5a1a7551b2c0a7c1addea560">gpsNoiseScaler</a> = 1.4f;</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// &lt;= 4 satellites or in constant position mode</span></div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;            <a class="code" href="classNavEKF.html#a33123d9b5a1a7551b2c0a7c1addea560">gpsNoiseScaler</a> = 2.0f;</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;        }</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;        <span class="comment">// Check if GPS can output vertical velocity and set GPS fusion mode accordingly</span></div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#ac7d2e0692095207a6ff19072dcac9ef6">have_vertical_velocity</a>()) {</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;            <span class="comment">// vertical velocity should not be fused</span></div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 0) {</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;                <a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> = 1;</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;            }</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;        }</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;        <span class="comment">// Monitor quality of the GPS velocity data for alignment</span></div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;        goodToAlign = <a class="code" href="classNavEKF.html#a442aeaf3f7b83e2be7f737ac81486c65">calcGpsGoodToAlign</a>();</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;        <span class="comment">// read latitutde and longitude from GPS and convert to local NE position relative to the stored origin</span></div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;        <span class="comment">// If we don&#39;t have an origin, then set it to the current GPS coordinates</span></div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structLocation.html">Location</a> &amp;gpsloc = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">location</a>();</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a>) {</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;            <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a> = <a class="code" href="AP__Math_8h.html#a527b26472ed6f2e0c141e109a0722a0a">location_diff</a>(<a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a>, gpsloc);</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (goodToAlign){</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;            <span class="comment">// Set the NE origin to the current GPS position</span></div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;            <a class="code" href="classNavEKF.html#a7bf2627b0844597c21b9736204fd672f">setOrigin</a>();</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;            <span class="comment">// Now we know the location we have an estimate for the magnetic field declination and adjust the earth field accordingly</span></div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;            <a class="code" href="classNavEKF.html#a22aad7c0baf696cae27135ecaa4f2f58">alignMagStateDeclination</a>();</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;            <span class="comment">// Set the height of the NED origin to ‘height of baro height datum relative to GPS height datum&#39;</span></div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;            <a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a>.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> = gpsloc.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>;</div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;            <span class="comment">// We are by definition at the origin at the instant of alignment so set NE position to zero</span></div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;            <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;            <span class="comment">// If the vehicle is in flight (use arm status to determine) and GPS useage isn&#39;t explicitly prohibited, we switch to absolute position mode</span></div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; <a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> != 3) {</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;                <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;                <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>;</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;                <a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;                <span class="comment">// Initialise EKF position and velocity states</span></div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;                <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;                <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;            }</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;        }</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;</div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;        <span class="comment">// calculate a position offset which is applied to NE position and velocity wherever it is used throughout code to allow GPS position jumps to be accommodated gradually</span></div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;        <a class="code" href="classNavEKF.html#a55a6ae919135e4deef0cffe2eca3ac80">decayGpsOffset</a>();</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;    }</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;    <span class="comment">// If no previous GPS lock or told not to use it, or EKF origin not set, we declare the  GPS unavailable for use</span></div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &lt; <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a>) || <a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 3 || !<a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a>) {</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;        <a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;        <a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;    }</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;}</div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;<span class="comment">// check for new altitude measurement data and update stored measurement if available</span></div>
<div class="line"><a name="l04197"></a><span class="lineno"><a class="line" href="classNavEKF.html#a87c71e92e35c460ff8f026333dc1e813"> 4197</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a87c71e92e35c460ff8f026333dc1e813">NavEKF::readHgtData</a>()</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;{</div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;    <span class="comment">// check to see if baro measurement has changed so we know if a new measurement has arrived</span></div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a24be97aa79bc2f3f9b9bbb84ede8c298">_baro</a>.<a class="code" href="classAP__Baro.html#aae5b3ae28aca807eb20b722a04685061">get_last_update</a>() != <a class="code" href="classNavEKF.html#aebca5af77c541497460468f5f6b4cfcb">lastHgtMeasTime</a>) {</div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        <span class="comment">// Don&#39;t use Baro height if operating in optical flow mode as we use range finder instead</span></div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 3 &amp;&amp; <a class="code" href="classNavEKF.html#ac428877731660c88f3854d0fce38ff1e">_altSource</a> == 1) {</div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a0eb21c6bcabd51abbf2279f17e434d67">rngValidMeaTime_ms</a>) &lt; 2000) {</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;                <span class="comment">// adjust range finder measurement to allow for effect of vehicle tilt and height of sensor</span></div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;                <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">rngMea</a> * <a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a>.<a class="code" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>, <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;                <span class="comment">// get states that were stored at the time closest to the measurement time, taking measurement delay into account</span></div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;                <a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a> = <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>;</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;                <span class="comment">// calculate offset to baro data that enables baro to be used as a backup</span></div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;                <span class="comment">// filter offset to reduce effect of baro noise and other transient errors on estimate</span></div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;                <a class="code" href="classNavEKF.html#a63a00adf98f2e2dd2ddf271201d880c4">baroHgtOffset</a> = 0.1f * (<a class="code" href="classNavEKF.html#a24be97aa79bc2f3f9b9bbb84ede8c298">_baro</a>.<a class="code" href="classAP__Baro.html#a984b4dbc11e276e832467253590da933">get_altitude</a>() + <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) + 0.9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * <a class="code" href="classNavEKF.html#a63a00adf98f2e2dd2ddf271201d880c4">baroHgtOffset</a>;</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; <a class="code" href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">takeOffDetected</a>) {</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;                <span class="comment">// use baro measurement and correct for baro offset - failsafe use only as baro will drift</span></div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;                <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#a24be97aa79bc2f3f9b9bbb84ede8c298">_baro</a>.<a class="code" href="classAP__Baro.html#a984b4dbc11e276e832467253590da933">get_altitude</a>() - <a class="code" href="classNavEKF.html#a63a00adf98f2e2dd2ddf271201d880c4">baroHgtOffset</a>, <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;                <span class="comment">// get states that were stored at the time closest to the measurement time, taking measurement delay into account</span></div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;                <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a>, (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#ab6e1b2ec32c9b85512a6eaa96e67a9f4">msecHgtDelay</a>));</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;                <span class="comment">// If we are on ground and have no range finder reading, assume the nominal on-ground height</span></div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;                <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a> = <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>;</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;                <span class="comment">// get states that were stored at the time closest to the measurement time, taking measurement delay into account</span></div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;                <a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>;</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;                <span class="comment">// calculate offset to baro data that enables baro to be used as a backup</span></div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;                <span class="comment">// filter offset to reduce effect of baro noise and other transient errors on estimate</span></div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;                <a class="code" href="classNavEKF.html#a63a00adf98f2e2dd2ddf271201d880c4">baroHgtOffset</a> = 0.1f * (<a class="code" href="classNavEKF.html#a24be97aa79bc2f3f9b9bbb84ede8c298">_baro</a>.<a class="code" href="classAP__Baro.html#a984b4dbc11e276e832467253590da933">get_altitude</a>() + <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) + 0.9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * <a class="code" href="classNavEKF.html#a63a00adf98f2e2dd2ddf271201d880c4">baroHgtOffset</a>;</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;            }</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;            <span class="comment">// use baro measurement and correct for baro offset</span></div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;            <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a> = <a class="code" href="classNavEKF.html#a24be97aa79bc2f3f9b9bbb84ede8c298">_baro</a>.<a class="code" href="classAP__Baro.html#a984b4dbc11e276e832467253590da933">get_altitude</a>();</div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;            <span class="comment">// get states that were stored at the time closest to the measurement time, taking measurement delay into account</span></div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;            <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">statesAtHgtTime</a>, (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#ab6e1b2ec32c9b85512a6eaa96e67a9f4">msecHgtDelay</a>));</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;        }</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;        <span class="comment">// filtered baro data used to provide a reference for takeoff</span></div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;        <span class="comment">// it is is reset to last height measurement on disarming in performArmingChecks()</span></div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#a3108596d21f107f9b35517900bb82569">getTakeoffExpected</a>()) {</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> gndHgtFiltTC = 0.5f;</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> dtBaro = <a class="code" href="classNavEKF.html#a584f5bca8fd1baa4a42462830cb5151b">msecHgtAvg</a>*1.0e-3<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;            <span class="keywordtype">float</span> alpha = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>(dtBaro / (dtBaro+gndHgtFiltTC),0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;            <a class="code" href="classNavEKF.html#aec95d8fd1ddeb0c6eff1b185ff00b94d">meaHgtAtTakeOff</a> += (<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>-<a class="code" href="classNavEKF.html#aec95d8fd1ddeb0c6eff1b185ff00b94d">meaHgtAtTakeOff</a>)*alpha;</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; <a class="code" href="classNavEKF.html#a3108596d21f107f9b35517900bb82569">getTakeoffExpected</a>()) {</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;            <span class="comment">// If we are in takeoff mode, the height measurement is limited to be no less than the measurement at start of takeoff</span></div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;            <span class="comment">// This prevents negative baro disturbances due to copter downwash corrupting the EKF altitude during initial ascent</span></div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;            <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>, <a class="code" href="classNavEKF.html#aec95d8fd1ddeb0c6eff1b185ff00b94d">meaHgtAtTakeOff</a>);</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;        }</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;</div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;        <span class="comment">// set flag to let other functions know new data has arrived</span></div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;        <a class="code" href="classNavEKF.html#adc843fa54ea2e75f96053bc8033e0f09">newDataHgt</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;        <span class="comment">// time stamp used to check for new measurement</span></div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;        <a class="code" href="classNavEKF.html#aebca5af77c541497460468f5f6b4cfcb">lastHgtMeasTime</a> = <a class="code" href="classNavEKF.html#a24be97aa79bc2f3f9b9bbb84ede8c298">_baro</a>.<a class="code" href="classAP__Baro.html#aae5b3ae28aca807eb20b722a04685061">get_last_update</a>();</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;        <a class="code" href="classNavEKF.html#adc843fa54ea2e75f96053bc8033e0f09">newDataHgt</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;    }</div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;}</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;<span class="comment">// check for new magnetometer data and update store measurements if available</span></div>
<div class="line"><a name="l04255"></a><span class="lineno"><a class="line" href="classNavEKF.html#adf06c6a73b9ca994ca16892ed0740283"> 4255</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#adf06c6a73b9ca994ca16892ed0740283">NavEKF::readMagData</a>()</div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;{</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a9600516e0dbde9186d3b14b3457af013">last_update_usec</a>() != <a class="code" href="classNavEKF.html#a31faab99ce8bbe09b011f75bfa615c56">lastMagUpdate</a>) {</div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;        <span class="comment">// store time of last measurement update</span></div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;        <a class="code" href="classNavEKF.html#a31faab99ce8bbe09b011f75bfa615c56">lastMagUpdate</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a9600516e0dbde9186d3b14b3457af013">last_update_usec</a>();</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;        <span class="comment">// read compass data and scale to improve numerical conditioning</span></div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;        <a class="code" href="classNavEKF.html#aee2794d28212ecbeb58ba7fa5fedb543">magData</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#aa1f44c7920bbd147fa2e58bfedd3c4bb">get_field</a>() * 0.001f;</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;        <span class="comment">// get states stored at time closest to measurement time after allowance for measurement delay</span></div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">statesAtMagMeasTime</a>, (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a1c47691318dde97cee97ae20a8dfac8e">msecMagDelay</a>));</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        <span class="comment">// let other processes know that new compass data has arrived</span></div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;        <a class="code" href="classNavEKF.html#a0e2d1fc2ccd36ee1751b09aae63cfda1">newDataMag</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;        <span class="comment">// check if compass offsets have ben changed and adjust EKF bias states to maintain consistent innovations</span></div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#ab3787292557255d4b935b00fe7a94f68">healthy</a>(0)) {</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;            <a class="code" href="classVector3.html">Vector3f</a> nowMagOffsets = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a6ef45f63ac177793bf38270cef8228cb">get_offsets</a>(0);</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;            <span class="keywordtype">bool</span> changeDetected = (!<a class="code" href="AP__Math_8h.html#acedd05d9f5ab6f2878991cc684e17c18">is_equal</a>(nowMagOffsets.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>,<a class="code" href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">lastMagOffsets</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>) || !<a class="code" href="AP__Math_8h.html#acedd05d9f5ab6f2878991cc684e17c18">is_equal</a>(nowMagOffsets.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>,<a class="code" href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">lastMagOffsets</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) || !<a class="code" href="AP__Math_8h.html#acedd05d9f5ab6f2878991cc684e17c18">is_equal</a>(nowMagOffsets.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>,<a class="code" href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">lastMagOffsets</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>));</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;            <span class="comment">// Ignore bias changes before final mag field and yaw initialisation, as there may have been a compass calibration</span></div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;            <span class="keywordflow">if</span> (changeDetected &amp;&amp; <a class="code" href="classNavEKF.html#a1056d50a16aea29e1fab99e3d4a1c61c">secondMagYawInit</a>) {</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;                <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> += (nowMagOffsets.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> - <a class="code" href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">lastMagOffsets</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>) * 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;                <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> += (nowMagOffsets.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> - <a class="code" href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">lastMagOffsets</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) * 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;                <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">body_magfield</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> += (nowMagOffsets.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - <a class="code" href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">lastMagOffsets</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) * 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;            }</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;        <a class="code" href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">lastMagOffsets</a> = nowMagOffsets;</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;        }</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;        <a class="code" href="classNavEKF.html#a0e2d1fc2ccd36ee1751b09aae63cfda1">newDataMag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;    }</div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;}</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;<span class="comment">// check for new airspeed data and update stored measurements if available</span></div>
<div class="line"><a name="l04288"></a><span class="lineno"><a class="line" href="classNavEKF.html#a6d310b4b28cd5ab824db834feadc83ff"> 4288</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a6d310b4b28cd5ab824db834feadc83ff">NavEKF::readAirSpdData</a>()</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;{</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;    <span class="comment">// if airspeed reading is valid and is set by the user to be used and has been updated then</span></div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;    <span class="comment">// we take a new reading, convert from EAS to TAS and set the flag letting other functions</span></div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;    <span class="comment">// know a new measurement is available</span></div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAP__Airspeed.html">AP_Airspeed</a> *aspeed = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a2e82ec5ae0f44ff0e9e944e354b17eb3">get_airspeed</a>();</div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;    <span class="keywordflow">if</span> (aspeed &amp;&amp;</div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;        aspeed-&gt;<a class="code" href="classAP__Airspeed.html#a6162295b433e3a863c0d4b9086b19014">use</a>() &amp;&amp;</div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;        aspeed-&gt;<a class="code" href="classAP__Airspeed.html#adaad3ab10fbc87f821d6657683ad22fa">last_update_ms</a>() != <a class="code" href="classNavEKF.html#a0779a1ae19736ff610bc33032eecefc1">lastAirspeedUpdate</a>) {</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        <a class="code" href="classNavEKF.html#a4b6dd409fcc6638f66596f0e8c99b96e">VtasMeas</a> = aspeed-&gt;<a class="code" href="classAP__Airspeed.html#a1027b15b91e0af1dbfe8b999a88c8a25">get_airspeed</a>() * aspeed-&gt;<a class="code" href="classAP__Airspeed.html#a9bb14f83815ed35b067dd2f4a7c1851f">get_EAS2TAS</a>();</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;        <a class="code" href="classNavEKF.html#a0779a1ae19736ff610bc33032eecefc1">lastAirspeedUpdate</a> = aspeed-&gt;<a class="code" href="classAP__Airspeed.html#adaad3ab10fbc87f821d6657683ad22fa">last_update_ms</a>();</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;        <a class="code" href="classNavEKF.html#ae0f9a27d62a94d973281b2ee9bae4ac6">newDataTas</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;        <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#a438ec63738f917e8d25a448414c83d23">statesAtVtasMeasTime</a>, (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a6d214404e386084c3ed35b2b89f6e0a5">msecTasDelay</a>));</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;        <a class="code" href="classNavEKF.html#ae0f9a27d62a94d973281b2ee9bae4ac6">newDataTas</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    }</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;}</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;<span class="comment">// write the raw optical flow measurements</span></div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;<span class="comment">// this needs to be called externally.</span></div>
<div class="line"><a name="l04308"></a><span class="lineno"><a class="line" href="classNavEKF.html#ad193e5aab03041673d4cfad9f7a2a6ba"> 4308</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#ad193e5aab03041673d4cfad9f7a2a6ba">NavEKF::writeOptFlowMeas</a>(uint8_t &amp;rawFlowQuality, <a class="code" href="structVector2.html">Vector2f</a> &amp;rawFlowRates, <a class="code" href="structVector2.html">Vector2f</a> &amp;rawGyroRates, uint32_t &amp;msecFlowMeas)</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;{</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;    <span class="comment">// The raw measurements need to be optical flow rates in radians/second averaged across the time since the last update</span></div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    <span class="comment">// The PX4Flow sensor outputs flow rates with the following axis and sign conventions:</span></div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;    <span class="comment">// A positive X rate is produced by a positive sensor rotation about the X axis</span></div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;    <span class="comment">// A positive Y rate is produced by a positive sensor rotation about the Y axis</span></div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;    <span class="comment">// This filter uses a different definition of optical flow rates to the sensor with a positive optical flow rate produced by a</span></div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;    <span class="comment">// negative rotation about that axis. For example a positive rotation of the flight vehicle about its X (roll) axis would produce a negative X flow rate</span></div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;    <a class="code" href="classNavEKF.html#a9edebf0f3984be8ac3a94070e5ccccbc">flowMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    <a class="code" href="classNavEKF.html#a9b64a8219583f08c858742652fce2774">flowQuality</a> = rawFlowQuality;</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;    <span class="comment">// recall angular rates averaged across flow observation period allowing for processing, transmission and intersample delays</span></div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;    <a class="code" href="classNavEKF.html#a826c6c487744f2a5997045e1bf4ffb6e">RecallOmega</a>(<a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>, <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a6e4b25213035e6299da4e6df725db0ec">flowTimeDeltaAvg_ms</a> - <a class="code" href="classNavEKF.html#aac9fc945bc68d4140eccf78d4ab295dc">_msecFLowDelay</a>, <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#aac9fc945bc68d4140eccf78d4ab295dc">_msecFLowDelay</a>);</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;    <span class="comment">// calculate bias errors on flow sensor gyro rates, but protect against spikes in data</span></div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;    <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = 0.99f * <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> + 0.01f * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>((rawGyroRates.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> - <a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>),-0.1f,0.1f);</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;    <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = 0.99f * <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> + 0.01f * <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>((rawGyroRates.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> - <a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>),-0.1f,0.1f);</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;    <span class="comment">// check for takeoff if relying on optical flow and zero measurements until takeoff detected</span></div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;    <span class="comment">// if we haven&#39;t taken off - constrain position and velocity states</span></div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 3) {</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;        <a class="code" href="classNavEKF.html#a9c6fa0fb0aea35417db85255fdea98c9">detectOptFlowTakeoff</a>();</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;    }</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;    <span class="comment">// recall vehicle states at mid sample time for flow observations allowing for delays</span></div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;    <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>, <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#aac9fc945bc68d4140eccf78d4ab295dc">_msecFLowDelay</a> - <a class="code" href="classNavEKF.html#a6e4b25213035e6299da4e6df725db0ec">flowTimeDeltaAvg_ms</a>/2);</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;    <span class="comment">// calculate rotation matrices at mid sample time for flow observations</span></div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;    <a class="code" href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">statesAtFlowTime</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#afb7132c9c69a984a40be950a17effeaa">rotation_matrix</a>(<a class="code" href="classNavEKF.html#ad47e865d8535dad43dfae2af2001b855">Tbn_flow</a>);</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;    <a class="code" href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">Tnb_flow</a> = <a class="code" href="classNavEKF.html#ad47e865d8535dad43dfae2af2001b855">Tbn_flow</a>.<a class="code" href="classMatrix3.html#a18e2df03dec4abdf11fc9fb60ed7c226">transposed</a>();</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;    <span class="comment">// don&#39;t use data with a low quality indicator or extreme rates (helps catch corrupt sensor data)</span></div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;    <span class="keywordflow">if</span> ((rawFlowQuality &gt; 0) &amp;&amp; rawFlowRates.<a class="code" href="structVector2.html#ad8ebafde96f43521d3647e2552387529">length</a>() &lt; 4.2f &amp;&amp; rawGyroRates.<a class="code" href="structVector2.html#ad8ebafde96f43521d3647e2552387529">length</a>() &lt; 4.2f) {</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;        <span class="comment">// correct flow sensor rates for bias</span></div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;        <a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = rawGyroRates.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> - <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;        <a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = rawGyroRates.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> - <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        <span class="comment">// write uncorrected flow rate measurements that will be used by the focal length scale factor estimator</span></div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;        <span class="comment">// note correction for different axis and sign conventions used by the px4flow sensor</span></div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;        <a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[0] = - rawFlowRates.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>; <span class="comment">// raw (non motion compensated) optical flow angular rate about the X axis (rad/sec)</span></div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;        <a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[1] = - rawFlowRates.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>; <span class="comment">// raw (non motion compensated) optical flow angular rate about the Y axis (rad/sec)</span></div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;        <span class="comment">// write flow rate measurements corrected for body rates</span></div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;        <a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[0] = <a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[0] + <a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;        <a class="code" href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">flowRadXYcomp</a>[1] = <a class="code" href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">flowRadXY</a>[1] + <a class="code" href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">omegaAcrossFlowTime</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;        <span class="comment">// set flag that will trigger observations</span></div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;        <a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;        <a class="code" href="classNavEKF.html#aefbf03b57265a352e23c75441036f414">flowValidMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        <a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;    }</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;}</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;<span class="comment">// calculate the NED earth spin vector in rad/sec</span></div>
<div class="line"><a name="l04354"></a><span class="lineno"><a class="line" href="classNavEKF.html#a8071e344cd833c0d7e511de9f423ff88"> 4354</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a8071e344cd833c0d7e511de9f423ff88">NavEKF::calcEarthRateNED</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;omega, int32_t latitude)<span class="keyword"> const</span></div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;    <span class="keywordtype">float</span> lat_rad = <a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(latitude*1.0e-7<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;    omega.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>  = <a class="code" href="AP__NavEKF_8cpp.html#a6d50d30e44d32c192e4d932bbb166ba0">earthRate</a>*<a class="code" href="AP__Math__AVR__Compat_8h.html#acc171f0e087ed26abd701c827944a43b">cosf</a>(lat_rad);</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;    omega.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>  = 0;</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;    omega.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>  = -<a class="code" href="AP__NavEKF_8cpp.html#a6d50d30e44d32c192e4d932bbb166ba0">earthRate</a>*<a class="code" href="AP__Math__AVR__Compat_8h.html#a6776b8d1a4149fe35e282a76effd8a9d">sinf</a>(lat_rad);</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;}</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;<span class="comment">// initialise the earth magnetic field states using declination, suppled roll/pitch</span></div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="comment">// and magnetometer measurements and return initial attitude quaternion</span></div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;<span class="comment">// if no magnetometer data, do not update magnetic field states and assume zero yaw angle</span></div>
<div class="line"><a name="l04365"></a><span class="lineno"><a class="line" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e"> 4365</a></span>&#160;<a class="code" href="classQuaternion.html">Quaternion</a> <a class="code" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">NavEKF::calcQuatAndFieldStates</a>(<span class="keywordtype">float</span> roll, <span class="keywordtype">float</span> pitch)</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;{</div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;    <span class="comment">// declare local variables required to calculate initial orientation and magnetic field</span></div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;    <span class="keywordtype">float</span> yaw;</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;    <a class="code" href="classMatrix3.html">Matrix3f</a> Tbn;</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> initMagNED;</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;    <a class="code" href="classQuaternion.html">Quaternion</a> initQuat;</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>()) {</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;        <span class="comment">// calculate rotation matrix from body to NED frame</span></div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;        Tbn.<a class="code" href="classMatrix3.html#a62587bd216436f09f06b9e1330f84bc0">from_euler</a>(roll, pitch, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        <span class="comment">// read the magnetometer data</span></div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;        <a class="code" href="classNavEKF.html#adf06c6a73b9ca994ca16892ed0740283">readMagData</a>();</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;        <span class="comment">// rotate the magnetic field into NED axes</span></div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;        initMagNED = Tbn * <a class="code" href="classNavEKF.html#aee2794d28212ecbeb58ba7fa5fedb543">magData</a>;</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;        <span class="comment">// calculate heading of mag field rel to body heading</span></div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;        <span class="keywordtype">float</span> magHeading = <a class="code" href="AP__Math__AVR__Compat_8h.html#ae31ff8b5990823ebb5d9746cc0843293">atan2f</a>(initMagNED.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, initMagNED.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>);</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;        <span class="comment">// get the magnetic declination</span></div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;        <span class="keywordtype">float</span> magDecAng = <a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>() ? <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a5051de1d15ee203600422235ab93c88c">get_declination</a>() : 0;</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;        <span class="comment">// calculate yaw angle rel to true north</span></div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;        yaw = magDecAng - magHeading;</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;        <a class="code" href="classNavEKF.html#ac999f7aa652d88fb7a6b41011fb33ca4">yawAligned</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;        <span class="comment">// calculate initial filter quaternion states using yaw from magnetometer if mag heading healthy</span></div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;        <span class="comment">// otherwise use existing heading</span></div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aae4b7b974327d3a54daf9bf78e667a52">badMag</a>) {</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;            initQuat.<a class="code" href="classQuaternion.html#aff2d2d3d1c5937523df8357deae4eeab">from_euler</a>(roll, pitch, yaw);</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;            initQuat = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>;</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;        }</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;        <span class="comment">// calculate initial Tbn matrix and rotate Mag measurements into NED</span></div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;        <span class="comment">// to set initial NED magnetic field states</span></div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        initQuat.<a class="code" href="classQuaternion.html#afb7132c9c69a984a40be950a17effeaa">rotation_matrix</a>(Tbn);</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a> = Tbn * <a class="code" href="classNavEKF.html#aee2794d28212ecbeb58ba7fa5fedb543">magData</a>;</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;        <span class="comment">// align the NE earth magnetic field states with the published declination</span></div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;        <a class="code" href="classNavEKF.html#a22aad7c0baf696cae27135ecaa4f2f58">alignMagStateDeclination</a>();</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;        <span class="comment">// clear bad magnetometer status</span></div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;        <a class="code" href="classNavEKF.html#aae4b7b974327d3a54daf9bf78e667a52">badMag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;        initQuat.<a class="code" href="classQuaternion.html#aff2d2d3d1c5937523df8357deae4eeab">from_euler</a>(roll, pitch, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;        <a class="code" href="classNavEKF.html#ac999f7aa652d88fb7a6b41011fb33ca4">yawAligned</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;    }</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;</div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;    <span class="comment">// return attitude quaternion</span></div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;    <span class="keywordflow">return</span> initQuat;</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;}</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;</div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;<span class="comment">// this function is used to do a forced alignment of the yaw angle to align with the horizontal velocity</span></div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;<span class="comment">// vector from GPS. It is used to align the yaw angle after launch or takeoff.</span></div>
<div class="line"><a name="l04421"></a><span class="lineno"><a class="line" href="classNavEKF.html#a24a9b1e9c8504aa4821f2459c7ae6117"> 4421</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a24a9b1e9c8504aa4821f2459c7ae6117">NavEKF::alignYawGPS</a>()</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;{</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>[0]) + <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>[1])) &gt; 25.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;        <span class="keywordtype">float</span> roll;</div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;        <span class="keywordtype">float</span> pitch;</div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;        <span class="keywordtype">float</span> oldYaw;</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;        <span class="keywordtype">float</span> newYaw;</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;        <span class="keywordtype">float</span> yawErr;</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;        <span class="comment">// get quaternion from existing filter states and calculate roll, pitch and yaw angles</span></div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#ab3049efa36b211699ca03ea53970f0fd">to_euler</a>(roll, pitch, oldYaw);</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;        <span class="comment">// calculate course yaw angle</span></div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;        oldYaw = <a class="code" href="AP__Math__AVR__Compat_8h.html#ae31ff8b5990823ebb5d9746cc0843293">atan2f</a>(<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>,<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>);</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;        <span class="comment">// calculate yaw angle from GPS velocity</span></div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;        newYaw = <a class="code" href="AP__Math__AVR__Compat_8h.html#ae31ff8b5990823ebb5d9746cc0843293">atan2f</a>(<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>[1],<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>[0]);</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;        <span class="comment">// estimate the yaw error</span></div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;        yawErr = <a class="code" href="AP__Math_8h.html#ada62278a4b460237f914e1c6a5355e55">wrap_PI</a>(newYaw - oldYaw);</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;        <span class="comment">// If the inertial course angle disagrees with the GPS by more than 45 degrees, we declare the compass as bad</span></div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        <a class="code" href="classNavEKF.html#aae4b7b974327d3a54daf9bf78e667a52">badMag</a> = (<a class="code" href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(yawErr) &gt; 0.7854f);</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;        <span class="comment">// correct yaw angle using GPS ground course compass failed or if not previously aligned</span></div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aae4b7b974327d3a54daf9bf78e667a52">badMag</a> || !<a class="code" href="classNavEKF.html#ac999f7aa652d88fb7a6b41011fb33ca4">yawAligned</a>) {</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;            <span class="comment">// correct the yaw angle</span></div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;            newYaw = oldYaw + yawErr;</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;            <span class="comment">// calculate new filter quaternion states from Euler angles</span></div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;            <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#aff2d2d3d1c5937523df8357deae4eeab">from_euler</a>(roll, pitch, newYaw);</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;            <span class="comment">// the yaw angle is now aligned so update its status</span></div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;            <a class="code" href="classNavEKF.html#ac999f7aa652d88fb7a6b41011fb33ca4">yawAligned</a> =  <span class="keyword">true</span>;</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;            <span class="comment">// reset the position and velocity states</span></div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;            <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;            <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;            <span class="comment">// reset the covariance for the quaternion, velocity and position states</span></div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;            <span class="comment">// zero the matrix entries</span></div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;            <a class="code" href="classNavEKF.html#aaef60d20b82acb3930c5866abe3977b4">zeroRows</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>,0,9);</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;            <a class="code" href="classNavEKF.html#a755c7075fb0ee5f86cef734ecf83e53a">zeroCols</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>,0,9);</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;            <span class="comment">// quaternions - TODO maths that sets them based on different roll, yaw and pitch uncertainties</span></div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0]   = 1.0e-9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[1][1]   = 0.25f*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[2][2]   = 0.25f*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[3][3]   = 0.25f*<a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(<a class="code" href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a>(1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>));</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;            <span class="comment">// velocities - we could have a big error coming out of constant position mode due to GPS lag</span></div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4]   = 400.0f;</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[5][5]   = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[4][4];</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[6][6]   = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(0.7<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;            <span class="comment">// positions - we could have a big error coming out of constant position mode due to GPS lag</span></div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][7]   = 400.0f;</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[8][8]   = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[7][7];</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;            <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[9][9]   = <a class="code" href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a>(5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;        }</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;        <span class="comment">// Update magnetic field states if the magnetometer is bad</span></div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aae4b7b974327d3a54daf9bf78e667a52">badMag</a>) {</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;            <a class="code" href="classVector3.html">Vector3f</a> eulerAngles;</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;            <a class="code" href="classNavEKF.html#af00a144845ea0078be28516c5d584c78">getEulerAngles</a>(eulerAngles);</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;            <a class="code" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">calcQuatAndFieldStates</a>(eulerAngles.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, eulerAngles.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;        }</div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;    }</div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;}</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;<span class="comment">// This function is used to do a forced alignment of the wind velocity</span></div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;<span class="comment">// states so that they are set to the reciprocal of the ground speed</span></div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;<span class="comment">// and scaled to STARTUP_WIND_SPEED m/s. This is used when launching a</span></div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;<span class="comment">// fly-forward vehicle without an airspeed sensor on the assumption</span></div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;<span class="comment">// that launch will be into wind and STARTUP_WIND_SPEED is</span></div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;<span class="comment">// representative of typical launch wind</span></div>
<div class="line"><a name="l04483"></a><span class="lineno"><a class="line" href="classNavEKF.html#a6d64ec17dcec8b8c486857bd4fb3b54c"> 4483</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a6d64ec17dcec8b8c486857bd4fb3b54c">NavEKF::setWindVelStates</a>()</div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;{</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;    <span class="keywordtype">float</span> gndSpd = <a class="code" href="AP__Math_8cpp.html#afd3767d48a7b20f6d5220a4f8007af00">pythagorous2</a>(<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;    <span class="keywordflow">if</span> (gndSpd &gt; 4.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;        <span class="comment">// set the wind states to be the reciprocal of the velocity and scale</span></div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;        <span class="keywordtype">float</span> scaleFactor = <a class="code" href="AP__NavEKF_8cpp.html#a94492e11259113c24733219b832878b6">STARTUP_WIND_SPEED</a> / gndSpd;</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> * scaleFactor;</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">wind_vel</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> * scaleFactor;</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;        <span class="comment">// reinitialise the wind state covariances</span></div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;        <a class="code" href="classNavEKF.html#aaef60d20b82acb3930c5866abe3977b4">zeroRows</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>,14,15);</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;        <a class="code" href="classNavEKF.html#a755c7075fb0ee5f86cef734ecf83e53a">zeroCols</a>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>,14,15);</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14] = 64.0f;</div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;        <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[15][15] = <a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[14][14];</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;    }</div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;}</div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;<span class="comment">// return the transformation matrix from XYZ (body) to NED axes</span></div>
<div class="line"><a name="l04500"></a><span class="lineno"><a class="line" href="classNavEKF.html#a6a04a684cec578f919586066d0784103"> 4500</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a6a04a684cec578f919586066d0784103">NavEKF::getRotationBodyToNED</a>(<a class="code" href="classMatrix3.html">Matrix3f</a> &amp;mat)<span class="keyword"> const</span></div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> trim = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a93a3774320e331583fc6c6ac2418be21">get_trim</a>();</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#afb7132c9c69a984a40be950a17effeaa">rotation_matrix</a>(mat);</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;    mat.<a class="code" href="classMatrix3.html#af6fb286af49f43844ba70cbb80ab2db7">rotateXYinv</a>(trim);</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;}</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;<span class="comment">// return the innovations for the NED Pos, NED Vel, XYZ Mag and Vtas measurements</span></div>
<div class="line"><a name="l04508"></a><span class="lineno"><a class="line" href="classNavEKF.html#ab383bfe9058c3edeba7787c8b55f681f"> 4508</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="classNavEKF.html#ab383bfe9058c3edeba7787c8b55f681f">NavEKF::getInnovations</a>(<a class="code" href="classVector3.html">Vector3f</a> &amp;velInnov, <a class="code" href="classVector3.html">Vector3f</a> &amp;posInnov, <a class="code" href="classVector3.html">Vector3f</a> &amp;magInnov, <span class="keywordtype">float</span> &amp;tasInnov)<span class="keyword"> const</span></div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;    velInnov.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[0];</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;    velInnov.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[1];</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;    velInnov.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[2];</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;    posInnov.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[3];</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;    posInnov.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[4];</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;    posInnov.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">innovVelPos</a>[5];</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;    magInnov.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = 1e3f*<a class="code" href="classNavEKF.html#a4b96227e0553b69fa0882d3adc0a2877">innovMag</a>[0]; <span class="comment">// Convert back to sensor units</span></div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;    magInnov.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = 1e3f*innovMag[1]; <span class="comment">// Convert back to sensor units</span></div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;    magInnov.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = 1e3f*innovMag[2]; <span class="comment">// Convert back to sensor units</span></div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;    tasInnov   = <a class="code" href="classNavEKF.html#ad04500d06937a8f13de6c4ee497cdb84">innovVtas</a>;</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;}</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;<span class="comment">// return the innovation consistency test ratios for the velocity, position, magnetometer and true airspeed measurements</span></div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;<span class="comment">// this indicates the amount of margin available when tuning the various error traps</span></div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;<span class="comment">// also return the current offsets applied to the GPS position measurements</span></div>
<div class="line"><a name="l04525"></a><span class="lineno"><a class="line" href="classNavEKF.html#ac786ebf1b73275ba6ea744c0648b1d76"> 4525</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="classNavEKF.html#ac786ebf1b73275ba6ea744c0648b1d76">NavEKF::getVariances</a>(<span class="keywordtype">float</span> &amp;velVar, <span class="keywordtype">float</span> &amp;posVar, <span class="keywordtype">float</span> &amp;hgtVar, <a class="code" href="classVector3.html">Vector3f</a> &amp;magVar, <span class="keywordtype">float</span> &amp;tasVar, <a class="code" href="structVector2.html">Vector2f</a> &amp;offset)<span class="keyword"> const</span></div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;    velVar   = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#a96245bb1cbb49e89c52e282b38d00c7a">velTestRatio</a>);</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;    posVar   = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">posTestRatio</a>);</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;    hgtVar   = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#a96c31aaedf02ab8cc9f33c7da1d85fd8">hgtTestRatio</a>);</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;    magVar.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>);</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;    magVar.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;    magVar.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;    tasVar   = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a>(<a class="code" href="classNavEKF.html#a2f5fa2977d33ddd0c5f8d350c049cd2c">tasTestRatio</a>);</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;    offset   = <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>;</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;}</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;<span class="comment">// Use a function call rather than a constructor to initialise variables because it enables the filter to be re-started in flight if necessary.</span></div>
<div class="line"><a name="l04538"></a><span class="lineno"><a class="line" href="classNavEKF.html#a619b70e1205a58b444e22a8d5b51f16d"> 4538</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a619b70e1205a58b444e22a8d5b51f16d">NavEKF::InitialiseVariables</a>()</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;{</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;    <span class="comment">// initialise time stamps</span></div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;    <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> = hal.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#a26b68339fc68a562d8d3a1238d0ec8c1">millis</a>();</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;    <a class="code" href="classNavEKF.html#a0704abcdd99ba0ab2a8254fba20c843c">lastHealthyMagTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;    <a class="code" href="classNavEKF.html#a00cd23012b3330cc889f02352d3e47d2">TASmsecPrev</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;    <a class="code" href="classNavEKF.html#aeed006203acc8a02856514f330b17ed7">BETAmsecPrev</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;    <a class="code" href="classNavEKF.html#a31faab99ce8bbe09b011f75bfa615c56">lastMagUpdate</a> = 0;</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;    <a class="code" href="classNavEKF.html#aebca5af77c541497460468f5f6b4cfcb">lastHgtMeasTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;    <a class="code" href="classNavEKF.html#a0779a1ae19736ff610bc33032eecefc1">lastAirspeedUpdate</a> = 0;</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;    <a class="code" href="classNavEKF.html#a532d96729dba3c794df2de8c36890fba">lastVelPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    <a class="code" href="classNavEKF.html#a8c72f168838db6b818956a87fa640f0e">lastPosPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;    <a class="code" href="classNavEKF.html#a9f5a7e05866a566fd9243727906f636f">lastPosFailTime</a> = 0;</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;    <a class="code" href="classNavEKF.html#a269fafed960b894f2f170bdb66e367dd">lastHgtPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;    <a class="code" href="classNavEKF.html#a2ba17c3452c9ce37f919bfa58f8ddd38">lastTasPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;    <a class="code" href="classNavEKF.html#a640b3c5ebf5371325d670668a6c2557e">lastStateStoreTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;    <a class="code" href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">lastFixTime_ms</a> = 0;</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;    <a class="code" href="classNavEKF.html#a8ac5727059185f254f5c95ea8ba658b1">secondLastFixTime_ms</a> = 0;</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;    <a class="code" href="classNavEKF.html#a601c708d728c71bd84de7bc0d0ea5a8a">lastDecayTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;    <a class="code" href="classNavEKF.html#a2d27879e22f14746869d7152f57e5667">timeAtLastAuxEKF_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;    <a class="code" href="classNavEKF.html#aefbf03b57265a352e23c75441036f414">flowValidMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;    <a class="code" href="classNavEKF.html#a0eb21c6bcabd51abbf2279f17e434d67">rngValidMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;    <a class="code" href="classNavEKF.html#a9edebf0f3984be8ac3a94070e5ccccbc">flowMeaTime_ms</a> = 0;</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;    <a class="code" href="classNavEKF.html#a1fff68de02d811e590b09385a9427e58">prevFlowFuseTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;    <a class="code" href="classNavEKF.html#ae04d7990ade9e35561c1cb3759267196">gndHgtValidTime_ms</a> = 0;</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;    <a class="code" href="classNavEKF.html#a85bde5695be6bf1fcfec41fc13ccddcd">ekfStartTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;    <a class="code" href="classNavEKF.html#ab58ac524e9097d91b12fe85c1c64e304">lastGpsVelFail_ms</a> = 0;</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    <a class="code" href="classNavEKF.html#a0463575b0fd4ac7b5fa4cf9db23e6418">lastGpsAidBadTime_ms</a> = 0;</div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    <span class="comment">// initialise other variables</span></div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    <a class="code" href="classNavEKF.html#a33123d9b5a1a7551b2c0a7c1addea560">gpsNoiseScaler</a> = 1.0f;</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;    <a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;    <a class="code" href="classNavEKF.html#a8072f31f08434518f5a27ad06ce6d2b5">magTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;    <a class="code" href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">tasTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;    <a class="code" href="classNavEKF.html#aae4b7b974327d3a54daf9bf78e667a52">badMag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;    <a class="code" href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">badIMUdata</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;    <a class="code" href="classNavEKF.html#ab0e1d269feaa76d5474e212ce1e003e6">firstArmComplete</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;    <a class="code" href="classNavEKF.html#a61fd7d0a8e6789e650fe3c4239806f4d">firstMagYawInit</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;    <a class="code" href="classNavEKF.html#a1056d50a16aea29e1fab99e3d4a1c61c">secondMagYawInit</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;    <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> = 0;</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;    <a class="code" href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">dtIMUavg</a> = 0.0025f;</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;    <a class="code" href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">dtIMUactual</a> = 0.0025f;</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;    <a class="code" href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">dt</a> = 0;</div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;    <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a> = 0;</div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;    <a class="code" href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">storeIndex</a> = 0;</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;    <a class="code" href="classNavEKF.html#ac3ca17ee02d5d5aac81457b86d77f2af">lastGyroBias</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;    <a class="code" href="classNavEKF.html#a413d74ab571dfb46bc0a90c5b293d364">lastAngRate</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;    <a class="code" href="classNavEKF.html#aeb78f45ab039841cda67736a597c2c5f">lastAccel1</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;    <a class="code" href="classNavEKF.html#a9811c1b11e7fced4f5b53c0052854099">lastAccel2</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;    <a class="code" href="classNavEKF.html#ae9a923b1ced7c82894cbd0c2caebadee">velDotNEDfilt</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;    <a class="code" href="classNavEKF.html#a133e1311f462787207a078398dd85e63">summedDelAng</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;    <a class="code" href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">summedDelVel</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;    <a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;    <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;    <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;    <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;    <a class="code" href="classNavEKF.html#aef1c557739419cc240386b4f3c8e7983">prevTnb</a>.<a class="code" href="classMatrix3.html#a90cfd0bec53253429603b5600dcdce81">zero</a>();</div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>[0][0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">P</a>));</div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">nextP</a>[0][0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">nextP</a>));</div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">processNoise</a>));</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">storedStates</a>));</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">statetimeStamp</a>));</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a878cd2073d88522b03e3f6a972bacf3c">gpsIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a878cd2073d88522b03e3f6a972bacf3c">gpsIncrStateDelta</a>));</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a1849d7cc900d9c76dfcfee92e9ede03d">hgtIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a1849d7cc900d9c76dfcfee92e9ede03d">hgtIncrStateDelta</a>));</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a5ea1ecbce4372b7cb77fd19e6142a1aa">magIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a5ea1ecbce4372b7cb77fd19e6142a1aa">magIncrStateDelta</a>));</div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a703d77a71d6bd0be67dcfb9ad1d1eb97">flowIncrStateDelta</a>[0], 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a703d77a71d6bd0be67dcfb9ad1d1eb97">flowIncrStateDelta</a>));</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;    <a class="code" href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">newDataFlow</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;    <a class="code" href="classNavEKF.html#ac8ac5c5066acbea171a692e2b03735e6">flowDataValid</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;    <a class="code" href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">newDataRng</a>  = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;    <a class="code" href="classNavEKF.html#a7d468bceeabf5169403c4b1b146bec63">flowFusePerformed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;    <a class="code" href="classNavEKF.html#af87a2a59a63349321588523f47027747">fuseOptFlowData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    <a class="code" href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">Popt</a> = 0.0f;</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;    <a class="code" href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">terrainState</a> = 0.0f;</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;    <a class="code" href="classNavEKF.html#a736a3224673c62453aaf9a9035d1470a">prevPosN</a> = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;    <a class="code" href="classNavEKF.html#a67e6b67640dd6b3b44b35b6406c47c6e">prevPosE</a> = <a class="code" href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">gpsPosNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    <a class="code" href="classNavEKF.html#a0f328969ff5f2ed7349d760661a65a62">fuseRngData</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;    <a class="code" href="classNavEKF.html#a68aa4d3ae31fc58ca9cdc21cdd4e2799">inhibitGndState</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;    <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = 0;</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    <a class="code" href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">flowGyroBias</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = 0;</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;    <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    <a class="code" href="classNavEKF.html#ae348168676a32e441570ef3dd46153be">lastConstVelMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    <a class="code" href="classNavEKF.html#a42c664df5b7a9fb51d590fc3d7791c5d">heldVelNE</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>;</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    <a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <a class="code" href="classNavEKF.html#a0c379d143436bd0618a89a7935c58400">prevVehicleArmed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    memset(&amp;<a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>));</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;    <a class="code" href="classNavEKF.html#ac9273a0000085f43cceee01c72dcc2cf">hgtRate</a> = 0.0f;</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.q0 = 1;</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;    <a class="code" href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">mag_state</a>.DCM.identity();</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    <a class="code" href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">IMU1_weighting</a> = 0.5f;</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;    <a class="code" href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">onGround</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;    <a class="code" href="classNavEKF.html#a28bfd83f329595dc26ba1dce262c4c19">manoeuvring</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    <a class="code" href="classNavEKF.html#ac999f7aa652d88fb7a6b41011fb33ca4">yawAligned</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;    <a class="code" href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">inhibitWindStates</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;    <a class="code" href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">inhibitMagStates</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;    <a class="code" href="classNavEKF.html#aedabdd90e9cfdf598424e88700d94c7f">gndOffsetValid</a> =  <span class="keyword">false</span>;</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;    <a class="code" href="classNavEKF.html#a0b9da623e9e7cf3d051442c3ecb97b81">flowXfailed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;    <a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;    <a class="code" href="classNavEKF.html#a4b50771bf4522b595267af095ba8333a">takeoffExpectedSet_ms</a> = 0;</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;    <a class="code" href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">expectGndEffectTakeoff</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;    <a class="code" href="classNavEKF.html#af6ed0063fb171f237efceb25dcbe6aec">touchdownExpectedSet_ms</a> = 0;</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    <a class="code" href="classNavEKF.html#a58487ff745a90aad44ac05d69dd8809f">expectGndEffectTouchdown</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;    <a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a> = 0.0f;</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;    <a class="code" href="classNavEKF.html#a63a00adf98f2e2dd2ddf271201d880c4">baroHgtOffset</a> = 0.0f;</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    <a class="code" href="classNavEKF.html#a7ffc1616eba87ddced506c6bc2c47ba6">gpsAidingBad</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;    <a class="code" href="classNavEKF.html#a7a9f26f4c53700ba4f1afac54e9c6ac5">highYawRate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;    <a class="code" href="classNavEKF.html#a11268c75bd9e5061c56d9d0776634edc">yawRateFilt</a> = 0.0f;</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;}</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;<span class="comment">// return true if we should use the airspeed sensor</span></div>
<div class="line"><a name="l04652"></a><span class="lineno"><a class="line" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75"> 4652</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">NavEKF::useAirspeed</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a8691156c332da099e3f5952e72ae2a58">airspeed_sensor_enabled</a>();</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;}</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;<span class="comment">// return true if we should use the range finder sensor</span></div>
<div class="line"><a name="l04658"></a><span class="lineno"><a class="line" href="classNavEKF.html#a784d6082ed20be29982a2f1203280a1a"> 4658</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a784d6082ed20be29982a2f1203280a1a">NavEKF::useRngFinder</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;    <span class="comment">// TO-DO add code to set this based in setting of optical flow use parameter and presence of sensor</span></div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;}</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;<span class="comment">// return true if optical flow data is available</span></div>
<div class="line"><a name="l04665"></a><span class="lineno"><a class="line" href="classNavEKF.html#a17086cdf3fc411329b12faa25b1713f1"> 4665</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a17086cdf3fc411329b12faa25b1713f1">NavEKF::optFlowDataPresent</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a9edebf0f3984be8ac3a94070e5ccccbc">flowMeaTime_ms</a> &lt; 5000) {</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    }</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;}</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;<span class="comment">// return true if the vehicle is requesting the filter to be ready for flight</span></div>
<div class="line"><a name="l04675"></a><span class="lineno"><a class="line" href="classNavEKF.html#aa98e017d389ce1831db02e36a44d5647"> 4675</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#aa98e017d389ce1831db02e36a44d5647">NavEKF::getVehicleArmStatus</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;    <span class="keywordflow">return</span> hal.<a class="code" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code" href="classAP__HAL_1_1Util.html#a973ee89f8eee7af3a4d2a3eb700cbf3c">get_soft_armed</a>() || <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a45357ce4e0057215a0ade439e63daa79">get_correct_centrifugal</a>();</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;}</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;<span class="comment">// return true if we should use the compass</span></div>
<div class="line"><a name="l04681"></a><span class="lineno"><a class="line" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10"> 4681</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">NavEKF::use_compass</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a97437729a583cd900e4dd1d6d84a4a0e">use_for_yaw</a>();</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;}</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;<span class="comment">// decay GPS horizontal position offset to close to zero at a rate of 1 m/s for copters and 5 m/s for planes</span></div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;<span class="comment">// limit radius to a maximum of 50m</span></div>
<div class="line"><a name="l04688"></a><span class="lineno"><a class="line" href="classNavEKF.html#a55a6ae919135e4deef0cffe2eca3ac80"> 4688</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a55a6ae919135e4deef0cffe2eca3ac80">NavEKF::decayGpsOffset</a>()</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;{</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;    <span class="keywordtype">float</span> offsetDecaySpd;</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>()) {</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;        offsetDecaySpd = 5.0f;</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;        offsetDecaySpd = 1.0f;</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;    }</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;    <span class="keywordtype">float</span> lapsedTime = 0.001f*float(<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a601c708d728c71bd84de7bc0d0ea5a8a">lastDecayTime_ms</a>);</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;    <a class="code" href="classNavEKF.html#a601c708d728c71bd84de7bc0d0ea5a8a">lastDecayTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;    <span class="keywordtype">float</span> offsetRadius = <a class="code" href="AP__Math_8cpp.html#afd3767d48a7b20f6d5220a4f8007af00">pythagorous2</a>(<a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>, <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>);</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;    <span class="comment">// decay radius if larger than offset decay speed multiplied by lapsed time (plus a margin to prevent divide by zero)</span></div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;    <span class="keywordflow">if</span> (offsetRadius &gt; (offsetDecaySpd * lapsedTime + 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) {</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;        <span class="comment">// Calculate the GPS velocity offset required. This is necessary to prevent the position measurement being rejected for inconsistency when the radius is being pulled back in.</span></div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;        <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a> = -<a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>*offsetDecaySpd/offsetRadius;</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;        <span class="comment">// calculate scale factor to be applied to both offset components</span></div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;        <span class="keywordtype">float</span> scaleFactor = <a class="code" href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a>((offsetRadius - offsetDecaySpd * lapsedTime), 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 50.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) / offsetRadius;</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;        <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> *= scaleFactor;</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;        <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> *= scaleFactor;</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;        <a class="code" href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">gpsVelGlitchOffset</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;        <a class="code" href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">gpsPosGlitchOffsetNE</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;    }</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;}</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;<span class="comment">  should we assume zero sideslip?</span></div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l04716"></a><span class="lineno"><a class="line" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437"> 4716</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">NavEKF::assume_zero_sideslip</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;    <span class="comment">// we don&#39;t assume zero sideslip for ground vehicles as EKF could</span></div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;    <span class="comment">// be quite sensitive to a rapid spin of the ground vehicle if</span></div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;    <span class="comment">// traction is lost</span></div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a6120b45de751ab784fdfdd04f437b44e">get_fly_forward</a>() &amp;&amp; <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a91a73986f61cc338a22047e34230cbb2">get_vehicle_class</a>() != <a class="code" href="AP__AHRS_8h.html#add679f4b895d592dc5f213964dd54d48af82a87d7a11f285e948932c783eb8482">AHRS_VEHICLE_GROUND</a>;</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;}</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;<span class="comment">return the filter fault status as a bitmasked integer</span></div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;<span class="comment"> 0 = quaternions are NaN</span></div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;<span class="comment"> 1 = velocities are NaN</span></div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;<span class="comment"> 2 = badly conditioned X magnetometer fusion</span></div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;<span class="comment"> 3 = badly conditioned Y magnetometer fusion</span></div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;<span class="comment"> 5 = badly conditioned Z magnetometer fusion</span></div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;<span class="comment"> 6 = badly conditioned airspeed fusion</span></div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;<span class="comment"> 7 = badly conditioned synthetic sideslip fusion</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;<span class="comment"> 7 = filter is not initialised</span></div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l04735"></a><span class="lineno"><a class="line" href="classNavEKF.html#ab71619ef68ba5d8b11f68ef4f31a65c2"> 4735</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="classNavEKF.html#ab71619ef68ba5d8b11f68ef4f31a65c2">NavEKF::getFilterFaults</a>(uint8_t &amp;faults)<span class="keyword"> const</span></div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;    faults = (<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#aa3036ce97bb5a7394a2d65edecd8f1ab">is_nan</a>()&lt;&lt;0 |</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;              <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#a076ee3d40e645623b54650cca5ae6df7">is_nan</a>()&lt;&lt;1 |</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;              <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_xmag&lt;&lt;2 |</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;              <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_ymag&lt;&lt;3 |</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;              <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_zmag&lt;&lt;4 |</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;              <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_airspeed&lt;&lt;5 |</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;              <a class="code" href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">faultStatus</a>.bad_sideslip&lt;&lt;6 |</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;              !<a class="code" href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">statesInitialised</a>&lt;&lt;7);</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;}</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;</div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;<span class="comment">return filter timeout status as a bitmasked integer</span></div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;<span class="comment"> 0 = position measurement timeout</span></div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;<span class="comment"> 1 = velocity measurement timeout</span></div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;<span class="comment"> 2 = height measurement timeout</span></div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;<span class="comment"> 3 = magnetometer measurement timeout</span></div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;<span class="comment"> 4 = true airspeed measurement timeout</span></div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;<span class="comment"> 5 = unassigned</span></div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;<span class="comment"> 6 = unassigned</span></div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;<span class="comment"> 7 = unassigned</span></div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l04758"></a><span class="lineno"><a class="line" href="classNavEKF.html#ad2cb550e9590b8bf6d921467d10766af"> 4758</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="classNavEKF.html#ad2cb550e9590b8bf6d921467d10766af">NavEKF::getFilterTimeouts</a>(uint8_t &amp;timeouts)<span class="keyword"> const</span></div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;    timeouts = (<a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a>&lt;&lt;0 |</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;                <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a>&lt;&lt;1 |</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;                <a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a>&lt;&lt;2 |</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;                <a class="code" href="classNavEKF.html#a8072f31f08434518f5a27ad06ce6d2b5">magTimeout</a>&lt;&lt;3 |</div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;                <a class="code" href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">tasTimeout</a>&lt;&lt;4);</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;}</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;</div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;<span class="comment">return filter function status as a bitmasked integer</span></div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;<span class="comment"> 0 = attitude estimate valid</span></div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;<span class="comment"> 1 = horizontal velocity estimate valid</span></div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;<span class="comment"> 2 = vertical velocity estimate valid</span></div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;<span class="comment"> 3 = relative horizontal position estimate valid</span></div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;<span class="comment"> 4 = absolute horizontal position estimate valid</span></div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;<span class="comment"> 5 = vertical position estimate valid</span></div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;<span class="comment"> 6 = terrain height estimate valid</span></div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;<span class="comment"> 7 = constant position mode</span></div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l04778"></a><span class="lineno"><a class="line" href="classNavEKF.html#a84cacea011683356ae5fcd2eb2e30fcc"> 4778</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="classNavEKF.html#a84cacea011683356ae5fcd2eb2e30fcc">NavEKF::getFilterStatus</a>(<a class="code" href="unionnav__filter__status.html">nav_filter_status</a> &amp;status)<span class="keyword"> const</span></div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;    <span class="comment">// init return value</span></div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a80274fe56f3e6edad87ae9fbe3b797ab">value</a> = 0;</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;    <span class="keywordtype">bool</span> doingFlowNav = (<a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20">AID_RELATIVE</a>) &amp;&amp; <a class="code" href="classNavEKF.html#ac8ac5c5066acbea171a692e2b03735e6">flowDataValid</a>;</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;    <span class="keywordtype">bool</span> doingWindRelNav = !<a class="code" href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">tasTimeout</a> &amp;&amp; <a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>();</div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;    <span class="keywordtype">bool</span> doingNormalGpsNav = !<a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> &amp;&amp; (<a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> == <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>);</div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;    <span class="keywordtype">bool</span> notDeadReckoning = !<a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a>;</div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;    <span class="keywordtype">bool</span> someVertRefData = (!<a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> &amp;&amp; (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 0)) || !<a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a>;</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;    <span class="keywordtype">bool</span> someHorizRefData = !(<a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> &amp;&amp; <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> &amp;&amp; <a class="code" href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">tasTimeout</a>) || doingFlowNav;</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;    <span class="keywordtype">bool</span> optFlowNavPossible = <a class="code" href="classNavEKF.html#ac8ac5c5066acbea171a692e2b03735e6">flowDataValid</a> &amp;&amp; (_fusionModeGPS == 3);</div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;    <span class="keywordtype">bool</span> gpsNavPossible = !<a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a> &amp;&amp; (_fusionModeGPS &lt;= 2);</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;    <span class="keywordtype">bool</span> filterHealthy = <a class="code" href="classNavEKF.html#ad418b75ceae3dde42f8c588b7e88abb4">healthy</a>();</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;    <span class="comment">// set individual flags</span></div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#ab78ba643299306ea1e89ed080bc5fa07">attitude</a> = !<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>.<a class="code" href="classQuaternion.html#aa3036ce97bb5a7394a2d65edecd8f1ab">is_nan</a>() &amp;&amp; filterHealthy;   <span class="comment">// attitude valid (we need a better check)</span></div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a3d2e277ecebb6384d9d988af57cab57c">horiz_vel</a> = someHorizRefData &amp;&amp; notDeadReckoning &amp;&amp; filterHealthy;      <span class="comment">// horizontal velocity estimate valid</span></div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a2fdcb4700d008878e906cf0c775f514d">vert_vel</a> = someVertRefData &amp;&amp; filterHealthy;        <span class="comment">// vertical velocity estimate valid</span></div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#aeb523909236437827ddecee5cdfbe0ff">horiz_pos_rel</a> = ((doingFlowNav &amp;&amp; <a class="code" href="classNavEKF.html#aedabdd90e9cfdf598424e88700d94c7f">gndOffsetValid</a>) || doingWindRelNav || doingNormalGpsNav) &amp;&amp; notDeadReckoning &amp;&amp; filterHealthy;   <span class="comment">// relative horizontal position estimate valid</span></div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a4a085e3ddf0ce92ba727e3ba78650c34">horiz_pos_abs</a> = !<a class="code" href="classNavEKF.html#a7ffc1616eba87ddced506c6bc2c47ba6">gpsAidingBad</a> &amp;&amp; doingNormalGpsNav &amp;&amp; notDeadReckoning &amp;&amp; filterHealthy; <span class="comment">// absolute horizontal position estimate valid</span></div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a21e8c3dabeb62fc401615127b1f3dd18">vert_pos</a> = !<a class="code" href="classNavEKF.html#a889fc596b783daa58c668abac1975345">hgtTimeout</a> &amp;&amp; filterHealthy;            <span class="comment">// vertical position estimate valid</span></div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a7556f9c9944ef00ccff5b0ba95a629ca">terrain_alt</a> = <a class="code" href="classNavEKF.html#aedabdd90e9cfdf598424e88700d94c7f">gndOffsetValid</a> &amp;&amp; filterHealthy;     <span class="comment">// terrain height estimate valid</span></div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a89a70e81b9a7012025c7e5e490fc35a4">const_pos_mode</a> = <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> &amp;&amp; filterHealthy;     <span class="comment">// constant position mode</span></div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#afb587191e891ab4cbc95821ac3395d5e">pred_horiz_pos_rel</a> = (optFlowNavPossible || gpsNavPossible) &amp;&amp; filterHealthy; <span class="comment">// we should be able to estimate a relative position when we enter flight mode</span></div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#ae8997c3724e9a13ff589d5b931891586">pred_horiz_pos_abs</a> = gpsNavPossible &amp;&amp; filterHealthy; <span class="comment">// we should be able to estimate an absolute position when we enter flight mode</span></div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a0672949c16970f513dc0734f1a5ee4ed">takeoff_detected</a> = <a class="code" href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">takeOffDetected</a>; <span class="comment">// takeoff for optical flow navigation has been detected</span></div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a824196d024c4f10183ff02a5ac9a27f5">takeoff</a> = <a class="code" href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">expectGndEffectTakeoff</a>; <span class="comment">// The EKF has been told to expect takeoff and is in a ground effect mitigation mode</span></div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#aefcffe537765de6fd7557c110d88ab94">touchdown</a> = <a class="code" href="classNavEKF.html#a58487ff745a90aad44ac05d69dd8809f">expectGndEffectTouchdown</a>; <span class="comment">// The EKF has been told to detect touchdown and is in a ground effect mitigation mode</span></div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;    status.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#ac556cb93868743fd8c922c01c1952ab3">using_gps</a> = (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a8c72f168838db6b818956a87fa640f0e">lastPosPassTime</a>) &lt; 4000;</div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;}</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;<span class="comment">// send an EKF_STATUS message to GCS</span></div>
<div class="line"><a name="l04811"></a><span class="lineno"><a class="line" href="classNavEKF.html#aa397dc742e68d43d9b10bc1e036d4674"> 4811</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#aa397dc742e68d43d9b10bc1e036d4674">NavEKF::send_status_report</a>(<a class="code" href="v0_89_2mavlink__types_8h.html#aa0f38d2f21462ce9ff37bfb2fb43709c">mavlink_channel_t</a> chan)</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;{</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;    <span class="comment">// get filter status</span></div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;    <a class="code" href="unionnav__filter__status.html">nav_filter_status</a> filt_state;</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;    <a class="code" href="classNavEKF.html#a84cacea011683356ae5fcd2eb2e30fcc">getFilterStatus</a>(filt_state);</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;    <span class="comment">// prepare flags</span></div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;    uint16_t <a class="code" href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">flags</a> = 0;</div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#ab78ba643299306ea1e89ed080bc5fa07">attitude</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa6c49a156c90fb77ea446da33bd95432a">EKF_ATTITUDE</a>; }</div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a3d2e277ecebb6384d9d988af57cab57c">horiz_vel</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfac1022faba58ff86b20a9efb07dae5eca">EKF_VELOCITY_HORIZ</a>; }</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a2fdcb4700d008878e906cf0c775f514d">vert_vel</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa5b60279426fddb859cc1adcf46dcb957">EKF_VELOCITY_VERT</a>; }</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#aeb523909236437827ddecee5cdfbe0ff">horiz_pos_rel</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfae7564d93b60edc369106a4030f9ea964">EKF_POS_HORIZ_REL</a>; }</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a4a085e3ddf0ce92ba727e3ba78650c34">horiz_pos_abs</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa1349810940e959ebefef1429ed8e8ce6">EKF_POS_HORIZ_ABS</a>; }</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a21e8c3dabeb62fc401615127b1f3dd18">vert_pos</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfaf7c1d2e5b450a672f6c4f7123f6af34c">EKF_POS_VERT_ABS</a>; }</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a7556f9c9944ef00ccff5b0ba95a629ca">terrain_alt</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa24046586de895f91705fdd782b62fab3">EKF_POS_VERT_AGL</a>; }</div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#a89a70e81b9a7012025c7e5e490fc35a4">const_pos_mode</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa381f4e22f4fe13803505004cc018e122">EKF_CONST_POS_MODE</a>; }</div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#afb587191e891ab4cbc95821ac3395d5e">pred_horiz_pos_rel</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfaa5e61a9c5f99875adc14ce76e386a1db">EKF_PRED_POS_HORIZ_REL</a>; }</div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;    <span class="keywordflow">if</span> (filt_state.<a class="code" href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">flags</a>.<a class="code" href="unionnav__filter__status.html#ae8997c3724e9a13ff589d5b931891586">pred_horiz_pos_abs</a>) { flags |= <a class="code" href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfab11a54da20f04e9a45f7196da5dd601f">EKF_PRED_POS_HORIZ_ABS</a>; }</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;    <span class="comment">// get variances</span></div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;    <span class="keywordtype">float</span> velVar, posVar, hgtVar, tasVar;</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> magVar;</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;    <a class="code" href="structVector2.html">Vector2f</a> offset;</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <a class="code" href="classNavEKF.html#ac786ebf1b73275ba6ea744c0648b1d76">getVariances</a>(velVar, posVar, hgtVar, magVar, tasVar, offset);</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    <span class="comment">// send message</span></div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    mavlink_msg_ekf_status_report_send(chan, flags, velVar, posVar, hgtVar, magVar.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>(), tasVar);</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;</div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;}</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;<span class="comment">// Check arm status and perform required checks and mode changes</span></div>
<div class="line"><a name="l04842"></a><span class="lineno"><a class="line" href="classNavEKF.html#a9eb8c77b7f824e2ebbf378f1d269290b"> 4842</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a9eb8c77b7f824e2ebbf378f1d269290b">NavEKF::performArmingChecks</a>()</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;{</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;    <span class="comment">// determine vehicle arm status and don&#39;t allow filter to arm until it has been running for long enough to stabilise</span></div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;    <a class="code" href="classNavEKF.html#a0c379d143436bd0618a89a7935c58400">prevVehicleArmed</a> = <a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>;</div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;    <a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> = (<a class="code" href="classNavEKF.html#aa98e017d389ce1831db02e36a44d5647">getVehicleArmStatus</a>() &amp;&amp; (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a85bde5695be6bf1fcfec41fc13ccddcd">ekfStartTime_ms</a>) &gt; 1000);</div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;    <span class="comment">// check to see if arm status has changed and reset states if it has</span></div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> != <a class="code" href="classNavEKF.html#a0c379d143436bd0618a89a7935c58400">prevVehicleArmed</a>) {</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;        <span class="comment">// only reset the magnetic field and heading on the first arm. This prevents in-flight learning being forgotten for vehicles that do multiple short flights and disarm in-between.</span></div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; !<a class="code" href="classNavEKF.html#ab0e1d269feaa76d5474e212ce1e003e6">firstArmComplete</a>) {</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;            <a class="code" href="classNavEKF.html#ab0e1d269feaa76d5474e212ce1e003e6">firstArmComplete</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;            <a class="code" href="classVector3.html">Vector3f</a> eulerAngles;</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;            <a class="code" href="classNavEKF.html#af00a144845ea0078be28516c5d584c78">getEulerAngles</a>(eulerAngles);</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;            <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a> = <a class="code" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">calcQuatAndFieldStates</a>(eulerAngles.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, eulerAngles.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;        }</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;        <span class="comment">// store vertical position at arming to use as a reference for ground relative cehcks</span></div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;            <a class="code" href="classNavEKF.html#a004ab08b00cefe4e09a910bb7eef2a3b">posDownAtArming</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;        }</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;        <span class="comment">// zero stored velocities used to do dead-reckoning</span></div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;        <a class="code" href="classNavEKF.html#a42c664df5b7a9fb51d590fc3d7791c5d">heldVelNE</a>.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;        <span class="comment">// reset the flag that indicates takeoff for use by optical flow navigation</span></div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;        <a class="code" href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">takeOffDetected</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;        <span class="comment">// set various  useage modes based on the condition at arming. These are then held until the vehicle is disarmed.</span></div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;            <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>; <span class="comment">// When dis-armed, we only estimate orientation &amp; height using the constant position mode</span></div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;            <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;            <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;            <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;            <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>; <span class="comment">// always clear constant velocity mode if constant position mode is active</span></div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;            <a class="code" href="classNavEKF.html#ae348168676a32e441570ef3dd46153be">lastConstVelMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;            <span class="comment">// store the current position to be used to keep reporting the last known position when disarmed</span></div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;            <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;            <a class="code" href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">lastKnownPositionNE</a>.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;            <span class="comment">// initialise filtered altitude used to provide a takeoff reference to current baro on disarm</span></div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;            <span class="comment">// this reduces the time required for the filter to settle before the estimate can be used</span></div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;            <a class="code" href="classNavEKF.html#aec95d8fd1ddeb0c6eff1b185ff00b94d">meaHgtAtTakeOff</a> = <a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>;</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;            <span class="comment">// reset the vertical position state to faster recover from baro errors experienced during touchdown</span></div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;            <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = -<a class="code" href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">hgtMea</a>;</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 3) { <span class="comment">// arming when GPS useage has been prohibited</span></div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a17086cdf3fc411329b12faa25b1713f1">optFlowDataPresent</a>()) {</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;                <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20">AID_RELATIVE</a>; <span class="comment">// we have optical flow data and can estimate all vehicle states</span></div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;                <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;                <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;                <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;                <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;                <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>; <span class="comment">// we don&#39;t have optical flow data and will only be able to estimate orientation and height</span></div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;                <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;                <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;                <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;                <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>; <span class="comment">// always clear constant velocity mode if constant position mode is active</span></div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;            }</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;            <span class="comment">// Reset the last valid flow measurement time</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;            <a class="code" href="classNavEKF.html#aefbf03b57265a352e23c75441036f414">flowValidMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;            <span class="comment">// Reset the last valid flow fusion time</span></div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;            <a class="code" href="classNavEKF.html#a1fff68de02d811e590b09385a9427e58">prevFlowFuseTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;            <span class="comment">// this avoids issues casued by the time delay associated with arming that can trigger short timeouts</span></div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;            <a class="code" href="classNavEKF.html#a0eb21c6bcabd51abbf2279f17e434d67">rngValidMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;            <span class="comment">// store the range finder measurement which will be used as a reference to detect when we have taken off</span></div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;            <a class="code" href="classNavEKF.html#a65d15fe2ebf0c1e1c47375e575ccd36e">rangeAtArming</a> = <a class="code" href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">rngMea</a>;</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;            <span class="comment">// set the time at which we arm to assist with takeoff detection</span></div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;            <a class="code" href="classNavEKF.html#af41b8a9e16d1f33c5f209187cc34168d">timeAtArming_ms</a> =  <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// arming when GPS useage is allowed</span></div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">gpsNotAvailable</a>) {</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;                <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>; <span class="comment">// we don&#39;t have have GPS data and will only be able to estimate orientation and height</span></div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;                <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;                <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;                <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;                <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>; <span class="comment">// always clear constant velocity mode if constant position mode is active</span></div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;                <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">AID_ABSOLUTE</a>; <span class="comment">// we have GPS data and can estimate all vehicle states</span></div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;                <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;                <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;                <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;                <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;                <span class="comment">// we need to reset the GPS timers to prevent GPS timeout logic being invoked on entry into GPS aiding</span></div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;                <span class="comment">// this is becasue the EKF can be interrupted for an arbitrary amount of time during vehicle arming checks</span></div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;                <a class="code" href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">lastFixTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;                <a class="code" href="classNavEKF.html#a8ac5727059185f254f5c95ea8ba658b1">secondLastFixTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;                <span class="comment">// reset the last valid position fix time to prevent unwanted activation of GPS glitch logic</span></div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;                <a class="code" href="classNavEKF.html#a8c72f168838db6b818956a87fa640f0e">lastPosPassTime</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;                <span class="comment">// reset the fail time to prevent premature reporting of loss of position accruacy</span></div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;                <a class="code" href="classNavEKF.html#a9f5a7e05866a566fd9243727906f636f">lastPosFailTime</a> = 0;</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;            }</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;        }</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;            <span class="comment">// Reset filter position to GPS when transitioning into flight mode</span></div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;            <span class="comment">// We need to do this becasue the vehicle may have moved since the EKF origin was set</span></div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;            <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;            <a class="code" href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640">StoreStatesReset</a>();</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;            <span class="comment">// Reset all position and velocity states when transitioning out of flight mode</span></div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;            <span class="comment">// We need to do this becasue we are going into a mode that assumes zero position and velocity</span></div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;            <a class="code" href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">ResetVelocity</a>();</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;            <a class="code" href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">ResetPosition</a>();</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;            <a class="code" href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640">StoreStatesReset</a>();</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;        }</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a61fd7d0a8e6789e650fe3c4239806f4d">firstMagYawInit</a> &amp;&amp; (<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>  - <a class="code" href="classNavEKF.html#a004ab08b00cefe4e09a910bb7eef2a3b">posDownAtArming</a>) &lt; -1.5f &amp;&amp; !<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>()) {</div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;        <span class="comment">// Do the first in-air yaw and earth mag field initialisation when the vehicle has gained 1.5m of altitude after arming if it is a non-fly forward vehicle (vertical takeoff)</span></div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;        <span class="comment">// This is done to prevent magnetic field distoration from steel roofs and adjacent structures causing bad earth field and initial yaw values</span></div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> eulerAngles;</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;        <a class="code" href="classNavEKF.html#af00a144845ea0078be28516c5d584c78">getEulerAngles</a>(eulerAngles);</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a> = <a class="code" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">calcQuatAndFieldStates</a>(eulerAngles.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, eulerAngles.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;        <a class="code" href="classNavEKF.html#a61fd7d0a8e6789e650fe3c4239806f4d">firstMagYawInit</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; !<a class="code" href="classNavEKF.html#a1056d50a16aea29e1fab99e3d4a1c61c">secondMagYawInit</a> &amp;&amp; (<a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">position</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - <a class="code" href="classNavEKF.html#a004ab08b00cefe4e09a910bb7eef2a3b">posDownAtArming</a>) &lt; -5.0f &amp;&amp; !<a class="code" href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">assume_zero_sideslip</a>()) {</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;        <span class="comment">// Do the second and final yaw and earth mag field initialisation when the vehicle has gained 5.0m of altitude after arming if it is a non-fly forward vehicle (vertical takeoff)</span></div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;        <span class="comment">// This second and final correction is needed for flight from large metal structures where the magnetic field distortion can extend up to 5m</span></div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> eulerAngles;</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;        <a class="code" href="classNavEKF.html#af00a144845ea0078be28516c5d584c78">getEulerAngles</a>(eulerAngles);</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;        <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a> = <a class="code" href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">calcQuatAndFieldStates</a>(eulerAngles.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, eulerAngles.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;        <a class="code" href="classNavEKF.html#a1056d50a16aea29e1fab99e3d4a1c61c">secondMagYawInit</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;    }</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;    <span class="comment">// Always turn aiding off when the vehicle is disarmed</span></div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;        <a class="code" href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">PV_AidingMode</a> = <a class="code" href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">AID_NONE</a>;</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;        <a class="code" href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">posTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;        <a class="code" href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">velTimeout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;        <span class="comment">// set constant position mode if aiding is inhibited</span></div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;        <a class="code" href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">constPosMode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;        <a class="code" href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">constVelMode</a> = <span class="keyword">false</span>; <span class="comment">// always clear constant velocity mode if constant position mode is active</span></div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;        <a class="code" href="classNavEKF.html#ae348168676a32e441570ef3dd46153be">lastConstVelMode</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;    }</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;}</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;<span class="comment">// Set the NED origin to be used until the next filter reset</span></div>
<div class="line"><a name="l04971"></a><span class="lineno"><a class="line" href="classNavEKF.html#a7bf2627b0844597c21b9736204fd672f"> 4971</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a7bf2627b0844597c21b9736204fd672f">NavEKF::setOrigin</a>()</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;{</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;    <a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">location</a>();</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;    <a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;}</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;<span class="comment">// return the LLH location of the filters NED origin</span></div>
<div class="line"><a name="l04978"></a><span class="lineno"><a class="line" href="classNavEKF.html#aeb335cf7b5bc6c54905b2d2e51b48d30"> 4978</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#aeb335cf7b5bc6c54905b2d2e51b48d30">NavEKF::getOriginLLH</a>(<span class="keyword">struct</span> <a class="code" href="structLocation.html">Location</a> &amp;loc)<span class="keyword"> const</span></div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a>) {</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;        loc = <a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a>;</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;    }</div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a>;</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;}</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;<span class="comment">// set the LLH location of the filters NED origin</span></div>
<div class="line"><a name="l04987"></a><span class="lineno"><a class="line" href="classNavEKF.html#abc4672f6de40482dd1aeffbb38bd7d50"> 4987</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#abc4672f6de40482dd1aeffbb38bd7d50">NavEKF::setOriginLLH</a>(<span class="keyword">struct</span> <a class="code" href="structLocation.html">Location</a> &amp;loc)</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;{</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;    }</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;    <a class="code" href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">EKF_origin</a> = loc;</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;    <a class="code" href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">validOrigin</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;}</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;<span class="comment">// determine if a takeoff is expected so that we can compensate for expected barometer errors due to ground effect</span></div>
<div class="line"><a name="l04998"></a><span class="lineno"><a class="line" href="classNavEKF.html#a3108596d21f107f9b35517900bb82569"> 4998</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a3108596d21f107f9b35517900bb82569">NavEKF::getTakeoffExpected</a>()</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;{</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">expectGndEffectTakeoff</a> &amp;&amp; <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#a4b50771bf4522b595267af095ba8333a">takeoffExpectedSet_ms</a> &gt; <a class="code" href="classNavEKF.html#a5119fdbfa518bcab916ef8e4fbbae309">gndEffectTimeout_ms</a>) {</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;        <a class="code" href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">expectGndEffectTakeoff</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;    }</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">expectGndEffectTakeoff</a>;</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;}</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;<span class="comment">// called by vehicle code to specify that a takeoff is happening</span></div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;<span class="comment">// causes the EKF to compensate for expected barometer errors due to ground effect</span></div>
<div class="line"><a name="l05009"></a><span class="lineno"><a class="line" href="classNavEKF.html#a55191b30bb5eefa6d7a1aa140454b686"> 5009</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a55191b30bb5eefa6d7a1aa140454b686">NavEKF::setTakeoffExpected</a>(<span class="keywordtype">bool</span> val)</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;{</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;    <a class="code" href="classNavEKF.html#a4b50771bf4522b595267af095ba8333a">takeoffExpectedSet_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;    <a class="code" href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">expectGndEffectTakeoff</a> = val;</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;}</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;<span class="comment">// determine if a touchdown is expected so that we can compensate for expected barometer errors due to ground effect</span></div>
<div class="line"><a name="l05017"></a><span class="lineno"><a class="line" href="classNavEKF.html#a22250b5dd5beb633d424ed895659039f"> 5017</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a22250b5dd5beb633d424ed895659039f">NavEKF::getTouchdownExpected</a>()</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;{</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a58487ff745a90aad44ac05d69dd8809f">expectGndEffectTouchdown</a> &amp;&amp; <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#af6ed0063fb171f237efceb25dcbe6aec">touchdownExpectedSet_ms</a> &gt; <a class="code" href="classNavEKF.html#a5119fdbfa518bcab916ef8e4fbbae309">gndEffectTimeout_ms</a>) {</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;        <a class="code" href="classNavEKF.html#a58487ff745a90aad44ac05d69dd8809f">expectGndEffectTouchdown</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;    }</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;</div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classNavEKF.html#a58487ff745a90aad44ac05d69dd8809f">expectGndEffectTouchdown</a>;</div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;}</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;<span class="comment">// called by vehicle code to specify that a touchdown is expected to happen</span></div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;<span class="comment">// causes the EKF to compensate for expected barometer errors due to ground effect</span></div>
<div class="line"><a name="l05028"></a><span class="lineno"><a class="line" href="classNavEKF.html#a6dd42da4655ea2038e6c33c5fc55a4ce"> 5028</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a6dd42da4655ea2038e6c33c5fc55a4ce">NavEKF::setTouchdownExpected</a>(<span class="keywordtype">bool</span> val)</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;{</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;    <a class="code" href="classNavEKF.html#af6ed0063fb171f237efceb25dcbe6aec">touchdownExpectedSet_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;    <a class="code" href="classNavEKF.html#a58487ff745a90aad44ac05d69dd8809f">expectGndEffectTouchdown</a> = val;</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;}</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;<span class="comment">// Monitor GPS data to see if quality is good enough to initialise the EKF</span></div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;<span class="comment">// Monitor magnetometer innovations to to see if the heading is good enough to use GPS</span></div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;<span class="comment">// Return true if all criteria pass for 10 seconds</span></div>
<div class="line"><a name="l05037"></a><span class="lineno"><a class="line" href="classNavEKF.html#a442aeaf3f7b83e2be7f737ac81486c65"> 5037</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a442aeaf3f7b83e2be7f737ac81486c65">NavEKF::calcGpsGoodToAlign</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;{</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;    <span class="comment">// calculate absolute difference between GPS vert vel and inertial vert vel</span></div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;    <span class="keywordtype">float</span> velDiffAbs;</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#ac7d2e0692095207a6ff19072dcac9ef6">have_vertical_velocity</a>()) {</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;        velDiffAbs = <a class="code" href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a>(<a class="code" href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">velNED</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">velocity</a>.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;        velDiffAbs = 0.0f;</div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;    }</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;    <span class="comment">// fail if velocity difference or reported speed accuracy greater than threshold</span></div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;    <span class="keywordtype">bool</span> gpsVelFail = (velDiffAbs &gt; 1.0f) || (<a class="code" href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">gpsSpdAccuracy</a> &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;    <span class="comment">// fail if not enough sats</span></div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;    <span class="keywordtype">bool</span> numSatsFail = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#af74c8da8ab7394a33b0f0e64582d8648">num_sats</a>() &lt; 6;</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;    <span class="comment">// fail if horiziontal position accuracy not sufficient</span></div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;    <span class="keywordtype">float</span> hAcc = 0.0f;</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;    <span class="keywordtype">bool</span> hAccFail;</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">get_gps</a>().<a class="code" href="classAP__GPS.html#ab9667a2efe22a330232d6ba425c78364">horizontal_accuracy</a>(hAcc)) {</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;        hAccFail = hAcc &gt; 5.0f;</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;        hAccFail =  <span class="keyword">false</span>;</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;    }</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;    <span class="comment">// fail if magnetometer innovations are outside limits indicating bad yaw</span></div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;    <span class="comment">// with bad yaw we are unable to use GPS</span></div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;    <span class="keywordtype">bool</span> yawFail;</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> &gt; 1.0f || <a class="code" href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">magTestRatio</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> &gt; 1.0f) {</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;        yawFail = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;        yawFail = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;    }</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;    <span class="comment">// record time of fail</span></div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;    <span class="comment">// assume  fail first time called</span></div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;    <span class="keywordflow">if</span> (gpsVelFail || numSatsFail || hAccFail || yawFail || <a class="code" href="classNavEKF.html#ab58ac524e9097d91b12fe85c1c64e304">lastGpsVelFail_ms</a> == 0) {</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;        <a class="code" href="classNavEKF.html#ab58ac524e9097d91b12fe85c1c64e304">lastGpsVelFail_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;    }</div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;    <span class="comment">// DEBUG PRINT</span></div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;    <span class="comment">//hal.console-&gt;printf(&quot;velDiff = %5.2f, nSats = %i, hAcc = %5.2f, sAcc = %5.2f, delTime = %i\n&quot;, velDiffAbs, _ahrs-&gt;get_gps().num_sats(), hAcc, gpsSpdAccuracy, imuSampleTime_ms - lastGpsVelFail_ms);</span></div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;    <span class="comment">// continuous period without fail required to return healthy</span></div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#ab58ac524e9097d91b12fe85c1c64e304">lastGpsVelFail_ms</a> &gt; 10000) {</div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;    }</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;}</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;<span class="comment">// Read the range finder and take new measurements if available</span></div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;<span class="comment">// Read at 20Hz and apply a median filter</span></div>
<div class="line"><a name="l05083"></a><span class="lineno"><a class="line" href="classNavEKF.html#ae4d8e282bc4e67e56179c5dd6861dfe9"> 5083</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#ae4d8e282bc4e67e56179c5dd6861dfe9">NavEKF::readRangeFinder</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;{</div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">float</span> storedRngMeas[3];</div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;    <span class="keyword">static</span> uint32_t storedRngMeasTime_ms[3];</div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;    <span class="keyword">static</span> uint32_t lastRngMeasTime_ms = 0;</div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;    <span class="keyword">static</span> uint8_t rngMeasIndex = 0;</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;    uint8_t midIndex;</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;    uint8_t maxIndex;</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;    uint8_t minIndex;</div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;    <span class="comment">// get theoretical correct range when the vehicle is on the ground</span></div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;    <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a> = <a class="code" href="classNavEKF.html#ab3dfb2c1857d3d1504a22d1f8f4b1ba1">_rng</a>.<a class="code" href="classRangeFinder.html#ad95f15a0eea1106c41337089636175b3">ground_clearance_cm</a>() * 0.01f;</div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#ab3dfb2c1857d3d1504a22d1f8f4b1ba1">_rng</a>.<a class="code" href="classRangeFinder.html#a5452cf4387ba889dd206b12375d2e059">status</a>() == <a class="code" href="classRangeFinder.html#adea3c02123a4fbad18d7510c4718d8eda6a6a3d5d796bc66c713f11f2b633e1bb">RangeFinder::RangeFinder_Good</a> &amp;&amp; (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - lastRngMeasTime_ms) &gt; 50) {</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;        <span class="comment">// store samples and sample time into a ring buffer</span></div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;        rngMeasIndex ++;</div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;        <span class="keywordflow">if</span> (rngMeasIndex &gt; 2) {</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;            rngMeasIndex = 0;</div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;        }</div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;        storedRngMeasTime_ms[rngMeasIndex] = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;        storedRngMeas[rngMeasIndex] = <a class="code" href="classNavEKF.html#ab3dfb2c1857d3d1504a22d1f8f4b1ba1">_rng</a>.<a class="code" href="classRangeFinder.html#a451a7507d534024c72faa2d1b734cb3c">distance_cm</a>() * 0.01f;</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;        <span class="comment">// check for three fresh samples and take median</span></div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;        <span class="keywordtype">bool</span> sampleFresh[3];</div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;        <span class="keywordflow">for</span> (uint8_t index = 0; index &lt;= 2; index++) {</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;            sampleFresh[index] = (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - storedRngMeasTime_ms[index]) &lt; 500;</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;        }</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;        <span class="keywordflow">if</span> (sampleFresh[0] &amp;&amp; sampleFresh[1] &amp;&amp; sampleFresh[2]) {</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;            <span class="keywordflow">if</span> (storedRngMeas[0] &gt; storedRngMeas[1]) {</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;                minIndex = 1;</div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;                maxIndex = 0;</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;                maxIndex = 0;</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;                minIndex = 1;</div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;            }</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;            <span class="keywordflow">if</span> (storedRngMeas[2] &gt; storedRngMeas[maxIndex]) {</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;                midIndex = maxIndex;</div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (storedRngMeas[2] &lt; storedRngMeas[minIndex]) {</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;                midIndex = minIndex;</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;                midIndex = 2;</div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;            }</div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;            <a class="code" href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">rngMea</a> = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(storedRngMeas[midIndex],<a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>);</div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;            <a class="code" href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">newDataRng</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;            <a class="code" href="classNavEKF.html#a0eb21c6bcabd51abbf2279f17e434d67">rngValidMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;            <span class="comment">// recall vehicle states at mid sample time for range finder</span></div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;            <a class="code" href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">RecallStates</a>(<a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a>, storedRngMeasTime_ms[midIndex] - 25);</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a>) {</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;            <span class="comment">// if not armed and no return, we assume on ground range</span></div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;            <a class="code" href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">rngMea</a> = <a class="code" href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">rngOnGnd</a>;</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;            <a class="code" href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">newDataRng</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;            <a class="code" href="classNavEKF.html#a0eb21c6bcabd51abbf2279f17e434d67">rngValidMeaTime_ms</a> = <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;            <span class="comment">// assume synthetic measurement is at current time (no delay)</span></div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;            <a class="code" href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">statesAtRngTime</a> = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>;</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;            <a class="code" href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">newDataRng</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;        }</div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;        lastRngMeasTime_ms =  <a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a>;</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    }</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;}</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;<span class="comment">// Detect takeoff for optical flow navigation</span></div>
<div class="line"><a name="l05142"></a><span class="lineno"><a class="line" href="classNavEKF.html#a9c6fa0fb0aea35417db85255fdea98c9"> 5142</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a9c6fa0fb0aea35417db85255fdea98c9">NavEKF::detectOptFlowTakeoff</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;{</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">vehicleArmed</a> &amp;&amp; !<a class="code" href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">takeOffDetected</a> &amp;&amp; (<a class="code" href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">imuSampleTime_ms</a> - <a class="code" href="classNavEKF.html#af41b8a9e16d1f33c5f209187cc34168d">timeAtArming_ms</a>) &gt; 1000) {</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;        <span class="keyword">const</span> <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a> &amp;<a class="code" href="AHRS__Test_8pde.html#a4b91d1711c0d031f33f581540503bc54">ins</a> = <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">get_ins</a>();</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> angRateVec;</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> gyroBias;</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;        <a class="code" href="classNavEKF.html#a7aa7c1b989521cde235e21a82ec537e4">getGyroBias</a>(gyroBias);</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;        <span class="keywordtype">bool</span> dual_ins = ins.<a class="code" href="classAP__InertialSensor.html#abc8c1aea2c3bc58a05d8d9832a9d1194">get_gyro_health</a>(0) &amp;&amp; ins.<a class="code" href="classAP__InertialSensor.html#abc8c1aea2c3bc58a05d8d9832a9d1194">get_gyro_health</a>(1);</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;        <span class="keywordflow">if</span> (dual_ins) {</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;                angRateVec = (ins.<a class="code" href="classAP__InertialSensor.html#a6df2d8ad956d4f375bdee541102f16af">get_gyro</a>(0) + ins.<a class="code" href="classAP__InertialSensor.html#a6df2d8ad956d4f375bdee541102f16af">get_gyro</a>(1)) * 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> - gyroBias;</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;                angRateVec = ins.<a class="code" href="classAP__InertialSensor.html#a6df2d8ad956d4f375bdee541102f16af">get_gyro</a>() - gyroBias;</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;        }</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;        <a class="code" href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">takeOffDetected</a> = (<a class="code" href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">takeOffDetected</a> || (angRateVec.<a class="code" href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">length</a>() &gt; 0.1f) || (<a class="code" href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">rngMea</a> &gt; (<a class="code" href="classNavEKF.html#a65d15fe2ebf0c1e1c47375e575ccd36e">rangeAtArming</a> + 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)));</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;    }</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;}</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;<span class="comment">// provides the height limit to be observed by the control loops</span></div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;<span class="comment">// returns false if no height limiting is required</span></div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;<span class="comment">// this is needed to ensure the vehicle does not fly too high when using optical flow navigation</span></div>
<div class="line"><a name="l05163"></a><span class="lineno"><a class="line" href="classNavEKF.html#a851694619b992bb036e750575b654014"> 5163</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classNavEKF.html#a851694619b992bb036e750575b654014">NavEKF::getHeightControlLimit</a>(<span class="keywordtype">float</span> &amp;height)<span class="keyword"> const</span></div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;    <span class="comment">// only ask for limiting if we are doing optical flow navigation</span></div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">_fusionModeGPS</a> == 3) {</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;        <span class="comment">// If are doing optical flow nav, ensure the height above ground is within range finder limits after accounting for vehicle tilt and control errors</span></div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;        height = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<span class="keywordtype">float</span>(<a class="code" href="classNavEKF.html#ab3dfb2c1857d3d1504a22d1f8f4b1ba1">_rng</a>.<a class="code" href="classRangeFinder.html#a52afaa97928556f60fe968ee9a6ce429">max_distance_cm</a>()) * 0.007<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> - 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;    }</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;}</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;<span class="comment">// provides the delta quaternion that was used by the INS calculation to rotate from the previous orientation to the orientation at the current time</span></div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;<span class="comment">// the delta quaternion returned will be a zero rotation if the INS calculation was not performed on that time step</span></div>
<div class="line"><a name="l05177"></a><span class="lineno"><a class="line" href="classNavEKF.html#a7cb2acda61b77f598bd8d3f498f064c7"> 5177</a></span>&#160;<a class="code" href="classQuaternion.html">Quaternion</a> <a class="code" href="classNavEKF.html#a7cb2acda61b77f598bd8d3f498f064c7">NavEKF::getDeltaQuaternion</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;    <span class="comment">// Note: correctedDelAngQuat is reset to a zero rotation at the start of every update cycle in UpdateFilter()</span></div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classNavEKF.html#aa9c0b8027f194f5e4735bc8cfede2503">correctedDelAngQuat</a>;</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;}</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="comment">// return the quaternions defining the rotation from NED to XYZ (body) axes</span></div>
<div class="line"><a name="l05184"></a><span class="lineno"><a class="line" href="classNavEKF.html#a9155b42312de4e57a182e58ca0a150fc"> 5184</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a9155b42312de4e57a182e58ca0a150fc">NavEKF::getQuaternion</a>(<a class="code" href="classQuaternion.html">Quaternion</a>&amp; ret)<span class="keyword"> const</span></div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    ret = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">quat</a>;</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;}</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;<span class="comment">// align the NE earth magnetic field states with the published declination</span></div>
<div class="line"><a name="l05190"></a><span class="lineno"><a class="line" href="classNavEKF.html#a22aad7c0baf696cae27135ecaa4f2f58"> 5190</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classNavEKF.html#a22aad7c0baf696cae27135ecaa4f2f58">NavEKF::alignMagStateDeclination</a>()</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;{</div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;    <span class="comment">// get the magnetic declination</span></div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;    <span class="keywordtype">float</span> magDecAng = <a class="code" href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">use_compass</a>() ? <a class="code" href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">_ahrs</a>-&gt;<a class="code" href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">get_compass</a>()-&gt;<a class="code" href="classCompass.html#a5051de1d15ee203600422235ab93c88c">get_declination</a>() : 0;</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;    <span class="comment">// rotate the NE values so that the declination matches the published value</span></div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> initMagNED = <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a>;</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;    <span class="keywordtype">float</span> magLengthNE = <a class="code" href="AP__Math_8cpp.html#afd3767d48a7b20f6d5220a4f8007af00">pythagorous2</a>(initMagNED.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>,initMagNED.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = magLengthNE * <a class="code" href="AP__Math__AVR__Compat_8h.html#acc171f0e087ed26abd701c827944a43b">cosf</a>(magDecAng);</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;    <a class="code" href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">state</a>.<a class="code" href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">earth_magfield</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = magLengthNE * <a class="code" href="AP__Math__AVR__Compat_8h.html#a6776b8d1a4149fe35e282a76effd8a9d">sinf</a>(magDecAng);</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;}</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;<span class="preprocessor">#endif // HAL_CPU_CLASS</span></div>
<div class="ttc" id="classAP__Airspeed_html"><div class="ttname"><a href="classAP__Airspeed.html">AP_Airspeed</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Airspeed_8h_source.html#l00039">AP_Airspeed.h:39</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a24aeadb733f27244ec14e4cba82eeee9"><div class="ttname"><a href="calcH__MAG_8c.html#a24aeadb733f27244ec14e4cba82eeee9">t2</a></div><div class="ttdeci">t2</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00001">calcH_MAG.c:1</a></div></div>
<div class="ttc" id="classQuaternion_html"><div class="ttname"><a href="classQuaternion.html">Quaternion</a></div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8h_source.html#l00028">quaternion.h:28</a></div></div>
<div class="ttc" id="classNavEKF_html_a84907f07399afdb2b7c8562aa5d749b4"><div class="ttname"><a href="classNavEKF.html#a84907f07399afdb2b7c8562aa5d749b4">NavEKF::msecBetaAvg</a></div><div class="ttdeci">const uint16_t msecBetaAvg</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00514">AP_NavEKF.h:514</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a527b26472ed6f2e0c141e109a0722a0a"><div class="ttname"><a href="AP__Math_8h.html#a527b26472ed6f2e0c141e109a0722a0a">location_diff</a></div><div class="ttdeci">Vector2f location_diff(const struct Location &amp;loc1, const struct Location &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="location_8cpp_source.html#l00143">location.cpp:143</a></div></div>
<div class="ttc" id="classNavEKF_html_ab96277c1a87dd3bd2da7fc3c4fbfb495"><div class="ttname"><a href="classNavEKF.html#ab96277c1a87dd3bd2da7fc3c4fbfb495">NavEKF::takeOffDetected</a></div><div class="ttdeci">bool takeOffDetected</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00742">AP_NavEKF.h:742</a></div></div>
<div class="ttc" id="classNavEKF_html_a9eb8c77b7f824e2ebbf378f1d269290b"><div class="ttname"><a href="classNavEKF.html#a9eb8c77b7f824e2ebbf378f1d269290b">NavEKF::performArmingChecks</a></div><div class="ttdeci">void performArmingChecks()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04842">AP_NavEKF.cpp:4842</a></div></div>
<div class="ttc" id="classNavEKF_html_af14ec775e5b4d433b39b28618836fbd8"><div class="ttname"><a href="classNavEKF.html#af14ec775e5b4d433b39b28618836fbd8">NavEKF::Kfusion</a></div><div class="ttdeci">Vector31 Kfusion</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00548">AP_NavEKF.h:548</a></div></div>
<div class="ttc" id="classNavEKF_html_a4e974460d85be5a996622af6b2ed73f9"><div class="ttname"><a href="classNavEKF.html#a4e974460d85be5a996622af6b2ed73f9">NavEKF::gpsPosGlitchOffsetNE</a></div><div class="ttdeci">Vector2f gpsPosGlitchOffsetNE</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00642">AP_NavEKF.h:642</a></div></div>
<div class="ttc" id="classNavEKF_html_a46acab5de021fea9824f4b5bed04e3e9"><div class="ttname"><a href="classNavEKF.html#a46acab5de021fea9824f4b5bed04e3e9">NavEKF::RecallStates</a></div><div class="ttdeci">void RecallStates(state_elements &amp;statesForFusion, uint32_t msec)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03555">AP_NavEKF.cpp:3555</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfab11a54da20f04e9a45f7196da5dd601f"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfab11a54da20f04e9a45f7196da5dd601f">EKF_PRED_POS_HORIZ_ABS</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00344">ardupilotmega.h:344</a></div></div>
<div class="ttc" id="classNavEKF_html_aec873372a31572fa3b15829cb0b96c50"><div class="ttname"><a href="classNavEKF.html#aec873372a31572fa3b15829cb0b96c50">NavEKF::_gpsVertVelNoise</a></div><div class="ttdeci">AP_Float _gpsVertVelNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00461">AP_NavEKF.h:461</a></div></div>
<div class="ttc" id="GCS__Console_2examples_2Console_2Console_8pde_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="GCS__Console_2examples_2Console_2Console_8pde.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Console_2examples_2Console_2Console_8pde_source.html#l00061">Console.pde:61</a></div></div>
<div class="ttc" id="classNavEKF_html_ac428877731660c88f3854d0fce38ff1e"><div class="ttname"><a href="classNavEKF.html#ac428877731660c88f3854d0fce38ff1e">NavEKF::_altSource</a></div><div class="ttdeci">AP_Int8 _altSource</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00492">AP_NavEKF.h:492</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a2044e7b3804c73b4c393d3988351a96e"><div class="ttname"><a href="classAP__InertialSensor.html#a2044e7b3804c73b4c393d3988351a96e">AP_InertialSensor::get_accel_health</a></div><div class="ttdeci">bool get_accel_health(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00154">AP_InertialSensor.h:154</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a7556f9c9944ef00ccff5b0ba95a629ca"><div class="ttname"><a href="unionnav__filter__status.html#a7556f9c9944ef00ccff5b0ba95a629ca">nav_filter_status::terrain_alt</a></div><div class="ttdeci">uint16_t terrain_alt</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00030">AP_Nav_Common.h:30</a></div></div>
<div class="ttc" id="classNavEKF_html_a64f8c6c7bafe2f50cd83a67c36406640"><div class="ttname"><a href="classNavEKF.html#a64f8c6c7bafe2f50cd83a67c36406640">NavEKF::StoreStatesReset</a></div><div class="ttdeci">void StoreStatesReset(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03542">AP_NavEKF.cpp:3542</a></div></div>
<div class="ttc" id="classNavEKF_html_ac893450bc563dcb72697e4eec779667d"><div class="ttname"><a href="classNavEKF.html#ac893450bc563dcb72697e4eec779667d">NavEKF::obsIndex</a></div><div class="ttdeci">uint8_t obsIndex</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00761">AP_NavEKF.h:761</a></div></div>
<div class="ttc" id="classNavEKF_html_aef0c532dcca365df6f58c1f19fcc764e"><div class="ttname"><a href="classNavEKF.html#aef0c532dcca365df6f58c1f19fcc764e">NavEKF::states</a></div><div class="ttdeci">Vector34 states</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00268">AP_NavEKF.h:268</a></div></div>
<div class="ttc" id="classNavEKF_html_ab0e1d269feaa76d5474e212ce1e003e6"><div class="ttname"><a href="classNavEKF.html#ab0e1d269feaa76d5474e212ce1e003e6">NavEKF::firstArmComplete</a></div><div class="ttdeci">bool firstArmComplete</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00652">AP_NavEKF.h:652</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a7fa04e2f196b27b876d86966f64e1fed"><div class="ttname"><a href="classAP__InertialSensor.html#a7fa04e2f196b27b876d86966f64e1fed">AP_InertialSensor::get_primary_gyro</a></div><div class="ttdeci">uint8_t get_primary_gyro(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00202">AP_InertialSensor.h:202</a></div></div>
<div class="ttc" id="classNavEKF_html_a178fdcb2e3178a0738ef69bd994a66f1"><div class="ttname"><a href="classNavEKF.html#a178fdcb2e3178a0738ef69bd994a66f1">NavEKF::_perf_CovariancePrediction</a></div><div class="ttdeci">perf_counter_t _perf_CovariancePrediction</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00808">AP_NavEKF.h:808</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a0672949c16970f513dc0734f1a5ee4ed"><div class="ttname"><a href="unionnav__filter__status.html#a0672949c16970f513dc0734f1a5ee4ed">nav_filter_status::takeoff_detected</a></div><div class="ttdeci">uint16_t takeoff_detected</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00034">AP_Nav_Common.h:34</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a0612b502881e2f25e9f3f0295f28d7f1"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a0612b502881e2f25e9f3f0295f28d7f1">PROGMEM</a></div><div class="ttdeci">const AP_Param::GroupInfo NavEKF::var_info[] PROGMEM</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00113">AP_NavEKF.cpp:113</a></div></div>
<div class="ttc" id="classNavEKF_html_a13b1a09dcdaaae1707abcf0e9e9d6471"><div class="ttname"><a href="classNavEKF.html#a13b1a09dcdaaae1707abcf0e9e9d6471">NavEKF::covTimeStepMax</a></div><div class="ttdeci">const float covTimeStepMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00518">AP_NavEKF.h:518</a></div></div>
<div class="ttc" id="classNavEKF_html_a3318012ee906704bbdd5b8f38a57c2d6"><div class="ttname"><a href="classNavEKF.html#a3318012ee906704bbdd5b8f38a57c2d6">NavEKF::dtIMUactual</a></div><div class="ttdeci">ftype dtIMUactual</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00570">AP_NavEKF.h:570</a></div></div>
<div class="ttc" id="classNavEKF_html_ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e"><div class="ttname"><a href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa7eda5803ffbbbbf583f9a5d2280e287e">NavEKF::AID_ABSOLUTE</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00729">AP_NavEKF.h:729</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a8691156c332da099e3f5952e72ae2a58"><div class="ttname"><a href="classAP__AHRS.html#a8691156c332da099e3f5952e72ae2a58">AP_AHRS::airspeed_sensor_enabled</a></div><div class="ttdeci">bool airspeed_sensor_enabled(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00265">AP_AHRS.h:265</a></div></div>
<div class="ttc" id="classNavEKF_html_a0cb5e7b30e1242cb452b92675495064b"><div class="ttname"><a href="classNavEKF.html#a0cb5e7b30e1242cb452b92675495064b">NavEKF::lastKnownPositionNE</a></div><div class="ttdeci">Vector2f lastKnownPositionNE</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00643">AP_NavEKF.h:643</a></div></div>
<div class="ttc" id="classNavEKF_html_a4f2f0068a25f875107d34f4781ddf8dd"><div class="ttname"><a href="classNavEKF.html#a4f2f0068a25f875107d34f4781ddf8dd">NavEKF::getWind</a></div><div class="ttdeci">void getWind(Vector3f &amp;wind) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03745">AP_NavEKF.cpp:3745</a></div></div>
<div class="ttc" id="classNavEKF_html_a735bc0b9b41f2f6df7ab8df344d15d78"><div class="ttname"><a href="classNavEKF.html#a735bc0b9b41f2f6df7ab8df344d15d78">NavEKF::SG</a></div><div class="ttdeci">Vector8 SG</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00637">AP_NavEKF.h:637</a></div></div>
<div class="ttc" id="classNavEKF_html_a878cd2073d88522b03e3f6a972bacf3c"><div class="ttname"><a href="classNavEKF.html#a878cd2073d88522b03e3f6a972bacf3c">NavEKF::gpsIncrStateDelta</a></div><div class="ttdeci">Vector10 gpsIncrStateDelta</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00672">AP_NavEKF.h:672</a></div></div>
<div class="ttc" id="classNavEKF_html_a9325c105b47dc9d869863976933a221a"><div class="ttname"><a href="classNavEKF.html#a9325c105b47dc9d869863976933a221a">NavEKF::_magBodyProcessNoise</a></div><div class="ttdeci">AP_Float _magBodyProcessNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00469">AP_NavEKF.h:469</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a384a23e205126cf43e91bec9668b7ed0"><div class="ttname"><a href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">AP_AHRS::roll</a></div><div class="ttdeci">float roll</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00197">AP_AHRS.h:197</a></div></div>
<div class="ttc" id="classNavEKF_html_a68aa4d3ae31fc58ca9cdc21cdd4e2799"><div class="ttname"><a href="classNavEKF.html#a68aa4d3ae31fc58ca9cdc21cdd4e2799">NavEKF::inhibitGndState</a></div><div class="ttdeci">bool inhibitGndState</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00714">AP_NavEKF.h:714</a></div></div>
<div class="ttc" id="classNavEKF_html_a9811c1b11e7fced4f5b53c0052854099"><div class="ttname"><a href="classNavEKF.html#a9811c1b11e7fced4f5b53c0052854099">NavEKF::lastAccel2</a></div><div class="ttdeci">Vector3f lastAccel2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00633">AP_NavEKF.h:633</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a326eac8bf597fa378535eab5e533acee"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a326eac8bf597fa378535eab5e533acee">NavEKF::state_elements::vel2</a></div><div class="ttdeci">Vector3f vel2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00281">AP_NavEKF.h:281</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_ab8559370abce329611c5c20b1cb92e7c"><div class="ttname"><a href="AP__NavEKF_8cpp.html#ab8559370abce329611c5c20b1cb92e7c">MAG_GATE_DEFAULT</a></div><div class="ttdeci">#define MAG_GATE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00089">AP_NavEKF.cpp:89</a></div></div>
<div class="ttc" id="classVector3_html_a076ee3d40e645623b54650cca5ae6df7"><div class="ttname"><a href="classVector3.html#a076ee3d40e645623b54650cca5ae6df7">Vector3::is_nan</a></div><div class="ttdeci">bool is_nan(void) const </div><div class="ttdef"><b>Definition:</b> <a href="vector3_8cpp_source.html#l00279">vector3.cpp:279</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a80274fe56f3e6edad87ae9fbe3b797ab"><div class="ttname"><a href="unionnav__filter__status.html#a80274fe56f3e6edad87ae9fbe3b797ab">nav_filter_status::value</a></div><div class="ttdeci">uint16_t value</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00039">AP_Nav_Common.h:39</a></div></div>
<div class="ttc" id="classNavEKF_html_a9edf7bed6dcbaaecf7c3f88e9cc2daa9"><div class="ttname"><a href="classNavEKF.html#a9edf7bed6dcbaaecf7c3f88e9cc2daa9">NavEKF::magE</a></div><div class="ttdeci">ftype magE</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00792">AP_NavEKF.h:792</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Scheduler_html_a26b68339fc68a562d8d3a1238d0ec8c1"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#a26b68339fc68a562d8d3a1238d0ec8c1">AP_HAL::Scheduler::millis</a></div><div class="ttdeci">virtual uint32_t millis()=0</div></div>
<div class="ttc" id="classNavEKF_html_adf06c6a73b9ca994ca16892ed0740283"><div class="ttname"><a href="classNavEKF.html#adf06c6a73b9ca994ca16892ed0740283">NavEKF::readMagData</a></div><div class="ttdeci">void readMagData()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04255">AP_NavEKF.cpp:4255</a></div></div>
<div class="ttc" id="classNavEKF_html_adc74369bdb7425b717f68eec54aa123f"><div class="ttname"><a href="classNavEKF.html#adc74369bdb7425b717f68eec54aa123f">NavEKF::getLLH</a></div><div class="ttdeci">bool getLLH(struct Location &amp;loc) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03782">AP_NavEKF.cpp:3782</a></div></div>
<div class="ttc" id="classNavEKF_html_a87c71e92e35c460ff8f026333dc1e813"><div class="ttname"><a href="classNavEKF.html#a87c71e92e35c460ff8f026333dc1e813">NavEKF::readHgtData</a></div><div class="ttdeci">void readHgtData()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04197">AP_NavEKF.cpp:4197</a></div></div>
<div class="ttc" id="classNavEKF_html_aa08107820e13ef44bf7a9325c713365b"><div class="ttname"><a href="classNavEKF.html#aa08107820e13ef44bf7a9325c713365b">NavEKF::SK_LOS</a></div><div class="ttdeci">Vector10 SK_LOS</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00763">AP_NavEKF.h:763</a></div></div>
<div class="ttc" id="classNavEKF_html_a98cecb1b04b7c353aa15e3801da5364e"><div class="ttname"><a href="classNavEKF.html#a98cecb1b04b7c353aa15e3801da5364e">NavEKF::summedDelVel</a></div><div class="ttdeci">Vector3f summedDelVel</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00560">AP_NavEKF.h:560</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html"><div class="ttname"><a href="structNavEKF_1_1state__elements.html">NavEKF::state_elements</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00269">AP_NavEKF.h:269</a></div></div>
<div class="ttc" id="classNavEKF_html_a91bb438d5ecdbfecf5b501f5cdddb7dc"><div class="ttname"><a href="classNavEKF.html#a91bb438d5ecdbfecf5b501f5cdddb7dc">NavEKF::constVelMode</a></div><div class="ttdeci">bool constVelMode</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00726">AP_NavEKF.h:726</a></div></div>
<div class="ttc" id="classNavEKF_html_ab58ac524e9097d91b12fe85c1c64e304"><div class="ttname"><a href="classNavEKF.html#ab58ac524e9097d91b12fe85c1c64e304">NavEKF::lastGpsVelFail_ms</a></div><div class="ttdeci">uint32_t lastGpsVelFail_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00663">AP_NavEKF.h:663</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_a996fdbe87607543eef5dcb234f6bc017"><div class="ttname"><a href="AP__Math_8cpp.html#a996fdbe87607543eef5dcb234f6bc017">sq</a></div><div class="ttdeci">float sq(float v)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00107">AP_Math.cpp:107</a></div></div>
<div class="ttc" id="AP__NavEKF_8h_html"><div class="ttname"><a href="AP__NavEKF_8h.html">AP_NavEKF.h</a></div></div>
<div class="ttc" id="classNavEKF_html_adcdf19a4bd79530aaac0fb6b49acca3f"><div class="ttname"><a href="classNavEKF.html#adcdf19a4bd79530aaac0fb6b49acca3f">NavEKF::_maxFlowRate</a></div><div class="ttdeci">AP_Float _maxFlowRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00490">AP_NavEKF.h:490</a></div></div>
<div class="ttc" id="classNavEKF_html_a58fc44f797a61b7f760baa4961f43342"><div class="ttname"><a href="classNavEKF.html#a58fc44f797a61b7f760baa4961f43342">NavEKF::SelectVelPosFusion</a></div><div class="ttdeci">void SelectVelPosFusion()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00762">AP_NavEKF.cpp:762</a></div></div>
<div class="ttc" id="classNavEKF_html_a469538f4ff5dd6886d8db2be0acd3b48"><div class="ttname"><a href="classNavEKF.html#a469538f4ff5dd6886d8db2be0acd3b48">NavEKF::ResetHeight</a></div><div class="ttdeci">void ResetHeight(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00501">AP_NavEKF.cpp:501</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfaa5e61a9c5f99875adc14ce76e386a1db"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfaa5e61a9c5f99875adc14ce76e386a1db">EKF_PRED_POS_HORIZ_REL</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00343">ardupilotmega.h:343</a></div></div>
<div class="ttc" id="classNavEKF_html_acae32760a02eabd8be7398e5a52ad47b"><div class="ttname"><a href="classNavEKF.html#acae32760a02eabd8be7398e5a52ad47b">NavEKF::_fallback</a></div><div class="ttdeci">AP_Int8 _fallback</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00491">AP_NavEKF.h:491</a></div></div>
<div class="ttc" id="classNavEKF_html_af8f52a8c0318c8a1e72b8b8810f66595"><div class="ttname"><a href="classNavEKF.html#af8f52a8c0318c8a1e72b8b8810f66595">NavEKF::lastMagOffsets</a></div><div class="ttdeci">Vector3f lastMagOffsets</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00664">AP_NavEKF.h:664</a></div></div>
<div class="ttc" id="classNavEKF_html_a8c72f168838db6b818956a87fa640f0e"><div class="ttname"><a href="classNavEKF.html#a8c72f168838db6b818956a87fa640f0e">NavEKF::lastPosPassTime</a></div><div class="ttdeci">uint32_t lastPosPassTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00620">AP_NavEKF.h:620</a></div></div>
<div class="ttc" id="classNavEKF_html_a3d1ab5eacbcc3b4e98187dff6a4f32bb"><div class="ttname"><a href="classNavEKF.html#a3d1ab5eacbcc3b4e98187dff6a4f32bb">NavEKF::ForceSymmetry</a></div><div class="ttdeci">void ForceSymmetry()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03968">AP_NavEKF.cpp:3968</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_afd3767d48a7b20f6d5220a4f8007af00"><div class="ttname"><a href="AP__Math_8cpp.html#afd3767d48a7b20f6d5220a4f8007af00">pythagorous2</a></div><div class="ttdeci">float pythagorous2(float a, float b)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00112">AP_Math.cpp:112</a></div></div>
<div class="ttc" id="classNavEKF_html_aed329b2d74037999afab1de3d6469811"><div class="ttname"><a href="classNavEKF.html#aed329b2d74037999afab1de3d6469811">NavEKF::vehicleArmed</a></div><div class="ttdeci">bool vehicleArmed</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00658">AP_NavEKF.h:658</a></div></div>
<div class="ttc" id="classNavEKF_html_a2edd60a03392bb20f9f5de0da6b6f7d3"><div class="ttname"><a href="classNavEKF.html#a2edd60a03392bb20f9f5de0da6b6f7d3">NavEKF::magD</a></div><div class="ttdeci">ftype magD</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00793">AP_NavEKF.h:793</a></div></div>
<div class="ttc" id="classNavEKF_html_a5ea1ecbce4372b7cb77fd19e6142a1aa"><div class="ttname"><a href="classNavEKF.html#a5ea1ecbce4372b7cb77fd19e6142a1aa">NavEKF::magIncrStateDelta</a></div><div class="ttdeci">Vector10 magIncrStateDelta</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00674">AP_NavEKF.h:674</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfae7564d93b60edc369106a4030f9ea964"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfae7564d93b60edc369106a4030f9ea964">EKF_POS_HORIZ_REL</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00338">ardupilotmega.h:338</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a96f2e39aff49e114a7f751ead66039bb"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a96f2e39aff49e114a7f751ead66039bb">NavEKF::state_elements::wind_vel</a></div><div class="ttdeci">Vector2f wind_vel</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00275">AP_NavEKF.h:275</a></div></div>
<div class="ttc" id="classNavEKF_html_a9b64a8219583f08c858742652fce2774"><div class="ttname"><a href="classNavEKF.html#a9b64a8219583f08c858742652fce2774">NavEKF::flowQuality</a></div><div class="ttdeci">uint8_t flowQuality</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00698">AP_NavEKF.h:698</a></div></div>
<div class="ttc" id="classNavEKF_html_ab383bfe9058c3edeba7787c8b55f681f"><div class="ttname"><a href="classNavEKF.html#ab383bfe9058c3edeba7787c8b55f681f">NavEKF::getInnovations</a></div><div class="ttdeci">void getInnovations(Vector3f &amp;velInnov, Vector3f &amp;posInnov, Vector3f &amp;magInnov, float &amp;tasInnov) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04508">AP_NavEKF.cpp:4508</a></div></div>
<div class="ttc" id="classCompass_html_a9600516e0dbde9186d3b14b3457af013"><div class="ttname"><a href="classCompass.html#a9600516e0dbde9186d3b14b3457af013">Compass::last_update_usec</a></div><div class="ttdeci">uint32_t last_update_usec(void) const </div><div class="ttdef"><b>Definition:</b> <a href="Compass_8h_source.html#l00235">Compass.h:235</a></div></div>
<div class="ttc" id="classNavEKF_html_aa655860e29ea497ab4b38f6c38f047bc"><div class="ttname"><a href="classNavEKF.html#aa655860e29ea497ab4b38f6c38f047bc">NavEKF::Vector22</a></div><div class="ttdeci">ftype Vector22[22]</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00082">AP_NavEKF.h:82</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfaf7c1d2e5b450a672f6c4f7123f6af34c"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfaf7c1d2e5b450a672f6c4f7123f6af34c">EKF_POS_VERT_ABS</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00340">ardupilotmega.h:340</a></div></div>
<div class="ttc" id="classNavEKF_html_aeb79ccc4b0cf30d9accb79b76820f151"><div class="ttname"><a href="classNavEKF.html#aeb79ccc4b0cf30d9accb79b76820f151">NavEKF::SH_LOS</a></div><div class="ttdeci">Vector4 SH_LOS</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00762">AP_NavEKF.h:762</a></div></div>
<div class="ttc" id="classNavEKF_html_ae4d8e282bc4e67e56179c5dd6861dfe9"><div class="ttname"><a href="classNavEKF.html#ae4d8e282bc4e67e56179c5dd6861dfe9">NavEKF::readRangeFinder</a></div><div class="ttdeci">void readRangeFinder()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05083">AP_NavEKF.cpp:5083</a></div></div>
<div class="ttc" id="classNavEKF_html_aabd2214f7cfadf604e0d8e6596f09836"><div class="ttname"><a href="classNavEKF.html#aabd2214f7cfadf604e0d8e6596f09836">NavEKF::correctedDelAng</a></div><div class="ttdeci">Vector3f correctedDelAng</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00554">AP_NavEKF.h:554</a></div></div>
<div class="ttc" id="classNavEKF_html_ad2cb550e9590b8bf6d921467d10766af"><div class="ttname"><a href="classNavEKF.html#ad2cb550e9590b8bf6d921467d10766af">NavEKF::getFilterTimeouts</a></div><div class="ttdeci">void getFilterTimeouts(uint8_t &amp;timeouts) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04758">AP_NavEKF.cpp:4758</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a2648b5fc68b22e83205161cf1274939c"><div class="ttname"><a href="classAP__AHRS.html#a2648b5fc68b22e83205161cf1274939c">AP_AHRS::get_EAS2TAS</a></div><div class="ttdeci">float get_EAS2TAS(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00256">AP_AHRS.h:256</a></div></div>
<div class="ttc" id="classNavEKF_html"><div class="ttname"><a href="classNavEKF.html">NavEKF</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00045">AP_NavEKF.h:45</a></div></div>
<div class="ttc" id="AHRS__Test_8pde_html_a53fcf9055dcf2464b865c886fb0c3853"><div class="ttname"><a href="AHRS__Test_8pde.html#a53fcf9055dcf2464b865c886fb0c3853">baro</a></div><div class="ttdeci">AP_Baro baro</div><div class="ttdef"><b>Definition:</b> <a href="AHRS__Test_8pde_source.html#l00057">AHRS_Test.pde:57</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a17c89aaaeb13a9f784b22070c92a90b5"><div class="ttname"><a href="calcH__MAG_8c.html#a17c89aaaeb13a9f784b22070c92a90b5">t26</a></div><div class="ttdeci">t26</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00027">calcH_MAG.c:27</a></div></div>
<div class="ttc" id="classNavEKF_html_a6718baa569eff65fb4e317ecf5426598"><div class="ttname"><a href="classNavEKF.html#a6718baa569eff65fb4e317ecf5426598">NavEKF::UpdateStrapdownEquationsNED</a></div><div class="ttdeci">void UpdateStrapdownEquationsNED()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l01106">AP_NavEKF.cpp:1106</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a93a3774320e331583fc6c6ac2418be21"><div class="ttname"><a href="classAP__AHRS.html#a93a3774320e331583fc6c6ac2418be21">AP_AHRS::get_trim</a></div><div class="ttdeci">const Vector3f &amp; get_trim() const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00310">AP_AHRS.h:310</a></div></div>
<div class="ttc" id="classNavEKF_html_ac2840665c445a4799438fa6e8e0fec5a"><div class="ttname"><a href="classNavEKF.html#ac2840665c445a4799438fa6e8e0fec5a">NavEKF::posHealth</a></div><div class="ttdeci">bool posHealth</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00535">AP_NavEKF.h:535</a></div></div>
<div class="ttc" id="classNavEKF_html_ab3dfb2c1857d3d1504a22d1f8f4b1ba1"><div class="ttname"><a href="classNavEKF.html#ab3dfb2c1857d3d1504a22d1f8f4b1ba1">NavEKF::_rng</a></div><div class="ttdeci">const RangeFinder &amp; _rng</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00263">AP_NavEKF.h:263</a></div></div>
<div class="ttc" id="classNavEKF_html_a1195468f35ab74063a4f84bd22e3956f"><div class="ttname"><a href="classNavEKF.html#a1195468f35ab74063a4f84bd22e3956f">NavEKF::newDataFlow</a></div><div class="ttdeci">bool newDataFlow</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00686">AP_NavEKF.h:686</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_aacc03a626049d93a3ea1f497c767aa00"><div class="ttname"><a href="AP__NavEKF_8cpp.html#aacc03a626049d93a3ea1f497c767aa00">MAGB_PNOISE_DEFAULT</a></div><div class="ttdeci">#define MAGB_PNOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00085">AP_NavEKF.cpp:85</a></div></div>
<div class="ttc" id="classNavEKF_html_ac6c439b358eca4f9a6ada0b8a3fcbafc"><div class="ttname"><a href="classNavEKF.html#ac6c439b358eca4f9a6ada0b8a3fcbafc">NavEKF::accelBiasNoiseScaler</a></div><div class="ttdeci">const float accelBiasNoiseScaler</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00510">AP_NavEKF.h:510</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_ac09c78b18c2ad21b9a04081f119f11c0"><div class="ttname"><a href="AP__Math_8cpp.html#ac09c78b18c2ad21b9a04081f119f11c0">pythagorous3</a></div><div class="ttdeci">float pythagorous3(float a, float b, float c)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00117">AP_Math.cpp:117</a></div></div>
<div class="ttc" id="classNavEKF_html_ab6af69aeaca1965e2a45c0eabd9d78c5"><div class="ttname"><a href="classNavEKF.html#ab6af69aeaca1965e2a45c0eabd9d78c5">NavEKF::_gpsGlitchAccelMax</a></div><div class="ttdeci">AP_Int16 _gpsGlitchAccelMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00483">AP_NavEKF.h:483</a></div></div>
<div class="ttc" id="classNavEKF_html_a21191ffbd3559a58c8dfe91b73520b02"><div class="ttname"><a href="classNavEKF.html#a21191ffbd3559a58c8dfe91b73520b02">NavEKF::velDotNED</a></div><div class="ttdeci">Vector3f velDotNED</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00608">AP_NavEKF.h:608</a></div></div>
<div class="ttc" id="classNavEKF_html_a1d3dccbab86ffda5898048f8f159c00c"><div class="ttname"><a href="classNavEKF.html#a1d3dccbab86ffda5898048f8f159c00c">NavEKF::ConstrainStates</a></div><div class="ttdeci">void ConstrainStates()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04011">AP_NavEKF.cpp:4011</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="classNavEKF_html_a4841badbd59995a1269f0ecdbfe6a8a3"><div class="ttname"><a href="classNavEKF.html#a4841badbd59995a1269f0ecdbfe6a8a3">NavEKF::covDelAngMax</a></div><div class="ttdeci">const float covDelAngMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00519">AP_NavEKF.h:519</a></div></div>
<div class="ttc" id="classNavEKF_html_abdaf68381be159aff6d4fa2e87464607"><div class="ttname"><a href="classNavEKF.html#abdaf68381be159aff6d4fa2e87464607">NavEKF::lastFixTime_ms</a></div><div class="ttdeci">uint32_t lastFixTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00626">AP_NavEKF.h:626</a></div></div>
<div class="ttc" id="AP__Param_8h_html_abe1c2a65ce5455bf37f3c000b4241c00"><div class="ttname"><a href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, class, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00046">AP_Param.h:46</a></div></div>
<div class="ttc" id="classNavEKF_html_a4116746f04808992aefdaa6d3ce446c2"><div class="ttname"><a href="classNavEKF.html#a4116746f04808992aefdaa6d3ce446c2">NavEKF::varInnovVelPos</a></div><div class="ttdeci">Vector6 varInnovVelPos</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00578">AP_NavEKF.h:578</a></div></div>
<div class="ttc" id="classNavEKF_html_a2d3826764619f06308d9390eb798b7c2"><div class="ttname"><a href="classNavEKF.html#a2d3826764619f06308d9390eb798b7c2">NavEKF::_magInnovGate</a></div><div class="ttdeci">AP_Int8 _magInnovGate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00480">AP_NavEKF.h:480</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_ac71cff0813716c587ac8703c30c0b234"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#ac71cff0813716c587ac8703c30c0b234">NavEKF::state_elements::earth_magfield</a></div><div class="ttdeci">Vector3f earth_magfield</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00276">AP_NavEKF.h:276</a></div></div>
<div class="ttc" id="AP__Math__AVR__Compat_8h_html_acc171f0e087ed26abd701c827944a43b"><div class="ttname"><a href="AP__Math__AVR__Compat_8h.html#acc171f0e087ed26abd701c827944a43b">cosf</a></div><div class="ttdeci">#define cosf</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math__AVR__Compat_8h_source.html#l00010">AP_Math_AVR_Compat.h:10</a></div></div>
<div class="ttc" id="classNavEKF_html_af4f4d6647b1e7882dc009af5b475761b"><div class="ttname"><a href="classNavEKF.html#af4f4d6647b1e7882dc009af5b475761b">NavEKF::FuseAirspeed</a></div><div class="ttdeci">void FuseAirspeed()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03151">AP_NavEKF.cpp:3151</a></div></div>
<div class="ttc" id="classAP__AHRS_html_adf808841de62499bc8c388fc798d47f1"><div class="ttname"><a href="classAP__AHRS.html#adf808841de62499bc8c388fc798d47f1">AP_AHRS::get_compass</a></div><div class="ttdeci">const Compass * get_compass() const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00142">AP_AHRS.h:142</a></div></div>
<div class="ttc" id="classNavEKF_html_a02ca7503660ded3d95abce7c81d2eebf"><div class="ttname"><a href="classNavEKF.html#a02ca7503660ded3d95abce7c81d2eebf">NavEKF::SetFlightAndFusionModes</a></div><div class="ttdeci">void SetFlightAndFusionModes()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03849">AP_NavEKF.cpp:3849</a></div></div>
<div class="ttc" id="classNavEKF_html_a91042776d706028291bd771fc20bfc7c"><div class="ttname"><a href="classNavEKF.html#a91042776d706028291bd771fc20bfc7c">NavEKF::magFusePerformed</a></div><div class="ttdeci">bool magFusePerformed</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00598">AP_NavEKF.h:598</a></div></div>
<div class="ttc" id="classNavEKF_html_ab9f414948d3220b44f9737db742a6c6c"><div class="ttname"><a href="classNavEKF.html#ab9f414948d3220b44f9737db742a6c6c">NavEKF::ve</a></div><div class="ttdeci">ftype ve</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00769">AP_NavEKF.h:769</a></div></div>
<div class="ttc" id="classNavEKF_html_ae409812bda25d41cf485da8a133c8cf7"><div class="ttname"><a href="classNavEKF.html#ae409812bda25d41cf485da8a133c8cf7">NavEKF::dVelIMU1</a></div><div class="ttdeci">Vector3f dVelIMU1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00566">AP_NavEKF.h:566</a></div></div>
<div class="ttc" id="classNavEKF_html_a442aeaf3f7b83e2be7f737ac81486c65"><div class="ttname"><a href="classNavEKF.html#a442aeaf3f7b83e2be7f737ac81486c65">NavEKF::calcGpsGoodToAlign</a></div><div class="ttdeci">bool calcGpsGoodToAlign(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05037">AP_NavEKF.cpp:5037</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a35f98cf767c5126fc81118a1d8c05480"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a35f98cf767c5126fc81118a1d8c05480">GLITCH_ACCEL_DEFAULT</a></div><div class="ttdeci">#define GLITCH_ACCEL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00091">AP_NavEKF.cpp:91</a></div></div>
<div class="ttc" id="classNavEKF_html_ac046341898f80930a42b4827c2c66f98"><div class="ttname"><a href="classNavEKF.html#ac046341898f80930a42b4827c2c66f98">NavEKF::auxFlowObsInnov</a></div><div class="ttdeci">float auxFlowObsInnov</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00691">AP_NavEKF.h:691</a></div></div>
<div class="ttc" id="classNavEKF_html_a8213661ff081f3e15cbf7293e744fa84"><div class="ttname"><a href="classNavEKF.html#a8213661ff081f3e15cbf7293e744fa84">NavEKF::tasRetryTime</a></div><div class="ttdeci">const uint16_t tasRetryTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00506">AP_NavEKF.h:506</a></div></div>
<div class="ttc" id="classNavEKF_html_ae04d7990ade9e35561c1cb3759267196"><div class="ttname"><a href="classNavEKF.html#ae04d7990ade9e35561c1cb3759267196">NavEKF::gndHgtValidTime_ms</a></div><div class="ttdeci">uint32_t gndHgtValidTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00699">AP_NavEKF.h:699</a></div></div>
<div class="ttc" id="classNavEKF_html_a0d9b31463df9a078cd1c362a99977a2c"><div class="ttname"><a href="classNavEKF.html#a0d9b31463df9a078cd1c362a99977a2c">NavEKF::omegaAcrossFlowTime</a></div><div class="ttdeci">Vector3f omegaAcrossFlowTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00700">AP_NavEKF.h:700</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a6d9d60005c3b44698c855beacdaaa49e"><div class="ttname"><a href="calcH__MAG_8c.html#a6d9d60005c3b44698c855beacdaaa49e">t16</a></div><div class="ttdeci">t16</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00015">calcH_MAG.c:15</a></div></div>
<div class="ttc" id="structVector2_html_ad8ebafde96f43521d3647e2552387529"><div class="ttname"><a href="structVector2.html#ad8ebafde96f43521d3647e2552387529">Vector2::length</a></div><div class="ttdeci">float length(void) const </div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="vector2_8cpp_source.html#l00023">vector2.cpp:23</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a4a085e3ddf0ce92ba727e3ba78650c34"><div class="ttname"><a href="unionnav__filter__status.html#a4a085e3ddf0ce92ba727e3ba78650c34">nav_filter_status::horiz_pos_abs</a></div><div class="ttdeci">uint16_t horiz_pos_abs</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00028">AP_Nav_Common.h:28</a></div></div>
<div class="ttc" id="classNavEKF_html_adf4a1897b5d669e0b0403926993204ff"><div class="ttname"><a href="classNavEKF.html#adf4a1897b5d669e0b0403926993204ff">NavEKF::_tasInnovGate</a></div><div class="ttdeci">AP_Int8 _tasInnovGate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00481">AP_NavEKF.h:481</a></div></div>
<div class="ttc" id="classNavEKF_html_a2ec06af3983c88d06a68e58f9df1d24f"><div class="ttname"><a href="classNavEKF.html#a2ec06af3983c88d06a68e58f9df1d24f">NavEKF::flowRadXY</a></div><div class="ttdeci">Vector2 flowRadXY</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00694">AP_NavEKF.h:694</a></div></div>
<div class="ttc" id="classMatrix3_html_af6fb286af49f43844ba70cbb80ab2db7"><div class="ttname"><a href="classMatrix3.html#af6fb286af49f43844ba70cbb80ab2db7">Matrix3::rotateXYinv</a></div><div class="ttdeci">void rotateXYinv(const Vector3&lt; T &gt; &amp;g)</div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8cpp_source.html#l00102">matrix3.cpp:102</a></div></div>
<div class="ttc" id="classNavEKF_html_aedc86985a1237d4a4a5c68be1a6bc7c4"><div class="ttname"><a href="classNavEKF.html#aedc86985a1237d4a4a5c68be1a6bc7c4">NavEKF::_gpsHorizPosNoise</a></div><div class="ttdeci">AP_Float _gpsHorizPosNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00462">AP_NavEKF.h:462</a></div></div>
<div class="ttc" id="classNavEKF_html_a575fac67ea0188de47ee6ac5c2217f32"><div class="ttname"><a href="classNavEKF.html#a575fac67ea0188de47ee6ac5c2217f32">NavEKF::_msecPosDelay</a></div><div class="ttdeci">AP_Int16 _msecPosDelay</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00475">AP_NavEKF.h:475</a></div></div>
<div class="ttc" id="classAP__Airspeed_html_a6162295b433e3a863c0d4b9086b19014"><div class="ttname"><a href="classAP__Airspeed.html#a6162295b433e3a863c0d4b9086b19014">AP_Airspeed::use</a></div><div class="ttdeci">bool use(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Airspeed_8h_source.html#l00098">AP_Airspeed.h:98</a></div></div>
<div class="ttc" id="classNavEKF_html_a7f7509df021d3c16069d7db511133085"><div class="ttname"><a href="classNavEKF.html#a7f7509df021d3c16069d7db511133085">NavEKF::PV_AidingMode</a></div><div class="ttdeci">AidingMode PV_AidingMode</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00733">AP_NavEKF.h:733</a></div></div>
<div class="ttc" id="classNavEKF_html_a0da603890fb973ad3d5b83495a806dc3"><div class="ttname"><a href="classNavEKF.html#a0da603890fb973ad3d5b83495a806dc3">NavEKF::gpsNotAvailable</a></div><div class="ttdeci">bool gpsNotAvailable</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00657">AP_NavEKF.h:657</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_ab31e784050f8ae27dacd42839540e397"><div class="ttname"><a href="calcH__MAG_8c.html#ab31e784050f8ae27dacd42839540e397">t24</a></div><div class="ttdeci">t24</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00024">calcH_MAG.c:24</a></div></div>
<div class="ttc" id="classNavEKF_html_ac74736f59142532bc1b1e605859dc23c"><div class="ttname"><a href="classNavEKF.html#ac74736f59142532bc1b1e605859dc23c">NavEKF::expectGndEffectTakeoff</a></div><div class="ttdeci">bool expectGndEffectTakeoff</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00751">AP_NavEKF.h:751</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a7e9afc57ac1aa35adca7d8bf870fbb4c"><div class="ttname"><a href="classAP__InertialSensor.html#a7e9afc57ac1aa35adca7d8bf870fbb4c">AP_InertialSensor::get_sample_rate</a></div><div class="ttdeci">Sample_rate get_sample_rate(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00196">AP_InertialSensor.h:196</a></div></div>
<div class="ttc" id="classMatrix3_html_a18e2df03dec4abdf11fc9fb60ed7c226"><div class="ttname"><a href="classMatrix3.html#a18e2df03dec4abdf11fc9fb60ed7c226">Matrix3::transposed</a></div><div class="ttdeci">Matrix3&lt; T &gt; transposed(void) const </div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8cpp_source.html#l00176">matrix3.cpp:176</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfa24046586de895f91705fdd782b62fab3"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa24046586de895f91705fdd782b62fab3">EKF_POS_VERT_AGL</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00341">ardupilotmega.h:341</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a81e13a370d69eb740c8e4d60ba00652b"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a81e13a370d69eb740c8e4d60ba00652b">FLOW_MEAS_DELAY</a></div><div class="ttdeci">#define FLOW_MEAS_DELAY</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00093">AP_NavEKF.cpp:93</a></div></div>
<div class="ttc" id="classNavEKF_html_ae764a797b10e2b64075baa305f43e089"><div class="ttname"><a href="classNavEKF.html#ae764a797b10e2b64075baa305f43e089">NavEKF::innovOptFlow</a></div><div class="ttdeci">Vector2 innovOptFlow</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00704">AP_NavEKF.h:704</a></div></div>
<div class="ttc" id="classNavEKF_html_a6931a7d21e31405f2f50b672daa82218"><div class="ttname"><a href="classNavEKF.html#a6931a7d21e31405f2f50b672daa82218">NavEKF::pd</a></div><div class="ttdeci">ftype pd</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00771">AP_NavEKF.h:771</a></div></div>
<div class="ttc" id="classNavEKF_html_a1562d00a2d13f627800c9c4d40148c44"><div class="ttname"><a href="classNavEKF.html#a1562d00a2d13f627800c9c4d40148c44">NavEKF::innovVelPos</a></div><div class="ttdeci">Vector6 innovVelPos</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00577">AP_NavEKF.h:577</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a8ce5f52ee45362cd73431e43eafd7ebb"><div class="ttname"><a href="calcH__MAG_8c.html#a8ce5f52ee45362cd73431e43eafd7ebb">t28</a></div><div class="ttdeci">t28</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00029">calcH_MAG.c:29</a></div></div>
<div class="ttc" id="classNavEKF_html_ac67dfe022dbb4c390fdefa3f60d6a6d8"><div class="ttname"><a href="classNavEKF.html#ac67dfe022dbb4c390fdefa3f60d6a6d8">NavEKF::getEkfControlLimits</a></div><div class="ttdeci">void getEkfControlLimits(float &amp;ekfGndSpdLimit, float &amp;ekfNavVelGainScaler) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03714">AP_NavEKF.cpp:3714</a></div></div>
<div class="ttc" id="classNavEKF_html_a58d3c9694abab421e8eadd78e72ac67c"><div class="ttname"><a href="classNavEKF.html#a58d3c9694abab421e8eadd78e72ac67c">NavEKF::UpdateFilter</a></div><div class="ttdeci">void UpdateFilter(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00675">AP_NavEKF.cpp:675</a></div></div>
<div class="ttc" id="AHRS__Test_8pde_html_a0a15280249072432f8c559cc00d09dee"><div class="ttname"><a href="AHRS__Test_8pde.html#a0a15280249072432f8c559cc00d09dee">ahrs</a></div><div class="ttdeci">AP_AHRS_DCM ahrs(ins, baro, gps)</div></div>
<div class="ttc" id="classAP__InertialSensor_html_ad22e8ed9b13a093d5cf3a2a420522b3b"><div class="ttname"><a href="classAP__InertialSensor.html#ad22e8ed9b13a093d5cf3a2a420522b3b">AP_InertialSensor::get_delta_velocity_dt</a></div><div class="ttdeci">float get_delta_velocity_dt(uint8_t i) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00130">AP_InertialSensor.h:130</a></div></div>
<div class="ttc" id="classNavEKF_html_a70ffb5c65a0c2501b84e3d803ddca789"><div class="ttname"><a href="classNavEKF.html#a70ffb5c65a0c2501b84e3d803ddca789">NavEKF::onGround</a></div><div class="ttdeci">bool onGround</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00573">AP_NavEKF.h:573</a></div></div>
<div class="ttc" id="classNavEKF_html_ac2cc3ec695c82693577b72655f675aa9"><div class="ttname"><a href="classNavEKF.html#ac2cc3ec695c82693577b72655f675aa9">NavEKF::getAccelZBias</a></div><div class="ttdeci">void getAccelZBias(float &amp;zbias1, float &amp;zbias2) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03734">AP_NavEKF.cpp:3734</a></div></div>
<div class="ttc" id="classNavEKF_html_a74882eb98d3c69065b640829154a500c"><div class="ttname"><a href="classNavEKF.html#a74882eb98d3c69065b640829154a500c">NavEKF::FuseVelPosNED</a></div><div class="ttdeci">void FuseVelPosNED()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l01876">AP_NavEKF.cpp:1876</a></div></div>
<div class="ttc" id="classNavEKF_html_a3108596d21f107f9b35517900bb82569"><div class="ttname"><a href="classNavEKF.html#a3108596d21f107f9b35517900bb82569">NavEKF::getTakeoffExpected</a></div><div class="ttdeci">bool getTakeoffExpected()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04998">AP_NavEKF.cpp:4998</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a2aa61744614d8e0ef64803583359a56e"><div class="ttname"><a href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">AP_AHRS::pitch</a></div><div class="ttdeci">float pitch</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00198">AP_AHRS.h:198</a></div></div>
<div class="ttc" id="classNavEKF_html_aa996a851e3fdcf1d8e5566667d7a7849"><div class="ttname"><a href="classNavEKF.html#aa996a851e3fdcf1d8e5566667d7a7849">NavEKF::msecFlowAvg</a></div><div class="ttdeci">const uint16_t msecFlowAvg</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00516">AP_NavEKF.h:516</a></div></div>
<div class="ttc" id="classNavEKF_html_a6a04a684cec578f919586066d0784103"><div class="ttname"><a href="classNavEKF.html#a6a04a684cec578f919586066d0784103">NavEKF::getRotationBodyToNED</a></div><div class="ttdeci">void getRotationBodyToNED(Matrix3f &amp;mat) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04500">AP_NavEKF.cpp:4500</a></div></div>
<div class="ttc" id="classNavEKF_html_a55191b30bb5eefa6d7a1aa140454b686"><div class="ttname"><a href="classNavEKF.html#a55191b30bb5eefa6d7a1aa140454b686">NavEKF::setTakeoffExpected</a></div><div class="ttdeci">void setTakeoffExpected(bool val)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05009">AP_NavEKF.cpp:5009</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfa1349810940e959ebefef1429ed8e8ce6"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa1349810940e959ebefef1429ed8e8ce6">EKF_POS_HORIZ_ABS</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00339">ardupilotmega.h:339</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a9337a60383f4264fa96a20dbe43a4e2e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">AP_HAL::HAL::util</a></div><div class="ttdeci">AP_HAL::Util * util</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00066">HAL.h:66</a></div></div>
<div class="ttc" id="classNavEKF_html_abc4672f6de40482dd1aeffbb38bd7d50"><div class="ttname"><a href="classNavEKF.html#abc4672f6de40482dd1aeffbb38bd7d50">NavEKF::setOriginLLH</a></div><div class="ttdeci">bool setOriginLLH(struct Location &amp;loc)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04987">AP_NavEKF.cpp:4987</a></div></div>
<div class="ttc" id="classNavEKF_html_a33123d9b5a1a7551b2c0a7c1addea560"><div class="ttname"><a href="classNavEKF.html#a33123d9b5a1a7551b2c0a7c1addea560">NavEKF::gpsNoiseScaler</a></div><div class="ttdeci">float gpsNoiseScaler</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00547">AP_NavEKF.h:547</a></div></div>
<div class="ttc" id="classMatrix3_html"><div class="ttname"><a href="classMatrix3.html">Matrix3&lt; float &gt;</a></div></div>
<div class="ttc" id="classMatrix3_html_a62587bd216436f09f06b9e1330f84bc0"><div class="ttname"><a href="classMatrix3.html#a62587bd216436f09f06b9e1330f84bc0">Matrix3::from_euler</a></div><div class="ttdeci">void from_euler(float roll, float pitch, float yaw)</div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8cpp_source.html#l00025">matrix3.cpp:25</a></div></div>
<div class="ttc" id="classNavEKF_html_a9e4b654c4ec8d92216e8f4b8f8a8d88d"><div class="ttname"><a href="classNavEKF.html#a9e4b654c4ec8d92216e8f4b8f8a8d88d">NavEKF::inhibitMagStates</a></div><div class="ttdeci">bool inhibitMagStates</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00651">AP_NavEKF.h:651</a></div></div>
<div class="ttc" id="classNavEKF_html_ae388459b6238501b7689d371cba355fc"><div class="ttname"><a href="classNavEKF.html#ae388459b6238501b7689d371cba355fc">NavEKF::_magNoise</a></div><div class="ttdeci">AP_Float _magNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00464">AP_NavEKF.h:464</a></div></div>
<div class="ttc" id="classNavEKF_html_a54c8e23d28fe48b55b75861eb4427499"><div class="ttname"><a href="classNavEKF.html#a54c8e23d28fe48b55b75861eb4427499">NavEKF::statesAtFlowTime</a></div><div class="ttdeci">state_elements statesAtFlowTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00689">AP_NavEKF.h:689</a></div></div>
<div class="ttc" id="classAP__GPS_html_a8b36acdc5098b3f77e28ec640b438fbd"><div class="ttname"><a href="classAP__GPS.html#a8b36acdc5098b3f77e28ec640b438fbd">AP_GPS::velocity</a></div><div class="ttdeci">const Vector3f &amp; velocity(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00220">AP_GPS.h:220</a></div></div>
<div class="ttc" id="classAP__AHRS_html"><div class="ttname"><a href="classAP__AHRS.html">AP_AHRS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00061">AP_AHRS.h:61</a></div></div>
<div class="ttc" id="classNavEKF_html_add08a20902184b616da1e9f79efcbc5f"><div class="ttname"><a href="classNavEKF.html#add08a20902184b616da1e9f79efcbc5f">NavEKF::getMagXYZ</a></div><div class="ttdeci">void getMagXYZ(Vector3f &amp;magXYZ) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03759">AP_NavEKF.cpp:3759</a></div></div>
<div class="ttc" id="classNavEKF_html_a08de10f525ebfa894304c1fe3f8cf521"><div class="ttname"><a href="classNavEKF.html#a08de10f525ebfa894304c1fe3f8cf521">NavEKF::airborneDetectTime_ms</a></div><div class="ttdeci">uint32_t airborneDetectTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00576">AP_NavEKF.h:576</a></div></div>
<div class="ttc" id="classNavEKF_html_a640b3c5ebf5371325d670668a6c2557e"><div class="ttname"><a href="classNavEKF.html#a640b3c5ebf5371325d670668a6c2557e">NavEKF::lastStateStoreTime_ms</a></div><div class="ttdeci">uint32_t lastStateStoreTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00625">AP_NavEKF.h:625</a></div></div>
<div class="ttc" id="classQuaternion_html_aff2d2d3d1c5937523df8357deae4eeab"><div class="ttname"><a href="classQuaternion.html#aff2d2d3d1c5937523df8357deae4eeab">Quaternion::from_euler</a></div><div class="ttdeci">void from_euler(float roll, float pitch, float yaw)</div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8cpp_source.html#l00103">quaternion.cpp:103</a></div></div>
<div class="ttc" id="classNavEKF_html_a6d64ec17dcec8b8c486857bd4fb3b54c"><div class="ttname"><a href="classNavEKF.html#a6d64ec17dcec8b8c486857bd4fb3b54c">NavEKF::setWindVelStates</a></div><div class="ttdeci">void setWindVelStates()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04483">AP_NavEKF.cpp:4483</a></div></div>
<div class="ttc" id="classNavEKF_html_adc7afbf3588484b2d90720aed871ca97"><div class="ttname"><a href="classNavEKF.html#adc7afbf3588484b2d90720aed871ca97">NavEKF::ftype</a></div><div class="ttdeci">float ftype</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00048">AP_NavEKF.h:48</a></div></div>
<div class="ttc" id="classNavEKF_html_acb20ad8ad982539dcb608533b0fe77d0"><div class="ttname"><a href="classNavEKF.html#acb20ad8ad982539dcb608533b0fe77d0">NavEKF::ResetVelocity</a></div><div class="ttdeci">void ResetVelocity(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00478">AP_NavEKF.cpp:478</a></div></div>
<div class="ttc" id="classNavEKF_html_a0ece2c48f78d3496d10b1476f89125b1"><div class="ttname"><a href="classNavEKF.html#a0ece2c48f78d3496d10b1476f89125b1">NavEKF::msecGpsAvg</a></div><div class="ttdeci">const uint16_t msecGpsAvg</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00511">AP_NavEKF.h:511</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a2e82ec5ae0f44ff0e9e944e354b17eb3"><div class="ttname"><a href="classAP__AHRS.html#a2e82ec5ae0f44ff0e9e944e354b17eb3">AP_AHRS::get_airspeed</a></div><div class="ttdeci">const AP_Airspeed * get_airspeed(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00167">AP_AHRS.h:167</a></div></div>
<div class="ttc" id="classNavEKF_html_aa7a1c636e5f17f79265bab234dfac5c9"><div class="ttname"><a href="classNavEKF.html#aa7a1c636e5f17f79265bab234dfac5c9">NavEKF::varInnovRng</a></div><div class="ttdeci">float varInnovRng</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00711">AP_NavEKF.h:711</a></div></div>
<div class="ttc" id="classNavEKF_html_a69ee0fc8083369854d0df69078454a67"><div class="ttname"><a href="classNavEKF.html#a69ee0fc8083369854d0df69078454a67">NavEKF::SH_MAG</a></div><div class="ttdeci">Vector9 SH_MAG</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00801">AP_NavEKF.h:801</a></div></div>
<div class="ttc" id="classAP__GPS_html_af74c8da8ab7394a33b0f0e64582d8648"><div class="ttname"><a href="classAP__GPS.html#af74c8da8ab7394a33b0f0e64582d8648">AP_GPS::num_sats</a></div><div class="ttdeci">uint8_t num_sats(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00249">AP_GPS.h:249</a></div></div>
<div class="ttc" id="classNavEKF_html_afc0e131151cc5d4c9ce26621b5427152"><div class="ttname"><a href="classNavEKF.html#afc0e131151cc5d4c9ce26621b5427152">NavEKF::gpsFailTimeWithFlow</a></div><div class="ttdeci">const uint16_t gpsFailTimeWithFlow</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00503">AP_NavEKF.h:503</a></div></div>
<div class="ttc" id="classNavEKF_html_aec95d8fd1ddeb0c6eff1b185ff00b94d"><div class="ttname"><a href="classNavEKF.html#aec95d8fd1ddeb0c6eff1b185ff00b94d">NavEKF::meaHgtAtTakeOff</a></div><div class="ttdeci">float meaHgtAtTakeOff</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00755">AP_NavEKF.h:755</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a2fdcb4700d008878e906cf0c775f514d"><div class="ttname"><a href="unionnav__filter__status.html#a2fdcb4700d008878e906cf0c775f514d">nav_filter_status::vert_vel</a></div><div class="ttdeci">uint16_t vert_vel</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00026">AP_Nav_Common.h:26</a></div></div>
<div class="ttc" id="classNavEKF_html_a68eb1a5117369ac8f7ceb677d42758ce"><div class="ttname"><a href="classNavEKF.html#a68eb1a5117369ac8f7ceb677d42758ce">NavEKF::_gyrNoise</a></div><div class="ttdeci">AP_Float _gyrNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00470">AP_NavEKF.h:470</a></div></div>
<div class="ttc" id="classNavEKF_html_adf35d8ce1fae088bf19de6c0b8d9fc26"><div class="ttname"><a href="classNavEKF.html#adf35d8ce1fae088bf19de6c0b8d9fc26">NavEKF::losPred</a></div><div class="ttdeci">Vector2 losPred</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00772">AP_NavEKF.h:772</a></div></div>
<div class="ttc" id="classNavEKF_html_a1056d50a16aea29e1fab99e3d4a1c61c"><div class="ttname"><a href="classNavEKF.html#a1056d50a16aea29e1fab99e3d4a1c61c">NavEKF::secondMagYawInit</a></div><div class="ttdeci">bool secondMagYawInit</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00654">AP_NavEKF.h:654</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a91a73986f61cc338a22047e34230cbb2"><div class="ttname"><a href="classAP__AHRS.html#a91a73986f61cc338a22047e34230cbb2">AP_AHRS::get_vehicle_class</a></div><div class="ttdeci">AHRS_VehicleClass get_vehicle_class(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00125">AP_AHRS.h:125</a></div></div>
<div class="ttc" id="classNavEKF_html_a74e1debc46998128deb7ba6a77e75f29"><div class="ttname"><a href="classNavEKF.html#a74e1debc46998128deb7ba6a77e75f29">NavEKF::_baroAltNoise</a></div><div class="ttdeci">AP_Float _baroAltNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00463">AP_NavEKF.h:463</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_af8487399e0f3543a8a70146223f8412e"><div class="ttname"><a href="AP__NavEKF_8cpp.html#af8487399e0f3543a8a70146223f8412e">VELD_NOISE_DEFAULT</a></div><div class="ttdeci">#define VELD_NOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00076">AP_NavEKF.cpp:76</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a7091792f55b39778157617b5e38e6075"><div class="ttname"><a href="classAP__InertialSensor.html#a7091792f55b39778157617b5e38e6075">AP_InertialSensor::get_delta_time</a></div><div class="ttdeci">float get_delta_time() const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00175">AP_InertialSensor.h:175</a></div></div>
<div class="ttc" id="classNavEKF_html_a8bf0c9a0bbc43bcd399261e54af1b662"><div class="ttname"><a href="classNavEKF.html#a8bf0c9a0bbc43bcd399261e54af1b662">NavEKF::Vector13</a></div><div class="ttdeci">ftype Vector13[13]</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00079">AP_NavEKF.h:79</a></div></div>
<div class="ttc" id="classNavEKF_html_a63ede7463be667d9ac34509ea5414a2d"><div class="ttname"><a href="classNavEKF.html#a63ede7463be667d9ac34509ea5414a2d">NavEKF::magUpdateCount</a></div><div class="ttdeci">uint8_t magUpdateCount</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00681">AP_NavEKF.h:681</a></div></div>
<div class="ttc" id="classNavEKF_html_aa157548e084fc3aef403b4bebd53a5ed"><div class="ttname"><a href="classNavEKF.html#aa157548e084fc3aef403b4bebd53a5ed">NavEKF::R_LOS</a></div><div class="ttdeci">float R_LOS</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00718">AP_NavEKF.h:718</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a892ea9ef8352f64c8fc3e4fd4ded1bca"><div class="ttname"><a href="calcH__MAG_8c.html#a892ea9ef8352f64c8fc3e4fd4ded1bca">t31</a></div><div class="ttdeci">t31</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00026">calcH_MAG.c:26</a></div></div>
<div class="ttc" id="classNavEKF_html_a7ca27f8c85733769ea4bfdb723dab655"><div class="ttname"><a href="classNavEKF.html#a7ca27f8c85733769ea4bfdb723dab655">NavEKF::_accelBiasProcessNoise</a></div><div class="ttdeci">AP_Float _accelBiasProcessNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00473">AP_NavEKF.h:473</a></div></div>
<div class="ttc" id="classNavEKF_html_a22aad7c0baf696cae27135ecaa4f2f58"><div class="ttname"><a href="classNavEKF.html#a22aad7c0baf696cae27135ecaa4f2f58">NavEKF::alignMagStateDeclination</a></div><div class="ttdeci">void alignMagStateDeclination()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05190">AP_NavEKF.cpp:5190</a></div></div>
<div class="ttc" id="classNavEKF_html_a65d15fe2ebf0c1e1c47375e575ccd36e"><div class="ttname"><a href="classNavEKF.html#a65d15fe2ebf0c1e1c47375e575ccd36e">NavEKF::rangeAtArming</a></div><div class="ttdeci">float rangeAtArming</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00743">AP_NavEKF.h:743</a></div></div>
<div class="ttc" id="classNavEKF_html_a43274582141957bdf6bc75ad1c2c4a9d"><div class="ttname"><a href="classNavEKF.html#a43274582141957bdf6bc75ad1c2c4a9d">NavEKF::newDataRng</a></div><div class="ttdeci">bool newDataRng</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00725">AP_NavEKF.h:725</a></div></div>
<div class="ttc" id="classNavEKF_html_ad0cb4a84962425485592d3e1d1727471"><div class="ttname"><a href="classNavEKF.html#ad0cb4a84962425485592d3e1d1727471">NavEKF::_easNoise</a></div><div class="ttdeci">AP_Float _easNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00465">AP_NavEKF.h:465</a></div></div>
<div class="ttc" id="classNavEKF_html_aeb78f45ab039841cda67736a597c2c5f"><div class="ttname"><a href="classNavEKF.html#aeb78f45ab039841cda67736a597c2c5f">NavEKF::lastAccel1</a></div><div class="ttdeci">Vector3f lastAccel1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00632">AP_NavEKF.h:632</a></div></div>
<div class="ttc" id="classRangeFinder_html_a52afaa97928556f60fe968ee9a6ce429"><div class="ttname"><a href="classRangeFinder.html#a52afaa97928556f60fe968ee9a6ce429">RangeFinder::max_distance_cm</a></div><div class="ttdeci">int16_t max_distance_cm(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="RangeFinder_8h_source.html#l00126">RangeFinder.h:126</a></div></div>
<div class="ttc" id="classNavEKF_html_aac9fc945bc68d4140eccf78d4ab295dc"><div class="ttname"><a href="classNavEKF.html#aac9fc945bc68d4140eccf78d4ab295dc">NavEKF::_msecFLowDelay</a></div><div class="ttdeci">AP_Int8 _msecFLowDelay</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00488">AP_NavEKF.h:488</a></div></div>
<div class="ttc" id="classNavEKF_html_a6e4286ed524605696e8f76bba0a27c97"><div class="ttname"><a href="classNavEKF.html#a6e4286ed524605696e8f76bba0a27c97">NavEKF::storeIndex</a></div><div class="ttdeci">uint8_t storeIndex</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00624">AP_NavEKF.h:624</a></div></div>
<div class="ttc" id="classNavEKF_html_aaef60d20b82acb3930c5866abe3977b4"><div class="ttname"><a href="classNavEKF.html#aaef60d20b82acb3930c5866abe3977b4">NavEKF::zeroRows</a></div><div class="ttdeci">void zeroRows(Matrix22 &amp;covMat, uint8_t first, uint8_t last)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03507">AP_NavEKF.cpp:3507</a></div></div>
<div class="ttc" id="classNavEKF_html_a3d9d1255f042b4d19ef8611443aca6c1"><div class="ttname"><a href="classNavEKF.html#a3d9d1255f042b4d19ef8611443aca6c1">NavEKF::rngMea</a></div><div class="ttdeci">float rngMea</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00713">AP_NavEKF.h:713</a></div></div>
<div class="ttc" id="classRangeFinder_html_adea3c02123a4fbad18d7510c4718d8eda6a6a3d5d796bc66c713f11f2b633e1bb"><div class="ttname"><a href="classRangeFinder.html#adea3c02123a4fbad18d7510c4718d8eda6a6a3d5d796bc66c713f11f2b633e1bb">RangeFinder::RangeFinder_Good</a></div><div class="ttdef"><b>Definition:</b> <a href="RangeFinder_8h_source.html#l00066">RangeFinder.h:66</a></div></div>
<div class="ttc" id="classNavEKF_html_afaa81e08a98db599f139657cabd99fa7"><div class="ttname"><a href="classNavEKF.html#afaa81e08a98db599f139657cabd99fa7">NavEKF::CopyAndFixCovariances</a></div><div class="ttdeci">void CopyAndFixCovariances()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03982">AP_NavEKF.cpp:3982</a></div></div>
<div class="ttc" id="classNavEKF_html_aeed7826096e508cea10ebd858694f308"><div class="ttname"><a href="classNavEKF.html#aeed7826096e508cea10ebd858694f308">NavEKF::prevOnGround</a></div><div class="ttdeci">bool prevOnGround</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00574">AP_NavEKF.h:574</a></div></div>
<div class="ttc" id="classNavEKF_html_a0e431c75e932225df5190a5e3e9d72c9"><div class="ttname"><a href="classNavEKF.html#a0e431c75e932225df5190a5e3e9d72c9">NavEKF::magUpdateCountMax</a></div><div class="ttdeci">uint8_t magUpdateCountMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00682">AP_NavEKF.h:682</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_aff3592d4298ab52727456d4e8ce6c18b"><div class="ttname"><a href="calcH__MAG_8c.html#aff3592d4298ab52727456d4e8ce6c18b">t21</a></div><div class="ttdeci">t21</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00020">calcH_MAG.c:20</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a6120b45de751ab784fdfdd04f437b44e"><div class="ttname"><a href="classAP__AHRS.html#a6120b45de751ab784fdfdd04f437b44e">AP_AHRS::get_fly_forward</a></div><div class="ttdeci">bool get_fly_forward(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00121">AP_AHRS.h:121</a></div></div>
<div class="ttc" id="classNavEKF_html_ad47e865d8535dad43dfae2af2001b855"><div class="ttname"><a href="classNavEKF.html#ad47e865d8535dad43dfae2af2001b855">NavEKF::Tbn_flow</a></div><div class="ttdeci">Matrix3f Tbn_flow</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00702">AP_NavEKF.h:702</a></div></div>
<div class="ttc" id="classRangeFinder_html_a451a7507d534024c72faa2d1b734cb3c"><div class="ttname"><a href="classRangeFinder.html#a451a7507d534024c72faa2d1b734cb3c">RangeFinder::distance_cm</a></div><div class="ttdeci">uint16_t distance_cm(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="RangeFinder_8h_source.html#l00112">RangeFinder.h:112</a></div></div>
<div class="ttc" id="classNavEKF_html_a0de2acf7f39fb61c8dd76255933a1a8c"><div class="ttname"><a href="classNavEKF.html#a0de2acf7f39fb61c8dd76255933a1a8c">NavEKF::getIMU1Weighting</a></div><div class="ttdeci">void getIMU1Weighting(float &amp;ret) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03728">AP_NavEKF.cpp:3728</a></div></div>
<div class="ttc" id="classNavEKF_html_accf06a51694a1d842dd7b648a78c40d1"><div class="ttname"><a href="classNavEKF.html#accf06a51694a1d842dd7b648a78c40d1">NavEKF::EKF_origin</a></div><div class="ttdeci">struct Location EKF_origin</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00660">AP_NavEKF.h:660</a></div></div>
<div class="ttc" id="classAP__Airspeed_html_a9bb14f83815ed35b067dd2f4a7c1851f"><div class="ttname"><a href="classAP__Airspeed.html#a9bb14f83815ed35b067dd2f4a7c1851f">AP_Airspeed::get_EAS2TAS</a></div><div class="ttdeci">float get_EAS2TAS(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Airspeed_8h_source.html#l00139">AP_Airspeed.h:139</a></div></div>
<div class="ttc" id="classNavEKF_html_a617e88f0e357eb16d2540f25981e9ee2"><div class="ttname"><a href="classNavEKF.html#a617e88f0e357eb16d2540f25981e9ee2">NavEKF::readIMUData</a></div><div class="ttdeci">void readIMUData()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04064">AP_NavEKF.cpp:4064</a></div></div>
<div class="ttc" id="classNavEKF_html_aedabdd90e9cfdf598424e88700d94c7f"><div class="ttname"><a href="classNavEKF.html#aedabdd90e9cfdf598424e88700d94c7f">NavEKF::gndOffsetValid</a></div><div class="ttdeci">bool gndOffsetValid</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00734">AP_NavEKF.h:734</a></div></div>
<div class="ttc" id="classNavEKF_html_a91fee108e5fe9e1201be3552e8b8e9d1"><div class="ttname"><a href="classNavEKF.html#a91fee108e5fe9e1201be3552e8b8e9d1">NavEKF::auxFlowTestRatio</a></div><div class="ttdeci">float auxFlowTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00717">AP_NavEKF.h:717</a></div></div>
<div class="ttc" id="classNavEKF_html_ad8f659aaf64d57f01bfe8a677c15aa2f"><div class="ttname"><a href="classNavEKF.html#ad8f659aaf64d57f01bfe8a677c15aa2f">NavEKF::R_MAG</a></div><div class="ttdeci">ftype R_MAG</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00800">AP_NavEKF.h:800</a></div></div>
<div class="ttc" id="classNavEKF_html_a6639cde71ecf7957ff403ec84d155ee6"><div class="ttname"><a href="classNavEKF.html#a6639cde71ecf7957ff403ec84d155ee6">NavEKF::posTimeout</a></div><div class="ttdeci">bool posTimeout</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00540">AP_NavEKF.h:540</a></div></div>
<div class="ttc" id="classNavEKF_html_a8a8acb912e7080ae297d6689d4f0273e"><div class="ttname"><a href="classNavEKF.html#a8a8acb912e7080ae297d6689d4f0273e">NavEKF::IMU1_weighting</a></div><div class="ttdeci">float IMU1_weighting</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00640">AP_NavEKF.h:640</a></div></div>
<div class="ttc" id="structLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdoc">param 3 - Lattitude * 10**7 </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00115">AP_Common.h:115</a></div></div>
<div class="ttc" id="classNavEKF_html_acfd49b998168fc32e4a9932aa5b8155d"><div class="ttname"><a href="classNavEKF.html#acfd49b998168fc32e4a9932aa5b8155d">NavEKF::state</a></div><div class="ttdeci">struct NavEKF::state_elements &amp; state</div></div>
<div class="ttc" id="classNavEKF_html_adbbffcb5c98c13ab6b1cef9ead571451"><div class="ttname"><a href="classNavEKF.html#adbbffcb5c98c13ab6b1cef9ead571451">NavEKF::setInhibitGPS</a></div><div class="ttdeci">uint8_t setInhibitGPS(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03699">AP_NavEKF.cpp:3699</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a603be3532744d28bc5914786120e73a1"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a603be3532744d28bc5914786120e73a1">GYRO_PNOISE_DEFAULT</a></div><div class="ttdeci">#define GYRO_PNOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00080">AP_NavEKF.cpp:80</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a15e3c6f8792afd1e6a582076fcc7140d"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a15e3c6f8792afd1e6a582076fcc7140d">NavEKF::state_elements::vel1</a></div><div class="ttdeci">Vector3f vel1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00279">AP_NavEKF.h:279</a></div></div>
<div class="ttc" id="classNavEKF_html_a58487ff745a90aad44ac05d69dd8809f"><div class="ttname"><a href="classNavEKF.html#a58487ff745a90aad44ac05d69dd8809f">NavEKF::expectGndEffectTouchdown</a></div><div class="ttdeci">bool expectGndEffectTouchdown</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00753">AP_NavEKF.h:753</a></div></div>
<div class="ttc" id="classNavEKF_html_a4b96227e0553b69fa0882d3adc0a2877"><div class="ttname"><a href="classNavEKF.html#a4b96227e0553b69fa0882d3adc0a2877">NavEKF::innovMag</a></div><div class="ttdeci">Vector3f innovMag</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00588">AP_NavEKF.h:588</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfa6c49a156c90fb77ea446da33bd95432a"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa6c49a156c90fb77ea446da33bd95432a">EKF_ATTITUDE</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00335">ardupilotmega.h:335</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a0af10efa16501307c43edf7edd800b7d"><div class="ttname"><a href="unionnav__filter__status.html#a0af10efa16501307c43edf7edd800b7d">nav_filter_status::flags</a></div><div class="ttdeci">struct nav_filter_status::@30 flags</div></div>
<div class="ttc" id="classNavEKF_html_a05d37541115785503db786986b1ee0aa"><div class="ttname"><a href="classNavEKF.html#a05d37541115785503db786986b1ee0aa">NavEKF::statesAtVelTime</a></div><div class="ttdeci">state_elements statesAtVelTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00585">AP_NavEKF.h:585</a></div></div>
<div class="ttc" id="classNavEKF_html_a770d6516e6b4e7a2fb3ba5a81dda54d6"><div class="ttname"><a href="classNavEKF.html#a770d6516e6b4e7a2fb3ba5a81dda54d6">NavEKF::dtVelPos</a></div><div class="ttdeci">const float dtVelPos</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00517">AP_NavEKF.h:517</a></div></div>
<div class="ttc" id="classNavEKF_html_a1fff68de02d811e590b09385a9427e58"><div class="ttname"><a href="classNavEKF.html#a1fff68de02d811e590b09385a9427e58">NavEKF::prevFlowFuseTime_ms</a></div><div class="ttdeci">uint32_t prevFlowFuseTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00715">AP_NavEKF.h:715</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac7d2e0692095207a6ff19072dcac9ef6"><div class="ttname"><a href="classAP__GPS.html#ac7d2e0692095207a6ff19072dcac9ef6">AP_GPS::have_vertical_velocity</a></div><div class="ttdeci">bool have_vertical_velocity(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00305">AP_GPS.h:305</a></div></div>
<div class="ttc" id="classNavEKF_html_ac3076a532180b538dd17e6eea4751130"><div class="ttname"><a href="classNavEKF.html#ac3076a532180b538dd17e6eea4751130">NavEKF::statesAtMagMeasTime</a></div><div class="ttdeci">state_elements statesAtMagMeasTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00591">AP_NavEKF.h:591</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae23d76fc05fafc83e57d0c6a620b1567"><div class="ttname"><a href="classAP__GPS.html#ae23d76fc05fafc83e57d0c6a620b1567">AP_GPS::speed_accuracy</a></div><div class="ttdeci">bool speed_accuracy(uint8_t instance, float &amp;sacc) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00183">AP_GPS.h:183</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a41462b3552d510da7e227643d634eedb"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a41462b3552d510da7e227643d634eedb">MAG_NOISE_DEFAULT</a></div><div class="ttdeci">#define MAG_NOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00079">AP_NavEKF.cpp:79</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a5e2e9fd0ef3ef01661ed47b760169514"><div class="ttname"><a href="calcH__MAG_8c.html#a5e2e9fd0ef3ef01661ed47b760169514">t13</a></div><div class="ttdeci">t13</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00012">calcH_MAG.c:12</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a0b0052b773b95089b9fccc7d02009d8d"><div class="ttname"><a href="calcH__MAG_8c.html#a0b0052b773b95089b9fccc7d02009d8d">t27</a></div><div class="ttdeci">t27</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00028">calcH_MAG.c:28</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ac6afabdc09a49a433ee19d8a9486056d"><div class="ttname"><a href="AP__Math_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a></div><div class="ttdeci">#define min(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00194">AP_Math.h:194</a></div></div>
<div class="ttc" id="classNavEKF_html_aa86e0ec11ec5c3abe9b13b69377298ff"><div class="ttname"><a href="classNavEKF.html#aa86e0ec11ec5c3abe9b13b69377298ff">NavEKF::_flowInnovGate</a></div><div class="ttdeci">AP_Int8 _flowInnovGate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00487">AP_NavEKF.h:487</a></div></div>
<div class="ttc" id="classNavEKF_html_aefbf03b57265a352e23c75441036f414"><div class="ttname"><a href="classNavEKF.html#aefbf03b57265a352e23c75441036f414">NavEKF::flowValidMeaTime_ms</a></div><div class="ttdeci">uint32_t flowValidMeaTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00695">AP_NavEKF.h:695</a></div></div>
<div class="ttc" id="classNavEKF_html_a7cdd3a0ebbcb7be9bd644ebb03665e55"><div class="ttname"><a href="classNavEKF.html#a7cdd3a0ebbcb7be9bd644ebb03665e55">NavEKF::getFlowDebug</a></div><div class="ttdeci">void getFlowDebug(float &amp;varFlow, float &amp;gndOffset, float &amp;flowInnovX, float &amp;flowInnovY, float &amp;auxInnov, float &amp;HAGL, float &amp;rngInnov, float &amp;range, float &amp;gndOffsetErr) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03835">AP_NavEKF.cpp:3835</a></div></div>
<div class="ttc" id="classNavEKF_html_a31faab99ce8bbe09b011f75bfa615c56"><div class="ttname"><a href="classNavEKF.html#a31faab99ce8bbe09b011f75bfa615c56">NavEKF::lastMagUpdate</a></div><div class="ttdeci">uint32_t lastMagUpdate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00607">AP_NavEKF.h:607</a></div></div>
<div class="ttc" id="classNavEKF_html_a4f8b59045c059831f9016eaae4c1a99c"><div class="ttname"><a href="classNavEKF.html#a4f8b59045c059831f9016eaae4c1a99c">NavEKF::flowGyroBias</a></div><div class="ttdeci">Vector2f flowGyroBias</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00720">AP_NavEKF.h:720</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aef7fac4fe6ae817ed325f9e35735e94d"><div class="ttname"><a href="classAP__InertialSensor.html#aef7fac4fe6ae817ed325f9e35735e94d">AP_InertialSensor::get_gyro_count</a></div><div class="ttdeci">uint8_t get_gyro_count(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00150">AP_InertialSensor.h:150</a></div></div>
<div class="ttc" id="classNavEKF_html_a8f54918dd49fe509a6f95c2ee0a590e0"><div class="ttname"><a href="classNavEKF.html#a8f54918dd49fe509a6f95c2ee0a590e0">NavEKF::magVarRateScale</a></div><div class="ttdeci">const float magVarRateScale</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00508">AP_NavEKF.h:508</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_ab78ba643299306ea1e89ed080bc5fa07"><div class="ttname"><a href="unionnav__filter__status.html#ab78ba643299306ea1e89ed080bc5fa07">nav_filter_status::attitude</a></div><div class="ttdeci">uint16_t attitude</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00024">AP_Nav_Common.h:24</a></div></div>
<div class="ttc" id="AHRS__Test_8pde_html_a4b91d1711c0d031f33f581540503bc54"><div class="ttname"><a href="AHRS__Test_8pde.html#a4b91d1711c0d031f33f581540503bc54">ins</a></div><div class="ttdeci">AP_InertialSensor ins</div><div class="ttdef"><b>Definition:</b> <a href="AHRS__Test_8pde_source.html#l00048">AHRS_Test.pde:48</a></div></div>
<div class="ttc" id="classAP__Baro_html"><div class="ttname"><a href="classAP__Baro.html">AP_Baro</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00028">AP_Baro.h:28</a></div></div>
<div class="ttc" id="classNavEKF_html_adc843fa54ea2e75f96053bc8033e0f09"><div class="ttname"><a href="classNavEKF.html#adc843fa54ea2e75f96053bc8033e0f09">NavEKF::newDataHgt</a></div><div class="ttdeci">bool newDataHgt</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00616">AP_NavEKF.h:616</a></div></div>
<div class="ttc" id="classNavEKF_html_ae5da79f131b7cf151054f0d31bc19afe"><div class="ttname"><a href="classNavEKF.html#ae5da79f131b7cf151054f0d31bc19afe">NavEKF::Vector8</a></div><div class="ttdeci">ftype Vector8[8]</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00075">AP_NavEKF.h:75</a></div></div>
<div class="ttc" id="classAP__AHRS_html_aea45b16e6469a3b392b8bf52fb864732"><div class="ttname"><a href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">AP_AHRS::get_home</a></div><div class="ttdeci">const struct Location &amp; get_home(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00337">AP_AHRS.h:337</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ae29959984a5cbda37ebfce599f89ef73"><div class="ttname"><a href="classAP__InertialSensor.html#ae29959984a5cbda37ebfce599f89ef73">AP_InertialSensor::get_delta_velocity</a></div><div class="ttdeci">bool get_delta_velocity(uint8_t i, Vector3f &amp;delta_velocity) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00124">AP_InertialSensor.h:124</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a0381fb42eda8f6435540fbc568a63c1c"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a0381fb42eda8f6435540fbc568a63c1c">NavEKF::state_elements::accel_zbias1</a></div><div class="ttdeci">float accel_zbias1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00274">AP_NavEKF.h:274</a></div></div>
<div class="ttc" id="classNavEKF_html_ac5bd4b5c0717d17f66f4a97f647368ac"><div class="ttname"><a href="classNavEKF.html#ac5bd4b5c0717d17f66f4a97f647368ac">NavEKF::magHealth</a></div><div class="ttdeci">bool magHealth</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00537">AP_NavEKF.h:537</a></div></div>
<div class="ttc" id="AP__Param_8h_html"><div class="ttname"><a href="AP__Param_8h.html">AP_Param.h</a></div><div class="ttdoc">A system for managing and storing variables that are of general interest to the system. </div></div>
<div class="ttc" id="classNavEKF_html_a601c708d728c71bd84de7bc0d0ea5a8a"><div class="ttname"><a href="classNavEKF.html#a601c708d728c71bd84de7bc0d0ea5a8a">NavEKF::lastDecayTime_ms</a></div><div class="ttdeci">uint32_t lastDecayTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00644">AP_NavEKF.h:644</a></div></div>
<div class="ttc" id="classNavEKF_html_a9e50c3a32b880544e268be5bd833af42"><div class="ttname"><a href="classNavEKF.html#a9e50c3a32b880544e268be5bd833af42">NavEKF::tasTimeout</a></div><div class="ttdeci">bool tasTimeout</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00543">AP_NavEKF.h:543</a></div></div>
<div class="ttc" id="classNavEKF_html_a9c6fa0fb0aea35417db85255fdea98c9"><div class="ttname"><a href="classNavEKF.html#a9c6fa0fb0aea35417db85255fdea98c9">NavEKF::detectOptFlowTakeoff</a></div><div class="ttdeci">void detectOptFlowTakeoff(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05142">AP_NavEKF.cpp:5142</a></div></div>
<div class="ttc" id="classQuaternion_html_a872dcfe279bd5ba36a67ce90014dc187"><div class="ttname"><a href="classQuaternion.html#a872dcfe279bd5ba36a67ce90014dc187">Quaternion::initialise</a></div><div class="ttdeci">void initialise()</div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8h_source.html#l00102">quaternion.h:102</a></div></div>
<div class="ttc" id="structVector2_html_a6cfed8355591aa269f4dba43bd806ef9"><div class="ttname"><a href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">Vector2::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector2_8h_source.html#l00040">vector2.h:40</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_ac556cb93868743fd8c922c01c1952ab3"><div class="ttname"><a href="unionnav__filter__status.html#ac556cb93868743fd8c922c01c1952ab3">nav_filter_status::using_gps</a></div><div class="ttdeci">uint16_t using_gps</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00037">AP_Nav_Common.h:37</a></div></div>
<div class="ttc" id="AP__Math_8h_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00193">AP_Math.h:193</a></div></div>
<div class="ttc" id="classNavEKF_html_aff54fedb54585c939b417de52da8e37a"><div class="ttname"><a href="classNavEKF.html#aff54fedb54585c939b417de52da8e37a">NavEKF::Vector6</a></div><div class="ttdeci">ftype Vector6[6]</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00074">AP_NavEKF.h:74</a></div></div>
<div class="ttc" id="classNavEKF_html_a1bccd4b8bcc129f2daabf04b02a44bf3"><div class="ttname"><a href="classNavEKF.html#a1bccd4b8bcc129f2daabf04b02a44bf3">NavEKF::getMagNED</a></div><div class="ttdeci">void getMagNED(Vector3f &amp;magNED) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03753">AP_NavEKF.cpp:3753</a></div></div>
<div class="ttc" id="classRangeFinder_html_a5452cf4387ba889dd206b12375d2e059"><div class="ttname"><a href="classRangeFinder.html#a5452cf4387ba889dd206b12375d2e059">RangeFinder::status</a></div><div class="ttdeci">RangeFinder_Status status(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="RangeFinder_8cpp_source.html#l00299">RangeFinder.cpp:299</a></div></div>
<div class="ttc" id="classCompass_html_a5051de1d15ee203600422235ab93c88c"><div class="ttname"><a href="classCompass.html#a5051de1d15ee203600422235ab93c88c">Compass::get_declination</a></div><div class="ttdeci">float get_declination() const </div><div class="ttdef"><b>Definition:</b> <a href="Compass_8cpp_source.html#l00486">Compass.cpp:486</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_aa3adb05231060d239e5b91940e001f85"><div class="ttname"><a href="AP__Math_8cpp.html#aa3adb05231060d239e5b91940e001f85">radians</a></div><div class="ttdeci">float radians(float deg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00097">AP_Math.cpp:97</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_ab9650e2cc1e22e16bb259712157791c8"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#ab9650e2cc1e22e16bb259712157791c8">NavEKF::state_elements::quat</a></div><div class="ttdeci">Quaternion quat</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00270">AP_NavEKF.h:270</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab7e75af54a874d77240c89c6e5152a99"><div class="ttname"><a href="classAP__InertialSensor.html#ab7e75af54a874d77240c89c6e5152a99">AP_InertialSensor::get_primary_accel</a></div><div class="ttdeci">uint8_t get_primary_accel(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00201">AP_InertialSensor.h:201</a></div></div>
<div class="ttc" id="classNavEKF_html_a0e8008718ac47915dec8d396ad53ea3f"><div class="ttname"><a href="classNavEKF.html#a0e8008718ac47915dec8d396ad53ea3f">NavEKF::vn</a></div><div class="ttdeci">ftype vn</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00768">AP_NavEKF.h:768</a></div></div>
<div class="ttc" id="classNavEKF_html_a9155b42312de4e57a182e58ca0a150fc"><div class="ttname"><a href="classNavEKF.html#a9155b42312de4e57a182e58ca0a150fc">NavEKF::getQuaternion</a></div><div class="ttdeci">void getQuaternion(Quaternion &amp;quat) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05184">AP_NavEKF.cpp:5184</a></div></div>
<div class="ttc" id="classAP__GPS_html_af701b15d8f8f1050e4acab57a867cf4b"><div class="ttname"><a href="classAP__GPS.html#af701b15d8f8f1050e4acab57a867cf4b">AP_GPS::last_message_time_ms</a></div><div class="ttdeci">uint32_t last_message_time_ms(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00291">AP_GPS.h:291</a></div></div>
<div class="ttc" id="classNavEKF_html_a514c91480f1d3173fc3f463519c1e3a9"><div class="ttname"><a href="classNavEKF.html#a514c91480f1d3173fc3f463519c1e3a9">NavEKF::hgtHealth</a></div><div class="ttdeci">bool hgtHealth</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00536">AP_NavEKF.h:536</a></div></div>
<div class="ttc" id="classNavEKF_html_ad04500d06937a8f13de6c4ee497cdb84"><div class="ttname"><a href="classNavEKF.html#ad04500d06937a8f13de6c4ee497cdb84">NavEKF::innovVtas</a></div><div class="ttdeci">ftype innovVtas</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00592">AP_NavEKF.h:592</a></div></div>
<div class="ttc" id="classNavEKF_html_a7a9f26f4c53700ba4f1afac54e9c6ac5"><div class="ttname"><a href="classNavEKF.html#a7a9f26f4c53700ba4f1afac54e9c6ac5">NavEKF::highYawRate</a></div><div class="ttdeci">bool highYawRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00668">AP_NavEKF.h:668</a></div></div>
<div class="ttc" id="classNavEKF_html_a1566591e9caf14504f532caaed34b7bb"><div class="ttname"><a href="classNavEKF.html#a1566591e9caf14504f532caaed34b7bb">NavEKF::hgtRetryTimeMode0</a></div><div class="ttdeci">const uint16_t hgtRetryTimeMode0</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00504">AP_NavEKF.h:504</a></div></div>
<div class="ttc" id="classNavEKF_html_ae88087f9cdf8baa6d5f5d7106d682a80"><div class="ttname"><a href="classNavEKF.html#ae88087f9cdf8baa6d5f5d7106d682a80">NavEKF::DCM</a></div><div class="ttdeci">Matrix3f DCM</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00798">AP_NavEKF.h:798</a></div></div>
<div class="ttc" id="classNavEKF_html_a133e1311f462787207a078398dd85e63"><div class="ttname"><a href="classNavEKF.html#a133e1311f462787207a078398dd85e63">NavEKF::summedDelAng</a></div><div class="ttdeci">Vector3f summedDelAng</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00559">AP_NavEKF.h:559</a></div></div>
<div class="ttc" id="classNavEKF_html_abb693a00d56f98f4cd8d654605163d14"><div class="ttname"><a href="classNavEKF.html#abb693a00d56f98f4cd8d654605163d14">NavEKF::SelectMagFusion</a></div><div class="ttdeci">void SelectMagFusion()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00934">AP_NavEKF.cpp:934</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_adc02e30ae2afa5e09c12e47158bfa882"><div class="ttname"><a href="AP__NavEKF_8cpp.html#adc02e30ae2afa5e09c12e47158bfa882">ABIAS_PNOISE_DEFAULT</a></div><div class="ttdeci">#define ABIAS_PNOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00083">AP_NavEKF.cpp:83</a></div></div>
<div class="ttc" id="classNavEKF_html_a4600ad3e42aba285eb657ef3ce1af512"><div class="ttname"><a href="classNavEKF.html#a4600ad3e42aba285eb657ef3ce1af512">NavEKF::gpsPosVarAccScale</a></div><div class="ttdeci">const float gpsPosVarAccScale</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00497">AP_NavEKF.h:497</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__NavEKF_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8pde_source.html#l00041">AC_PID_test.pde:41</a></div></div>
<div class="ttc" id="classNavEKF_html_a708dcd665d3a63193a1efd2ac89e2d8c"><div class="ttname"><a href="classNavEKF.html#a708dcd665d3a63193a1efd2ac89e2d8c">NavEKF::dtDelVel2</a></div><div class="ttdeci">float dtDelVel2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00748">AP_NavEKF.h:748</a></div></div>
<div class="ttc" id="classNavEKF_html_ae3672ad8ec8eb4f7f7601fb2aa08451d"><div class="ttname"><a href="classNavEKF.html#ae3672ad8ec8eb4f7f7601fb2aa08451d">NavEKF::flow_state</a></div><div class="ttdeci">struct NavEKF::@31 flow_state</div></div>
<div class="ttc" id="classNavEKF_html_af8becb3bed10af9b016a0bfe529543e5"><div class="ttname"><a href="classNavEKF.html#af8becb3bed10af9b016a0bfe529543e5">NavEKF::_perf_FuseAirspeed</a></div><div class="ttdeci">perf_counter_t _perf_FuseAirspeed</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00811">AP_NavEKF.h:811</a></div></div>
<div class="ttc" id="classNavEKF_html_a0734b0ccc02602007dafc6d956a5dc30"><div class="ttname"><a href="classNavEKF.html#a0734b0ccc02602007dafc6d956a5dc30">NavEKF::dAngIMU</a></div><div class="ttdeci">Vector3f dAngIMU</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00568">AP_NavEKF.h:568</a></div></div>
<div class="ttc" id="classNavEKF_html_af5b82a44abb8a143dd981043af24248f"><div class="ttname"><a href="classNavEKF.html#af5b82a44abb8a143dd981043af24248f">NavEKF::newDataGps</a></div><div class="ttdeci">bool newDataGps</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00612">AP_NavEKF.h:612</a></div></div>
<div class="ttc" id="classNavEKF_html_a09707728fa0e68e4ce49133052ab1d11"><div class="ttname"><a href="classNavEKF.html#a09707728fa0e68e4ce49133052ab1d11">NavEKF::_perf_FuseOptFlow</a></div><div class="ttdeci">perf_counter_t _perf_FuseOptFlow</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00814">AP_NavEKF.h:814</a></div></div>
<div class="ttc" id="classAP__AHRS_html_adab911dc87e234603bea168495da909a"><div class="ttname"><a href="classAP__AHRS.html#adab911dc87e234603bea168495da909a">AP_AHRS::uptime_ms</a></div><div class="ttdeci">virtual uint32_t uptime_ms(void) const =0</div></div>
<div class="ttc" id="AP__Math__AVR__Compat_8h_html_a3745ca949b1ef9df47fb2f52c2536e68"><div class="ttname"><a href="AP__Math__AVR__Compat_8h.html#a3745ca949b1ef9df47fb2f52c2536e68">fabsf</a></div><div class="ttdeci">#define fabsf</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math__AVR__Compat_8h_source.html#l00022">AP_Math_AVR_Compat.h:22</a></div></div>
<div class="ttc" id="classNavEKF_html_ab4970d7ec89480a7198a8e3254ac9f30"><div class="ttname"><a href="classNavEKF.html#ab4970d7ec89480a7198a8e3254ac9f30">NavEKF::gpsNEVelVarAccScale</a></div><div class="ttdeci">const float gpsNEVelVarAccScale</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00495">AP_NavEKF.h:495</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00015">HAL.h:15</a></div></div>
<div class="ttc" id="classNavEKF_html_a6d214404e386084c3ed35b2b89f6e0a5"><div class="ttname"><a href="classNavEKF.html#a6d214404e386084c3ed35b2b89f6e0a5">NavEKF::msecTasDelay</a></div><div class="ttdeci">const uint16_t msecTasDelay</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00500">AP_NavEKF.h:500</a></div></div>
<div class="ttc" id="classNavEKF_html_a422c7239c10e10bfd6d540d06ef23cbc"><div class="ttname"><a href="classNavEKF.html#a422c7239c10e10bfd6d540d06ef23cbc">NavEKF::statesInitialised</a></div><div class="ttdeci">bool statesInitialised</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00533">AP_NavEKF.h:533</a></div></div>
<div class="ttc" id="classNavEKF_html_a0e2d1fc2ccd36ee1751b09aae63cfda1"><div class="ttname"><a href="classNavEKF.html#a0e2d1fc2ccd36ee1751b09aae63cfda1">NavEKF::newDataMag</a></div><div class="ttdeci">bool newDataMag</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00613">AP_NavEKF.h:613</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html"><div class="ttname"><a href="classAP__InertialSensor.html">AP_InertialSensor</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00043">AP_InertialSensor.h:43</a></div></div>
<div class="ttc" id="v0_89_2mavlink__types_8h_html_aa0f38d2f21462ce9ff37bfb2fb43709c"><div class="ttname"><a href="v0_89_2mavlink__types_8h.html#aa0f38d2f21462ce9ff37bfb2fb43709c">mavlink_channel_t</a></div><div class="ttdeci">mavlink_channel_t</div><div class="ttdef"><b>Definition:</b> <a href="v0_89_2mavlink__types_8h_source.html#l00275">mavlink_types.h:275</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_af2d594bf1c73a239d30648408d3c328d"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#af2d594bf1c73a239d30648408d3c328d">NavEKF::state_elements::gyro_bias</a></div><div class="ttdeci">Vector3f gyro_bias</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00273">AP_NavEKF.h:273</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a22dd0f659b148ac74a104caa972e6790"><div class="ttname"><a href="calcH__MAG_8c.html#a22dd0f659b148ac74a104caa972e6790">t12</a></div><div class="ttdeci">t12</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00011">calcH_MAG.c:11</a></div></div>
<div class="ttc" id="classNavEKF_html_a5bf42c72b13a5a1b0055d42627dd8bde"><div class="ttname"><a href="classNavEKF.html#a5bf42c72b13a5a1b0055d42627dd8bde">NavEKF::dVelIMU2</a></div><div class="ttdeci">Vector3f dVelIMU2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00567">AP_NavEKF.h:567</a></div></div>
<div class="ttc" id="classNavEKF_html_ab4055c5fc783af9aac11a3e0a3fc5bc4"><div class="ttname"><a href="classNavEKF.html#ab4055c5fc783af9aac11a3e0a3fc5bc4">NavEKF::_perf_UpdateFilter</a></div><div class="ttdeci">perf_counter_t _perf_UpdateFilter</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00807">AP_NavEKF.h:807</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a6d50d30e44d32c192e4d932bbb166ba0"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a6d50d30e44d32c192e4d932bbb166ba0">earthRate</a></div><div class="ttdeci">#define earthRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00102">AP_NavEKF.cpp:102</a></div></div>
<div class="ttc" id="classNavEKF_html_a90a0fa8431a481fc2809734fee931610"><div class="ttname"><a href="classNavEKF.html#a90a0fa8431a481fc2809734fee931610">NavEKF::_hgtInnovGate</a></div><div class="ttdeci">AP_Int8 _hgtInnovGate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00479">AP_NavEKF.h:479</a></div></div>
<div class="ttc" id="structLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdoc">param 2 - Altitude in centimeters (meters * 100) </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00114">AP_Common.h:114</a></div></div>
<div class="ttc" id="classNavEKF_html_ad193e5aab03041673d4cfad9f7a2a6ba"><div class="ttname"><a href="classNavEKF.html#ad193e5aab03041673d4cfad9f7a2a6ba">NavEKF::writeOptFlowMeas</a></div><div class="ttdeci">void writeOptFlowMeas(uint8_t &amp;rawFlowQuality, Vector2f &amp;rawFlowRates, Vector2f &amp;rawGyroRates, uint32_t &amp;msecFlowMeas)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04308">AP_NavEKF.cpp:4308</a></div></div>
<div class="ttc" id="AP__AHRS_8h_html_add679f4b895d592dc5f213964dd54d48af82a87d7a11f285e948932c783eb8482"><div class="ttname"><a href="AP__AHRS_8h.html#add679f4b895d592dc5f213964dd54d48af82a87d7a11f285e948932c783eb8482">AHRS_VEHICLE_GROUND</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00055">AP_AHRS.h:55</a></div></div>
<div class="ttc" id="classNavEKF_html_a6ca946cfb2943450437555b33a8975f0"><div class="ttname"><a href="classNavEKF.html#a6ca946cfb2943450437555b33a8975f0">NavEKF::accNavMagHoriz</a></div><div class="ttdeci">ftype accNavMagHoriz</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00564">AP_NavEKF.h:564</a></div></div>
<div class="ttc" id="classNavEKF_html_a49295ac247658724f852cbec8be83398"><div class="ttname"><a href="classNavEKF.html#a49295ac247658724f852cbec8be83398">NavEKF::SelectTasFusion</a></div><div class="ttdeci">void SelectTasFusion()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l01062">AP_NavEKF.cpp:1062</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ac57331a5046d45016ef900726e1be2fb"><div class="ttname"><a href="classAP__InertialSensor.html#ac57331a5046d45016ef900726e1be2fb">AP_InertialSensor::get_accel_count</a></div><div class="ttdeci">uint8_t get_accel_count(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00157">AP_InertialSensor.h:157</a></div></div>
<div class="ttc" id="classNavEKF_html_a4a3a094724a522cd92d31f10ed66ef0b"><div class="ttname"><a href="classNavEKF.html#a4a3a094724a522cd92d31f10ed66ef0b">NavEKF::Tnb_flow</a></div><div class="ttdeci">Matrix3f Tnb_flow</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00701">AP_NavEKF.h:701</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a9d23b3a127a3bd2ef156b919d13c4ddf"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a9d23b3a127a3bd2ef156b919d13c4ddf">ALT_NOISE_DEFAULT</a></div><div class="ttdeci">#define ALT_NOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00078">AP_NavEKF.cpp:78</a></div></div>
<div class="ttc" id="classNavEKF_html_ac8ac5c5066acbea171a692e2b03735e6"><div class="ttname"><a href="classNavEKF.html#ac8ac5c5066acbea171a692e2b03735e6">NavEKF::flowDataValid</a></div><div class="ttdeci">bool flowDataValid</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00688">AP_NavEKF.h:688</a></div></div>
<div class="ttc" id="classNavEKF_html_ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9"><div class="ttname"><a href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafa00c38751965390bd45a75a0f4863cfd9">NavEKF::AID_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00730">AP_NavEKF.h:730</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_afb587191e891ab4cbc95821ac3395d5e"><div class="ttname"><a href="unionnav__filter__status.html#afb587191e891ab4cbc95821ac3395d5e">nav_filter_status::pred_horiz_pos_rel</a></div><div class="ttdeci">uint16_t pred_horiz_pos_rel</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00032">AP_Nav_Common.h:32</a></div></div>
<div class="ttc" id="classNavEKF_html_a08ea3fd0ddbdb4153eedeb6f43a7352c"><div class="ttname"><a href="classNavEKF.html#a08ea3fd0ddbdb4153eedeb6f43a7352c">NavEKF::_rngInnovGate</a></div><div class="ttdeci">AP_Int8 _rngInnovGate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00489">AP_NavEKF.h:489</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="classNavEKF_html_a43471539b5aebe3fabe45e0fb934f0ff"><div class="ttname"><a href="classNavEKF.html#a43471539b5aebe3fabe45e0fb934f0ff">NavEKF::gpsSpdAccuracy</a></div><div class="ttdeci">float gpsSpdAccuracy</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00662">AP_NavEKF.h:662</a></div></div>
<div class="ttc" id="classNavEKF_html_a17f134494d9a1901e2d933fd980e6634"><div class="ttname"><a href="classNavEKF.html#a17f134494d9a1901e2d933fd980e6634">NavEKF::nextP</a></div><div class="ttdeci">Matrix22 nextP</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00634">AP_NavEKF.h:634</a></div></div>
<div class="ttc" id="classNavEKF_html_a0463575b0fd4ac7b5fa4cf9db23e6418"><div class="ttname"><a href="classNavEKF.html#a0463575b0fd4ac7b5fa4cf9db23e6418">NavEKF::lastGpsAidBadTime_ms</a></div><div class="ttdeci">uint32_t lastGpsAidBadTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00666">AP_NavEKF.h:666</a></div></div>
<div class="ttc" id="classNavEKF_html_a84cacea011683356ae5fcd2eb2e30fcc"><div class="ttname"><a href="classNavEKF.html#a84cacea011683356ae5fcd2eb2e30fcc">NavEKF::getFilterStatus</a></div><div class="ttdeci">void getFilterStatus(nav_filter_status &amp;status) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04778">AP_NavEKF.cpp:4778</a></div></div>
<div class="ttc" id="classNavEKF_html_a24be97aa79bc2f3f9b9bbb84ede8c298"><div class="ttname"><a href="classNavEKF.html#a24be97aa79bc2f3f9b9bbb84ede8c298">NavEKF::_baro</a></div><div class="ttdeci">AP_Baro &amp; _baro</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00262">AP_NavEKF.h:262</a></div></div>
<div class="ttc" id="classNavEKF_html_ae348168676a32e441570ef3dd46153be"><div class="ttname"><a href="classNavEKF.html#ae348168676a32e441570ef3dd46153be">NavEKF::lastConstVelMode</a></div><div class="ttdeci">bool lastConstVelMode</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00727">AP_NavEKF.h:727</a></div></div>
<div class="ttc" id="classNavEKF_html_a4c44a7b25f5b5584b755142c6198fd1e"><div class="ttname"><a href="classNavEKF.html#a4c44a7b25f5b5584b755142c6198fd1e">NavEKF::readGpsData</a></div><div class="ttdeci">void readGpsData()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04104">AP_NavEKF.cpp:4104</a></div></div>
<div class="ttc" id="classNavEKF_html_ab0b5685a752b604d338b625da5e457d4"><div class="ttname"><a href="classNavEKF.html#ab0b5685a752b604d338b625da5e457d4">NavEKF::FuseOptFlow</a></div><div class="ttdeci">void FuseOptFlow()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l02871">AP_NavEKF.cpp:2871</a></div></div>
<div class="ttc" id="classNavEKF_html_a1c2beb90156edd9a4383c7d652b7ef7e"><div class="ttname"><a href="classNavEKF.html#a1c2beb90156edd9a4383c7d652b7ef7e">NavEKF::EstimateTerrainOffset</a></div><div class="ttdeci">void EstimateTerrainOffset()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l02692">AP_NavEKF.cpp:2692</a></div></div>
<div class="ttc" id="structVector2_html"><div class="ttname"><a href="structVector2.html">Vector2&lt; float &gt;</a></div></div>
<div class="ttc" id="classNavEKF_html_a7834f68e34b1d9541d1836661b02571d"><div class="ttname"><a href="classNavEKF.html#a7834f68e34b1d9541d1836661b02571d">NavEKF::innovRng</a></div><div class="ttdeci">float innovRng</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00712">AP_NavEKF.h:712</a></div></div>
<div class="ttc" id="classNavEKF_html_a0b17a3410a3c45b35d8bf993098e8f75"><div class="ttname"><a href="classNavEKF.html#a0b17a3410a3c45b35d8bf993098e8f75">NavEKF::useAirspeed</a></div><div class="ttdeci">bool useAirspeed(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04652">AP_NavEKF.cpp:4652</a></div></div>
<div class="ttc" id="AP__HAL__Boards_8h_html_a1a4e182bb1892026f81f6652d6550cdc"><div class="ttname"><a href="AP__HAL__Boards_8h.html#a1a4e182bb1892026f81f6652d6550cdc">HAL_BOARD_VRBRAIN</a></div><div class="ttdeci">#define HAL_BOARD_VRBRAIN</div><div class="ttdef"><b>Definition:</b> <a href="AP__HAL__Boards_8h_source.html#l00020">AP_HAL_Boards.h:20</a></div></div>
<div class="ttc" id="classAP__GPS_html_a2ca8a9bad47faad1baeb09e124979022"><div class="ttname"><a href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">AP_GPS::location</a></div><div class="ttdeci">const Location &amp; location(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00176">AP_GPS.h:176</a></div></div>
<div class="ttc" id="classNavEKF_html_a413d74ab571dfb46bc0a90c5b293d364"><div class="ttname"><a href="classNavEKF.html#a413d74ab571dfb46bc0a90c5b293d364">NavEKF::lastAngRate</a></div><div class="ttdeci">Vector3f lastAngRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00631">AP_NavEKF.h:631</a></div></div>
<div class="ttc" id="classNavEKF_html_aa397dc742e68d43d9b10bc1e036d4674"><div class="ttname"><a href="classNavEKF.html#aa397dc742e68d43d9b10bc1e036d4674">NavEKF::send_status_report</a></div><div class="ttdeci">void send_status_report(mavlink_channel_t chan)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04811">AP_NavEKF.cpp:4811</a></div></div>
<div class="ttc" id="classNavEKF_html_a2ba17c3452c9ce37f919bfa58f8ddd38"><div class="ttname"><a href="classNavEKF.html#a2ba17c3452c9ce37f919bfa58f8ddd38">NavEKF::lastTasPassTime</a></div><div class="ttdeci">uint32_t lastTasPassTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00623">AP_NavEKF.h:623</a></div></div>
<div class="ttc" id="classVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00070">vector3.h:70</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a70736687012cc7bdcfb1c3c861da9d37"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a70736687012cc7bdcfb1c3c861da9d37">GLITCH_RADIUS_DEFAULT</a></div><div class="ttdeci">#define GLITCH_RADIUS_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00092">AP_NavEKF.cpp:92</a></div></div>
<div class="ttc" id="classNavEKF_html_a61fd7d0a8e6789e650fe3c4239806f4d"><div class="ttname"><a href="classNavEKF.html#a61fd7d0a8e6789e650fe3c4239806f4d">NavEKF::firstMagYawInit</a></div><div class="ttdeci">bool firstMagYawInit</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00653">AP_NavEKF.h:653</a></div></div>
<div class="ttc" id="classNavEKF_html_af6e14aa136ad92925e3064a7c4243b71"><div class="ttname"><a href="classNavEKF.html#af6e14aa136ad92925e3064a7c4243b71">NavEKF::statetimeStamp</a></div><div class="ttdeci">Vector_u32_50 statetimeStamp</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00553">AP_NavEKF.h:553</a></div></div>
<div class="ttc" id="classNavEKF_html_a921e3fd1bb15e7f2414a9d85b1642fb7"><div class="ttname"><a href="classNavEKF.html#a921e3fd1bb15e7f2414a9d85b1642fb7">NavEKF::_windVelProcessNoise</a></div><div class="ttdeci">AP_Float _windVelProcessNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00466">AP_NavEKF.h:466</a></div></div>
<div class="ttc" id="AP__Math_8h_html_acedd05d9f5ab6f2878991cc684e17c18"><div class="ttname"><a href="AP__Math_8h.html#acedd05d9f5ab6f2878991cc684e17c18">is_equal</a></div><div class="ttdeci">static bool is_equal(const float fVal1, const float fVal2)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00080">AP_Math.h:80</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfa381f4e22f4fe13803505004cc018e122"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa381f4e22f4fe13803505004cc018e122">EKF_CONST_POS_MODE</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00342">ardupilotmega.h:342</a></div></div>
<div class="ttc" id="structLocation__Option__Flags_html_a4c355df903072f511744774812ef6dc3"><div class="ttname"><a href="structLocation__Option__Flags.html#a4c355df903072f511744774812ef6dc3">Location_Option_Flags::terrain_alt</a></div><div class="ttdeci">uint8_t terrain_alt</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00102">AP_Common.h:102</a></div></div>
<div class="ttc" id="classMatrix3_html_a7efa0e7bd4c621a7fe76cd9168960b94"><div class="ttname"><a href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">Matrix3::c</a></div><div class="ttdeci">Vector3&lt; T &gt; c</div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8h_source.html#l00051">matrix3.h:51</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_aefcffe537765de6fd7557c110d88ab94"><div class="ttname"><a href="unionnav__filter__status.html#aefcffe537765de6fd7557c110d88ab94">nav_filter_status::touchdown</a></div><div class="ttdeci">uint16_t touchdown</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00036">AP_Nav_Common.h:36</a></div></div>
<div class="ttc" id="classNavEKF_html_a82d63c45e27559907bba4f997230c8b9"><div class="ttname"><a href="classNavEKF.html#a82d63c45e27559907bba4f997230c8b9">NavEKF::getAccelNED</a></div><div class="ttdeci">void getAccelNED(Vector3f &amp;accelNED) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03619">AP_NavEKF.cpp:3619</a></div></div>
<div class="ttc" id="classNavEKF_html_abf2437b13b0f20096df6b2bd633c4944"><div class="ttname"><a href="classNavEKF.html#abf2437b13b0f20096df6b2bd633c4944">NavEKF::flowUpdateCountMax</a></div><div class="ttdeci">uint8_t flowUpdateCountMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00722">AP_NavEKF.h:722</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_afe975e201ce16d25813c239a1d21e8c9"><div class="ttname"><a href="calcH__MAG_8c.html#afe975e201ce16d25813c239a1d21e8c9">t7</a></div><div class="ttdeci">t7</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00006">calcH_MAG.c:6</a></div></div>
<div class="ttc" id="AP__HAL__Boards_8h_html_a8dcea2b41cd8fb125b22079bfad735aa"><div class="ttname"><a href="AP__HAL__Boards_8h.html#a8dcea2b41cd8fb125b22079bfad735aa">HAL_BOARD_PX4</a></div><div class="ttdeci">#define HAL_BOARD_PX4</div><div class="ttdef"><b>Definition:</b> <a href="AP__HAL__Boards_8h_source.html#l00017">AP_HAL_Boards.h:17</a></div></div>
<div class="ttc" id="classAP__Baro_html_a984b4dbc11e276e832467253590da933"><div class="ttname"><a href="classAP__Baro.html#a984b4dbc11e276e832467253590da933">AP_Baro::get_altitude</a></div><div class="ttdeci">float get_altitude(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00072">AP_Baro.h:72</a></div></div>
<div class="ttc" id="classNavEKF_html_aa55218a253ab5ef9c321145d552ccbef"><div class="ttname"><a href="classNavEKF.html#aa55218a253ab5ef9c321145d552ccbef">NavEKF::accNavMag</a></div><div class="ttdeci">ftype accNavMag</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00563">AP_NavEKF.h:563</a></div></div>
<div class="ttc" id="classNavEKF_html_a67e6b67640dd6b3b44b35b6406c47c6e"><div class="ttname"><a href="classNavEKF.html#a67e6b67640dd6b3b44b35b6406c47c6e">NavEKF::prevPosE</a></div><div class="ttdeci">float prevPosE</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00708">AP_NavEKF.h:708</a></div></div>
<div class="ttc" id="classNavEKF_html_a202ea1c0d365a297b1619730b0110678"><div class="ttname"><a href="classNavEKF.html#a202ea1c0d365a297b1619730b0110678">NavEKF::hgtRetryTime</a></div><div class="ttdeci">uint16_t hgtRetryTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00618">AP_NavEKF.h:618</a></div></div>
<div class="ttc" id="classNavEKF_html_a1849d7cc900d9c76dfcfee92e9ede03d"><div class="ttname"><a href="classNavEKF.html#a1849d7cc900d9c76dfcfee92e9ede03d">NavEKF::hgtIncrStateDelta</a></div><div class="ttdeci">Vector10 hgtIncrStateDelta</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00673">AP_NavEKF.h:673</a></div></div>
<div class="ttc" id="classQuaternion_html_ab3049efa36b211699ca03ea53970f0fd"><div class="ttname"><a href="classQuaternion.html#ab3049efa36b211699ca03ea53970f0fd">Quaternion::to_euler</a></div><div class="ttdeci">void to_euler(float &amp;roll, float &amp;pitch, float &amp;yaw) const </div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8cpp_source.html#l00248">quaternion.cpp:248</a></div></div>
<div class="ttc" id="classNavEKF_html_a7ffc1616eba87ddced506c6bc2c47ba6"><div class="ttname"><a href="classNavEKF.html#a7ffc1616eba87ddced506c6bc2c47ba6">NavEKF::gpsAidingBad</a></div><div class="ttdeci">bool gpsAidingBad</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00665">AP_NavEKF.h:665</a></div></div>
<div class="ttc" id="classNavEKF_html_a04bc3b07fd94968b70effec730d3b829"><div class="ttname"><a href="classNavEKF.html#a04bc3b07fd94968b70effec730d3b829">NavEKF::MagPred</a></div><div class="ttdeci">Vector3f MagPred</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00799">AP_NavEKF.h:799</a></div></div>
<div class="ttc" id="classNavEKF_html_a9d80eedd8fbbdb9c0997d3c49859c976"><div class="ttname"><a href="classNavEKF.html#a9d80eedd8fbbdb9c0997d3c49859c976">NavEKF::vd</a></div><div class="ttdeci">ftype vd</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00770">AP_NavEKF.h:770</a></div></div>
<div class="ttc" id="classNavEKF_html_aab032ee99a4313ffb2ef124b0d1d61a9"><div class="ttname"><a href="classNavEKF.html#aab032ee99a4313ffb2ef124b0d1d61a9">NavEKF::varInnovMag</a></div><div class="ttdeci">Vector3f varInnovMag</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00589">AP_NavEKF.h:589</a></div></div>
<div class="ttc" id="classNavEKF_html_a96245bb1cbb49e89c52e282b38d00c7a"><div class="ttname"><a href="classNavEKF.html#a96245bb1cbb49e89c52e282b38d00c7a">NavEKF::velTestRatio</a></div><div class="ttdeci">float velTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00645">AP_NavEKF.h:645</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a824196d024c4f10183ff02a5ac9a27f5"><div class="ttname"><a href="unionnav__filter__status.html#a824196d024c4f10183ff02a5ac9a27f5">nav_filter_status::takeoff</a></div><div class="ttdeci">uint16_t takeoff</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00035">AP_Nav_Common.h:35</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a21e8c3dabeb62fc401615127b1f3dd18"><div class="ttname"><a href="unionnav__filter__status.html#a21e8c3dabeb62fc401615127b1f3dd18">nav_filter_status::vert_pos</a></div><div class="ttdeci">uint16_t vert_pos</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00029">AP_Nav_Common.h:29</a></div></div>
<div class="ttc" id="classNavEKF_html_aead25814b7b3c494ceccbde73fb55125"><div class="ttname"><a href="classNavEKF.html#aead25814b7b3c494ceccbde73fb55125">NavEKF::hgtRetryTimeMode12</a></div><div class="ttdeci">const uint16_t hgtRetryTimeMode12</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00505">AP_NavEKF.h:505</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a14398c5d2ae68bbe1c67482a91909ad9"><div class="ttname"><a href="classAP__AHRS.html#a14398c5d2ae68bbe1c67482a91909ad9">AP_AHRS::get_ins</a></div><div class="ttdeci">const AP_InertialSensor &amp; get_ins() const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00175">AP_AHRS.h:175</a></div></div>
<div class="ttc" id="classNavEKF_html_ac999f7aa652d88fb7a6b41011fb33ca4"><div class="ttname"><a href="classNavEKF.html#ac999f7aa652d88fb7a6b41011fb33ca4">NavEKF::yawAligned</a></div><div class="ttdeci">bool yawAligned</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00641">AP_NavEKF.h:641</a></div></div>
<div class="ttc" id="classNavEKF_html_a94d438dac9319935c54b5c098cfbfb0a"><div class="ttname"><a href="classNavEKF.html#a94d438dac9319935c54b5c098cfbfb0a">NavEKF::posTestRatio</a></div><div class="ttdeci">float posTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00646">AP_NavEKF.h:646</a></div></div>
<div class="ttc" id="AP__Math__AVR__Compat_8h_html_a6776b8d1a4149fe35e282a76effd8a9d"><div class="ttname"><a href="AP__Math__AVR__Compat_8h.html#a6776b8d1a4149fe35e282a76effd8a9d">sinf</a></div><div class="ttdeci">#define sinf</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math__AVR__Compat_8h_source.html#l00014">AP_Math_AVR_Compat.h:14</a></div></div>
<div class="ttc" id="classVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00070">vector3.h:70</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00078">AP_Param.h:78</a></div></div>
<div class="ttc" id="classNavEKF_html_af6ed0063fb171f237efceb25dcbe6aec"><div class="ttname"><a href="classNavEKF.html#af6ed0063fb171f237efceb25dcbe6aec">NavEKF::touchdownExpectedSet_ms</a></div><div class="ttdeci">uint32_t touchdownExpectedSet_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00754">AP_NavEKF.h:754</a></div></div>
<div class="ttc" id="classNavEKF_html_a03ae50659f23195842d62d3345397819"><div class="ttname"><a href="classNavEKF.html#a03ae50659f23195842d62d3345397819">NavEKF::SPP</a></div><div class="ttdeci">Vector8 SPP</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00639">AP_NavEKF.h:639</a></div></div>
<div class="ttc" id="AP__Math__AVR__Compat_8h_html_a68e4969cdd396dc3d4ad5abef13880b1"><div class="ttname"><a href="AP__Math__AVR__Compat_8h.html#a68e4969cdd396dc3d4ad5abef13880b1">asinf</a></div><div class="ttdeci">#define asinf</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math__AVR__Compat_8h_source.html#l00082">AP_Math_AVR_Compat.h:82</a></div></div>
<div class="ttc" id="classNavEKF_html_a12a663e422a33c37a23b093dd0f0c397"><div class="ttname"><a href="classNavEKF.html#a12a663e422a33c37a23b093dd0f0c397">NavEKF::NavEKF</a></div><div class="ttdeci">NavEKF(const AP_AHRS *ahrs, AP_Baro &amp;baro, const RangeFinder &amp;rng)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00377">AP_NavEKF.cpp:377</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_aab01a87c6ad75643a39277a8954a7140"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#aab01a87c6ad75643a39277a8954a7140">NavEKF::state_elements::posD2</a></div><div class="ttdeci">float posD2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00282">AP_NavEKF.h:282</a></div></div>
<div class="ttc" id="classNavEKF_html_ac06c4870764d286cc4661233c07fec30"><div class="ttname"><a href="classNavEKF.html#ac06c4870764d286cc4661233c07fec30">NavEKF::auxFlowObsInnovVar</a></div><div class="ttdeci">float auxFlowObsInnovVar</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00692">AP_NavEKF.h:692</a></div></div>
<div class="ttc" id="classNavEKF_html_a50054a8af8c2457a5dd91fd443d7dcf3"><div class="ttname"><a href="classNavEKF.html#a50054a8af8c2457a5dd91fd443d7dcf3">NavEKF::gpsRetryTimeUseTAS</a></div><div class="ttdeci">const uint16_t gpsRetryTimeUseTAS</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00501">AP_NavEKF.h:501</a></div></div>
<div class="ttc" id="classNavEKF_html_a83d2898e9146509d0fc353a17a2dfc7e"><div class="ttname"><a href="classNavEKF.html#a83d2898e9146509d0fc353a17a2dfc7e">NavEKF::_msecVelDelay</a></div><div class="ttdeci">AP_Int16 _msecVelDelay</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00474">AP_NavEKF.h:474</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a5acc5924c4a1100f963d8002eeb282a2"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a5acc5924c4a1100f963d8002eeb282a2">MAG_CAL_DEFAULT</a></div><div class="ttdeci">#define MAG_CAL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00090">AP_NavEKF.cpp:90</a></div></div>
<div class="ttc" id="classNavEKF_html_adbb3dbdaa665f1780aa2d473ef785845"><div class="ttname"><a href="classNavEKF.html#adbb3dbdaa665f1780aa2d473ef785845">NavEKF::terrainState</a></div><div class="ttdeci">float terrainState</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00706">AP_NavEKF.h:706</a></div></div>
<div class="ttc" id="Linux_2Util_8cpp_html_a89f234133d3efe315836311cbf21c64b"><div class="ttname"><a href="Linux_2Util_8cpp.html#a89f234133d3efe315836311cbf21c64b">state</a></div><div class="ttdeci">static int state</div><div class="ttdef"><b>Definition:</b> <a href="Linux_2Util_8cpp_source.html#l00016">Util.cpp:16</a></div></div>
<div class="ttc" id="classNavEKF_html_aaac625772ab0369814489a172b4ea9e7"><div class="ttname"><a href="classNavEKF.html#aaac625772ab0369814489a172b4ea9e7">NavEKF::gyroBiasNoiseScaler</a></div><div class="ttdeci">const float gyroBiasNoiseScaler</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00509">AP_NavEKF.h:509</a></div></div>
<div class="ttc" id="classNavEKF_html_a9c1aa11023c0d9aff8a091ebcc4a789d"><div class="ttname"><a href="classNavEKF.html#a9c1aa11023c0d9aff8a091ebcc4a789d">NavEKF::tasHealth</a></div><div class="ttdeci">bool tasHealth</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00538">AP_NavEKF.h:538</a></div></div>
<div class="ttc" id="classNavEKF_html_a96fd5d3fe1fa7ec75c5841e7eb99c100"><div class="ttname"><a href="classNavEKF.html#a96fd5d3fe1fa7ec75c5841e7eb99c100">NavEKF::_wndVarHgtRateScale</a></div><div class="ttdeci">AP_Float _wndVarHgtRateScale</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00467">AP_NavEKF.h:467</a></div></div>
<div class="ttc" id="classCompass_html_ab3787292557255d4b935b00fe7a94f68"><div class="ttname"><a href="classCompass.html#ab3787292557255d4b935b00fe7a94f68">Compass::healthy</a></div><div class="ttdeci">bool healthy[COMPASS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="Compass_8h_source.html#l00243">Compass.h:243</a></div></div>
<div class="ttc" id="classNavEKF_html_a5119fdbfa518bcab916ef8e4fbbae309"><div class="ttname"><a href="classNavEKF.html#a5119fdbfa518bcab916ef8e4fbbae309">NavEKF::gndEffectTimeout_ms</a></div><div class="ttdeci">const uint16_t gndEffectTimeout_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00528">AP_NavEKF.h:528</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a82b67b0c9761e790efbc11d5860920f2"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a82b67b0c9761e790efbc11d5860920f2">NavEKF::state_elements::position</a></div><div class="ttdeci">Vector3f position</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00272">AP_NavEKF.h:272</a></div></div>
<div class="ttc" id="classNavEKF_html_a0c379d143436bd0618a89a7935c58400"><div class="ttname"><a href="classNavEKF.html#a0c379d143436bd0618a89a7935c58400">NavEKF::prevVehicleArmed</a></div><div class="ttdeci">bool prevVehicleArmed</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00659">AP_NavEKF.h:659</a></div></div>
<div class="ttc" id="classNavEKF_html_a83bc985fa5b587e5d43f8482f93c763c"><div class="ttname"><a href="classNavEKF.html#a83bc985fa5b587e5d43f8482f93c763c">NavEKF::flowUpdateCount</a></div><div class="ttdeci">uint8_t flowUpdateCount</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00721">AP_NavEKF.h:721</a></div></div>
<div class="ttc" id="classNavEKF_html_a0a5952d2ee3852fcf00fc65032c48cf3"><div class="ttname"><a href="classNavEKF.html#a0a5952d2ee3852fcf00fc65032c48cf3">NavEKF::constPosMode</a></div><div class="ttdeci">bool constPosMode</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00606">AP_NavEKF.h:606</a></div></div>
<div class="ttc" id="classNavEKF_html_ae0f9a27d62a94d973281b2ee9bae4ac6"><div class="ttname"><a href="classNavEKF.html#ae0f9a27d62a94d973281b2ee9bae4ac6">NavEKF::newDataTas</a></div><div class="ttdeci">bool newDataTas</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00614">AP_NavEKF.h:614</a></div></div>
<div class="ttc" id="classNavEKF_html_abfa9617589db799ff0a405e34550f0dd"><div class="ttname"><a href="classNavEKF.html#abfa9617589db799ff0a405e34550f0dd">NavEKF::ConstrainVariances</a></div><div class="ttdeci">void ConstrainVariances()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03999">AP_NavEKF.cpp:3999</a></div></div>
<div class="ttc" id="classNavEKF_html_a619b70e1205a58b444e22a8d5b51f16d"><div class="ttname"><a href="classNavEKF.html#a619b70e1205a58b444e22a8d5b51f16d">NavEKF::InitialiseVariables</a></div><div class="ttdeci">void InitialiseVariables()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04538">AP_NavEKF.cpp:4538</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a8524c1ce54ed16e744f6690f713daa58"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a8524c1ce54ed16e744f6690f713daa58">HGT_GATE_DEFAULT</a></div><div class="ttdeci">#define HGT_GATE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00088">AP_NavEKF.cpp:88</a></div></div>
<div class="ttc" id="classAP__GPS_html_a9093c8cf1d5a78ccd8677229bb314d37"><div class="ttname"><a href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">AP_GPS::status</a></div><div class="ttdeci">GPS_Status status(uint8_t instance) const </div><div class="ttdoc">Query GPS status. </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00164">AP_GPS.h:164</a></div></div>
<div class="ttc" id="classNavEKF_html_a63a00adf98f2e2dd2ddf271201d880c4"><div class="ttname"><a href="classNavEKF.html#a63a00adf98f2e2dd2ddf271201d880c4">NavEKF::baroHgtOffset</a></div><div class="ttdeci">float baroHgtOffset</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00738">AP_NavEKF.h:738</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a04640c6b2d683cd1a657580c299f6a38"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a04640c6b2d683cd1a657580c299f6a38">POS_GATE_DEFAULT</a></div><div class="ttdeci">#define POS_GATE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00087">AP_NavEKF.cpp:87</a></div></div>
<div class="ttc" id="classNavEKF_html_aa9c0b8027f194f5e4735bc8cfede2503"><div class="ttname"><a href="classNavEKF.html#aa9c0b8027f194f5e4735bc8cfede2503">NavEKF::correctedDelAngQuat</a></div><div class="ttdeci">Quaternion correctedDelAngQuat</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00555">AP_NavEKF.h:555</a></div></div>
<div class="ttc" id="classNavEKF_html_a8525e5774e083f7187a7c4ed8609fa38"><div class="ttname"><a href="classNavEKF.html#a8525e5774e083f7187a7c4ed8609fa38">NavEKF::SelectBetaFusion</a></div><div class="ttdeci">void SelectBetaFusion()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l01088">AP_NavEKF.cpp:1088</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a></div><div class="ttdoc">Receiving valid messages and 2D lock. </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00095">AP_GPS.h:95</a></div></div>
<div class="ttc" id="classNavEKF_html_add9478dcd53d558470ce115bda94f5af"><div class="ttname"><a href="classNavEKF.html#add9478dcd53d558470ce115bda94f5af">NavEKF::dtIMUavg</a></div><div class="ttdeci">ftype dtIMUavg</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00569">AP_NavEKF.h:569</a></div></div>
<div class="ttc" id="classAP__AHRS_html_abfedb071fb724826675bbe3186eeb9e3"><div class="ttname"><a href="classAP__AHRS.html#abfedb071fb724826675bbe3186eeb9e3">AP_AHRS::get_error_rp</a></div><div class="ttdeci">virtual float get_error_rp(void) const =0</div></div>
<div class="ttc" id="classNavEKF_html_ae9a923b1ced7c82894cbd0c2caebadee"><div class="ttname"><a href="classNavEKF.html#ae9a923b1ced7c82894cbd0c2caebadee">NavEKF::velDotNEDfilt</a></div><div class="ttdeci">Vector3f velDotNEDfilt</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00609">AP_NavEKF.h:609</a></div></div>
<div class="ttc" id="classNavEKF_html_af87a2a59a63349321588523f47027747"><div class="ttname"><a href="classNavEKF.html#af87a2a59a63349321588523f47027747">NavEKF::fuseOptFlowData</a></div><div class="ttdeci">bool fuseOptFlowData</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00690">AP_NavEKF.h:690</a></div></div>
<div class="ttc" id="classNavEKF_html_a7d009a7072d4746586d26cac43f288d2"><div class="ttname"><a href="classNavEKF.html#a7d009a7072d4746586d26cac43f288d2">NavEKF::statesAtRngTime</a></div><div class="ttdeci">state_elements statesAtRngTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00709">AP_NavEKF.h:709</a></div></div>
<div class="ttc" id="classNavEKF_html_a673720d0bd4db0031acc55cbf0309ceb"><div class="ttname"><a href="classNavEKF.html#a673720d0bd4db0031acc55cbf0309ceb">NavEKF::statesAtPosTime</a></div><div class="ttdeci">state_elements statesAtPosTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00586">AP_NavEKF.h:586</a></div></div>
<div class="ttc" id="classNavEKF_html_acc95e88cc639bb7672a907e0e51f854d"><div class="ttname"><a href="classNavEKF.html#acc95e88cc639bb7672a907e0e51f854d">NavEKF::StoreStates</a></div><div class="ttdeci">void StoreStates(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03527">AP_NavEKF.cpp:3527</a></div></div>
<div class="ttc" id="classQuaternion_html_a6c21fe33378aa16a33cba869ba4af5dc"><div class="ttname"><a href="classQuaternion.html#a6c21fe33378aa16a33cba869ba4af5dc">Quaternion::from_axis_angle</a></div><div class="ttdeci">void from_axis_angle(Vector3f v)</div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8cpp_source.html#l00142">quaternion.cpp:142</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_ae4daab54339a9af7eb97d380e2b65c2f"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#ae4daab54339a9af7eb97d380e2b65c2f">NavEKF::state_elements::accel_zbias2</a></div><div class="ttdeci">float accel_zbias2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00278">AP_NavEKF.h:278</a></div></div>
<div class="ttc" id="classNavEKF_html_afeacabb24861b5cca5211eb8e0cc2917"><div class="ttname"><a href="classNavEKF.html#afeacabb24861b5cca5211eb8e0cc2917">NavEKF::mag_state</a></div><div class="ttdeci">struct NavEKF::@33 mag_state</div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_afc8bd464e2802810d4493cbea6591972"><div class="ttname"><a href="AP__NavEKF_8cpp.html#afc8bd464e2802810d4493cbea6591972">FLOW_GATE_DEFAULT</a></div><div class="ttdeci">#define FLOW_GATE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00095">AP_NavEKF.cpp:95</a></div></div>
<div class="ttc" id="classVector3_html_ac1fd5514e368a1e1c2d13f71eda18345"><div class="ttname"><a href="classVector3.html#ac1fd5514e368a1e1c2d13f71eda18345">Vector3::length</a></div><div class="ttdeci">float length(void) const </div><div class="ttdef"><b>Definition:</b> <a href="vector3_8cpp_source.html#l00252">vector3.cpp:252</a></div></div>
<div class="ttc" id="classNavEKF_html_a269fafed960b894f2f170bdb66e367dd"><div class="ttname"><a href="classNavEKF.html#a269fafed960b894f2f170bdb66e367dd">NavEKF::lastHgtPassTime</a></div><div class="ttdeci">uint32_t lastHgtPassTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00622">AP_NavEKF.h:622</a></div></div>
<div class="ttc" id="classNavEKF_html_a22250b5dd5beb633d424ed895659039f"><div class="ttname"><a href="classNavEKF.html#a22250b5dd5beb633d424ed895659039f">NavEKF::getTouchdownExpected</a></div><div class="ttdeci">bool getTouchdownExpected()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05017">AP_NavEKF.cpp:5017</a></div></div>
<div class="ttc" id="classNavEKF_html_ad418b75ceae3dde42f8c588b7e88abb4"><div class="ttname"><a href="classNavEKF.html#ad418b75ceae3dde42f8c588b7e88abb4">NavEKF::healthy</a></div><div class="ttdeci">bool healthy(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00429">AP_NavEKF.cpp:429</a></div></div>
<div class="ttc" id="classNavEKF_html_ae77495e0011e8bc93a057a66c3e39521"><div class="ttname"><a href="classNavEKF.html#ae77495e0011e8bc93a057a66c3e39521">NavEKF::fuseVelData</a></div><div class="ttdeci">bool fuseVelData</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00579">AP_NavEKF.h:579</a></div></div>
<div class="ttc" id="classNavEKF_html_aede9e0e542bbf09e7815a71cd3ed3437"><div class="ttname"><a href="classNavEKF.html#aede9e0e542bbf09e7815a71cd3ed3437">NavEKF::assume_zero_sideslip</a></div><div class="ttdeci">bool assume_zero_sideslip(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04716">AP_NavEKF.cpp:4716</a></div></div>
<div class="ttc" id="classNavEKF_html_a28bfd83f329595dc26ba1dce262c4c19"><div class="ttname"><a href="classNavEKF.html#a28bfd83f329595dc26ba1dce262c4c19">NavEKF::manoeuvring</a></div><div class="ttdeci">bool manoeuvring</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00575">AP_NavEKF.h:575</a></div></div>
<div class="ttc" id="classNavEKF_html_a2ef01d55f65156c80bcd8ef8ef3ac909"><div class="ttname"><a href="classNavEKF.html#a2ef01d55f65156c80bcd8ef8ef3ac909">NavEKF::resetGyroBias</a></div><div class="ttdeci">void resetGyroBias(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03682">AP_NavEKF.cpp:3682</a></div></div>
<div class="ttc" id="classVector3_html_a9b147a862a1b86ed2e5b735d19da3da1"><div class="ttname"><a href="classVector3.html#a9b147a862a1b86ed2e5b735d19da3da1">Vector3::normalize</a></div><div class="ttdeci">void normalize()</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00175">vector3.h:175</a></div></div>
<div class="ttc" id="classNavEKF_html_a108cf3c8f5e4cfa274249eacebe33298"><div class="ttname"><a href="classNavEKF.html#a108cf3c8f5e4cfa274249eacebe33298">NavEKF::magFailTimeLimit_ms</a></div><div class="ttdeci">const uint32_t magFailTimeLimit_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00507">AP_NavEKF.h:507</a></div></div>
<div class="ttc" id="classNavEKF_html_a5e82d7eb114f6e4b37f15564c22f46b7"><div class="ttname"><a href="classNavEKF.html#a5e82d7eb114f6e4b37f15564c22f46b7">NavEKF::earthRateNED</a></div><div class="ttdeci">Vector3f earthRateNED</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00565">AP_NavEKF.h:565</a></div></div>
<div class="ttc" id="classNavEKF_html_a703d77a71d6bd0be67dcfb9ad1d1eb97"><div class="ttname"><a href="classNavEKF.html#a703d77a71d6bd0be67dcfb9ad1d1eb97">NavEKF::flowIncrStateDelta</a></div><div class="ttdeci">Vector10 flowIncrStateDelta</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00724">AP_NavEKF.h:724</a></div></div>
<div class="ttc" id="classNavEKF_html_a96c31aaedf02ab8cc9f33c7da1d85fd8"><div class="ttname"><a href="classNavEKF.html#a96c31aaedf02ab8cc9f33c7da1d85fd8">NavEKF::hgtTestRatio</a></div><div class="ttdeci">float hgtTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00647">AP_NavEKF.h:647</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a2af8cc9d990e7ff559392286c7120c1f"><div class="ttname"><a href="calcH__MAG_8c.html#a2af8cc9d990e7ff559392286c7120c1f">t14</a></div><div class="ttdeci">t14</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00013">calcH_MAG.c:13</a></div></div>
<div class="ttc" id="classNavEKF_html_a1e9023c03f695e3685b396ab94728bb9"><div class="ttname"><a href="classNavEKF.html#a1e9023c03f695e3685b396ab94728bb9">NavEKF::q1</a></div><div class="ttdeci">ftype q1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00765">AP_NavEKF.h:765</a></div></div>
<div class="ttc" id="classNavEKF_html_acc762a0249338693cdd04ed6a51b7b86"><div class="ttname"><a href="classNavEKF.html#acc762a0249338693cdd04ed6a51b7b86">NavEKF::flowUpdateCountMaxInv</a></div><div class="ttdeci">float flowUpdateCountMaxInv</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00723">AP_NavEKF.h:723</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a94492e11259113c24733219b832878b6"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a94492e11259113c24733219b832878b6">STARTUP_WIND_SPEED</a></div><div class="ttdeci">#define STARTUP_WIND_SPEED</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00106">AP_NavEKF.cpp:106</a></div></div>
<div class="ttc" id="classNavEKF_html_a7ee46142ad96265b38516044aa506906"><div class="ttname"><a href="classNavEKF.html#a7ee46142ad96265b38516044aa506906">NavEKF::magZbias</a></div><div class="ttdeci">ftype magZbias</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00796">AP_NavEKF.h:796</a></div></div>
<div class="ttc" id="classNavEKF_html_a0779a1ae19736ff610bc33032eecefc1"><div class="ttname"><a href="classNavEKF.html#a0779a1ae19736ff610bc33032eecefc1">NavEKF::lastAirspeedUpdate</a></div><div class="ttdeci">uint32_t lastAirspeedUpdate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00610">AP_NavEKF.h:610</a></div></div>
<div class="ttc" id="classNavEKF_html_affa6086752a2e15969daf07961f9e051"><div class="ttname"><a href="classNavEKF.html#affa6086752a2e15969daf07961f9e051">NavEKF::ResetPosition</a></div><div class="ttdeci">void ResetPosition(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00456">AP_NavEKF.cpp:456</a></div></div>
<div class="ttc" id="classNavEKF_html_a09aca3d45616daec8ede188f54dc3734"><div class="ttname"><a href="classNavEKF.html#a09aca3d45616daec8ede188f54dc3734">NavEKF::_perf_FuseMagnetometer</a></div><div class="ttdeci">perf_counter_t _perf_FuseMagnetometer</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00810">AP_NavEKF.h:810</a></div></div>
<div class="ttc" id="classAP__Baro_html_aae5b3ae28aca807eb20b722a04685061"><div class="ttname"><a href="classAP__Baro.html#aae5b3ae28aca807eb20b722a04685061">AP_Baro::get_last_update</a></div><div class="ttdeci">uint32_t get_last_update(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00105">AP_Baro.h:105</a></div></div>
<div class="ttc" id="structLocation_html_ad9759dba1fc13f13c531ebdcb2c9588e"><div class="ttname"><a href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">Location::flags</a></div><div class="ttdeci">Location_Option_Flags flags</div><div class="ttdoc">options bitmask (1&lt;&lt;0 = relative altitude) </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00107">AP_Common.h:107</a></div></div>
<div class="ttc" id="classNavEKF_html_a17086cdf3fc411329b12faa25b1713f1"><div class="ttname"><a href="classNavEKF.html#a17086cdf3fc411329b12faa25b1713f1">NavEKF::optFlowDataPresent</a></div><div class="ttdeci">bool optFlowDataPresent(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04665">AP_NavEKF.cpp:4665</a></div></div>
<div class="ttc" id="classCompass_html_a6ef45f63ac177793bf38270cef8228cb"><div class="ttname"><a href="classCompass.html#a6ef45f63ac177793bf38270cef8228cb">Compass::get_offsets</a></div><div class="ttdeci">const Vector3f &amp; get_offsets(uint8_t i) const </div><div class="ttdef"><b>Definition:</b> <a href="Compass_8h_source.html#l00116">Compass.h:116</a></div></div>
<div class="ttc" id="AP__AHRS_8h_html"><div class="ttname"><a href="AP__AHRS_8h.html">AP_AHRS.h</a></div></div>
<div class="ttc" id="classNavEKF_html_ad30b802b59220c5c32750c5d28397d5b"><div class="ttname"><a href="classNavEKF.html#ad30b802b59220c5c32750c5d28397d5b">NavEKF::velNED</a></div><div class="ttdeci">Vector3f velNED</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00582">AP_NavEKF.h:582</a></div></div>
<div class="ttc" id="classNavEKF_html_aeaae7c89924a1c30e39b67e9e6d97e28"><div class="ttname"><a href="classNavEKF.html#aeaae7c89924a1c30e39b67e9e6d97e28">NavEKF::_gndGradientSigma</a></div><div class="ttdeci">AP_Int8 _gndGradientSigma</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00485">AP_NavEKF.h:485</a></div></div>
<div class="ttc" id="AP__Vehicle_8h_html"><div class="ttname"><a href="AP__Vehicle_8h.html">AP_Vehicle.h</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_abd2b7c8d517daa27d47b67217a881e17"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#abd2b7c8d517daa27d47b67217a881e17">NavEKF::state_elements::posD1</a></div><div class="ttdeci">float posD1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00280">AP_NavEKF.h:280</a></div></div>
<div class="ttc" id="classNavEKF_html_a9e9c96c8c6469b1bf9b2a7f973a1cca2"><div class="ttname"><a href="classNavEKF.html#a9e9c96c8c6469b1bf9b2a7f973a1cca2">NavEKF::varInnovOptFlow</a></div><div class="ttdeci">Vector2 varInnovOptFlow</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00703">AP_NavEKF.h:703</a></div></div>
<div class="ttc" id="classNavEKF_html_ac786ebf1b73275ba6ea744c0648b1d76"><div class="ttname"><a href="classNavEKF.html#ac786ebf1b73275ba6ea744c0648b1d76">NavEKF::getVariances</a></div><div class="ttdeci">void getVariances(float &amp;velVar, float &amp;posVar, float &amp;hgtVar, Vector3f &amp;magVar, float &amp;tasVar, Vector2f &amp;offset) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04525">AP_NavEKF.cpp:4525</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfac1022faba58ff86b20a9efb07dae5eca"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfac1022faba58ff86b20a9efb07dae5eca">EKF_VELOCITY_HORIZ</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00336">ardupilotmega.h:336</a></div></div>
<div class="ttc" id="classNavEKF_html_ac3ca17ee02d5d5aac81457b86d77f2af"><div class="ttname"><a href="classNavEKF.html#ac3ca17ee02d5d5aac81457b86d77f2af">NavEKF::lastGyroBias</a></div><div class="ttdeci">Vector3f lastGyroBias</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00561">AP_NavEKF.h:561</a></div></div>
<div class="ttc" id="classNavEKF_html_a36ca8cd566775ade1ddcb1933d029d15"><div class="ttname"><a href="classNavEKF.html#a36ca8cd566775ade1ddcb1933d029d15">NavEKF::KH</a></div><div class="ttdeci">Matrix22 KH</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00549">AP_NavEKF.h:549</a></div></div>
<div class="ttc" id="classNavEKF_html_a8fbcd9282f3dcf7cd4b6bab74a1ac1e5"><div class="ttname"><a href="classNavEKF.html#a8fbcd9282f3dcf7cd4b6bab74a1ac1e5">NavEKF::hgtUpdateCountMax</a></div><div class="ttdeci">uint8_t hgtUpdateCountMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00679">AP_NavEKF.h:679</a></div></div>
<div class="ttc" id="classMatrix3_html_a90cfd0bec53253429603b5600dcdce81"><div class="ttname"><a href="classMatrix3.html#a90cfd0bec53253429603b5600dcdce81">Matrix3::zero</a></div><div class="ttdeci">void zero(void)</div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8cpp_source.html#l00184">matrix3.cpp:184</a></div></div>
<div class="ttc" id="classNavEKF_html_a889fc596b783daa58c668abac1975345"><div class="ttname"><a href="classNavEKF.html#a889fc596b783daa58c668abac1975345">NavEKF::hgtTimeout</a></div><div class="ttdeci">bool hgtTimeout</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00541">AP_NavEKF.h:541</a></div></div>
<div class="ttc" id="classNavEKF_html_a7bf2627b0844597c21b9736204fd672f"><div class="ttname"><a href="classNavEKF.html#a7bf2627b0844597c21b9736204fd672f">NavEKF::setOrigin</a></div><div class="ttdeci">void setOrigin()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04971">AP_NavEKF.cpp:4971</a></div></div>
<div class="ttc" id="classNavEKF_html_aef1c557739419cc240386b4f3c8e7983"><div class="ttname"><a href="classNavEKF.html#aef1c557739419cc240386b4f3c8e7983">NavEKF::prevTnb</a></div><div class="ttdeci">Matrix3f prevTnb</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00562">AP_NavEKF.h:562</a></div></div>
<div class="ttc" id="classNavEKF_html_aed610d847a3d3cb3190394ca0bf15365"><div class="ttname"><a href="classNavEKF.html#aed610d847a3d3cb3190394ca0bf15365">NavEKF::dt</a></div><div class="ttdeci">ftype dt</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00571">AP_NavEKF.h:571</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a96994a7b9809909fd8f626cfad5a0cfa"><div class="ttname"><a href="calcH__MAG_8c.html#a96994a7b9809909fd8f626cfad5a0cfa">t23</a></div><div class="ttdeci">t23</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00022">calcH_MAG.c:22</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a1ed1b5c6e35ed0e61f04b94c4f96133c"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a1ed1b5c6e35ed0e61f04b94c4f96133c">VEL_GATE_DEFAULT</a></div><div class="ttdeci">#define VEL_GATE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00086">AP_NavEKF.cpp:86</a></div></div>
<div class="ttc" id="classNavEKF_html_a783ccf1ecdea0b4b1fe19ae7e771fc3a"><div class="ttname"><a href="classNavEKF.html#a783ccf1ecdea0b4b1fe19ae7e771fc3a">NavEKF::fuseHgtData</a></div><div class="ttdeci">bool fuseHgtData</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00581">AP_NavEKF.h:581</a></div></div>
<div class="ttc" id="classNavEKF_html_ad3d371f0125528a6ca2f3a996e7a4ad6"><div class="ttname"><a href="classNavEKF.html#ad3d371f0125528a6ca2f3a996e7a4ad6">NavEKF::readDeltaVelocity</a></div><div class="ttdeci">bool readDeltaVelocity(uint8_t ins_index, Vector3f &amp;dVel, float &amp;dVel_dt)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04036">AP_NavEKF.cpp:4036</a></div></div>
<div class="ttc" id="classNavEKF_html_a290932b02347c5247f036fbc3c7af9d8"><div class="ttname"><a href="classNavEKF.html#a290932b02347c5247f036fbc3c7af9d8">NavEKF::InitialiseFilterBootstrap</a></div><div class="ttdeci">bool InitialiseFilterBootstrap(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00589">AP_NavEKF.cpp:589</a></div></div>
<div class="ttc" id="classNavEKF_html_acc76fcd8b8c642d2bebbcea04803918f"><div class="ttname"><a href="classNavEKF.html#acc76fcd8b8c642d2bebbcea04803918f">NavEKF::gpsVelGlitchOffset</a></div><div class="ttdeci">Vector2f gpsVelGlitchOffset</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00656">AP_NavEKF.h:656</a></div></div>
<div class="ttc" id="classNavEKF_html_aa91014258fb5b42fa4e1c33353f775ef"><div class="ttname"><a href="classNavEKF.html#aa91014258fb5b42fa4e1c33353f775ef">NavEKF::magYbias</a></div><div class="ttdeci">ftype magYbias</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00795">AP_NavEKF.h:795</a></div></div>
<div class="ttc" id="classNavEKF_html_a9edebf0f3984be8ac3a94070e5ccccbc"><div class="ttname"><a href="classNavEKF.html#a9edebf0f3984be8ac3a94070e5ccccbc">NavEKF::flowMeaTime_ms</a></div><div class="ttdeci">uint32_t flowMeaTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00697">AP_NavEKF.h:697</a></div></div>
<div class="ttc" id="classQuaternion_html_afb7132c9c69a984a40be950a17effeaa"><div class="ttname"><a href="classQuaternion.html#afb7132c9c69a984a40be950a17effeaa">Quaternion::rotation_matrix</a></div><div class="ttdeci">void rotation_matrix(Matrix3f &amp;m) const </div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8cpp_source.html#l00023">quaternion.cpp:23</a></div></div>
<div class="ttc" id="classNavEKF_html_aeed006203acc8a02856514f330b17ed7"><div class="ttname"><a href="classNavEKF.html#aeed006203acc8a02856514f330b17ed7">NavEKF::BETAmsecPrev</a></div><div class="ttdeci">uint32_t BETAmsecPrev</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00603">AP_NavEKF.h:603</a></div></div>
<div class="ttc" id="classNavEKF_html_ac52244eda24db6db88d6364af75934cf"><div class="ttname"><a href="classNavEKF.html#ac52244eda24db6db88d6364af75934cf">NavEKF::q3</a></div><div class="ttdeci">ftype q3</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00767">AP_NavEKF.h:767</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_ad5dd8be9d3136630d1ab0c84d00f8bed"><div class="ttname"><a href="calcH__MAG_8c.html#ad5dd8be9d3136630d1ab0c84d00f8bed">t15</a></div><div class="ttdeci">t15</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00014">calcH_MAG.c:14</a></div></div>
<div class="ttc" id="structVector2_html_a78fa1f2ed5e261c7fbeb8f3536a1ee34"><div class="ttname"><a href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">Vector2::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="vector2_8h_source.html#l00040">vector2.h:40</a></div></div>
<div class="ttc" id="classNavEKF_html_a3925b0ab8bf958e0a8dfb84cd591c8b3"><div class="ttname"><a href="classNavEKF.html#a3925b0ab8bf958e0a8dfb84cd591c8b3">NavEKF::getVelNED</a></div><div class="ttdeci">void getVelNED(Vector3f &amp;vel) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03626">AP_NavEKF.cpp:3626</a></div></div>
<div class="ttc" id="classQuaternion_html_a48e6bafb249c895ed25f29dc9170e11e"><div class="ttname"><a href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">Quaternion::normalize</a></div><div class="ttdeci">void normalize()</div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8cpp_source.html#l00280">quaternion.cpp:280</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_ad63ffee70a630b49aa4e5677ad59c3a9"><div class="ttname"><a href="calcH__MAG_8c.html#ad63ffee70a630b49aa4e5677ad59c3a9">t3</a></div><div class="ttdeci">t3</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00002">calcH_MAG.c:2</a></div></div>
<div class="ttc" id="classNavEKF_html_a9df8b078c6da464dd8aa858675eae659"><div class="ttname"><a href="classNavEKF.html#a9df8b078c6da464dd8aa858675eae659">NavEKF::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00258">AP_NavEKF.h:258</a></div></div>
<div class="ttc" id="classNavEKF_html_af4f43124b5822af7ceb49ba80fa045e3"><div class="ttname"><a href="classNavEKF.html#af4f43124b5822af7ceb49ba80fa045e3">NavEKF::flowRadXYcomp</a></div><div class="ttdeci">Vector2 flowRadXYcomp</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00693">AP_NavEKF.h:693</a></div></div>
<div class="ttc" id="classNavEKF_html_ac5f621c055f03f974a1bb5d9a34cb931"><div class="ttname"><a href="classNavEKF.html#ac5f621c055f03f974a1bb5d9a34cb931">NavEKF::SF</a></div><div class="ttdeci">Vector15 SF</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00636">AP_NavEKF.h:636</a></div></div>
<div class="ttc" id="structLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdoc">param 4 - Longitude * 10**7 </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00116">AP_Common.h:116</a></div></div>
<div class="ttc" id="classNavEKF_html_acea66c70376189fe4399fd1c355a793f"><div class="ttname"><a href="classNavEKF.html#acea66c70376189fe4399fd1c355a793f">NavEKF::hgtUpdateCount</a></div><div class="ttdeci">uint8_t hgtUpdateCount</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00678">AP_NavEKF.h:678</a></div></div>
<div class="ttc" id="classNavEKF_html_a11268c75bd9e5061c56d9d0776634edc"><div class="ttname"><a href="classNavEKF.html#a11268c75bd9e5061c56d9d0776634edc">NavEKF::yawRateFilt</a></div><div class="ttdeci">float yawRateFilt</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00669">AP_NavEKF.h:669</a></div></div>
<div class="ttc" id="classNavEKF_html_a0229be7ce43a7a835026448d57b52e23"><div class="ttname"><a href="classNavEKF.html#a0229be7ce43a7a835026448d57b52e23">NavEKF::KHP</a></div><div class="ttdeci">Matrix22 KHP</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00550">AP_NavEKF.h:550</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_aeb523909236437827ddecee5cdfbe0ff"><div class="ttname"><a href="unionnav__filter__status.html#aeb523909236437827ddecee5cdfbe0ff">nav_filter_status::horiz_pos_rel</a></div><div class="ttdeci">uint16_t horiz_pos_rel</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00027">AP_Nav_Common.h:27</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ada62278a4b460237f914e1c6a5355e55"><div class="ttname"><a href="AP__Math_8h.html#ada62278a4b460237f914e1c6a5355e55">wrap_PI</a></div><div class="ttdeci">float wrap_PI(float angle_in_radians)</div><div class="ttdef"><b>Definition:</b> <a href="location_8cpp_source.html#l00208">location.cpp:208</a></div></div>
<div class="ttc" id="classNavEKF_html_a2f5fa2977d33ddd0c5f8d350c049cd2c"><div class="ttname"><a href="classNavEKF.html#a2f5fa2977d33ddd0c5f8d350c049cd2c">NavEKF::tasTestRatio</a></div><div class="ttdeci">float tasTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00649">AP_NavEKF.h:649</a></div></div>
<div class="ttc" id="classNavEKF_html_a2eb7c3839fa75aef22700e1c03d2fc0b"><div class="ttname"><a href="classNavEKF.html#a2eb7c3839fa75aef22700e1c03d2fc0b">NavEKF::faultStatus</a></div><div class="ttdeci">struct NavEKF::@32 faultStatus</div></div>
<div class="ttc" id="classNavEKF_html_a50f655be7d57ef4d23c9d7d1007c02ea"><div class="ttname"><a href="classNavEKF.html#a50f655be7d57ef4d23c9d7d1007c02ea">NavEKF::flowTestRatio</a></div><div class="ttdeci">Vector2 flowTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00716">AP_NavEKF.h:716</a></div></div>
<div class="ttc" id="classNavEKF_html_ab5af5cb7fb1076a855e4eacebc14daba"><div class="ttname"><a href="classNavEKF.html#ab5af5cb7fb1076a855e4eacebc14daba">NavEKF::_gpsPosInnovGate</a></div><div class="ttdeci">AP_Int8 _gpsPosInnovGate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00478">AP_NavEKF.h:478</a></div></div>
<div class="ttc" id="classQuaternion_html_aa3036ce97bb5a7394a2d65edecd8f1ab"><div class="ttname"><a href="classQuaternion.html#aa3036ce97bb5a7394a2d65edecd8f1ab">Quaternion::is_nan</a></div><div class="ttdeci">bool is_nan(void) const </div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8h_source.html#l00051">quaternion.h:51</a></div></div>
<div class="ttc" id="classNavEKF_html_a736a3224673c62453aaf9a9035d1470a"><div class="ttname"><a href="classNavEKF.html#a736a3224673c62453aaf9a9035d1470a">NavEKF::prevPosN</a></div><div class="ttdeci">float prevPosN</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00707">AP_NavEKF.h:707</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a804705b86ec3b055a1b0f8d8baf6e6b4"><div class="ttname"><a href="calcH__MAG_8c.html#a804705b86ec3b055a1b0f8d8baf6e6b4">t8</a></div><div class="ttdeci">t8</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00007">calcH_MAG.c:7</a></div></div>
<div class="ttc" id="classNavEKF_html_afd23b087248e7c8bb5b65f834ba9544e"><div class="ttname"><a href="classNavEKF.html#afd23b087248e7c8bb5b65f834ba9544e">NavEKF::calcQuatAndFieldStates</a></div><div class="ttdeci">Quaternion calcQuatAndFieldStates(float roll, float pitch)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04365">AP_NavEKF.cpp:4365</a></div></div>
<div class="ttc" id="classNavEKF_html_a90a1fa4f67a09d5af0a6d2a11580269f"><div class="ttname"><a href="classNavEKF.html#a90a1fa4f67a09d5af0a6d2a11580269f">NavEKF::getPosNED</a></div><div class="ttdeci">bool getPosNED(Vector3f &amp;pos) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03633">AP_NavEKF.cpp:3633</a></div></div>
<div class="ttc" id="classNavEKF_html_aeb335cf7b5bc6c54905b2d2e51b48d30"><div class="ttname"><a href="classNavEKF.html#aeb335cf7b5bc6c54905b2d2e51b48d30">NavEKF::getOriginLLH</a></div><div class="ttdeci">bool getOriginLLH(struct Location &amp;loc) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04978">AP_NavEKF.cpp:4978</a></div></div>
<div class="ttc" id="classNavEKF_html_a6dd42da4655ea2038e6c33c5fc55a4ce"><div class="ttname"><a href="classNavEKF.html#a6dd42da4655ea2038e6c33c5fc55a4ce">NavEKF::setTouchdownExpected</a></div><div class="ttdeci">void setTouchdownExpected(bool val)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05028">AP_NavEKF.cpp:5028</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab9667a2efe22a330232d6ba425c78364"><div class="ttname"><a href="classAP__GPS.html#ab9667a2efe22a330232d6ba425c78364">AP_GPS::horizontal_accuracy</a></div><div class="ttdeci">bool horizontal_accuracy(uint8_t instance, float &amp;hacc) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00195">AP_GPS.h:195</a></div></div>
<div class="ttc" id="classNavEKF_html_a2be25c24c75b63c69ec5051b1b6d6c41"><div class="ttname"><a href="classNavEKF.html#a2be25c24c75b63c69ec5051b1b6d6c41">NavEKF::_gyroBiasProcessNoise</a></div><div class="ttdeci">AP_Float _gyroBiasProcessNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00472">AP_NavEKF.h:472</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a76c230df585d816181a91a1f3cabf434"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a76c230df585d816181a91a1f3cabf434">NavEKF::state_elements::body_magfield</a></div><div class="ttdeci">Vector3f body_magfield</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00277">AP_NavEKF.h:277</a></div></div>
<div class="ttc" id="classNavEKF_html_a8071e344cd833c0d7e511de9f423ff88"><div class="ttname"><a href="classNavEKF.html#a8071e344cd833c0d7e511de9f423ff88">NavEKF::calcEarthRateNED</a></div><div class="ttdeci">void calcEarthRateNED(Vector3f &amp;omega, int32_t latitude) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04354">AP_NavEKF.cpp:4354</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a7c3c3fcc625241253a23a2b68805d0a7"><div class="ttname"><a href="calcH__MAG_8c.html#a7c3c3fcc625241253a23a2b68805d0a7">t5</a></div><div class="ttdeci">t5</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00004">calcH_MAG.c:4</a></div></div>
<div class="ttc" id="classNavEKF_html_aba3fd29d5b5e57944f4bd7977d9ff5a0"><div class="ttname"><a href="classNavEKF.html#aba3fd29d5b5e57944f4bd7977d9ff5a0">NavEKF::quat2Tbn</a></div><div class="ttdeci">void quat2Tbn(Matrix3f &amp;Tbn, const Quaternion &amp;quat) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03605">AP_NavEKF.cpp:3605</a></div></div>
<div class="ttc" id="classNavEKF_html_a745bb9dd1c9c7377dc8971b4b315f28e"><div class="ttname"><a href="classNavEKF.html#a745bb9dd1c9c7377dc8971b4b315f28e">NavEKF::correctedDelVel12</a></div><div class="ttdeci">Vector3f correctedDelVel12</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00556">AP_NavEKF.h:556</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a3316284b2bf12b8db1b4a39539799efc"><div class="ttname"><a href="classAP__AHRS.html#a3316284b2bf12b8db1b4a39539799efc">AP_AHRS::get_gps</a></div><div class="ttdeci">const AP_GPS &amp; get_gps() const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00171">AP_AHRS.h:171</a></div></div>
<div class="ttc" id="classNavEKF_html_a581b552408119cbd88f0c83690583cd9"><div class="ttname"><a href="classNavEKF.html#a581b552408119cbd88f0c83690583cd9">NavEKF::velHealth</a></div><div class="ttdeci">bool velHealth</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00534">AP_NavEKF.h:534</a></div></div>
<div class="ttc" id="classNavEKF_html_a10b41615971fa8b09603c14088e526ef"><div class="ttname"><a href="classNavEKF.html#a10b41615971fa8b09603c14088e526ef">NavEKF::storedStates</a></div><div class="ttdeci">VectorN&lt; state_elements, 50 &gt; storedStates</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00552">AP_NavEKF.h:552</a></div></div>
<div class="ttc" id="classNavEKF_html_aae4b7b974327d3a54daf9bf78e667a52"><div class="ttname"><a href="classNavEKF.html#aae4b7b974327d3a54daf9bf78e667a52">NavEKF::badMag</a></div><div class="ttdeci">bool badMag</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00544">AP_NavEKF.h:544</a></div></div>
<div class="ttc" id="structVector2_html_a6b537328ae913e3e7267b539e7a4af92"><div class="ttname"><a href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">Vector2::zero</a></div><div class="ttdeci">void zero()</div><div class="ttdef"><b>Definition:</b> <a href="vector2_8h_source.html#l00109">vector2.h:109</a></div></div>
<div class="ttc" id="classNavEKF_html_a1f1806842e132701a67b46c9f7139e1c"><div class="ttname"><a href="classNavEKF.html#a1f1806842e132701a67b46c9f7139e1c">NavEKF::_gpsHorizVelNoise</a></div><div class="ttdeci">AP_Float _gpsHorizVelNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00460">AP_NavEKF.h:460</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a45357ce4e0057215a0ade439e63daa79"><div class="ttname"><a href="classAP__AHRS.html#a45357ce4e0057215a0ade439e63daa79">AP_AHRS::get_correct_centrifugal</a></div><div class="ttdeci">bool get_correct_centrifugal(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00305">AP_AHRS.h:305</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_ae95ab11d59379638967673bd74654b2a"><div class="ttname"><a href="calcH__MAG_8c.html#ae95ab11d59379638967673bd74654b2a">t4</a></div><div class="ttdeci">t4</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00003">calcH_MAG.c:3</a></div></div>
<div class="ttc" id="classNavEKF_html_a22317183f862c0e772190633317d77e7"><div class="ttname"><a href="classNavEKF.html#a22317183f862c0e772190633317d77e7">NavEKF::fusePosData</a></div><div class="ttdeci">bool fusePosData</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00580">AP_NavEKF.h:580</a></div></div>
<div class="ttc" id="classNavEKF_html_addb269a21ef9657d2b86ced6ae64a8f9"><div class="ttname"><a href="classNavEKF.html#addb269a21ef9657d2b86ced6ae64a8f9">NavEKF::badIMUdata</a></div><div class="ttdeci">bool badIMUdata</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00545">AP_NavEKF.h:545</a></div></div>
<div class="ttc" id="classNavEKF_html_a004ab08b00cefe4e09a910bb7eef2a3b"><div class="ttname"><a href="classNavEKF.html#a004ab08b00cefe4e09a910bb7eef2a3b">NavEKF::posDownAtArming</a></div><div class="ttdeci">float posDownAtArming</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00667">AP_NavEKF.h:667</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a89a70e81b9a7012025c7e5e490fc35a4"><div class="ttname"><a href="unionnav__filter__status.html#a89a70e81b9a7012025c7e5e490fc35a4">nav_filter_status::const_pos_mode</a></div><div class="ttdeci">uint16_t const_pos_mode</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00031">AP_Nav_Common.h:31</a></div></div>
<div class="ttc" id="classNavEKF_html_a12500a621febd8f914f6e16db4c28759"><div class="ttname"><a href="classNavEKF.html#a12500a621febd8f914f6e16db4c28759">NavEKF::InitialiseFilterDynamic</a></div><div class="ttdeci">bool InitialiseFilterDynamic(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00518">AP_NavEKF.cpp:518</a></div></div>
<div class="ttc" id="classNavEKF_html_ac9abf6cd97300918fd5de34b295d4a07"><div class="ttname"><a href="classNavEKF.html#ac9abf6cd97300918fd5de34b295d4a07">NavEKF::q0</a></div><div class="ttdeci">ftype q0</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00764">AP_NavEKF.h:764</a></div></div>
<div class="ttc" id="classNavEKF_html_aaff17cca139a3ba16009e124e3e7ec0f"><div class="ttname"><a href="classNavEKF.html#aaff17cca139a3ba16009e124e3e7ec0f">NavEKF::_gpsVelInnovGate</a></div><div class="ttdeci">AP_Int8 _gpsVelInnovGate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00477">AP_NavEKF.h:477</a></div></div>
<div class="ttc" id="classNavEKF_html_a0f328969ff5f2ed7349d760661a65a62"><div class="ttname"><a href="classNavEKF.html#a0f328969ff5f2ed7349d760661a65a62">NavEKF::fuseRngData</a></div><div class="ttdeci">bool fuseRngData</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00710">AP_NavEKF.h:710</a></div></div>
<div class="ttc" id="classRangeFinder_html"><div class="ttname"><a href="classRangeFinder.html">RangeFinder</a></div><div class="ttdef"><b>Definition:</b> <a href="RangeFinder_8h_source.html#l00033">RangeFinder.h:33</a></div></div>
<div class="ttc" id="classNavEKF_html_a3d21102f255ba63c8d37a50ff9abde46"><div class="ttname"><a href="classNavEKF.html#a3d21102f255ba63c8d37a50ff9abde46">NavEKF::gpsRetryTimeNoTAS</a></div><div class="ttdeci">const uint16_t gpsRetryTimeNoTAS</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00502">AP_NavEKF.h:502</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a254d1982103c648403924dc00c845301"><div class="ttname"><a href="calcH__MAG_8c.html#a254d1982103c648403924dc00c845301">t25</a></div><div class="ttdeci">t25</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00025">calcH_MAG.c:25</a></div></div>
<div class="ttc" id="classNavEKF_html_a1b60b100325aafb18a11331ccb1ab15e"><div class="ttname"><a href="classNavEKF.html#a1b60b100325aafb18a11331ccb1ab15e">NavEKF::auxRngTestRatio</a></div><div class="ttdeci">float auxRngTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00719">AP_NavEKF.h:719</a></div></div>
<div class="ttc" id="classNavEKF_html_a4b50771bf4522b595267af095ba8333a"><div class="ttname"><a href="classNavEKF.html#a4b50771bf4522b595267af095ba8333a">NavEKF::takeoffExpectedSet_ms</a></div><div class="ttdeci">uint32_t takeoffExpectedSet_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00752">AP_NavEKF.h:752</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_a3d2e277ecebb6384d9d988af57cab57c"><div class="ttname"><a href="unionnav__filter__status.html#a3d2e277ecebb6384d9d988af57cab57c">nav_filter_status::horiz_vel</a></div><div class="ttdeci">uint16_t horiz_vel</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00025">AP_Nav_Common.h:25</a></div></div>
<div class="ttc" id="classNavEKF_html_a826c6c487744f2a5997045e1bf4ffb6e"><div class="ttname"><a href="classNavEKF.html#a826c6c487744f2a5997045e1bf4ffb6e">NavEKF::RecallOmega</a></div><div class="ttdeci">void RecallOmega(Vector3f &amp;omegaAvg, uint32_t msecStart, uint32_t msecEnd)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03580">AP_NavEKF.cpp:3580</a></div></div>
<div class="ttc" id="classNavEKF_html_a2b605aa62bb5ce81f9d0cccaa3ad0f0b"><div class="ttname"><a href="classNavEKF.html#a2b605aa62bb5ce81f9d0cccaa3ad0f0b">NavEKF::_gpsGlitchRadiusMax</a></div><div class="ttdeci">AP_Int8 _gpsGlitchRadiusMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00484">AP_NavEKF.h:484</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a8f776ff561231966d9c72ec06e1b56f9"><div class="ttname"><a href="calcH__MAG_8c.html#a8f776ff561231966d9c72ec06e1b56f9">t29</a></div><div class="ttdeci">t29</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00030">calcH_MAG.c:30</a></div></div>
<div class="ttc" id="classNavEKF_html_aec5be73c28730c3f9c6cf4a908e6c26e"><div class="ttname"><a href="classNavEKF.html#aec5be73c28730c3f9c6cf4a908e6c26e">NavEKF::_perf_OpticalFlowEKF</a></div><div class="ttdeci">perf_counter_t _perf_OpticalFlowEKF</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00813">AP_NavEKF.h:813</a></div></div>
<div class="ttc" id="classNavEKF_html_af41b8a9e16d1f33c5f209187cc34168d"><div class="ttname"><a href="classNavEKF.html#af41b8a9e16d1f33c5f209187cc34168d">NavEKF::timeAtArming_ms</a></div><div class="ttdeci">uint32_t timeAtArming_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00744">AP_NavEKF.h:744</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a11a516f80538ab08ec10562101bdc1e7"><div class="ttname"><a href="calcH__MAG_8c.html#a11a516f80538ab08ec10562101bdc1e7">t18</a></div><div class="ttdeci">t18</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00016">calcH_MAG.c:16</a></div></div>
<div class="ttc" id="AP__Math_8h_html_aea8758bf61b23b46507902b46060ebfd"><div class="ttname"><a href="AP__Math_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a></div><div class="ttdeci">#define GRAVITY_MSS</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00052">AP_Math.h:52</a></div></div>
<div class="ttc" id="classNavEKF_html_a85b6d179a631d25f34f2560e660aee10"><div class="ttname"><a href="classNavEKF.html#a85b6d179a631d25f34f2560e660aee10">NavEKF::use_compass</a></div><div class="ttdeci">bool use_compass(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04681">AP_NavEKF.cpp:4681</a></div></div>
<div class="ttc" id="classNavEKF_html_ad571a76ad4877e7c7127962366a86b7a"><div class="ttname"><a href="classNavEKF.html#ad571a76ad4877e7c7127962366a86b7a">NavEKF::Popt</a></div><div class="ttdeci">float Popt</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00705">AP_NavEKF.h:705</a></div></div>
<div class="ttc" id="classNavEKF_html_a2d27879e22f14746869d7152f57e5667"><div class="ttname"><a href="classNavEKF.html#a2d27879e22f14746869d7152f57e5667">NavEKF::timeAtLastAuxEKF_ms</a></div><div class="ttdeci">uint32_t timeAtLastAuxEKF_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00627">AP_NavEKF.h:627</a></div></div>
<div class="ttc" id="unionnav__filter__status_html_ae8997c3724e9a13ff589d5b931891586"><div class="ttname"><a href="unionnav__filter__status.html#ae8997c3724e9a13ff589d5b931891586">nav_filter_status::pred_horiz_pos_abs</a></div><div class="ttdeci">uint16_t pred_horiz_pos_abs</div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00033">AP_Nav_Common.h:33</a></div></div>
<div class="ttc" id="classNavEKF_html_af00a144845ea0078be28516c5d584c78"><div class="ttname"><a href="classNavEKF.html#af00a144845ea0078be28516c5d584c78">NavEKF::getEulerAngles</a></div><div class="ttdeci">void getEulerAngles(Vector3f &amp;eulers) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03612">AP_NavEKF.cpp:3612</a></div></div>
<div class="ttc" id="classNavEKF_html_a98f32795156af6b0de0eadfdd9d304f9"><div class="ttname"><a href="classNavEKF.html#a98f32795156af6b0de0eadfdd9d304f9">NavEKF::correctedDelVel2</a></div><div class="ttdeci">Vector3f correctedDelVel2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00558">AP_NavEKF.h:558</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a7ae0a9703c028ac364432e722c91ae57"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a7ae0a9703c028ac364432e722c91ae57">ACC_PNOISE_DEFAULT</a></div><div class="ttdeci">#define ACC_PNOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00081">AP_NavEKF.cpp:81</a></div></div>
<div class="ttc" id="classNavEKF_html_a42c664df5b7a9fb51d590fc3d7791c5d"><div class="ttname"><a href="classNavEKF.html#a42c664df5b7a9fb51d590fc3d7791c5d">NavEKF::heldVelNE</a></div><div class="ttdeci">Vector2f heldVelNE</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00728">AP_NavEKF.h:728</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a4adccacc4492780e962b0b872360b081"><div class="ttname"><a href="calcH__MAG_8c.html#a4adccacc4492780e962b0b872360b081">t6</a></div><div class="ttdeci">t6</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00005">calcH_MAG.c:5</a></div></div>
<div class="ttc" id="v1_80_2ardupilotmega_2ardupilotmega_8h_html_aa0930464f8c0dddb4bbd590e08935abfa5b60279426fddb859cc1adcf46dcb957"><div class="ttname"><a href="v1_80_2ardupilotmega_2ardupilotmega_8h.html#aa0930464f8c0dddb4bbd590e08935abfa5b60279426fddb859cc1adcf46dcb957">EKF_VELOCITY_VERT</a></div><div class="ttdef"><b>Definition:</b> <a href="v1_80_2ardupilotmega_2ardupilotmega_8h_source.html#l00337">ardupilotmega.h:337</a></div></div>
<div class="ttc" id="classNavEKF_html_a8a0d11f11046dfe628c6bc1e51ef643a"><div class="ttname"><a href="classNavEKF.html#a8a0d11f11046dfe628c6bc1e51ef643a">NavEKF::_magCal</a></div><div class="ttdeci">AP_Int8 _magCal</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00482">AP_NavEKF.h:482</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_a08eedb329d8162ddbd344d4f6c8cde20"><div class="ttname"><a href="AP__Math_8cpp.html#a08eedb329d8162ddbd344d4f6c8cde20">constrain_float</a></div><div class="ttdeci">float constrain_float(float amt, float low, float high)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00074">AP_Math.cpp:74</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_ad3fb415efca7a253fb01f3d143782230"><div class="ttname"><a href="AP__NavEKF_8cpp.html#ad3fb415efca7a253fb01f3d143782230">MAGE_PNOISE_DEFAULT</a></div><div class="ttdeci">#define MAGE_PNOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00084">AP_NavEKF.cpp:84</a></div></div>
<div class="ttc" id="classNavEKF_html_a85bde5695be6bf1fcfec41fc13ccddcd"><div class="ttname"><a href="classNavEKF.html#a85bde5695be6bf1fcfec41fc13ccddcd">NavEKF::ekfStartTime_ms</a></div><div class="ttdeci">uint32_t ekfStartTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00630">AP_NavEKF.h:630</a></div></div>
<div class="ttc" id="classNavEKF_html_a99a20e876b5b008663c831da43ab44e7"><div class="ttname"><a href="classNavEKF.html#a99a20e876b5b008663c831da43ab44e7">NavEKF::gpsUpdateCountMaxInv</a></div><div class="ttdeci">float gpsUpdateCountMaxInv</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00677">AP_NavEKF.h:677</a></div></div>
<div class="ttc" id="AP__Math__AVR__Compat_8h_html_ae31ff8b5990823ebb5d9746cc0843293"><div class="ttname"><a href="AP__Math__AVR__Compat_8h.html#ae31ff8b5990823ebb5d9746cc0843293">atan2f</a></div><div class="ttdeci">#define atan2f</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math__AVR__Compat_8h_source.html#l00090">AP_Math_AVR_Compat.h:90</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a8ff29a8a8c15df0fe2b26ca482f2a548"><div class="ttname"><a href="calcH__MAG_8c.html#a8ff29a8a8c15df0fe2b26ca482f2a548">t11</a></div><div class="ttdeci">t11</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00010">calcH_MAG.c:10</a></div></div>
<div class="ttc" id="classNavEKF_html_a755c7075fb0ee5f86cef734ecf83e53a"><div class="ttname"><a href="classNavEKF.html#a755c7075fb0ee5f86cef734ecf83e53a">NavEKF::zeroCols</a></div><div class="ttdeci">void zeroCols(Matrix22 &amp;covMat, uint8_t first, uint8_t last)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03517">AP_NavEKF.cpp:3517</a></div></div>
<div class="ttc" id="classNavEKF_html_a8fa1f0e68c872b724a2af4b2610c635e"><div class="ttname"><a href="classNavEKF.html#a8fa1f0e68c872b724a2af4b2610c635e">NavEKF::DCM33FlowMin</a></div><div class="ttdeci">const float DCM33FlowMin</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00521">AP_NavEKF.h:521</a></div></div>
<div class="ttc" id="classNavEKF_html_a9a57fcddedaf879de6e7126a4cc85bd5"><div class="ttname"><a href="classNavEKF.html#a9a57fcddedaf879de6e7126a4cc85bd5">NavEKF::velTimeout</a></div><div class="ttdeci">bool velTimeout</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00539">AP_NavEKF.h:539</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a0baed3323b0e73e69e2d80fb232031ba"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a0baed3323b0e73e69e2d80fb232031ba">INIT_GYRO_BIAS_UNCERTAINTY</a></div><div class="ttdeci">#define INIT_GYRO_BIAS_UNCERTAINTY</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00109">AP_NavEKF.cpp:109</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_ad3ddc628cd252634272d1818f00c7981"><div class="ttname"><a href="calcH__MAG_8c.html#ad3ddc628cd252634272d1818f00c7981">t32</a></div><div class="ttdeci">t32</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00032">calcH_MAG.c:32</a></div></div>
<div class="ttc" id="classVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="classNavEKF_html_a55a6ae919135e4deef0cffe2eca3ac80"><div class="ttname"><a href="classNavEKF.html#a55a6ae919135e4deef0cffe2eca3ac80">NavEKF::decayGpsOffset</a></div><div class="ttdeci">void decayGpsOffset(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04688">AP_NavEKF.cpp:4688</a></div></div>
<div class="ttc" id="classNavEKF_html_a532d96729dba3c794df2de8c36890fba"><div class="ttname"><a href="classNavEKF.html#a532d96729dba3c794df2de8c36890fba">NavEKF::lastVelPassTime</a></div><div class="ttdeci">uint32_t lastVelPassTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00619">AP_NavEKF.h:619</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a486aed3cc284bf78393a531434d38a41"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a486aed3cc284bf78393a531434d38a41">INIT_ACCEL_BIAS_UNCERTAINTY</a></div><div class="ttdeci">#define INIT_ACCEL_BIAS_UNCERTAINTY</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00110">AP_NavEKF.cpp:110</a></div></div>
<div class="ttc" id="classNavEKF_html_a438ec63738f917e8d25a448414c83d23"><div class="ttname"><a href="classNavEKF.html#a438ec63738f917e8d25a448414c83d23">NavEKF::statesAtVtasMeasTime</a></div><div class="ttdeci">state_elements statesAtVtasMeasTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00596">AP_NavEKF.h:596</a></div></div>
<div class="ttc" id="classNavEKF_html_a08e342053cbf38b680f703e8ed575189"><div class="ttname"><a href="classNavEKF.html#a08e342053cbf38b680f703e8ed575189">NavEKF::gpsUpdateCount</a></div><div class="ttdeci">uint8_t gpsUpdateCount</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00675">AP_NavEKF.h:675</a></div></div>
<div class="ttc" id="classNavEKF_html_a4bf5a87405a1622378ec638d2643525f"><div class="ttname"><a href="classNavEKF.html#a4bf5a87405a1622378ec638d2643525f">NavEKF::_fusionModeGPS</a></div><div class="ttdeci">AP_Int8 _fusionModeGPS</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00476">AP_NavEKF.h:476</a></div></div>
<div class="ttc" id="classNavEKF_html_af7abc10696cb7b7d1adcb534dedce316"><div class="ttname"><a href="classNavEKF.html#af7abc10696cb7b7d1adcb534dedce316">NavEKF::q2</a></div><div class="ttdeci">ftype q2</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00766">AP_NavEKF.h:766</a></div></div>
<div class="ttc" id="classNavEKF_html_ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20"><div class="ttname"><a href="classNavEKF.html#ac1783e99d1c260076239fde6e0432fafaa06bfbafbdd497cf8781c5ba8e17ff20">NavEKF::AID_RELATIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00731">AP_NavEKF.h:731</a></div></div>
<div class="ttc" id="classNavEKF_html_aafbe3d69b1f8da37e57fb67505c9928f"><div class="ttname"><a href="classNavEKF.html#aafbe3d69b1f8da37e57fb67505c9928f">NavEKF::_flowNoise</a></div><div class="ttdeci">AP_Float _flowNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00486">AP_NavEKF.h:486</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a3be069418436a7fc7a9f87c2b8b34730"><div class="ttname"><a href="classAP__InertialSensor.html#a3be069418436a7fc7a9f87c2b8b34730">AP_InertialSensor::get_delta_angle</a></div><div class="ttdeci">bool get_delta_angle(uint8_t i, Vector3f &amp;delta_angle) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00116">AP_InertialSensor.h:116</a></div></div>
<div class="ttc" id="classNavEKF_html_a2740f69c3b0d44a9758ad49fb06021aa"><div class="ttname"><a href="classNavEKF.html#a2740f69c3b0d44a9758ad49fb06021aa">NavEKF::magN</a></div><div class="ttdeci">ftype magN</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00791">AP_NavEKF.h:791</a></div></div>
<div class="ttc" id="classNavEKF_html_ab96a015b749a218bae3e5b7ef6a2ddff"><div class="ttname"><a href="classNavEKF.html#ab96a015b749a218bae3e5b7ef6a2ddff">NavEKF::imuSampleTime_ms</a></div><div class="ttdeci">uint32_t imuSampleTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00611">AP_NavEKF.h:611</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a3a58fa912c1355cab719e7537e61a055"><div class="ttname"><a href="calcH__MAG_8c.html#a3a58fa912c1355cab719e7537e61a055">t19</a></div><div class="ttdeci">t19</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00018">calcH_MAG.c:18</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_abb28cf0ad28ee53d88665f63178d4f88"><div class="ttname"><a href="calcH__MAG_8c.html#abb28cf0ad28ee53d88665f63178d4f88">t10</a></div><div class="ttdeci">t10</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00009">calcH_MAG.c:9</a></div></div>
<div class="ttc" id="classCompass_html_aa1f44c7920bbd147fa2e58bfedd3c4bb"><div class="ttname"><a href="classCompass.html#aa1f44c7920bbd147fa2e58bfedd3c4bb">Compass::get_field</a></div><div class="ttdeci">const Vector3f &amp; get_field(uint8_t i) const </div><div class="ttdoc">Return the current field as a Vector3f. </div><div class="ttdef"><b>Definition:</b> <a href="Compass_8h_source.html#l00105">Compass.h:105</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_afb611b7759e2b83202e0f3bb9ea1b1f1"><div class="ttname"><a href="calcH__MAG_8c.html#afb611b7759e2b83202e0f3bb9ea1b1f1">t20</a></div><div class="ttdeci">t20</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00019">calcH_MAG.c:19</a></div></div>
<div class="ttc" id="classNavEKF_html_a6279cd6036a295cdb23eb6791e2b3606"><div class="ttname"><a href="classNavEKF.html#a6279cd6036a295cdb23eb6791e2b3606">NavEKF::_magEarthProcessNoise</a></div><div class="ttdeci">AP_Float _magEarthProcessNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00468">AP_NavEKF.h:468</a></div></div>
<div class="ttc" id="classNavEKF_html_a036b68726cb71dd62ac61bae01e0832a"><div class="ttname"><a href="classNavEKF.html#a036b68726cb71dd62ac61bae01e0832a">NavEKF::magFuseRequired</a></div><div class="ttdeci">bool magFuseRequired</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00599">AP_NavEKF.h:599</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a15011398a338800188c9c7a86078d230"><div class="ttname"><a href="calcH__MAG_8c.html#a15011398a338800188c9c7a86078d230">t17</a></div><div class="ttdeci">t17</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00017">calcH_MAG.c:17</a></div></div>
<div class="ttc" id="classNavEKF_html_a6d73179ba0b4f52982c4ef0604261d08"><div class="ttname"><a href="classNavEKF.html#a6d73179ba0b4f52982c4ef0604261d08">NavEKF::gpsPosNE</a></div><div class="ttdeci">Vector2f gpsPosNE</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00583">AP_NavEKF.h:583</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a8450c19ec690232a7ab0a967df04e469"><div class="ttname"><a href="calcH__MAG_8c.html#a8450c19ec690232a7ab0a967df04e469">t9</a></div><div class="ttdeci">t9</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00008">calcH_MAG.c:8</a></div></div>
<div class="ttc" id="classNavEKF_html_a0f89191e53135a85b5e07e7607bfe79f"><div class="ttname"><a href="classNavEKF.html#a0f89191e53135a85b5e07e7607bfe79f">NavEKF::SQ</a></div><div class="ttdeci">Vector11 SQ</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00638">AP_NavEKF.h:638</a></div></div>
<div class="ttc" id="classNavEKF_html_a8ac5727059185f254f5c95ea8ba658b1"><div class="ttname"><a href="classNavEKF.html#a8ac5727059185f254f5c95ea8ba658b1">NavEKF::secondLastFixTime_ms</a></div><div class="ttdeci">uint32_t secondLastFixTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00628">AP_NavEKF.h:628</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a></div><div class="ttdoc">Receiving valid messages and 3D lock. </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00096">AP_GPS.h:96</a></div></div>
<div class="ttc" id="classNavEKF_html_a42c64f93e6b922ee0e9167c7c9755748"><div class="ttname"><a href="classNavEKF.html#a42c64f93e6b922ee0e9167c7c9755748">NavEKF::dtDelVel1</a></div><div class="ttdeci">float dtDelVel1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00747">AP_NavEKF.h:747</a></div></div>
<div class="ttc" id="classNavEKF_html_a7312c13dafe6b36bf4703f10dd57aa2d"><div class="ttname"><a href="classNavEKF.html#a7312c13dafe6b36bf4703f10dd57aa2d">NavEKF::magUpdateCountMaxInv</a></div><div class="ttdeci">float magUpdateCountMaxInv</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00683">AP_NavEKF.h:683</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a6df2d8ad956d4f375bdee541102f16af"><div class="ttname"><a href="classAP__InertialSensor.html#a6df2d8ad956d4f375bdee541102f16af">AP_InertialSensor::get_gyro</a></div><div class="ttdeci">const Vector3f &amp; get_gyro(uint8_t i) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00107">AP_InertialSensor.h:107</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a1f0e37994a6f56855901949bd4ff8e25"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a1f0e37994a6f56855901949bd4ff8e25">FLOW_NOISE_DEFAULT</a></div><div class="ttdeci">#define FLOW_NOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00094">AP_NavEKF.cpp:94</a></div></div>
<div class="ttc" id="classNavEKF_html_a32241d266f63e90398d3f4b2934525dd"><div class="ttname"><a href="classNavEKF.html#a32241d266f63e90398d3f4b2934525dd">NavEKF::_ahrs</a></div><div class="ttdeci">const AP_AHRS * _ahrs</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00261">AP_NavEKF.h:261</a></div></div>
<div class="ttc" id="classNavEKF_html_ab71619ef68ba5d8b11f68ef4f31a65c2"><div class="ttname"><a href="classNavEKF.html#ab71619ef68ba5d8b11f68ef4f31a65c2">NavEKF::getFilterFaults</a></div><div class="ttdeci">void getFilterFaults(uint8_t &amp;faults) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04735">AP_NavEKF.cpp:4735</a></div></div>
<div class="ttc" id="classNavEKF_html_a55bead411e1fd0ed64342bd38e6a83bf"><div class="ttname"><a href="classNavEKF.html#a55bead411e1fd0ed64342bd38e6a83bf">NavEKF::FuseSideslip</a></div><div class="ttdeci">void FuseSideslip()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03317">AP_NavEKF.cpp:3317</a></div></div>
<div class="ttc" id="classNavEKF_html_a0704abcdd99ba0ab2a8254fba20c843c"><div class="ttname"><a href="classNavEKF.html#a0704abcdd99ba0ab2a8254fba20c843c">NavEKF::lastHealthyMagTime_ms</a></div><div class="ttdeci">uint32_t lastHealthyMagTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00629">AP_NavEKF.h:629</a></div></div>
<div class="ttc" id="classCompass_html_a97437729a583cd900e4dd1d6d84a4a0e"><div class="ttname"><a href="classCompass.html#a97437729a583cd900e4dd1d6d84a4a0e">Compass::use_for_yaw</a></div><div class="ttdeci">bool use_for_yaw(uint8_t i) const </div><div class="ttdoc">return true if the compass should be used for yaw calculations </div><div class="ttdef"><b>Definition:</b> <a href="Compass_8cpp_source.html#l00470">Compass.cpp:470</a></div></div>
<div class="ttc" id="classNavEKF_html_a57da170435f7f705a37d9e7beaaa680b"><div class="ttname"><a href="classNavEKF.html#a57da170435f7f705a37d9e7beaaa680b">NavEKF::getMagOffsets</a></div><div class="ttdeci">bool getMagOffsets(Vector3f &amp;magOffsets) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03766">AP_NavEKF.cpp:3766</a></div></div>
<div class="ttc" id="classNavEKF_html_a24a9b1e9c8504aa4821f2459c7ae6117"><div class="ttname"><a href="classNavEKF.html#a24a9b1e9c8504aa4821f2459c7ae6117">NavEKF::alignYawGPS</a></div><div class="ttdeci">void alignYawGPS()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04421">AP_NavEKF.cpp:4421</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_a21a7899aa064a08635b4233f4f00b658"><div class="ttname"><a href="calcH__MAG_8c.html#a21a7899aa064a08635b4233f4f00b658">t30</a></div><div class="ttdeci">t30</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00031">calcH_MAG.c:31</a></div></div>
<div class="ttc" id="classNavEKF_html_a9f5a7e05866a566fd9243727906f636f"><div class="ttname"><a href="classNavEKF.html#a9f5a7e05866a566fd9243727906f636f">NavEKF::lastPosFailTime</a></div><div class="ttdeci">uint32_t lastPosFailTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00621">AP_NavEKF.h:621</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a0f0f886dda819ea2b3cdcc3f4628cd80"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a0f0f886dda819ea2b3cdcc3f4628cd80">VELNE_NOISE_DEFAULT</a></div><div class="ttdeci">#define VELNE_NOISE_DEFAULT</div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00075">AP_NavEKF.cpp:75</a></div></div>
<div class="ttc" id="classNavEKF_html_a6e4b25213035e6299da4e6df725db0ec"><div class="ttname"><a href="classNavEKF.html#a6e4b25213035e6299da4e6df725db0ec">NavEKF::flowTimeDeltaAvg_ms</a></div><div class="ttdeci">const uint8_t flowTimeDeltaAvg_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00523">AP_NavEKF.h:523</a></div></div>
<div class="ttc" id="classNavEKF_html_a8e93d444fc5428b0170a178fb3c56e78"><div class="ttname"><a href="classNavEKF.html#a8e93d444fc5428b0170a178fb3c56e78">NavEKF::validOrigin</a></div><div class="ttdeci">bool validOrigin</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00661">AP_NavEKF.h:661</a></div></div>
<div class="ttc" id="classNavEKF_html_aa98e017d389ce1831db02e36a44d5647"><div class="ttname"><a href="classNavEKF.html#aa98e017d389ce1831db02e36a44d5647">NavEKF::getVehicleArmStatus</a></div><div class="ttdeci">bool getVehicleArmStatus(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04675">AP_NavEKF.cpp:4675</a></div></div>
<div class="ttc" id="classAP__Airspeed_html_adaad3ab10fbc87f821d6657683ad22fa"><div class="ttname"><a href="classAP__Airspeed.html#adaad3ab10fbc87f821d6657683ad22fa">AP_Airspeed::last_update_ms</a></div><div class="ttdeci">uint32_t last_update_ms(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Airspeed_8h_source.html#l00155">AP_Airspeed.h:155</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a7b2f01d2d02f1954dd7c5acae11e1562"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a7b2f01d2d02f1954dd7c5acae11e1562">NavEKF::state_elements::velocity</a></div><div class="ttdeci">Vector3f velocity</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00271">AP_NavEKF.h:271</a></div></div>
<div class="ttc" id="classNavEKF_html_af2a003bbd6abea81eae93d2c2faf8bfa"><div class="ttname"><a href="classNavEKF.html#af2a003bbd6abea81eae93d2c2faf8bfa">NavEKF::FuseMagnetometer</a></div><div class="ttdeci">void FuseMagnetometer()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l02305">AP_NavEKF.cpp:2305</a></div></div>
<div class="ttc" id="classNavEKF_html_a382eec217e3958da0ebe6cb810b47f2b"><div class="ttname"><a href="classNavEKF.html#a382eec217e3958da0ebe6cb810b47f2b">NavEKF::magTestRatio</a></div><div class="ttdeci">Vector3f magTestRatio</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00648">AP_NavEKF.h:648</a></div></div>
<div class="ttc" id="classNavEKF_html_a784d6082ed20be29982a2f1203280a1a"><div class="ttname"><a href="classNavEKF.html#a784d6082ed20be29982a2f1203280a1a">NavEKF::useRngFinder</a></div><div class="ttdeci">bool useRngFinder(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04658">AP_NavEKF.cpp:4658</a></div></div>
<div class="ttc" id="classNavEKF_html_a93570c80357656a5389eee3f186f000a"><div class="ttname"><a href="classNavEKF.html#a93570c80357656a5389eee3f186f000a">NavEKF::gpsDVelVarAccScale</a></div><div class="ttdeci">const float gpsDVelVarAccScale</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00496">AP_NavEKF.h:496</a></div></div>
<div class="ttc" id="classNavEKF_html_af11472d4d599c4c5d632d292a4ab29b1"><div class="ttname"><a href="classNavEKF.html#af11472d4d599c4c5d632d292a4ab29b1">NavEKF::CovariancePrediction</a></div><div class="ttdeci">void CovariancePrediction()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l01201">AP_NavEKF.cpp:1201</a></div></div>
<div class="ttc" id="classNavEKF_html_aae4b0265509fb303cb3a0912a2ed2e98"><div class="ttname"><a href="classNavEKF.html#aae4b0265509fb303cb3a0912a2ed2e98">NavEKF::inhibitWindStates</a></div><div class="ttdeci">bool inhibitWindStates</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00650">AP_NavEKF.h:650</a></div></div>
<div class="ttc" id="classNavEKF_html_a9abbd1ebe9283e85acb9a76a04e31039"><div class="ttname"><a href="classNavEKF.html#a9abbd1ebe9283e85acb9a76a04e31039">NavEKF::magXbias</a></div><div class="ttdeci">ftype magXbias</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00794">AP_NavEKF.h:794</a></div></div>
<div class="ttc" id="calcH__MAG_8c_html_adb7f8988295b809f49f25c5842228d6a"><div class="ttname"><a href="calcH__MAG_8c.html#adb7f8988295b809f49f25c5842228d6a">t22</a></div><div class="ttdeci">t22</div><div class="ttdef"><b>Definition:</b> <a href="calcH__MAG_8c_source.html#l00021">calcH_MAG.c:21</a></div></div>
<div class="ttc" id="classNavEKF_html_a0b9da623e9e7cf3d051442c3ecb97b81"><div class="ttname"><a href="classNavEKF.html#a0b9da623e9e7cf3d051442c3ecb97b81">NavEKF::flowXfailed</a></div><div class="ttdeci">bool flowXfailed</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00735">AP_NavEKF.h:735</a></div></div>
<div class="ttc" id="structNavEKF_1_1state__elements_html_a066d407536e13a4e96b1293528550611"><div class="ttname"><a href="structNavEKF_1_1state__elements.html#a066d407536e13a4e96b1293528550611">NavEKF::state_elements::omega</a></div><div class="ttdeci">Vector3f omega</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00283">AP_NavEKF.h:283</a></div></div>
<div class="ttc" id="AP__Math__AVR__Compat_8h_html_a3d93f9727a460ef2670f5cfd91029fc6"><div class="ttname"><a href="AP__Math__AVR__Compat_8h.html#a3d93f9727a460ef2670f5cfd91029fc6">sqrtf</a></div><div class="ttdeci">#define sqrtf</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math__AVR__Compat_8h_source.html#l00030">AP_Math_AVR_Compat.h:30</a></div></div>
<div class="ttc" id="classNavEKF_html_a11e77f9d00e0bcaf0d480d15c5922f29"><div class="ttname"><a href="classNavEKF.html#a11e77f9d00e0bcaf0d480d15c5922f29">NavEKF::_perf_FuseVelPosNED</a></div><div class="ttdeci">perf_counter_t _perf_FuseVelPosNED</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00809">AP_NavEKF.h:809</a></div></div>
<div class="ttc" id="classNavEKF_html_a00cd23012b3330cc889f02352d3e47d2"><div class="ttname"><a href="classNavEKF.html#a00cd23012b3330cc889f02352d3e47d2">NavEKF::TASmsecPrev</a></div><div class="ttdeci">uint32_t TASmsecPrev</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00602">AP_NavEKF.h:602</a></div></div>
<div class="ttc" id="classNavEKF_html_a3f95877a29c4e324991e899c8316a0da"><div class="ttname"><a href="classNavEKF.html#a3f95877a29c4e324991e899c8316a0da">NavEKF::processNoise</a></div><div class="ttdeci">Vector22 processNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00635">AP_NavEKF.h:635</a></div></div>
<div class="ttc" id="classNavEKF_html_a584f5bca8fd1baa4a42462830cb5151b"><div class="ttname"><a href="classNavEKF.html#a584f5bca8fd1baa4a42462830cb5151b">NavEKF::msecHgtAvg</a></div><div class="ttdeci">const uint16_t msecHgtAvg</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00512">AP_NavEKF.h:512</a></div></div>
<div class="ttc" id="classNavEKF_html_a2e50e407ae3695d4aa1ae5b3bb09499e"><div class="ttname"><a href="classNavEKF.html#a2e50e407ae3695d4aa1ae5b3bb09499e">NavEKF::hgtMea</a></div><div class="ttdeci">ftype hgtMea</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00584">AP_NavEKF.h:584</a></div></div>
<div class="ttc" id="classNavEKF_html_a0499e105467997498b813dbc1af7607e"><div class="ttname"><a href="classNavEKF.html#a0499e105467997498b813dbc1af7607e">NavEKF::gndEffectBaroScaler</a></div><div class="ttdeci">const float gndEffectBaroScaler</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00529">AP_NavEKF.h:529</a></div></div>
<div class="ttc" id="classNavEKF_html_a4361b93656f6964cc65943400ddffb8c"><div class="ttname"><a href="classNavEKF.html#a4361b93656f6964cc65943400ddffb8c">NavEKF::varInnovVtas</a></div><div class="ttdeci">ftype varInnovVtas</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00593">AP_NavEKF.h:593</a></div></div>
<div class="ttc" id="classNavEKF_html_a48c71e58b6814cb102d84f04b0ae52ce"><div class="ttname"><a href="classNavEKF.html#a48c71e58b6814cb102d84f04b0ae52ce">NavEKF::P</a></div><div class="ttdeci">Matrix22 P</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00551">AP_NavEKF.h:551</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a717b438a67f0b41665feec9009ba1bd4"><div class="ttname"><a href="AP__Math_8h.html#a717b438a67f0b41665feec9009ba1bd4">location_offset</a></div><div class="ttdeci">void location_offset(struct Location &amp;loc, float ofs_north, float ofs_east)</div><div class="ttdef"><b>Definition:</b> <a href="location_8cpp_source.html#l00129">location.cpp:129</a></div></div>
<div class="ttc" id="classNavEKF_html_a7d468bceeabf5169403c4b1b146bec63"><div class="ttname"><a href="classNavEKF.html#a7d468bceeabf5169403c4b1b146bec63">NavEKF::flowFusePerformed</a></div><div class="ttdeci">bool flowFusePerformed</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00687">AP_NavEKF.h:687</a></div></div>
<div class="ttc" id="classAP__Airspeed_html_a1027b15b91e0af1dbfe8b999a88c8a25"><div class="ttname"><a href="classAP__Airspeed.html#a1027b15b91e0af1dbfe8b999a88c8a25">AP_Airspeed::get_airspeed</a></div><div class="ttdeci">float get_airspeed(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Airspeed_8h_source.html#l00070">AP_Airspeed.h:70</a></div></div>
<div class="ttc" id="classNavEKF_html_ab6e1b2ec32c9b85512a6eaa96e67a9f4"><div class="ttname"><a href="classNavEKF.html#ab6e1b2ec32c9b85512a6eaa96e67a9f4">NavEKF::msecHgtDelay</a></div><div class="ttdeci">const float msecHgtDelay</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00498">AP_NavEKF.h:498</a></div></div>
<div class="ttc" id="classNavEKF_html_a7cb2acda61b77f598bd8d3f498f064c7"><div class="ttname"><a href="classNavEKF.html#a7cb2acda61b77f598bd8d3f498f064c7">NavEKF::getDeltaQuaternion</a></div><div class="ttdeci">Quaternion getDeltaQuaternion(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05177">AP_NavEKF.cpp:5177</a></div></div>
<div class="ttc" id="classNavEKF_html_a8072f31f08434518f5a27ad06ce6d2b5"><div class="ttname"><a href="classNavEKF.html#a8072f31f08434518f5a27ad06ce6d2b5">NavEKF::magTimeout</a></div><div class="ttdeci">bool magTimeout</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00542">AP_NavEKF.h:542</a></div></div>
<div class="ttc" id="classNavEKF_html_ae427875ce4593b477ae259ab7a551c7e"><div class="ttname"><a href="classNavEKF.html#ae427875ce4593b477ae259ab7a551c7e">NavEKF::_accNoise</a></div><div class="ttdeci">AP_Float _accNoise</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00471">AP_NavEKF.h:471</a></div></div>
<div class="ttc" id="classNavEKF_html_a851694619b992bb036e750575b654014"><div class="ttname"><a href="classNavEKF.html#a851694619b992bb036e750575b654014">NavEKF::getHeightControlLimit</a></div><div class="ttdeci">bool getHeightControlLimit(float &amp;height) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l05163">AP_NavEKF.cpp:5163</a></div></div>
<div class="ttc" id="classNavEKF_html_af3ed4d1ab0d1e7c6eb21356ba24b8cd6"><div class="ttname"><a href="classNavEKF.html#af3ed4d1ab0d1e7c6eb21356ba24b8cd6">NavEKF::readDeltaAngle</a></div><div class="ttdeci">bool readDeltaAngle(uint8_t ins_index, Vector3f &amp;dAng)</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04051">AP_NavEKF.cpp:4051</a></div></div>
<div class="ttc" id="unionnav__filter__status_html"><div class="ttname"><a href="unionnav__filter__status.html">nav_filter_status</a></div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="AP__Nav__Common_8h_source.html#l00022">AP_Nav_Common.h:22</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_ad7c437e7c36f39117d19dc10c6a7766a"><div class="ttname"><a href="AP__NavEKF_8cpp.html#ad7c437e7c36f39117d19dc10c6a7766a">GBIAS_PNOISE_DEFAULT</a></div><div class="ttdeci">#define GBIAS_PNOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00082">AP_NavEKF.cpp:82</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a0f63a4a0e6fc84d6ab9519bc4b254055"><div class="ttname"><a href="classAP__InertialSensor.html#a0f63a4a0e6fc84d6ab9519bc4b254055">AP_InertialSensor::get_accel</a></div><div class="ttdeci">const Vector3f &amp; get_accel(uint8_t i) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00139">AP_InertialSensor.h:139</a></div></div>
<div class="ttc" id="classNavEKF_html_ad92280e849a014d102950c24f37a0324"><div class="ttname"><a href="classNavEKF.html#ad92280e849a014d102950c24f37a0324">NavEKF::correctedDelVel1</a></div><div class="ttdeci">Vector3f correctedDelVel1</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00557">AP_NavEKF.h:557</a></div></div>
<div class="ttc" id="classNavEKF_html_aa52bc3aced1667720b90440f2e1d63ee"><div class="ttname"><a href="classNavEKF.html#aa52bc3aced1667720b90440f2e1d63ee">NavEKF::tasDataWaiting</a></div><div class="ttdeci">bool tasDataWaiting</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00615">AP_NavEKF.h:615</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00053">AP_Param.h:53</a></div></div>
<div class="ttc" id="classNavEKF_html_ab2cb888ba8f31016825f3b0ce2466935"><div class="ttname"><a href="classNavEKF.html#ab2cb888ba8f31016825f3b0ce2466935">NavEKF::_perf_FuseSideslip</a></div><div class="ttdeci">perf_counter_t _perf_FuseSideslip</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00812">AP_NavEKF.h:812</a></div></div>
<div class="ttc" id="classVector3_html_adf1769d5ee5df2f8585df2f540fa5efe"><div class="ttname"><a href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">Vector3::zero</a></div><div class="ttdeci">void zero()</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00181">vector3.h:181</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_ac5d9502aca91c97f523fd9b35590215f"><div class="ttname"><a href="AP__Math_8cpp.html#ac5d9502aca91c97f523fd9b35590215f">constrain_int16</a></div><div class="ttdeci">int16_t constrain_int16(int16_t amt, int16_t low, int16_t high)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00087">AP_Math.cpp:87</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00065">HAL.h:65</a></div></div>
<div class="ttc" id="Airspeed_8pde_html_a304224bccd737323c9ee5b15cc9149ad"><div class="ttname"><a href="Airspeed_8pde.html#a304224bccd737323c9ee5b15cc9149ad">airspeed</a></div><div class="ttdeci">AP_Airspeed airspeed(aparm)</div></div>
<div class="ttc" id="classAP__HAL_1_1Util_html_a973ee89f8eee7af3a4d2a3eb700cbf3c"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a973ee89f8eee7af3a4d2a3eb700cbf3c">AP_HAL::Util::get_soft_armed</a></div><div class="ttdeci">bool get_soft_armed() const </div><div class="ttdef"><b>Definition:</b> <a href="Util_8h_source.html#l00027">Util.h:27</a></div></div>
<div class="ttc" id="AP__NavEKF_8cpp_html_a0f1645081a2864df607ae9e25dec9488"><div class="ttname"><a href="AP__NavEKF_8cpp.html#a0f1645081a2864df607ae9e25dec9488">POSNE_NOISE_DEFAULT</a></div><div class="ttdeci">#define POSNE_NOISE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00077">AP_NavEKF.cpp:77</a></div></div>
<div class="ttc" id="classNavEKF_html_a0eb21c6bcabd51abbf2279f17e434d67"><div class="ttname"><a href="classNavEKF.html#a0eb21c6bcabd51abbf2279f17e434d67">NavEKF::rngValidMeaTime_ms</a></div><div class="ttdeci">uint32_t rngValidMeaTime_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00696">AP_NavEKF.h:696</a></div></div>
<div class="ttc" id="classVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00070">vector3.h:70</a></div></div>
<div class="ttc" id="classNavEKF_html_a7bcc5a68b0195a062de10b1fe028e2a4"><div class="ttname"><a href="classNavEKF.html#a7bcc5a68b0195a062de10b1fe028e2a4">NavEKF::getHAGL</a></div><div class="ttdeci">bool getHAGL(float &amp;HAGL) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03827">AP_NavEKF.cpp:3827</a></div></div>
<div class="ttc" id="classNavEKF_html_aebca5af77c541497460468f5f6b4cfcb"><div class="ttname"><a href="classNavEKF.html#aebca5af77c541497460468f5f6b4cfcb">NavEKF::lastHgtMeasTime</a></div><div class="ttdeci">uint32_t lastHgtMeasTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00617">AP_NavEKF.h:617</a></div></div>
<div class="ttc" id="classNavEKF_html_a52562e37965717771b9b7c5c7b713276"><div class="ttname"><a href="classNavEKF.html#a52562e37965717771b9b7c5c7b713276">NavEKF::covPredStep</a></div><div class="ttdeci">bool covPredStep</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00597">AP_NavEKF.h:597</a></div></div>
<div class="ttc" id="classNavEKF_html_a37d2f6484fc9385a275829a481341d2a"><div class="ttname"><a href="classNavEKF.html#a37d2f6484fc9385a275829a481341d2a">NavEKF::CovarianceInit</a></div><div class="ttdeci">void CovarianceInit()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03921">AP_NavEKF.cpp:3921</a></div></div>
<div class="ttc" id="classNavEKF_html_ac9273a0000085f43cceee01c72dcc2cf"><div class="ttname"><a href="classNavEKF.html#ac9273a0000085f43cceee01c72dcc2cf">NavEKF::hgtRate</a></div><div class="ttdeci">ftype hgtRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00572">AP_NavEKF.h:572</a></div></div>
<div class="ttc" id="classNavEKF_html_ab0386943c12a0b3dabf4822c22ebd215"><div class="ttname"><a href="classNavEKF.html#ab0386943c12a0b3dabf4822c22ebd215">NavEKF::msecMagAvg</a></div><div class="ttdeci">const uint16_t msecMagAvg</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00513">AP_NavEKF.h:513</a></div></div>
<div class="ttc" id="classNavEKF_html_a7aa7c1b989521cde235e21a82ec537e4"><div class="ttname"><a href="classNavEKF.html#a7aa7c1b989521cde235e21a82ec537e4">NavEKF::getGyroBias</a></div><div class="ttdeci">void getGyroBias(Vector3f &amp;gyroBias) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l03672">AP_NavEKF.cpp:3672</a></div></div>
<div class="ttc" id="classNavEKF_html_a4b6dd409fcc6638f66596f0e8c99b96e"><div class="ttname"><a href="classNavEKF.html#a4b6dd409fcc6638f66596f0e8c99b96e">NavEKF::VtasMeas</a></div><div class="ttdeci">float VtasMeas</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00595">AP_NavEKF.h:595</a></div></div>
<div class="ttc" id="structLocation__Option__Flags_html_a3f0f17e655550917bc3177e876d6dc14"><div class="ttname"><a href="structLocation__Option__Flags.html#a3f0f17e655550917bc3177e876d6dc14">Location_Option_Flags::relative_alt</a></div><div class="ttdeci">uint8_t relative_alt</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00099">AP_Common.h:99</a></div></div>
<div class="ttc" id="classAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8cpp_source.html#l00841">AP_Param.cpp:841</a></div></div>
<div class="ttc" id="classNavEKF_html_a0302b7bbb74998406a938c227367797e"><div class="ttname"><a href="classNavEKF.html#a0302b7bbb74998406a938c227367797e">NavEKF::SelectFlowFusion</a></div><div class="ttdeci">void SelectFlowFusion()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l00975">AP_NavEKF.cpp:975</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_abc8c1aea2c3bc58a05d8d9832a9d1194"><div class="ttname"><a href="classAP__InertialSensor.html#abc8c1aea2c3bc58a05d8d9832a9d1194">AP_InertialSensor::get_gyro_health</a></div><div class="ttdeci">bool get_gyro_health(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00147">AP_InertialSensor.h:147</a></div></div>
<div class="ttc" id="classNavEKF_html_a657128e482f993bd65f6f86aed293d32"><div class="ttname"><a href="classNavEKF.html#a657128e482f993bd65f6f86aed293d32">NavEKF::statesAtHgtTime</a></div><div class="ttdeci">state_elements statesAtHgtTime</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00587">AP_NavEKF.h:587</a></div></div>
<div class="ttc" id="classNavEKF_html_aee2794d28212ecbeb58ba7fa5fedb543"><div class="ttname"><a href="classNavEKF.html#aee2794d28212ecbeb58ba7fa5fedb543">NavEKF::magData</a></div><div class="ttdeci">Vector3f magData</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00590">AP_NavEKF.h:590</a></div></div>
<div class="ttc" id="classRangeFinder_html_ad95f15a0eea1106c41337089636175b3"><div class="ttname"><a href="classRangeFinder.html#ad95f15a0eea1106c41337089636175b3">RangeFinder::ground_clearance_cm</a></div><div class="ttdeci">int16_t ground_clearance_cm(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="RangeFinder_8h_source.html#l00139">RangeFinder.h:139</a></div></div>
<div class="ttc" id="classNavEKF_html_aa4a74b46cabd98bf20f38e957e8562e3"><div class="ttname"><a href="classNavEKF.html#aa4a74b46cabd98bf20f38e957e8562e3">NavEKF::hgtUpdateCountMaxInv</a></div><div class="ttdeci">float hgtUpdateCountMaxInv</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00680">AP_NavEKF.h:680</a></div></div>
<div class="ttc" id="structLocation_html"><div class="ttname"><a href="structLocation.html">Location</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00105">AP_Common.h:105</a></div></div>
<div class="ttc" id="classNavEKF_html_ac149423cfc4aeaf0d3e8128d2334190e"><div class="ttname"><a href="classNavEKF.html#ac149423cfc4aeaf0d3e8128d2334190e">NavEKF::gpsUpdateCountMax</a></div><div class="ttdeci">uint8_t gpsUpdateCountMax</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00676">AP_NavEKF.h:676</a></div></div>
<div class="ttc" id="classNavEKF_html_a6d310b4b28cd5ab824db834feadc83ff"><div class="ttname"><a href="classNavEKF.html#a6d310b4b28cd5ab824db834feadc83ff">NavEKF::readAirSpdData</a></div><div class="ttdeci">void readAirSpdData()</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8cpp_source.html#l04288">AP_NavEKF.cpp:4288</a></div></div>
<div class="ttc" id="classNavEKF_html_a9e55ed403e6c131329d2f9d94745c121"><div class="ttname"><a href="classNavEKF.html#a9e55ed403e6c131329d2f9d94745c121">NavEKF::rngOnGnd</a></div><div class="ttdeci">float rngOnGnd</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00739">AP_NavEKF.h:739</a></div></div>
<div class="ttc" id="classNavEKF_html_a1c47691318dde97cee97ae20a8dfac8e"><div class="ttname"><a href="classNavEKF.html#a1c47691318dde97cee97ae20a8dfac8e">NavEKF::msecMagDelay</a></div><div class="ttdeci">const uint16_t msecMagDelay</div><div class="ttdef"><b>Definition:</b> <a href="AP__NavEKF_8h_source.html#l00499">AP_NavEKF.h:499</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 22 2016 15:25:21 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
